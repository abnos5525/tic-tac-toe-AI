import{r as b,_ as Ju,a as qu,b as Zu,c as Qu,s as Is,g as Ls,u as Os,d as Fe,f as Js,e as rr,t as ri,h as qe,i as Ho,j as ze,k as pr,l as pa,P as ws,K as Vr,m as ud,n as el,o as rn,p as Oe,w as br,q as tl,R as Ot,v as Cn,C as As,x as Bi,y as ld,z as fa,A as nl,B as Kn,D as ma,E as rl,F as il,G as fr,V as cd,H as hd,I as On,J as sl,L as $e,M as Sr,N as ir,O as dd,Q as Ir,S as wi,T as pd,U as fd,W as md,X as gd,Y as al,Z as ol,$ as yd,a0 as vn,a1 as xt,a2 as xd,a3 as ul,a4 as ll,a5 as Xr,a6 as bd,a7 as Gi,a8 as Rs,a9 as cl,aa as ga,ab as hl,ac as dl,ad as Ui,ae as vd,af as wd,ag as Sd,ah as pl,ai as Td,aj as Ed,ak as Cd,al as $d,am as _d,an as ya,ao as fl,ap as Id,aq as ml,ar as Ld,as as Od,at as Xo,au as Ad,av as Rd,aw as gl,ax as kd,ay as Dd,az as Md,aA as xe,aB as Ur,aC as Yo}from"./index-DnHNV6Lb.js";var xa=b.createContext(null);function Pd(e){var r=e.children,u=e.onBatchResize,c=b.useRef(0),f=b.useRef([]),E=b.useContext(xa),C=b.useCallback(function(A,R,M){c.current+=1;var F=c.current;f.current.push({size:A,element:R,data:M}),Promise.resolve().then(function(){F===c.current&&(u==null||u(f.current),f.current=[])}),E==null||E(A,R,M)},[u,E]);return b.createElement(xa.Provider,{value:C},r)}var yl=function(){if(typeof Map<"u")return Map;function e(r,u){var c=-1;return r.some(function(f,E){return f[0]===u?(c=E,!0):!1}),c}return function(){function r(){this.__entries__=[]}return Object.defineProperty(r.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),r.prototype.get=function(u){var c=e(this.__entries__,u),f=this.__entries__[c];return f&&f[1]},r.prototype.set=function(u,c){var f=e(this.__entries__,u);~f?this.__entries__[f][1]=c:this.__entries__.push([u,c])},r.prototype.delete=function(u){var c=this.__entries__,f=e(c,u);~f&&c.splice(f,1)},r.prototype.has=function(u){return!!~e(this.__entries__,u)},r.prototype.clear=function(){this.__entries__.splice(0)},r.prototype.forEach=function(u,c){c===void 0&&(c=null);for(var f=0,E=this.__entries__;f<E.length;f++){var C=E[f];u.call(c,C[1],C[0])}},r}()}(),ba=typeof window<"u"&&typeof document<"u"&&window.document===document,Ss=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),zd=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(Ss):function(e){return setTimeout(function(){return e(Date.now())},1e3/60)}}(),Nd=2;function Fd(e,r){var u=!1,c=!1,f=0;function E(){u&&(u=!1,e()),c&&A()}function C(){zd(E)}function A(){var R=Date.now();if(u){if(R-f<Nd)return;c=!0}else u=!0,c=!1,setTimeout(C,r);f=R}return A}var Vd=20,jd=["top","right","bottom","left","width","height","size","weight"],Kd=typeof MutationObserver<"u",Bd=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=Fd(this.refresh.bind(this),Vd)}return e.prototype.addObserver=function(r){~this.observers_.indexOf(r)||this.observers_.push(r),this.connected_||this.connect_()},e.prototype.removeObserver=function(r){var u=this.observers_,c=u.indexOf(r);~c&&u.splice(c,1),!u.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){var r=this.updateObservers_();r&&this.refresh()},e.prototype.updateObservers_=function(){var r=this.observers_.filter(function(u){return u.gatherActive(),u.hasActive()});return r.forEach(function(u){return u.broadcastActive()}),r.length>0},e.prototype.connect_=function(){!ba||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),Kd?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){!ba||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(r){var u=r.propertyName,c=u===void 0?"":u,f=jd.some(function(E){return!!~c.indexOf(E)});f&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),xl=function(e,r){for(var u=0,c=Object.keys(r);u<c.length;u++){var f=c[u];Object.defineProperty(e,f,{value:r[f],enumerable:!1,writable:!1,configurable:!0})}return e},bi=function(e){var r=e&&e.ownerDocument&&e.ownerDocument.defaultView;return r||Ss},bl=ks(0,0,0,0);function Ts(e){return parseFloat(e)||0}function Jo(e){for(var r=[],u=1;u<arguments.length;u++)r[u-1]=arguments[u];return r.reduce(function(c,f){var E=e["border-"+f+"-width"];return c+Ts(E)},0)}function Gd(e){for(var r=["top","right","bottom","left"],u={},c=0,f=r;c<f.length;c++){var E=f[c],C=e["padding-"+E];u[E]=Ts(C)}return u}function Ud(e){var r=e.getBBox();return ks(0,0,r.width,r.height)}function Wd(e){var r=e.clientWidth,u=e.clientHeight;if(!r&&!u)return bl;var c=bi(e).getComputedStyle(e),f=Gd(c),E=f.left+f.right,C=f.top+f.bottom,A=Ts(c.width),R=Ts(c.height);if(c.boxSizing==="border-box"&&(Math.round(A+E)!==r&&(A-=Jo(c,"left","right")+E),Math.round(R+C)!==u&&(R-=Jo(c,"top","bottom")+C)),!Xd(e)){var M=Math.round(A+E)-r,F=Math.round(R+C)-u;Math.abs(M)!==1&&(A-=M),Math.abs(F)!==1&&(R-=F)}return ks(f.left,f.top,A,R)}var Hd=function(){return typeof SVGGraphicsElement<"u"?function(e){return e instanceof bi(e).SVGGraphicsElement}:function(e){return e instanceof bi(e).SVGElement&&typeof e.getBBox=="function"}}();function Xd(e){return e===bi(e).document.documentElement}function Yd(e){return ba?Hd(e)?Ud(e):Wd(e):bl}function Jd(e){var r=e.x,u=e.y,c=e.width,f=e.height,E=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,C=Object.create(E.prototype);return xl(C,{x:r,y:u,width:c,height:f,top:u,right:r+c,bottom:f+u,left:r}),C}function ks(e,r,u,c){return{x:e,y:r,width:u,height:c}}var qd=function(){function e(r){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=ks(0,0,0,0),this.target=r}return e.prototype.isActive=function(){var r=Yd(this.target);return this.contentRect_=r,r.width!==this.broadcastWidth||r.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var r=this.contentRect_;return this.broadcastWidth=r.width,this.broadcastHeight=r.height,r},e}(),Zd=function(){function e(r,u){var c=Jd(u);xl(this,{target:r,contentRect:c})}return e}(),Qd=function(){function e(r,u,c){if(this.activeObservations_=[],this.observations_=new yl,typeof r!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=r,this.controller_=u,this.callbackCtx_=c}return e.prototype.observe=function(r){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(r instanceof bi(r).Element))throw new TypeError('parameter 1 is not of type "Element".');var u=this.observations_;u.has(r)||(u.set(r,new qd(r)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(r){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(r instanceof bi(r).Element))throw new TypeError('parameter 1 is not of type "Element".');var u=this.observations_;u.has(r)&&(u.delete(r),u.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var r=this;this.clearActive(),this.observations_.forEach(function(u){u.isActive()&&r.activeObservations_.push(u)})},e.prototype.broadcastActive=function(){if(this.hasActive()){var r=this.callbackCtx_,u=this.activeObservations_.map(function(c){return new Zd(c.target,c.broadcastRect())});this.callback_.call(r,u,r),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),vl=typeof WeakMap<"u"?new WeakMap:new yl,wl=function(){function e(r){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var u=Bd.getInstance(),c=new Qd(r,u,this);vl.set(this,c)}return e}();["observe","unobserve","disconnect"].forEach(function(e){wl.prototype[e]=function(){var r;return(r=vl.get(this))[e].apply(r,arguments)}});var ep=function(){return typeof Ss.ResizeObserver<"u"?Ss.ResizeObserver:wl}(),Wr=new Map;function tp(e){e.forEach(function(r){var u,c=r.target;(u=Wr.get(c))===null||u===void 0||u.forEach(function(f){return f(c)})})}var Sl=new ep(tp);function np(e,r){Wr.has(e)||(Wr.set(e,new Set),Sl.observe(e)),Wr.get(e).add(r)}function rp(e,r){Wr.has(e)&&(Wr.get(e).delete(r),Wr.get(e).size||(Sl.unobserve(e),Wr.delete(e)))}var ip=function(e){Ju(u,e);var r=qu(u);function u(){return Zu(this,u),r.apply(this,arguments)}return Qu(u,[{key:"render",value:function(){return this.props.children}}]),u}(b.Component);function sp(e,r){var u=e.children,c=e.disabled,f=b.useRef(null),E=b.useRef(null),C=b.useContext(xa),A=typeof u=="function",R=A?u(f):u,M=b.useRef({width:-1,height:-1,offsetWidth:-1,offsetHeight:-1}),F=!A&&b.isValidElement(R)&&Is(R),j=F?Ls(R):null,B=Os(j,f),H=function(){var G;return Js(f.current)||(f.current&&rr(f.current)==="object"?Js((G=f.current)===null||G===void 0?void 0:G.nativeElement):null)||Js(E.current)};b.useImperativeHandle(r,function(){return H()});var q=b.useRef(e);q.current=e;var W=b.useCallback(function(J){var G=q.current,Y=G.onResize,Z=G.data,X=J.getBoundingClientRect(),ne=X.width,Q=X.height,te=J.offsetWidth,se=J.offsetHeight,le=Math.floor(ne),ie=Math.floor(Q);if(M.current.width!==le||M.current.height!==ie||M.current.offsetWidth!==te||M.current.offsetHeight!==se){var pe={width:le,height:ie,offsetWidth:te,offsetHeight:se};M.current=pe;var ve=te===Math.round(ne)?ne:te,de=se===Math.round(Q)?Q:se,me=Fe(Fe({},pe),{},{offsetWidth:ve,offsetHeight:de});C==null||C(me,J,Z),Y&&Promise.resolve().then(function(){Y(me,J)})}},[]);return b.useEffect(function(){var J=H();return J&&!c&&np(J,W),function(){return rp(J,W)}},[f.current,c]),b.createElement(ip,{ref:E},F?b.cloneElement(R,{ref:B}):R)}var ap=b.forwardRef(sp),op="rc-observer-key";function up(e,r){var u=e.children,c=typeof u=="function"?[u]:ri(u);return c.map(function(f,E){var C=(f==null?void 0:f.key)||"".concat(op,"-").concat(E);return b.createElement(ap,qe({},e,{key:C,ref:E===0?r:void 0}),f)})}var _r=b.forwardRef(up);_r.Collection=Pd;function qs(e){return e!==void 0}function vr(e,r){var u=r||{},c=u.defaultValue,f=u.value,E=u.onChange,C=u.postState,A=Ho(function(){return qs(f)?f:qs(c)?typeof c=="function"?c():c:typeof e=="function"?e():e}),R=ze(A,2),M=R[0],F=R[1],j=f!==void 0?f:M,B=C?C(j):j,H=pr(E),q=Ho([j]),W=ze(q,2),J=W[0],G=W[1];pa(function(){var Z=J[0];M!==Z&&H(M,Z)},[J]),pa(function(){qs(f)||F(f)},[f]);var Y=pr(function(Z,X){F(Z,X),G([j],X)});return[B,Y]}function Tl(e,r){return ws.reduce((u,c)=>{const f=e[`${c}1`],E=e[`${c}3`],C=e[`${c}6`],A=e[`${c}7`];return Object.assign(Object.assign({},u),r(c,{lightColor:f,lightBorderColor:E,darkColor:C,textColor:A}))},{})}const lp=new Vr("antSlideUpIn",{"0%":{transform:"scaleY(0.8)",transformOrigin:"0% 0%",opacity:0},"100%":{transform:"scaleY(1)",transformOrigin:"0% 0%",opacity:1}}),cp=new Vr("antSlideUpOut",{"0%":{transform:"scaleY(1)",transformOrigin:"0% 0%",opacity:1},"100%":{transform:"scaleY(0.8)",transformOrigin:"0% 0%",opacity:0}}),hp=new Vr("antSlideDownIn",{"0%":{transform:"scaleY(0.8)",transformOrigin:"100% 100%",opacity:0},"100%":{transform:"scaleY(1)",transformOrigin:"100% 100%",opacity:1}}),dp=new Vr("antSlideDownOut",{"0%":{transform:"scaleY(1)",transformOrigin:"100% 100%",opacity:1},"100%":{transform:"scaleY(0.8)",transformOrigin:"100% 100%",opacity:0}}),pp=new Vr("antSlideLeftIn",{"0%":{transform:"scaleX(0.8)",transformOrigin:"0% 0%",opacity:0},"100%":{transform:"scaleX(1)",transformOrigin:"0% 0%",opacity:1}}),fp=new Vr("antSlideLeftOut",{"0%":{transform:"scaleX(1)",transformOrigin:"0% 0%",opacity:1},"100%":{transform:"scaleX(0.8)",transformOrigin:"0% 0%",opacity:0}}),mp=new Vr("antSlideRightIn",{"0%":{transform:"scaleX(0.8)",transformOrigin:"100% 0%",opacity:0},"100%":{transform:"scaleX(1)",transformOrigin:"100% 0%",opacity:1}}),gp=new Vr("antSlideRightOut",{"0%":{transform:"scaleX(1)",transformOrigin:"100% 0%",opacity:1},"100%":{transform:"scaleX(0.8)",transformOrigin:"100% 0%",opacity:0}}),yp={"slide-up":{inKeyframes:lp,outKeyframes:cp},"slide-down":{inKeyframes:hp,outKeyframes:dp},"slide-left":{inKeyframes:pp,outKeyframes:fp},"slide-right":{inKeyframes:mp,outKeyframes:gp}},qo=(e,r)=>{const{antCls:u}=e,c=`${u}-${r}`,{inKeyframes:f,outKeyframes:E}=yp[r];return[ud(c,f,E,e.motionDurationMid),{[`
      ${c}-enter,
      ${c}-appear
    `]:{transform:"scale(0)",transformOrigin:"0% 0%",opacity:0,animationTimingFunction:e.motionEaseOutQuint,"&-prepare":{transform:"scale(1)"}},[`${c}-leave`]:{animationTimingFunction:e.motionEaseInQuint}}]};var xp=function(r){if(el()&&window.document.documentElement){var u=Array.isArray(r)?r:[r],c=window.document.documentElement;return u.some(function(f){return f in c.style})}return!1};function Zo(e,r){return xp(e)}const El=function(){if(typeof navigator>"u"||typeof window>"u")return!1;var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e==null?void 0:e.substr(0,4))};var bp=["prefixCls","invalidate","item","renderItem","responsive","responsiveDisabled","registerSize","itemKey","className","style","children","display","order","component"],hi=void 0;function vp(e,r){var u=e.prefixCls,c=e.invalidate,f=e.item,E=e.renderItem,C=e.responsive,A=e.responsiveDisabled,R=e.registerSize,M=e.itemKey,F=e.className,j=e.style,B=e.children,H=e.display,q=e.order,W=e.component,J=W===void 0?"div":W,G=rn(e,bp),Y=C&&!H;function Z(se){R(M,se)}b.useEffect(function(){return function(){Z(null)}},[]);var X=E&&f!==hi?E(f,{index:q}):B,ne;c||(ne={opacity:Y?0:1,height:Y?0:hi,overflowY:Y?"hidden":hi,order:C?q:hi,pointerEvents:Y?"none":hi,position:Y?"absolute":hi});var Q={};Y&&(Q["aria-hidden"]=!0);var te=b.createElement(J,qe({className:Oe(!c&&u,F),style:Fe(Fe({},ne),j)},Q,G,{ref:r}),X);return C&&(te=b.createElement(_r,{onResize:function(le){var ie=le.offsetWidth;Z(ie)},disabled:A},te)),te}var Fi=b.forwardRef(vp);Fi.displayName="Item";function wp(e){if(typeof MessageChannel>"u")br(e);else{var r=new MessageChannel;r.port1.onmessage=function(){return e()},r.port2.postMessage(void 0)}}function Sp(){var e=b.useRef(null),r=function(c){e.current||(e.current=[],wp(function(){tl.unstable_batchedUpdates(function(){e.current.forEach(function(f){f()}),e.current=null})})),e.current.push(c)};return r}function Oi(e,r){var u=b.useState(r),c=ze(u,2),f=c[0],E=c[1],C=pr(function(A){e(function(){E(A)})});return[f,C]}var Es=Ot.createContext(null),Tp=["component"],Ep=["className"],Cp=["className"],$p=function(r,u){var c=b.useContext(Es);if(!c){var f=r.component,E=f===void 0?"div":f,C=rn(r,Tp);return b.createElement(E,qe({},C,{ref:u}))}var A=c.className,R=rn(c,Ep),M=r.className,F=rn(r,Cp);return b.createElement(Es.Provider,{value:null},b.createElement(Fi,qe({ref:u,className:Oe(A,M)},R,F)))},Cl=b.forwardRef($p);Cl.displayName="RawItem";var _p=["prefixCls","data","renderItem","renderRawItem","itemKey","itemWidth","ssr","style","className","maxCount","renderRest","renderRawRest","suffix","component","itemComponent","onVisibleChange"],$l="responsive",_l="invalidate";function Ip(e){return"+ ".concat(e.length," ...")}function Lp(e,r){var u=e.prefixCls,c=u===void 0?"rc-overflow":u,f=e.data,E=f===void 0?[]:f,C=e.renderItem,A=e.renderRawItem,R=e.itemKey,M=e.itemWidth,F=M===void 0?10:M,j=e.ssr,B=e.style,H=e.className,q=e.maxCount,W=e.renderRest,J=e.renderRawRest,G=e.suffix,Y=e.component,Z=Y===void 0?"div":Y,X=e.itemComponent,ne=e.onVisibleChange,Q=rn(e,_p),te=j==="full",se=Sp(),le=Oi(se,null),ie=ze(le,2),pe=ie[0],ve=ie[1],de=pe||0,me=Oi(se,new Map),Ee=ze(me,2),ye=Ee[0],Ce=Ee[1],oe=Oi(se,0),ae=ze(oe,2),be=ae[0],Le=ae[1],Ie=Oi(se,0),Ae=ze(Ie,2),Se=Ae[0],ke=Ae[1],Me=Oi(se,0),De=ze(Me,2),Ke=De[0],Ve=De[1],at=b.useState(null),Ze=ze(at,2),Qe=Ze[0],yt=Ze[1],ge=b.useState(null),Ge=ze(ge,2),We=Ge[0],we=Ge[1],ot=b.useMemo(function(){return We===null&&te?Number.MAX_SAFE_INTEGER:We||0},[We,pe]),et=b.useState(!1),Tt=ze(et,2),ut=Tt[0],Ut=Tt[1],Ft="".concat(c,"-item"),vt=Math.max(be,Se),on=q===$l,ht=E.length&&on,pn=q===_l,Wt=ht||typeof q=="number"&&E.length>q,wt=b.useMemo(function(){var nt=E;return ht?pe===null&&te?nt=E:nt=E.slice(0,Math.min(E.length,de/F)):typeof q=="number"&&(nt=E.slice(0,q)),nt},[E,F,pe,q,ht]),Kt=b.useMemo(function(){return ht?E.slice(ot+1):E.slice(wt.length)},[E,wt,ht,ot]),Et=b.useCallback(function(nt,rt){var Xe;return typeof R=="function"?R(nt):(Xe=R&&(nt==null?void 0:nt[R]))!==null&&Xe!==void 0?Xe:rt},[R]),kt=b.useCallback(C||function(nt){return nt},[C]);function dt(nt,rt,Xe){We===nt&&(rt===void 0||rt===Qe)||(we(nt),Xe||(Ut(nt<E.length-1),ne==null||ne(nt)),rt!==void 0&&yt(rt))}function Be(nt,rt){ve(rt.clientWidth)}function Ct(nt,rt){Ce(function(Xe){var Lt=new Map(Xe);return rt===null?Lt.delete(nt):Lt.set(nt,rt),Lt})}function Ne(nt,rt){ke(rt),Le(Se)}function He(nt,rt){Ve(rt)}function qt(nt){return ye.get(Et(wt[nt],nt))}Cn(function(){if(de&&typeof vt=="number"&&wt){var nt=Ke,rt=wt.length,Xe=rt-1;if(!rt){dt(0,null);return}for(var Lt=0;Lt<rt;Lt+=1){var Yt=qt(Lt);if(te&&(Yt=Yt||0),Yt===void 0){dt(Lt-1,void 0,!0);break}if(nt+=Yt,Xe===0&&nt<=de||Lt===Xe-1&&nt+qt(Xe)<=de){dt(Xe,null);break}else if(nt+vt>de){dt(Lt-1,nt-Yt-Ke+Se);break}}G&&qt(0)+Ke>de&&yt(null)}},[de,ye,Se,Ke,Et,wt]);var Pn=ut&&!!Kt.length,An={};Qe!==null&&ht&&(An={position:"absolute",left:Qe,top:0});var Xt={prefixCls:Ft,responsive:ht,component:X,invalidate:pn},sr=A?function(nt,rt){var Xe=Et(nt,rt);return b.createElement(Es.Provider,{key:Xe,value:Fe(Fe({},Xt),{},{order:rt,item:nt,itemKey:Xe,registerSize:Ct,display:rt<=ot})},A(nt,rt))}:function(nt,rt){var Xe=Et(nt,rt);return b.createElement(Fi,qe({},Xt,{order:rt,key:Xe,item:nt,renderItem:kt,itemKey:Xe,registerSize:Ct,display:rt<=ot}))},Bt={order:Pn?ot:Number.MAX_SAFE_INTEGER,className:"".concat(Ft,"-rest"),registerSize:Ne,display:Pn},en=W||Ip,zt=J?b.createElement(Es.Provider,{value:Fe(Fe({},Xt),Bt)},J(Kt)):b.createElement(Fi,qe({},Xt,Bt),typeof en=="function"?en(Kt):en),Vt=b.createElement(Z,qe({className:Oe(!pn&&c,H),style:B,ref:r},Q),wt.map(sr),Wt?zt:null,G&&b.createElement(Fi,qe({},Xt,{responsive:on,responsiveDisabled:!ht,order:ot,className:"".concat(Ft,"-suffix"),registerSize:He,display:!0,style:An}),G));return on?b.createElement(_r,{onResize:Be,disabled:!ht},Vt):Vt}var Fr=b.forwardRef(Lp);Fr.displayName="Overflow";Fr.Item=Cl;Fr.RESPONSIVE=$l;Fr.INVALIDATE=_l;function Op(e){var r=e.prefixCls,u=e.align,c=e.arrow,f=e.arrowPos,E=c||{},C=E.className,A=E.content,R=f.x,M=R===void 0?0:R,F=f.y,j=F===void 0?0:F,B=b.useRef();if(!u||!u.points)return null;var H={position:"absolute"};if(u.autoArrow!==!1){var q=u.points[0],W=u.points[1],J=q[0],G=q[1],Y=W[0],Z=W[1];J===Y||!["t","b"].includes(J)?H.top=j:J==="t"?H.top=0:H.bottom=0,G===Z||!["l","r"].includes(G)?H.left=M:G==="l"?H.left=0:H.right=0}return b.createElement("div",{ref:B,className:Oe("".concat(r,"-arrow"),C),style:H},A)}function Ap(e){var r=e.prefixCls,u=e.open,c=e.zIndex,f=e.mask,E=e.motion;return f?b.createElement(As,qe({},E,{motionAppear:!0,visible:u,removeOnLeave:!0}),function(C){var A=C.className;return b.createElement("div",{style:{zIndex:c},className:Oe("".concat(r,"-mask"),A)})}):null}var Rp=b.memo(function(e){var r=e.children;return r},function(e,r){return r.cache}),kp=b.forwardRef(function(e,r){var u=e.popup,c=e.className,f=e.prefixCls,E=e.style,C=e.target,A=e.onVisibleChanged,R=e.open,M=e.keepDom,F=e.fresh,j=e.onClick,B=e.mask,H=e.arrow,q=e.arrowPos,W=e.align,J=e.motion,G=e.maskMotion,Y=e.forceRender,Z=e.getPopupContainer,X=e.autoDestroy,ne=e.portal,Q=e.zIndex,te=e.onMouseEnter,se=e.onMouseLeave,le=e.onPointerEnter,ie=e.onPointerDownCapture,pe=e.ready,ve=e.offsetX,de=e.offsetY,me=e.offsetR,Ee=e.offsetB,ye=e.onAlign,Ce=e.onPrepare,oe=e.stretch,ae=e.targetWidth,be=e.targetHeight,Le=typeof u=="function"?u():u,Ie=R||M,Ae=(Z==null?void 0:Z.length)>0,Se=b.useState(!Z||!Ae),ke=ze(Se,2),Me=ke[0],De=ke[1];if(Cn(function(){!Me&&Ae&&C&&De(!0)},[Me,Ae,C]),!Me)return null;var Ke="auto",Ve={left:"-1000vw",top:"-1000vh",right:Ke,bottom:Ke};if(pe||!R){var at,Ze=W.points,Qe=W.dynamicInset||((at=W._experimental)===null||at===void 0?void 0:at.dynamicInset),yt=Qe&&Ze[0][1]==="r",ge=Qe&&Ze[0][0]==="b";yt?(Ve.right=me,Ve.left=Ke):(Ve.left=ve,Ve.right=Ke),ge?(Ve.bottom=Ee,Ve.top=Ke):(Ve.top=de,Ve.bottom=Ke)}var Ge={};return oe&&(oe.includes("height")&&be?Ge.height=be:oe.includes("minHeight")&&be&&(Ge.minHeight=be),oe.includes("width")&&ae?Ge.width=ae:oe.includes("minWidth")&&ae&&(Ge.minWidth=ae)),R||(Ge.pointerEvents="none"),b.createElement(ne,{open:Y||Ie,getContainer:Z&&function(){return Z(C)},autoDestroy:X},b.createElement(Ap,{prefixCls:f,open:R,zIndex:Q,mask:B,motion:G}),b.createElement(_r,{onResize:ye,disabled:!R},function(We){return b.createElement(As,qe({motionAppear:!0,motionEnter:!0,motionLeave:!0,removeOnLeave:!1,forceRender:Y,leavedClassName:"".concat(f,"-hidden")},J,{onAppearPrepare:Ce,onEnterPrepare:Ce,visible:R,onVisibleChanged:function(ot){var et;J==null||(et=J.onVisibleChanged)===null||et===void 0||et.call(J,ot),A(ot)}}),function(we,ot){var et=we.className,Tt=we.style,ut=Oe(f,et,c);return b.createElement("div",{ref:Bi(We,r,ot),className:ut,style:Fe(Fe(Fe(Fe({"--arrow-x":"".concat(q.x||0,"px"),"--arrow-y":"".concat(q.y||0,"px")},Ve),Ge),Tt),{},{boxSizing:"border-box",zIndex:Q},E),onMouseEnter:te,onMouseLeave:se,onPointerEnter:le,onClick:j,onPointerDownCapture:ie},H&&b.createElement(Op,{prefixCls:f,arrow:H,arrowPos:q,align:W}),b.createElement(Rp,{cache:!R&&!F},Le))})}))}),Dp=b.forwardRef(function(e,r){var u=e.children,c=e.getTriggerDOMNode,f=Is(u),E=b.useCallback(function(A){ld(r,c?c(A):A)},[c]),C=Os(E,Ls(u));return f?b.cloneElement(u,{ref:C}):u}),Qo=b.createContext(null);function eu(e){return e?Array.isArray(e)?e:[e]:[]}function Mp(e,r,u,c){return b.useMemo(function(){var f=eu(u??r),E=eu(c??r),C=new Set(f),A=new Set(E);return e&&(C.has("hover")&&(C.delete("hover"),C.add("click")),A.has("hover")&&(A.delete("hover"),A.add("click"))),[C,A]},[e,r,u,c])}function Pp(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],u=arguments.length>2?arguments[2]:void 0;return u?e[0]===r[0]:e[0]===r[0]&&e[1]===r[1]}function zp(e,r,u,c){for(var f=u.points,E=Object.keys(e),C=0;C<E.length;C+=1){var A,R=E[C];if(Pp((A=e[R])===null||A===void 0?void 0:A.points,f,c))return"".concat(r,"-placement-").concat(R)}return""}function tu(e,r,u,c){return r||(u?{motionName:"".concat(e,"-").concat(u)}:c?{motionName:c}:null)}function Wi(e){return e.ownerDocument.defaultView}function va(e){for(var r=[],u=e==null?void 0:e.parentElement,c=["hidden","scroll","clip","auto"];u;){var f=Wi(u).getComputedStyle(u),E=f.overflowX,C=f.overflowY,A=f.overflow;[E,C,A].some(function(R){return c.includes(R)})&&r.push(u),u=u.parentElement}return r}function Vi(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return Number.isNaN(e)?r:e}function Ai(e){return Vi(parseFloat(e),0)}function nu(e,r){var u=Fe({},e);return(r||[]).forEach(function(c){if(!(c instanceof HTMLBodyElement||c instanceof HTMLHtmlElement)){var f=Wi(c).getComputedStyle(c),E=f.overflow,C=f.overflowClipMargin,A=f.borderTopWidth,R=f.borderBottomWidth,M=f.borderLeftWidth,F=f.borderRightWidth,j=c.getBoundingClientRect(),B=c.offsetHeight,H=c.clientHeight,q=c.offsetWidth,W=c.clientWidth,J=Ai(A),G=Ai(R),Y=Ai(M),Z=Ai(F),X=Vi(Math.round(j.width/q*1e3)/1e3),ne=Vi(Math.round(j.height/B*1e3)/1e3),Q=(q-W-Y-Z)*X,te=(B-H-J-G)*ne,se=J*ne,le=G*ne,ie=Y*X,pe=Z*X,ve=0,de=0;if(E==="clip"){var me=Ai(C);ve=me*X,de=me*ne}var Ee=j.x+ie-ve,ye=j.y+se-de,Ce=Ee+j.width+2*ve-ie-pe-Q,oe=ye+j.height+2*de-se-le-te;u.left=Math.max(u.left,Ee),u.top=Math.max(u.top,ye),u.right=Math.min(u.right,Ce),u.bottom=Math.min(u.bottom,oe)}}),u}function ru(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,u="".concat(r),c=u.match(/^(.*)\%$/);return c?e*(parseFloat(c[1])/100):parseFloat(u)}function iu(e,r){var u=r||[],c=ze(u,2),f=c[0],E=c[1];return[ru(e.width,f),ru(e.height,E)]}function su(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return[e[0],e[1]]}function di(e,r){var u=r[0],c=r[1],f,E;return u==="t"?E=e.y:u==="b"?E=e.y+e.height:E=e.y+e.height/2,c==="l"?f=e.x:c==="r"?f=e.x+e.width:f=e.x+e.width/2,{x:f,y:E}}function Gr(e,r){var u={t:"b",b:"t",l:"r",r:"l"};return e.map(function(c,f){return f===r?u[c]||"c":c}).join("")}function Np(e,r,u,c,f,E,C){var A=b.useState({ready:!1,offsetX:0,offsetY:0,offsetR:0,offsetB:0,arrowX:0,arrowY:0,scaleX:1,scaleY:1,align:f[c]||{}}),R=ze(A,2),M=R[0],F=R[1],j=b.useRef(0),B=b.useMemo(function(){return r?va(r):[]},[r]),H=b.useRef({}),q=function(){H.current={}};e||q();var W=pr(function(){if(r&&u&&e){let Fn=function(Zr,yr){var Rr=arguments.length>2&&arguments[2]!==void 0?arguments[2]:on,ii=Ie.x+Zr,si=Ie.y+yr,Ti=ii+ge,ai=si+yt,Ue=Math.max(ii,Rr.left),pt=Math.max(si,Rr.top),an=Math.min(Ti,Rr.right),hn=Math.min(ai,Rr.bottom);return Math.max(0,(an-Ue)*(hn-pt))},Ar=function(){Xn=Ie.y+Lt,zn=Xn+yt,Rn=Ie.x+Xe,_n=Rn+ge};var Y,Z,X,ne,Q=r,te=Q.ownerDocument,se=Wi(Q),le=se.getComputedStyle(Q),ie=le.position,pe=Q.style.left,ve=Q.style.top,de=Q.style.right,me=Q.style.bottom,Ee=Q.style.overflow,ye=Fe(Fe({},f[c]),E),Ce=te.createElement("div");(Y=Q.parentElement)===null||Y===void 0||Y.appendChild(Ce),Ce.style.left="".concat(Q.offsetLeft,"px"),Ce.style.top="".concat(Q.offsetTop,"px"),Ce.style.position=ie,Ce.style.height="".concat(Q.offsetHeight,"px"),Ce.style.width="".concat(Q.offsetWidth,"px"),Q.style.left="0",Q.style.top="0",Q.style.right="auto",Q.style.bottom="auto",Q.style.overflow="hidden";var oe;if(Array.isArray(u))oe={x:u[0],y:u[1],width:0,height:0};else{var ae,be,Le=u.getBoundingClientRect();Le.x=(ae=Le.x)!==null&&ae!==void 0?ae:Le.left,Le.y=(be=Le.y)!==null&&be!==void 0?be:Le.top,oe={x:Le.x,y:Le.y,width:Le.width,height:Le.height}}var Ie=Q.getBoundingClientRect(),Ae=se.getComputedStyle(Q),Se=Ae.height,ke=Ae.width;Ie.x=(Z=Ie.x)!==null&&Z!==void 0?Z:Ie.left,Ie.y=(X=Ie.y)!==null&&X!==void 0?X:Ie.top;var Me=te.documentElement,De=Me.clientWidth,Ke=Me.clientHeight,Ve=Me.scrollWidth,at=Me.scrollHeight,Ze=Me.scrollTop,Qe=Me.scrollLeft,yt=Ie.height,ge=Ie.width,Ge=oe.height,We=oe.width,we={left:0,top:0,right:De,bottom:Ke},ot={left:-Qe,top:-Ze,right:Ve-Qe,bottom:at-Ze},et=ye.htmlRegion,Tt="visible",ut="visibleFirst";et!=="scroll"&&et!==ut&&(et=Tt);var Ut=et===ut,Ft=nu(ot,B),vt=nu(we,B),on=et===Tt?vt:Ft,ht=Ut?vt:on;Q.style.left="auto",Q.style.top="auto",Q.style.right="0",Q.style.bottom="0";var pn=Q.getBoundingClientRect();Q.style.left=pe,Q.style.top=ve,Q.style.right=de,Q.style.bottom=me,Q.style.overflow=Ee,(ne=Q.parentElement)===null||ne===void 0||ne.removeChild(Ce);var Wt=Vi(Math.round(ge/parseFloat(ke)*1e3)/1e3),wt=Vi(Math.round(yt/parseFloat(Se)*1e3)/1e3);if(Wt===0||wt===0||fa(u)&&!nl(u))return;var Kt=ye.offset,Et=ye.targetOffset,kt=iu(Ie,Kt),dt=ze(kt,2),Be=dt[0],Ct=dt[1],Ne=iu(oe,Et),He=ze(Ne,2),qt=He[0],Pn=He[1];oe.x-=qt,oe.y-=Pn;var An=ye.points||[],Xt=ze(An,2),sr=Xt[0],Bt=Xt[1],en=su(Bt),zt=su(sr),Vt=di(oe,en),nt=di(Ie,zt),rt=Fe({},ye),Xe=Vt.x-nt.x+Be,Lt=Vt.y-nt.y+Ct,Yt=Fn(Xe,Lt),cn=Fn(Xe,Lt,vt),$n=di(oe,["t","l"]),Bn=di(Ie,["t","l"]),Wn=di(oe,["b","r"]),yn=di(Ie,["b","r"]),xn=ye.overflow||{},Lr=xn.adjustX,ar=xn.adjustY,wn=xn.shiftX,Hn=xn.shiftY,mr=function(yr){return typeof yr=="boolean"?yr:yr>=0},Xn,zn,Rn,_n;Ar();var Qn=mr(ar),fn=zt[0]===en[0];if(Qn&&zt[0]==="t"&&(zn>ht.bottom||H.current.bt)){var Yn=Lt;fn?Yn-=yt-Ge:Yn=$n.y-yn.y-Ct;var Pt=Fn(Xe,Yn),Je=Fn(Xe,Yn,vt);Pt>Yt||Pt===Yt&&(!Ut||Je>=cn)?(H.current.bt=!0,Lt=Yn,Ct=-Ct,rt.points=[Gr(zt,0),Gr(en,0)]):H.current.bt=!1}if(Qn&&zt[0]==="b"&&(Xn<ht.top||H.current.tb)){var $t=Lt;fn?$t+=yt-Ge:$t=Wn.y-Bn.y-Ct;var Ht=Fn(Xe,$t),kn=Fn(Xe,$t,vt);Ht>Yt||Ht===Yt&&(!Ut||kn>=cn)?(H.current.tb=!0,Lt=$t,Ct=-Ct,rt.points=[Gr(zt,0),Gr(en,0)]):H.current.tb=!1}var bn=mr(Lr),Dn=zt[1]===en[1];if(bn&&zt[1]==="l"&&(_n>ht.right||H.current.rl)){var sn=Xe;Dn?sn-=ge-We:sn=$n.x-yn.x-Be;var In=Fn(sn,Lt),Nn=Fn(sn,Lt,vt);In>Yt||In===Yt&&(!Ut||Nn>=cn)?(H.current.rl=!0,Xe=sn,Be=-Be,rt.points=[Gr(zt,1),Gr(en,1)]):H.current.rl=!1}if(bn&&zt[1]==="r"&&(Rn<ht.left||H.current.lr)){var Jn=Xe;Dn?Jn+=ge-We:Jn=Wn.x-Bn.x-Be;var Gt=Fn(Jn,Lt),er=Fn(Jn,Lt,vt);Gt>Yt||Gt===Yt&&(!Ut||er>=cn)?(H.current.lr=!0,Xe=Jn,Be=-Be,rt.points=[Gr(zt,1),Gr(en,1)]):H.current.lr=!1}Ar();var Mn=wn===!0?0:wn;typeof Mn=="number"&&(Rn<vt.left&&(Xe-=Rn-vt.left-Be,oe.x+We<vt.left+Mn&&(Xe+=oe.x-vt.left+We-Mn)),_n>vt.right&&(Xe-=_n-vt.right-Be,oe.x>vt.right-Mn&&(Xe+=oe.x-vt.right+Mn)));var jt=Hn===!0?0:Hn;typeof jt=="number"&&(Xn<vt.top&&(Lt-=Xn-vt.top-Ct,oe.y+Ge<vt.top+jt&&(Lt+=oe.y-vt.top+Ge-jt)),zn>vt.bottom&&(Lt-=zn-vt.bottom-Ct,oe.y>vt.bottom-jt&&(Lt+=oe.y-vt.bottom+jt)));var or=Ie.x+Xe,ur=or+ge,Or=Ie.y+Lt,tn=Or+yt,tt=oe.x,Jt=tt+We,Sn=oe.y,Ln=Sn+Ge,Tr=Math.max(or,tt),gr=Math.min(ur,Jt),qn=(Tr+gr)/2,jr=qn-or,Er=Math.max(Or,Sn),lr=Math.min(tn,Ln),Cr=(Er+lr)/2,Jr=Cr-Or;C==null||C(r,rt);var cr=pn.right-Ie.x-(Xe+Ie.width),qr=pn.bottom-Ie.y-(Lt+Ie.height);Wt===1&&(Xe=Math.round(Xe),cr=Math.round(cr)),wt===1&&(Lt=Math.round(Lt),qr=Math.round(qr));var Si={ready:!0,offsetX:Xe/Wt,offsetY:Lt/wt,offsetR:cr/Wt,offsetB:qr/wt,arrowX:jr/Wt,arrowY:Jr/wt,scaleX:Wt,scaleY:wt,align:rt};F(Si)}}),J=function(){j.current+=1;var Z=j.current;Promise.resolve().then(function(){j.current===Z&&W()})},G=function(){F(function(Z){return Fe(Fe({},Z),{},{ready:!1})})};return Cn(G,[c]),Cn(function(){e||G()},[e]),[M.ready,M.offsetX,M.offsetY,M.offsetR,M.offsetB,M.arrowX,M.arrowY,M.scaleX,M.scaleY,M.align,J]}function Fp(e,r,u,c,f){Cn(function(){if(e&&r&&u){let j=function(){c(),f()};var E=r,C=u,A=va(E),R=va(C),M=Wi(C),F=new Set([M].concat(Kn(A),Kn(R)));return F.forEach(function(B){B.addEventListener("scroll",j,{passive:!0})}),M.addEventListener("resize",j,{passive:!0}),c(),function(){F.forEach(function(B){B.removeEventListener("scroll",j),M.removeEventListener("resize",j)})}}},[e,r,u])}function Vp(e,r,u,c,f,E,C,A){var R=b.useRef(e);R.current=e;var M=b.useRef(!1);b.useEffect(function(){if(r&&c&&(!f||E)){var j=function(){M.current=!1},B=function(J){var G;R.current&&!C(((G=J.composedPath)===null||G===void 0||(G=G.call(J))===null||G===void 0?void 0:G[0])||J.target)&&!M.current&&A(!1)},H=Wi(c);H.addEventListener("pointerdown",j,!0),H.addEventListener("mousedown",B,!0),H.addEventListener("contextmenu",B,!0);var q=ma(u);return q&&(q.addEventListener("mousedown",B,!0),q.addEventListener("contextmenu",B,!0)),function(){H.removeEventListener("pointerdown",j,!0),H.removeEventListener("mousedown",B,!0),H.removeEventListener("contextmenu",B,!0),q&&(q.removeEventListener("mousedown",B,!0),q.removeEventListener("contextmenu",B,!0))}}},[r,u,c,f,E]);function F(){M.current=!0}return F}var jp=["prefixCls","children","action","showAction","hideAction","popupVisible","defaultPopupVisible","onPopupVisibleChange","afterPopupVisibleChange","mouseEnterDelay","mouseLeaveDelay","focusDelay","blurDelay","mask","maskClosable","getPopupContainer","forceRender","autoDestroy","destroyPopupOnHide","popup","popupClassName","popupStyle","popupPlacement","builtinPlacements","popupAlign","zIndex","stretch","getPopupClassNameFromAlign","fresh","alignPoint","onPopupClick","onPopupAlign","arrow","popupMotion","maskMotion","popupTransitionName","popupAnimation","maskTransitionName","maskAnimation","className","getTriggerDOMNode"];function Kp(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:il,r=b.forwardRef(function(u,c){var f=u.prefixCls,E=f===void 0?"rc-trigger-popup":f,C=u.children,A=u.action,R=A===void 0?"hover":A,M=u.showAction,F=u.hideAction,j=u.popupVisible,B=u.defaultPopupVisible,H=u.onPopupVisibleChange,q=u.afterPopupVisibleChange,W=u.mouseEnterDelay,J=u.mouseLeaveDelay,G=J===void 0?.1:J,Y=u.focusDelay,Z=u.blurDelay,X=u.mask,ne=u.maskClosable,Q=ne===void 0?!0:ne,te=u.getPopupContainer,se=u.forceRender,le=u.autoDestroy,ie=u.destroyPopupOnHide,pe=u.popup,ve=u.popupClassName,de=u.popupStyle,me=u.popupPlacement,Ee=u.builtinPlacements,ye=Ee===void 0?{}:Ee,Ce=u.popupAlign,oe=u.zIndex,ae=u.stretch,be=u.getPopupClassNameFromAlign,Le=u.fresh,Ie=u.alignPoint,Ae=u.onPopupClick,Se=u.onPopupAlign,ke=u.arrow,Me=u.popupMotion,De=u.maskMotion,Ke=u.popupTransitionName,Ve=u.popupAnimation,at=u.maskTransitionName,Ze=u.maskAnimation,Qe=u.className,yt=u.getTriggerDOMNode,ge=rn(u,jp),Ge=le||ie||!1,We=b.useState(!1),we=ze(We,2),ot=we[0],et=we[1];Cn(function(){et(El())},[]);var Tt=b.useRef({}),ut=b.useContext(Qo),Ut=b.useMemo(function(){return{registerSubPopup:function(pt,an){Tt.current[pt]=an,ut==null||ut.registerSubPopup(pt,an)}}},[ut]),Ft=rl(),vt=b.useState(null),on=ze(vt,2),ht=on[0],pn=on[1],Wt=b.useRef(null),wt=pr(function(Ue){Wt.current=Ue,fa(Ue)&&ht!==Ue&&pn(Ue),ut==null||ut.registerSubPopup(Ft,Ue)}),Kt=b.useState(null),Et=ze(Kt,2),kt=Et[0],dt=Et[1],Be=b.useRef(null),Ct=pr(function(Ue){fa(Ue)&&kt!==Ue&&(dt(Ue),Be.current=Ue)}),Ne=b.Children.only(C),He=(Ne==null?void 0:Ne.props)||{},qt={},Pn=pr(function(Ue){var pt,an,hn=kt;return(hn==null?void 0:hn.contains(Ue))||((pt=ma(hn))===null||pt===void 0?void 0:pt.host)===Ue||Ue===hn||(ht==null?void 0:ht.contains(Ue))||((an=ma(ht))===null||an===void 0?void 0:an.host)===Ue||Ue===ht||Object.values(Tt.current).some(function(un){return(un==null?void 0:un.contains(Ue))||Ue===un})}),An=tu(E,Me,Ve,Ke),Xt=tu(E,De,Ze,at),sr=b.useState(B||!1),Bt=ze(sr,2),en=Bt[0],zt=Bt[1],Vt=j??en,nt=pr(function(Ue){j===void 0&&zt(Ue)});Cn(function(){zt(j||!1)},[j]);var rt=b.useRef(Vt);rt.current=Vt;var Xe=b.useRef([]);Xe.current=[];var Lt=pr(function(Ue){var pt;nt(Ue),((pt=Xe.current[Xe.current.length-1])!==null&&pt!==void 0?pt:Vt)!==Ue&&(Xe.current.push(Ue),H==null||H(Ue))}),Yt=b.useRef(),cn=function(){clearTimeout(Yt.current)},$n=function(pt){var an=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;cn(),an===0?Lt(pt):Yt.current=setTimeout(function(){Lt(pt)},an*1e3)};b.useEffect(function(){return cn},[]);var Bn=b.useState(!1),Wn=ze(Bn,2),yn=Wn[0],xn=Wn[1];Cn(function(Ue){(!Ue||Vt)&&xn(!0)},[Vt]);var Lr=b.useState(null),ar=ze(Lr,2),wn=ar[0],Hn=ar[1],mr=b.useState(null),Xn=ze(mr,2),zn=Xn[0],Rn=Xn[1],_n=function(pt){Rn([pt.clientX,pt.clientY])},Qn=Np(Vt,ht,Ie&&zn!==null?zn:kt,me,ye,Ce,Se),fn=ze(Qn,11),Yn=fn[0],Pt=fn[1],Je=fn[2],$t=fn[3],Ht=fn[4],kn=fn[5],bn=fn[6],Dn=fn[7],sn=fn[8],In=fn[9],Nn=fn[10],Jn=Mp(ot,R,M,F),Gt=ze(Jn,2),er=Gt[0],Mn=Gt[1],jt=er.has("click"),or=Mn.has("click")||Mn.has("contextMenu"),ur=pr(function(){yn||Nn()}),Or=function(){rt.current&&Ie&&or&&$n(!1)};Fp(Vt,kt,ht,ur,Or),Cn(function(){ur()},[zn,me]),Cn(function(){Vt&&!(ye!=null&&ye[me])&&ur()},[JSON.stringify(Ce)]);var tn=b.useMemo(function(){var Ue=zp(ye,E,In,Ie);return Oe(Ue,be==null?void 0:be(In))},[In,be,ye,E,Ie]);b.useImperativeHandle(c,function(){return{nativeElement:Be.current,popupElement:Wt.current,forceAlign:ur}});var tt=b.useState(0),Jt=ze(tt,2),Sn=Jt[0],Ln=Jt[1],Tr=b.useState(0),gr=ze(Tr,2),qn=gr[0],jr=gr[1],Er=function(){if(ae&&kt){var pt=kt.getBoundingClientRect();Ln(pt.width),jr(pt.height)}},lr=function(){Er(),ur()},Cr=function(pt){xn(!1),Nn(),q==null||q(pt)},Jr=function(){return new Promise(function(pt){Er(),Hn(function(){return pt})})};Cn(function(){wn&&(Nn(),wn(),Hn(null))},[wn]);function cr(Ue,pt,an,hn){qt[Ue]=function(un){var oi;hn==null||hn(un),$n(pt,an);for(var Ei=arguments.length,Ji=new Array(Ei>1?Ei-1:0),ui=1;ui<Ei;ui++)Ji[ui-1]=arguments[ui];(oi=He[Ue])===null||oi===void 0||oi.call.apply(oi,[He,un].concat(Ji))}}(jt||or)&&(qt.onClick=function(Ue){var pt;rt.current&&or?$n(!1):!rt.current&&jt&&(_n(Ue),$n(!0));for(var an=arguments.length,hn=new Array(an>1?an-1:0),un=1;un<an;un++)hn[un-1]=arguments[un];(pt=He.onClick)===null||pt===void 0||pt.call.apply(pt,[He,Ue].concat(hn))});var qr=Vp(Vt,or,kt,ht,X,Q,Pn,$n),Si=er.has("hover"),Fn=Mn.has("hover"),Ar,Zr;Si&&(cr("onMouseEnter",!0,W,function(Ue){_n(Ue)}),cr("onPointerEnter",!0,W,function(Ue){_n(Ue)}),Ar=function(pt){(Vt||yn)&&ht!==null&&ht!==void 0&&ht.contains(pt.target)&&$n(!0,W)},Ie&&(qt.onMouseMove=function(Ue){var pt;(pt=He.onMouseMove)===null||pt===void 0||pt.call(He,Ue)})),Fn&&(cr("onMouseLeave",!1,G),cr("onPointerLeave",!1,G),Zr=function(){$n(!1,G)}),er.has("focus")&&cr("onFocus",!0,Y),Mn.has("focus")&&cr("onBlur",!1,Z),er.has("contextMenu")&&(qt.onContextMenu=function(Ue){var pt;rt.current&&Mn.has("contextMenu")?$n(!1):(_n(Ue),$n(!0)),Ue.preventDefault();for(var an=arguments.length,hn=new Array(an>1?an-1:0),un=1;un<an;un++)hn[un-1]=arguments[un];(pt=He.onContextMenu)===null||pt===void 0||pt.call.apply(pt,[He,Ue].concat(hn))}),Qe&&(qt.className=Oe(He.className,Qe));var yr=Fe(Fe({},He),qt),Rr={},ii=["onContextMenu","onClick","onMouseDown","onTouchStart","onMouseEnter","onMouseLeave","onFocus","onBlur"];ii.forEach(function(Ue){ge[Ue]&&(Rr[Ue]=function(){for(var pt,an=arguments.length,hn=new Array(an),un=0;un<an;un++)hn[un]=arguments[un];(pt=yr[Ue])===null||pt===void 0||pt.call.apply(pt,[yr].concat(hn)),ge[Ue].apply(ge,hn)})});var si=b.cloneElement(Ne,Fe(Fe({},yr),Rr)),Ti={x:kn,y:bn},ai=ke?Fe({},ke!==!0?ke:{}):null;return b.createElement(b.Fragment,null,b.createElement(_r,{disabled:!Vt,ref:Ct,onResize:lr},b.createElement(Dp,{getTriggerDOMNode:yt},si)),b.createElement(Qo.Provider,{value:Ut},b.createElement(kp,{portal:e,ref:wt,prefixCls:E,popup:pe,className:Oe(ve,tn),style:de,target:kt,onMouseEnter:Ar,onMouseLeave:Zr,onPointerEnter:Ar,zIndex:oe,open:Vt,keepDom:yn,fresh:Le,onClick:Ae,onPointerDownCapture:qr,mask:X,motion:An,maskMotion:Xt,onVisibleChanged:Cr,onPrepare:Jr,forceRender:se,autoDestroy:Ge,getPopupContainer:te,align:In,arrow:ai,arrowPos:Ti,ready:Yn,offsetX:Pt,offsetY:Je,offsetR:$t,offsetB:Ht,onAlign:ur,stretch:ae,targetWidth:Sn/Dn,targetHeight:qn/sn})))});return r}const Ia=Kp(il);function Bp(e,r,u){return Oe({[`${e}-status-success`]:r==="success",[`${e}-status-warning`]:r==="warning",[`${e}-status-error`]:r==="error",[`${e}-status-validating`]:r==="validating",[`${e}-has-feedback`]:u})}const Gp=(e,r)=>r||e,Il=(e,r,u=void 0)=>{var c,f;const{variant:E,[e]:C}=b.useContext(fr),A=b.useContext(cd),R=C==null?void 0:C.variant;let M;typeof r<"u"?M=r:u===!1?M="borderless":M=(f=(c=A??R)!==null&&c!==void 0?c:E)!==null&&f!==void 0?f:"outlined";const F=hd.includes(M);return[M,F]};var Up={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5 207 474a32 32 0 00-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1.4-12.8-6.3-12.8z"}}]},name:"check",theme:"outlined"},Wp=function(r,u){return b.createElement(On,qe({},r,{ref:u,icon:Up}))},Ll=b.forwardRef(Wp);const Hp=(e,r)=>{typeof(e==null?void 0:e.addEventListener)<"u"?e.addEventListener("change",r):typeof(e==null?void 0:e.addListener)<"u"&&e.addListener(r)},Xp=(e,r)=>{typeof(e==null?void 0:e.removeEventListener)<"u"?e.removeEventListener("change",r):typeof(e==null?void 0:e.removeListener)<"u"&&e.removeListener(r)},vi=["xxl","xl","lg","md","sm","xs"],Yp=e=>({xs:`(max-width: ${e.screenXSMax}px)`,sm:`(min-width: ${e.screenSM}px)`,md:`(min-width: ${e.screenMD}px)`,lg:`(min-width: ${e.screenLG}px)`,xl:`(min-width: ${e.screenXL}px)`,xxl:`(min-width: ${e.screenXXL}px)`}),Jp=e=>{const r=e,u=[].concat(vi).reverse();return u.forEach((c,f)=>{const E=c.toUpperCase(),C=`screen${E}Min`,A=`screen${E}`;if(!(r[C]<=r[A]))throw new Error(`${C}<=${A} fails : !(${r[C]}<=${r[A]})`);if(f<u.length-1){const R=`screen${E}Max`;if(!(r[A]<=r[R]))throw new Error(`${A}<=${R} fails : !(${r[A]}<=${r[R]})`);const F=`screen${u[f+1].toUpperCase()}Min`;if(!(r[R]<=r[F]))throw new Error(`${R}<=${F} fails : !(${r[R]}<=${r[F]})`)}}),e},Ol=(e,r)=>{if(r){for(const u of vi)if(e[u]&&(r==null?void 0:r[u])!==void 0)return r[u]}},qp=()=>{const[,e]=sl(),r=Yp(Jp(e));return Ot.useMemo(()=>{const u=new Map;let c=-1,f={};return{responsiveMap:r,matchHandlers:{},dispatch(E){return f=E,u.forEach(C=>C(f)),u.size>=1},subscribe(E){return u.size||this.register(),c+=1,u.set(c,E),E(f),c},unsubscribe(E){u.delete(E),u.size||this.unregister()},register(){Object.entries(r).forEach(([E,C])=>{const A=({matches:M})=>{this.dispatch(Object.assign(Object.assign({},f),{[E]:M}))},R=window.matchMedia(C);Hp(R,A),this.matchHandlers[C]={mql:R,listener:A},A(R)})},unregister(){Object.values(r).forEach(E=>{const C=this.matchHandlers[E];Xp(C==null?void 0:C.mql,C==null?void 0:C.listener)}),u.clear()}}},[e])};function Zp(){const[,e]=b.useReducer(r=>r+1,0);return e}function Al(e=!0,r={}){const u=b.useRef(r),c=Zp(),f=qp();return Cn(()=>{const E=f.subscribe(C=>{u.current=C,e&&c()});return()=>f.unsubscribe(E)},[]),u.current}function Rl(e){var r=e.children,u=e.prefixCls,c=e.id,f=e.overlayInnerStyle,E=e.bodyClassName,C=e.className,A=e.style;return b.createElement("div",{className:Oe("".concat(u,"-content"),C),style:A},b.createElement("div",{className:Oe("".concat(u,"-inner"),E),id:c,role:"tooltip",style:f},typeof r=="function"?r():r))}var pi={shiftX:64,adjustY:1},fi={adjustX:1,shiftY:!0},dr=[0,0],Qp={left:{points:["cr","cl"],overflow:fi,offset:[-4,0],targetOffset:dr},right:{points:["cl","cr"],overflow:fi,offset:[4,0],targetOffset:dr},top:{points:["bc","tc"],overflow:pi,offset:[0,-4],targetOffset:dr},bottom:{points:["tc","bc"],overflow:pi,offset:[0,4],targetOffset:dr},topLeft:{points:["bl","tl"],overflow:pi,offset:[0,-4],targetOffset:dr},leftTop:{points:["tr","tl"],overflow:fi,offset:[-4,0],targetOffset:dr},topRight:{points:["br","tr"],overflow:pi,offset:[0,-4],targetOffset:dr},rightTop:{points:["tl","tr"],overflow:fi,offset:[4,0],targetOffset:dr},bottomRight:{points:["tr","br"],overflow:pi,offset:[0,4],targetOffset:dr},rightBottom:{points:["bl","br"],overflow:fi,offset:[4,0],targetOffset:dr},bottomLeft:{points:["tl","bl"],overflow:pi,offset:[0,4],targetOffset:dr},leftBottom:{points:["br","bl"],overflow:fi,offset:[-4,0],targetOffset:dr}},ef=["overlayClassName","trigger","mouseEnterDelay","mouseLeaveDelay","overlayStyle","prefixCls","children","onVisibleChange","afterVisibleChange","transitionName","animation","motion","placement","align","destroyTooltipOnHide","defaultVisible","getTooltipContainer","overlayInnerStyle","arrowContent","overlay","id","showArrow","classNames","styles"],tf=function(r,u){var c=r.overlayClassName,f=r.trigger,E=f===void 0?["hover"]:f,C=r.mouseEnterDelay,A=C===void 0?0:C,R=r.mouseLeaveDelay,M=R===void 0?.1:R,F=r.overlayStyle,j=r.prefixCls,B=j===void 0?"rc-tooltip":j,H=r.children,q=r.onVisibleChange,W=r.afterVisibleChange,J=r.transitionName,G=r.animation,Y=r.motion,Z=r.placement,X=Z===void 0?"right":Z,ne=r.align,Q=ne===void 0?{}:ne,te=r.destroyTooltipOnHide,se=te===void 0?!1:te,le=r.defaultVisible,ie=r.getTooltipContainer,pe=r.overlayInnerStyle;r.arrowContent;var ve=r.overlay,de=r.id,me=r.showArrow,Ee=me===void 0?!0:me,ye=r.classNames,Ce=r.styles,oe=rn(r,ef),ae=rl(de),be=b.useRef(null);b.useImperativeHandle(u,function(){return be.current});var Le=Fe({},oe);"visible"in r&&(Le.popupVisible=r.visible);var Ie=function(){return b.createElement(Rl,{key:"content",prefixCls:B,id:ae,bodyClassName:ye==null?void 0:ye.body,overlayInnerStyle:Fe(Fe({},pe),Ce==null?void 0:Ce.body)},ve)},Ae=function(){var ke=b.Children.only(H),Me=(ke==null?void 0:ke.props)||{},De=Fe(Fe({},Me),{},{"aria-describedby":ve?ae:null});return b.cloneElement(H,De)};return b.createElement(Ia,qe({popupClassName:Oe(c,ye==null?void 0:ye.root),prefixCls:B,popup:Ie,action:E,builtinPlacements:Qp,popupPlacement:X,ref:be,popupAlign:Q,getPopupContainer:ie,onPopupVisibleChange:q,afterPopupVisibleChange:W,popupTransitionName:J,popupAnimation:G,popupMotion:Y,defaultPopupVisible:le,autoDestroy:se,mouseLeaveDelay:M,popupStyle:Fe(Fe({},F),Ce==null?void 0:Ce.root),mouseEnterDelay:A,arrow:Ee},Le),Ae())};const nf=b.forwardRef(tf);function rf(e){const{sizePopupArrow:r,borderRadiusXS:u,borderRadiusOuter:c}=e,f=r/2,E=0,C=f,A=c*1/Math.sqrt(2),R=f-c*(1-1/Math.sqrt(2)),M=f-u*(1/Math.sqrt(2)),F=c*(Math.sqrt(2)-1)+u*(1/Math.sqrt(2)),j=2*f-M,B=F,H=2*f-A,q=R,W=2*f-E,J=C,G=f*Math.sqrt(2)+c*(Math.sqrt(2)-2),Y=c*(Math.sqrt(2)-1),Z=`polygon(${Y}px 100%, 50% ${Y}px, ${2*f-Y}px 100%, ${Y}px 100%)`,X=`path('M ${E} ${C} A ${c} ${c} 0 0 0 ${A} ${R} L ${M} ${F} A ${u} ${u} 0 0 1 ${j} ${B} L ${H} ${q} A ${c} ${c} 0 0 0 ${W} ${J} Z')`;return{arrowShadowWidth:G,arrowPath:X,arrowPolygon:Z}}const sf=(e,r,u)=>{const{sizePopupArrow:c,arrowPolygon:f,arrowPath:E,arrowShadowWidth:C,borderRadiusXS:A,calc:R}=e;return{pointerEvents:"none",width:c,height:c,overflow:"hidden","&::before":{position:"absolute",bottom:0,insetInlineStart:0,width:c,height:R(c).div(2).equal(),background:r,clipPath:{_multi_value_:!0,value:[f,E]},content:'""'},"&::after":{content:'""',position:"absolute",width:C,height:C,bottom:0,insetInline:0,margin:"auto",borderRadius:{_skip_check_:!0,value:`0 0 ${$e(A)} 0`},transform:"translateY(50%) rotate(-135deg)",boxShadow:u,zIndex:0,background:"transparent"}}},kl=8;function Dl(e){const{contentRadius:r,limitVerticalRadius:u}=e,c=r>12?r+2:12;return{arrowOffsetHorizontal:c,arrowOffsetVertical:u?kl:c}}function ds(e,r){return e?r:{}}function af(e,r,u){const{componentCls:c,boxShadowPopoverArrow:f,arrowOffsetVertical:E,arrowOffsetHorizontal:C}=e,{arrowDistance:A=0,arrowPlacement:R={left:!0,right:!0,top:!0,bottom:!0}}={};return{[c]:Object.assign(Object.assign(Object.assign(Object.assign({[`${c}-arrow`]:[Object.assign(Object.assign({position:"absolute",zIndex:1,display:"block"},sf(e,r,f)),{"&:before":{background:r}})]},ds(!!R.top,{[[`&-placement-top > ${c}-arrow`,`&-placement-topLeft > ${c}-arrow`,`&-placement-topRight > ${c}-arrow`].join(",")]:{bottom:A,transform:"translateY(100%) rotate(180deg)"},[`&-placement-top > ${c}-arrow`]:{left:{_skip_check_:!0,value:"50%"},transform:"translateX(-50%) translateY(100%) rotate(180deg)"},"&-placement-topLeft":{"--arrow-offset-horizontal":C,[`> ${c}-arrow`]:{left:{_skip_check_:!0,value:C}}},"&-placement-topRight":{"--arrow-offset-horizontal":`calc(100% - ${$e(C)})`,[`> ${c}-arrow`]:{right:{_skip_check_:!0,value:C}}}})),ds(!!R.bottom,{[[`&-placement-bottom > ${c}-arrow`,`&-placement-bottomLeft > ${c}-arrow`,`&-placement-bottomRight > ${c}-arrow`].join(",")]:{top:A,transform:"translateY(-100%)"},[`&-placement-bottom > ${c}-arrow`]:{left:{_skip_check_:!0,value:"50%"},transform:"translateX(-50%) translateY(-100%)"},"&-placement-bottomLeft":{"--arrow-offset-horizontal":C,[`> ${c}-arrow`]:{left:{_skip_check_:!0,value:C}}},"&-placement-bottomRight":{"--arrow-offset-horizontal":`calc(100% - ${$e(C)})`,[`> ${c}-arrow`]:{right:{_skip_check_:!0,value:C}}}})),ds(!!R.left,{[[`&-placement-left > ${c}-arrow`,`&-placement-leftTop > ${c}-arrow`,`&-placement-leftBottom > ${c}-arrow`].join(",")]:{right:{_skip_check_:!0,value:A},transform:"translateX(100%) rotate(90deg)"},[`&-placement-left > ${c}-arrow`]:{top:{_skip_check_:!0,value:"50%"},transform:"translateY(-50%) translateX(100%) rotate(90deg)"},[`&-placement-leftTop > ${c}-arrow`]:{top:E},[`&-placement-leftBottom > ${c}-arrow`]:{bottom:E}})),ds(!!R.right,{[[`&-placement-right > ${c}-arrow`,`&-placement-rightTop > ${c}-arrow`,`&-placement-rightBottom > ${c}-arrow`].join(",")]:{left:{_skip_check_:!0,value:A},transform:"translateX(-100%) rotate(-90deg)"},[`&-placement-right > ${c}-arrow`]:{top:{_skip_check_:!0,value:"50%"},transform:"translateY(-50%) translateX(-100%) rotate(-90deg)"},[`&-placement-rightTop > ${c}-arrow`]:{top:E},[`&-placement-rightBottom > ${c}-arrow`]:{bottom:E}}))}}function of(e,r,u,c){if(c===!1)return{adjustX:!1,adjustY:!1};const f=c&&typeof c=="object"?c:{},E={};switch(e){case"top":case"bottom":E.shiftX=r.arrowOffsetHorizontal*2+u,E.shiftY=!0,E.adjustY=!0;break;case"left":case"right":E.shiftY=r.arrowOffsetVertical*2+u,E.shiftX=!0,E.adjustX=!0;break}const C=Object.assign(Object.assign({},E),f);return C.shiftX||(C.adjustX=!0),C.shiftY||(C.adjustY=!0),C}const au={left:{points:["cr","cl"]},right:{points:["cl","cr"]},top:{points:["bc","tc"]},bottom:{points:["tc","bc"]},topLeft:{points:["bl","tl"]},leftTop:{points:["tr","tl"]},topRight:{points:["br","tr"]},rightTop:{points:["tl","tr"]},bottomRight:{points:["tr","br"]},rightBottom:{points:["bl","br"]},bottomLeft:{points:["tl","bl"]},leftBottom:{points:["br","bl"]}},uf={topLeft:{points:["bl","tc"]},leftTop:{points:["tr","cl"]},topRight:{points:["br","tc"]},rightTop:{points:["tl","cr"]},bottomRight:{points:["tr","bc"]},rightBottom:{points:["bl","cr"]},bottomLeft:{points:["tl","bc"]},leftBottom:{points:["br","cl"]}},lf=new Set(["topLeft","topRight","bottomLeft","bottomRight","leftTop","leftBottom","rightTop","rightBottom"]);function cf(e){const{arrowWidth:r,autoAdjustOverflow:u,arrowPointAtCenter:c,offset:f,borderRadius:E}=e,C=r/2,A={};return Object.keys(au).forEach(R=>{const M=c&&uf[R]||au[R],F=Object.assign(Object.assign({},M),{offset:[0,0],dynamicInset:!0});switch(A[R]=F,lf.has(R)&&(F.autoArrow=!1),R){case"top":case"topLeft":case"topRight":F.offset[1]=-C-f;break;case"bottom":case"bottomLeft":case"bottomRight":F.offset[1]=C+f;break;case"left":case"leftTop":case"leftBottom":F.offset[0]=-C-f;break;case"right":case"rightTop":case"rightBottom":F.offset[0]=C+f;break}const j=Dl({contentRadius:E,limitVerticalRadius:!0});if(c)switch(R){case"topLeft":case"bottomLeft":F.offset[0]=-j.arrowOffsetHorizontal-C;break;case"topRight":case"bottomRight":F.offset[0]=j.arrowOffsetHorizontal+C;break;case"leftTop":case"rightTop":F.offset[1]=-j.arrowOffsetHorizontal*2+C;break;case"leftBottom":case"rightBottom":F.offset[1]=j.arrowOffsetHorizontal*2-C;break}F.overflow=of(R,j,r,u),F.htmlRegion="visibleFirst"}),A}const hf=e=>{const{calc:r,componentCls:u,tooltipMaxWidth:c,tooltipColor:f,tooltipBg:E,tooltipBorderRadius:C,zIndexPopup:A,controlHeight:R,boxShadowSecondary:M,paddingSM:F,paddingXS:j,arrowOffsetHorizontal:B,sizePopupArrow:H}=e,q=r(C).add(H).add(B).equal(),W=r(C).mul(2).add(H).equal();return[{[u]:Object.assign(Object.assign(Object.assign(Object.assign({},Ir(e)),{position:"absolute",zIndex:A,display:"block",width:"max-content",maxWidth:c,visibility:"visible","--valid-offset-x":"var(--arrow-offset-horizontal, var(--arrow-x))",transformOrigin:["var(--valid-offset-x, 50%)","var(--arrow-y, 50%)"].join(" "),"&-hidden":{display:"none"},"--antd-arrow-background-color":E,[`${u}-inner`]:{minWidth:W,minHeight:R,padding:`${$e(e.calc(F).div(2).equal())} ${$e(j)}`,color:f,textAlign:"start",textDecoration:"none",wordWrap:"break-word",backgroundColor:E,borderRadius:C,boxShadow:M,boxSizing:"border-box"},[["&-placement-topLeft","&-placement-topRight","&-placement-bottomLeft","&-placement-bottomRight"].join(",")]:{minWidth:q},[["&-placement-left","&-placement-leftTop","&-placement-leftBottom","&-placement-right","&-placement-rightTop","&-placement-rightBottom"].join(",")]:{[`${u}-inner`]:{borderRadius:e.min(C,kl)}},[`${u}-content`]:{position:"relative"}}),Tl(e,(J,{darkColor:G})=>({[`&${u}-${J}`]:{[`${u}-inner`]:{backgroundColor:G},[`${u}-arrow`]:{"--antd-arrow-background-color":G}}}))),{"&-rtl":{direction:"rtl"}})},af(e,"var(--antd-arrow-background-color)"),{[`${u}-pure`]:{position:"relative",maxWidth:"none",margin:e.sizePopupArrow}}]},df=e=>Object.assign(Object.assign({zIndexPopup:e.zIndexPopupBase+70},Dl({contentRadius:e.borderRadius,limitVerticalRadius:!0})),rf(ir(e,{borderRadiusOuter:Math.min(e.borderRadiusOuter,4)}))),Ml=(e,r=!0)=>Sr("Tooltip",c=>{const{borderRadius:f,colorTextLightSolid:E,colorBgSpotlight:C}=c,A=ir(c,{tooltipMaxWidth:250,tooltipColor:E,tooltipBorderRadius:f,tooltipBg:C});return[hf(A),dd(c,"zoom-big-fast")]},df,{resetStyle:!1,injectStyle:r})(e),pf=ws.map(e=>`${e}-inverse`),ff=["success","processing","error","default","warning"];function Pl(e,r=!0){return r?[].concat(Kn(pf),Kn(ws)).includes(e):ws.includes(e)}function mf(e){return ff.includes(e)}function zl(e,r){const u=Pl(r),c=Oe({[`${e}-${r}`]:r&&u}),f={},E={};return r&&!u&&(f.background=r,E["--antd-arrow-background-color"]=r),{className:c,overlayStyle:f,arrowStyle:E}}const gf=e=>{const{prefixCls:r,className:u,placement:c="top",title:f,color:E,overlayInnerStyle:C}=e,{getPrefixCls:A}=b.useContext(fr),R=A("tooltip",r),[M,F,j]=Ml(R),B=zl(R,E),H=B.arrowStyle,q=Object.assign(Object.assign({},C),B.overlayStyle),W=Oe(F,j,R,`${R}-pure`,`${R}-placement-${c}`,u,B.className);return M(b.createElement("div",{className:W,style:H},b.createElement("div",{className:`${R}-arrow`}),b.createElement(Rl,Object.assign({},e,{className:F,prefixCls:R,overlayInnerStyle:q}),f)))};var yf=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};const xf=b.forwardRef((e,r)=>{var u,c;const{prefixCls:f,openClassName:E,getTooltipContainer:C,color:A,overlayInnerStyle:R,children:M,afterOpenChange:F,afterVisibleChange:j,destroyTooltipOnHide:B,destroyOnHidden:H,arrow:q=!0,title:W,overlay:J,builtinPlacements:G,arrowPointAtCenter:Y=!1,autoAdjustOverflow:Z=!0,motion:X,getPopupContainer:ne,placement:Q="top",mouseEnterDelay:te=.1,mouseLeaveDelay:se=.1,overlayStyle:le,rootClassName:ie,overlayClassName:pe,styles:ve,classNames:de}=e,me=yf(e,["prefixCls","openClassName","getTooltipContainer","color","overlayInnerStyle","children","afterOpenChange","afterVisibleChange","destroyTooltipOnHide","destroyOnHidden","arrow","title","overlay","builtinPlacements","arrowPointAtCenter","autoAdjustOverflow","motion","getPopupContainer","placement","mouseEnterDelay","mouseLeaveDelay","overlayStyle","rootClassName","overlayClassName","styles","classNames"]),Ee=!!q,[,ye]=sl(),{getPopupContainer:Ce,getPrefixCls:oe,direction:ae,className:be,style:Le,classNames:Ie,styles:Ae}=wi("tooltip"),Se=pd(),ke=b.useRef(null),Me=()=>{var Et;(Et=ke.current)===null||Et===void 0||Et.forceAlign()};b.useImperativeHandle(r,()=>{var Et,kt;return{forceAlign:Me,forcePopupAlign:()=>{Se.deprecated(!1,"forcePopupAlign","forceAlign"),Me()},nativeElement:(Et=ke.current)===null||Et===void 0?void 0:Et.nativeElement,popupElement:(kt=ke.current)===null||kt===void 0?void 0:kt.popupElement}});const[De,Ke]=vr(!1,{value:(u=e.open)!==null&&u!==void 0?u:e.visible,defaultValue:(c=e.defaultOpen)!==null&&c!==void 0?c:e.defaultVisible}),Ve=!W&&!J&&W!==0,at=Et=>{var kt,dt;Ke(Ve?!1:Et),Ve||((kt=e.onOpenChange)===null||kt===void 0||kt.call(e,Et),(dt=e.onVisibleChange)===null||dt===void 0||dt.call(e,Et))},Ze=b.useMemo(()=>{var Et,kt;let dt=Y;return typeof q=="object"&&(dt=(kt=(Et=q.pointAtCenter)!==null&&Et!==void 0?Et:q.arrowPointAtCenter)!==null&&kt!==void 0?kt:Y),G||cf({arrowPointAtCenter:dt,autoAdjustOverflow:Z,arrowWidth:Ee?ye.sizePopupArrow:0,borderRadius:ye.borderRadius,offset:ye.marginXXS})},[Y,q,G,ye]),Qe=b.useMemo(()=>W===0?W:J||W||"",[J,W]),yt=b.createElement(fd,{space:!0},typeof Qe=="function"?Qe():Qe),ge=oe("tooltip",f),Ge=oe(),We=e["data-popover-inject"];let we=De;!("open"in e)&&!("visible"in e)&&Ve&&(we=!1);const ot=b.isValidElement(M)&&!md(M)?M:b.createElement("span",null,M),et=ot.props,Tt=!et.className||typeof et.className=="string"?Oe(et.className,E||`${ge}-open`):et.className,[ut,Ut,Ft]=Ml(ge,!We),vt=zl(ge,A),on=vt.arrowStyle,ht=Oe(pe,{[`${ge}-rtl`]:ae==="rtl"},vt.className,ie,Ut,Ft,be,Ie.root,de==null?void 0:de.root),pn=Oe(Ie.body,de==null?void 0:de.body),[Wt,wt]=gd("Tooltip",me.zIndex),Kt=b.createElement(nf,Object.assign({},me,{zIndex:Wt,showArrow:Ee,placement:Q,mouseEnterDelay:te,mouseLeaveDelay:se,prefixCls:ge,classNames:{root:ht,body:pn},styles:{root:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},on),Ae.root),Le),le),ve==null?void 0:ve.root),body:Object.assign(Object.assign(Object.assign(Object.assign({},Ae.body),R),ve==null?void 0:ve.body),vt.overlayStyle)},getTooltipContainer:ne||C||Ce,ref:ke,builtinPlacements:Ze,overlay:yt,visible:we,onVisibleChange:at,afterVisibleChange:F??j,arrowContent:b.createElement("span",{className:`${ge}-arrow-content`}),motion:{motionName:al(Ge,"zoom-big-fast",e.transitionName),motionDeadline:1e3},destroyTooltipOnHide:H??!!B}),we?ol(ot,{className:Tt}):ot);return ut(b.createElement(yd.Provider,{value:wt},Kt))}),Hi=xf;Hi._InternalPanelDoNotUseOrYouWillBeFired=gf;var bf=vn.ESC,vf=vn.TAB;function wf(e){var r=e.visible,u=e.triggerRef,c=e.onVisibleChange,f=e.autoFocus,E=e.overlayRef,C=b.useRef(!1),A=function(){if(r){var j,B;(j=u.current)===null||j===void 0||(B=j.focus)===null||B===void 0||B.call(j),c==null||c(!1)}},R=function(){var j;return(j=E.current)!==null&&j!==void 0&&j.focus?(E.current.focus(),C.current=!0,!0):!1},M=function(j){switch(j.keyCode){case bf:A();break;case vf:{var B=!1;C.current||(B=R()),B?j.preventDefault():A();break}}};b.useEffect(function(){return r?(window.addEventListener("keydown",M),f&&br(R,3),function(){window.removeEventListener("keydown",M),C.current=!1}):function(){C.current=!1}},[r])}var Sf=b.forwardRef(function(e,r){var u=e.overlay,c=e.arrow,f=e.prefixCls,E=b.useMemo(function(){var A;return typeof u=="function"?A=u():A=u,A},[u]),C=Bi(r,Ls(E));return Ot.createElement(Ot.Fragment,null,c&&Ot.createElement("div",{className:"".concat(f,"-arrow")}),Ot.cloneElement(E,{ref:Is(E)?C:void 0}))}),mi={adjustX:1,adjustY:1},gi=[0,0],Tf={topLeft:{points:["bl","tl"],overflow:mi,offset:[0,-4],targetOffset:gi},top:{points:["bc","tc"],overflow:mi,offset:[0,-4],targetOffset:gi},topRight:{points:["br","tr"],overflow:mi,offset:[0,-4],targetOffset:gi},bottomLeft:{points:["tl","bl"],overflow:mi,offset:[0,4],targetOffset:gi},bottom:{points:["tc","bc"],overflow:mi,offset:[0,4],targetOffset:gi},bottomRight:{points:["tr","br"],overflow:mi,offset:[0,4],targetOffset:gi}},Ef=["arrow","prefixCls","transitionName","animation","align","placement","placements","getPopupContainer","showAction","hideAction","overlayClassName","overlayStyle","visible","trigger","autoFocus","overlay","children","onVisibleChange"];function Cf(e,r){var u,c=e.arrow,f=c===void 0?!1:c,E=e.prefixCls,C=E===void 0?"rc-dropdown":E,A=e.transitionName,R=e.animation,M=e.align,F=e.placement,j=F===void 0?"bottomLeft":F,B=e.placements,H=B===void 0?Tf:B,q=e.getPopupContainer,W=e.showAction,J=e.hideAction,G=e.overlayClassName,Y=e.overlayStyle,Z=e.visible,X=e.trigger,ne=X===void 0?["hover"]:X,Q=e.autoFocus,te=e.overlay,se=e.children,le=e.onVisibleChange,ie=rn(e,Ef),pe=Ot.useState(),ve=ze(pe,2),de=ve[0],me=ve[1],Ee="visible"in e?Z:de,ye=Ot.useRef(null),Ce=Ot.useRef(null),oe=Ot.useRef(null);Ot.useImperativeHandle(r,function(){return ye.current});var ae=function(Ke){me(Ke),le==null||le(Ke)};wf({visible:Ee,triggerRef:oe,onVisibleChange:ae,autoFocus:Q,overlayRef:Ce});var be=function(Ke){var Ve=e.onOverlayClick;me(!1),Ve&&Ve(Ke)},Le=function(){return Ot.createElement(Sf,{ref:Ce,overlay:te,prefixCls:C,arrow:f})},Ie=function(){return typeof te=="function"?Le:Le()},Ae=function(){var Ke=e.minOverlayWidthMatchTrigger,Ve=e.alignPoint;return"minOverlayWidthMatchTrigger"in e?Ke:!Ve},Se=function(){var Ke=e.openClassName;return Ke!==void 0?Ke:"".concat(C,"-open")},ke=Ot.cloneElement(se,{className:Oe((u=se.props)===null||u===void 0?void 0:u.className,Ee&&Se()),ref:Is(se)?Bi(oe,Ls(se)):void 0}),Me=J;return!Me&&ne.indexOf("contextMenu")!==-1&&(Me=["click"]),Ot.createElement(Ia,qe({builtinPlacements:H},ie,{prefixCls:C,ref:ye,popupClassName:Oe(G,xt({},"".concat(C,"-show-arrow"),f)),popupStyle:Y,action:ne,showAction:W,hideAction:Me,popupPlacement:j,popupAlign:M,popupTransitionName:A,popupAnimation:R,popupVisible:Ee,stretch:Ae()?"minWidth":"",popup:Ie(),onPopupVisibleChange:ae,onPopupClick:be,getPopupContainer:q}),ke)}const $f=Ot.forwardRef(Cf);var Nl=b.createContext(null);function Fl(e,r){return e===void 0?null:"".concat(e,"-").concat(r)}function Vl(e){var r=b.useContext(Nl);return Fl(r,e)}var _f=["children","locked"],wr=b.createContext(null);function If(e,r){var u=Fe({},e);return Object.keys(r).forEach(function(c){var f=r[c];f!==void 0&&(u[c]=f)}),u}function ji(e){var r=e.children,u=e.locked,c=rn(e,_f),f=b.useContext(wr),E=xd(function(){return If(f,c)},[f,c],function(C,A){return!u&&(C[0]!==A[0]||!ul(C[1],A[1],!0))});return b.createElement(wr.Provider,{value:E},r)}var Lf=[],jl=b.createContext(null);function Ds(){return b.useContext(jl)}var Kl=b.createContext(Lf);function Xi(e){var r=b.useContext(Kl);return b.useMemo(function(){return e!==void 0?[].concat(Kn(r),[e]):r},[r,e])}var Bl=b.createContext(null),La=b.createContext({});function ou(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(nl(e)){var u=e.nodeName.toLowerCase(),c=["input","select","textarea","button"].includes(u)||e.isContentEditable||u==="a"&&!!e.getAttribute("href"),f=e.getAttribute("tabindex"),E=Number(f),C=null;return f&&!Number.isNaN(E)?C=E:c&&C===null&&(C=0),c&&e.disabled&&(C=null),C!==null&&(C>=0||r&&C<0)}return!1}function Of(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,u=Kn(e.querySelectorAll("*")).filter(function(c){return ou(c,r)});return ou(e,r)&&u.unshift(e),u}var wa=vn.LEFT,Sa=vn.RIGHT,Ta=vn.UP,xs=vn.DOWN,bs=vn.ENTER,Gl=vn.ESC,Ri=vn.HOME,ki=vn.END,uu=[Ta,xs,wa,Sa];function Af(e,r,u,c){var f,E="prev",C="next",A="children",R="parent";if(e==="inline"&&c===bs)return{inlineTrigger:!0};var M=xt(xt({},Ta,E),xs,C),F=xt(xt(xt(xt({},wa,u?C:E),Sa,u?E:C),xs,A),bs,A),j=xt(xt(xt(xt(xt(xt({},Ta,E),xs,C),bs,A),Gl,R),wa,u?A:R),Sa,u?R:A),B={inline:M,horizontal:F,vertical:j,inlineSub:M,horizontalSub:j,verticalSub:j},H=(f=B["".concat(e).concat(r?"":"Sub")])===null||f===void 0?void 0:f[c];switch(H){case E:return{offset:-1,sibling:!0};case C:return{offset:1,sibling:!0};case R:return{offset:-1,sibling:!1};case A:return{offset:1,sibling:!1};default:return null}}function Rf(e){for(var r=e;r;){if(r.getAttribute("data-menu-list"))return r;r=r.parentElement}return null}function kf(e,r){for(var u=e||document.activeElement;u;){if(r.has(u))return u;u=u.parentElement}return null}function Oa(e,r){var u=Of(e,!0);return u.filter(function(c){return r.has(c)})}function lu(e,r,u){var c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;if(!e)return null;var f=Oa(e,r),E=f.length,C=f.findIndex(function(A){return u===A});return c<0?C===-1?C=E-1:C-=1:c>0&&(C+=1),C=(C+E)%E,f[C]}var Ea=function(r,u){var c=new Set,f=new Map,E=new Map;return r.forEach(function(C){var A=document.querySelector("[data-menu-id='".concat(Fl(u,C),"']"));A&&(c.add(A),E.set(A,C),f.set(C,A))}),{elements:c,key2element:f,element2key:E}};function Df(e,r,u,c,f,E,C,A,R,M){var F=b.useRef(),j=b.useRef();j.current=r;var B=function(){br.cancel(F.current)};return b.useEffect(function(){return function(){B()}},[]),function(H){var q=H.which;if([].concat(uu,[bs,Gl,Ri,ki]).includes(q)){var W=E(),J=Ea(W,c),G=J,Y=G.elements,Z=G.key2element,X=G.element2key,ne=Z.get(r),Q=kf(ne,Y),te=X.get(Q),se=Af(e,C(te,!0).length===1,u,q);if(!se&&q!==Ri&&q!==ki)return;(uu.includes(q)||[Ri,ki].includes(q))&&H.preventDefault();var le=function(Ce){if(Ce){var oe=Ce,ae=Ce.querySelector("a");ae!=null&&ae.getAttribute("href")&&(oe=ae);var be=X.get(Ce);A(be),B(),F.current=br(function(){j.current===be&&oe.focus()})}};if([Ri,ki].includes(q)||se.sibling||!Q){var ie;!Q||e==="inline"?ie=f.current:ie=Rf(Q);var pe,ve=Oa(ie,Y);q===Ri?pe=ve[0]:q===ki?pe=ve[ve.length-1]:pe=lu(ie,Y,Q,se.offset),le(pe)}else if(se.inlineTrigger)R(te);else if(se.offset>0)R(te,!0),B(),F.current=br(function(){J=Ea(W,c);var ye=Q.getAttribute("aria-controls"),Ce=document.getElementById(ye),oe=lu(Ce,J.elements);le(oe)},5);else if(se.offset<0){var de=C(te,!0),me=de[de.length-2],Ee=Z.get(me);R(me,!1),le(Ee)}}M==null||M(H)}}function Mf(e){Promise.resolve().then(e)}var Aa="__RC_UTIL_PATH_SPLIT__",cu=function(r){return r.join(Aa)},Pf=function(r){return r.split(Aa)},Ca="rc-menu-more";function zf(){var e=b.useState({}),r=ze(e,2),u=r[1],c=b.useRef(new Map),f=b.useRef(new Map),E=b.useState([]),C=ze(E,2),A=C[0],R=C[1],M=b.useRef(0),F=b.useRef(!1),j=function(){F.current||u({})},B=b.useCallback(function(Z,X){var ne=cu(X);f.current.set(ne,Z),c.current.set(Z,ne),M.current+=1;var Q=M.current;Mf(function(){Q===M.current&&j()})},[]),H=b.useCallback(function(Z,X){var ne=cu(X);f.current.delete(ne),c.current.delete(Z)},[]),q=b.useCallback(function(Z){R(Z)},[]),W=b.useCallback(function(Z,X){var ne=c.current.get(Z)||"",Q=Pf(ne);return X&&A.includes(Q[0])&&Q.unshift(Ca),Q},[A]),J=b.useCallback(function(Z,X){return Z.filter(function(ne){return ne!==void 0}).some(function(ne){var Q=W(ne,!0);return Q.includes(X)})},[W]),G=function(){var X=Kn(c.current.keys());return A.length&&X.push(Ca),X},Y=b.useCallback(function(Z){var X="".concat(c.current.get(Z)).concat(Aa),ne=new Set;return Kn(f.current.keys()).forEach(function(Q){Q.startsWith(X)&&ne.add(f.current.get(Q))}),ne},[]);return b.useEffect(function(){return function(){F.current=!0}},[]),{registerPath:B,unregisterPath:H,refreshOverflowKeys:q,isSubPathKey:J,getKeyPath:W,getKeys:G,getSubPathKeys:Y}}function Mi(e){var r=b.useRef(e);r.current=e;var u=b.useCallback(function(){for(var c,f=arguments.length,E=new Array(f),C=0;C<f;C++)E[C]=arguments[C];return(c=r.current)===null||c===void 0?void 0:c.call.apply(c,[r].concat(E))},[]);return e?u:void 0}var Nf=Math.random().toFixed(5).toString().slice(2),hu=0;function Ff(e){var r=vr(e,{value:e}),u=ze(r,2),c=u[0],f=u[1];return b.useEffect(function(){hu+=1;var E="".concat(Nf,"-").concat(hu);f("rc-menu-uuid-".concat(E))},[]),c}function Ul(e,r,u,c){var f=b.useContext(wr),E=f.activeKey,C=f.onActive,A=f.onInactive,R={active:E===e};return r||(R.onMouseEnter=function(M){u==null||u({key:e,domEvent:M}),C(e)},R.onMouseLeave=function(M){c==null||c({key:e,domEvent:M}),A(e)}),R}function Wl(e){var r=b.useContext(wr),u=r.mode,c=r.rtl,f=r.inlineIndent;if(u!=="inline")return null;var E=e;return c?{paddingRight:E*f}:{paddingLeft:E*f}}function Hl(e){var r=e.icon,u=e.props,c=e.children,f;return r===null||r===!1?null:(typeof r=="function"?f=b.createElement(r,Fe({},u)):typeof r!="boolean"&&(f=r),f||c||null)}var Vf=["item"];function Cs(e){var r=e.item,u=rn(e,Vf);return Object.defineProperty(u,"item",{get:function(){return ll(!1,"`info.item` is deprecated since we will move to function component that not provides React Node instance in future."),r}}),u}var jf=["title","attribute","elementRef"],Kf=["style","className","eventKey","warnKey","disabled","itemIcon","children","role","onMouseEnter","onMouseLeave","onClick","onKeyDown","onFocus"],Bf=["active"],Gf=function(e){Ju(u,e);var r=qu(u);function u(){return Zu(this,u),r.apply(this,arguments)}return Qu(u,[{key:"render",value:function(){var f=this.props,E=f.title,C=f.attribute,A=f.elementRef,R=rn(f,jf),M=Xr(R,["eventKey","popupClassName","popupOffset","onTitleClick"]);return ll(!C,"`attribute` of Menu.Item is deprecated. Please pass attribute directly."),b.createElement(Fr.Item,qe({},C,{title:typeof E=="string"?E:void 0},M,{ref:A}))}}]),u}(b.Component),Uf=b.forwardRef(function(e,r){var u=e.style,c=e.className,f=e.eventKey;e.warnKey;var E=e.disabled,C=e.itemIcon,A=e.children,R=e.role,M=e.onMouseEnter,F=e.onMouseLeave,j=e.onClick,B=e.onKeyDown,H=e.onFocus,q=rn(e,Kf),W=Vl(f),J=b.useContext(wr),G=J.prefixCls,Y=J.onItemClick,Z=J.disabled,X=J.overflowDisabled,ne=J.itemIcon,Q=J.selectedKeys,te=J.onActive,se=b.useContext(La),le=se._internalRenderMenuItem,ie="".concat(G,"-item"),pe=b.useRef(),ve=b.useRef(),de=Z||E,me=Os(r,ve),Ee=Xi(f),ye=function(Ve){return{key:f,keyPath:Kn(Ee).reverse(),item:pe.current,domEvent:Ve}},Ce=C||ne,oe=Ul(f,de,M,F),ae=oe.active,be=rn(oe,Bf),Le=Q.includes(f),Ie=Wl(Ee.length),Ae=function(Ve){if(!de){var at=ye(Ve);j==null||j(Cs(at)),Y(at)}},Se=function(Ve){if(B==null||B(Ve),Ve.which===vn.ENTER){var at=ye(Ve);j==null||j(Cs(at)),Y(at)}},ke=function(Ve){te(f),H==null||H(Ve)},Me={};e.role==="option"&&(Me["aria-selected"]=Le);var De=b.createElement(Gf,qe({ref:pe,elementRef:me,role:R===null?"none":R||"menuitem",tabIndex:E?null:-1,"data-menu-id":X&&W?null:W},Xr(q,["extra"]),be,Me,{component:"li","aria-disabled":E,style:Fe(Fe({},Ie),u),className:Oe(ie,xt(xt(xt({},"".concat(ie,"-active"),ae),"".concat(ie,"-selected"),Le),"".concat(ie,"-disabled"),de),c),onClick:Ae,onKeyDown:Se,onFocus:ke}),A,b.createElement(Hl,{props:Fe(Fe({},e),{},{isSelected:Le}),icon:Ce}));return le&&(De=le(De,e,{selected:Le})),De});function Wf(e,r){var u=e.eventKey,c=Ds(),f=Xi(u);return b.useEffect(function(){if(c)return c.registerPath(u,f),function(){c.unregisterPath(u,f)}},[f]),c?null:b.createElement(Uf,qe({},e,{ref:r}))}const Ms=b.forwardRef(Wf);var Hf=["className","children"],Xf=function(r,u){var c=r.className,f=r.children,E=rn(r,Hf),C=b.useContext(wr),A=C.prefixCls,R=C.mode,M=C.rtl;return b.createElement("ul",qe({className:Oe(A,M&&"".concat(A,"-rtl"),"".concat(A,"-sub"),"".concat(A,"-").concat(R==="inline"?"inline":"vertical"),c),role:"menu"},E,{"data-menu-list":!0,ref:u}),f)},Ra=b.forwardRef(Xf);Ra.displayName="SubMenuList";function ka(e,r){return ri(e).map(function(u,c){if(b.isValidElement(u)){var f,E,C=u.key,A=(f=(E=u.props)===null||E===void 0?void 0:E.eventKey)!==null&&f!==void 0?f:C,R=A==null;R&&(A="tmp_key-".concat([].concat(Kn(r),[c]).join("-")));var M={key:A,eventKey:A};return b.cloneElement(u,M)}return u})}var jn={adjustX:1,adjustY:1},Yf={topLeft:{points:["bl","tl"],overflow:jn},topRight:{points:["br","tr"],overflow:jn},bottomLeft:{points:["tl","bl"],overflow:jn},bottomRight:{points:["tr","br"],overflow:jn},leftTop:{points:["tr","tl"],overflow:jn},leftBottom:{points:["br","bl"],overflow:jn},rightTop:{points:["tl","tr"],overflow:jn},rightBottom:{points:["bl","br"],overflow:jn}},Jf={topLeft:{points:["bl","tl"],overflow:jn},topRight:{points:["br","tr"],overflow:jn},bottomLeft:{points:["tl","bl"],overflow:jn},bottomRight:{points:["tr","br"],overflow:jn},rightTop:{points:["tr","tl"],overflow:jn},rightBottom:{points:["br","bl"],overflow:jn},leftTop:{points:["tl","tr"],overflow:jn},leftBottom:{points:["bl","br"],overflow:jn}};function Xl(e,r,u){if(r)return r;if(u)return u[e]||u.other}var qf={horizontal:"bottomLeft",vertical:"rightTop","vertical-left":"rightTop","vertical-right":"leftTop"};function Zf(e){var r=e.prefixCls,u=e.visible,c=e.children,f=e.popup,E=e.popupStyle,C=e.popupClassName,A=e.popupOffset,R=e.disabled,M=e.mode,F=e.onVisibleChange,j=b.useContext(wr),B=j.getPopupContainer,H=j.rtl,q=j.subMenuOpenDelay,W=j.subMenuCloseDelay,J=j.builtinPlacements,G=j.triggerSubMenuAction,Y=j.forceSubMenuRender,Z=j.rootClassName,X=j.motion,ne=j.defaultMotions,Q=b.useState(!1),te=ze(Q,2),se=te[0],le=te[1],ie=H?Fe(Fe({},Jf),J):Fe(Fe({},Yf),J),pe=qf[M],ve=Xl(M,X,ne),de=b.useRef(ve);M!=="inline"&&(de.current=ve);var me=Fe(Fe({},de.current),{},{leavedClassName:"".concat(r,"-hidden"),removeOnLeave:!1,motionAppear:!0}),Ee=b.useRef();return b.useEffect(function(){return Ee.current=br(function(){le(u)}),function(){br.cancel(Ee.current)}},[u]),b.createElement(Ia,{prefixCls:r,popupClassName:Oe("".concat(r,"-popup"),xt({},"".concat(r,"-rtl"),H),C,Z),stretch:M==="horizontal"?"minWidth":null,getPopupContainer:B,builtinPlacements:ie,popupPlacement:pe,popupVisible:se,popup:f,popupStyle:E,popupAlign:A&&{offset:A},action:R?[]:[G],mouseEnterDelay:q,mouseLeaveDelay:W,onPopupVisibleChange:F,forceRender:Y,popupMotion:me,fresh:!0},c)}function Qf(e){var r=e.id,u=e.open,c=e.keyPath,f=e.children,E="inline",C=b.useContext(wr),A=C.prefixCls,R=C.forceSubMenuRender,M=C.motion,F=C.defaultMotions,j=C.mode,B=b.useRef(!1);B.current=j===E;var H=b.useState(!B.current),q=ze(H,2),W=q[0],J=q[1],G=B.current?u:!1;b.useEffect(function(){B.current&&J(!1)},[j]);var Y=Fe({},Xl(E,M,F));c.length>1&&(Y.motionAppear=!1);var Z=Y.onVisibleChanged;return Y.onVisibleChanged=function(X){return!B.current&&!X&&J(!0),Z==null?void 0:Z(X)},W?null:b.createElement(ji,{mode:E,locked:!B.current},b.createElement(As,qe({visible:G},Y,{forceRender:R,removeOnLeave:!1,leavedClassName:"".concat(A,"-hidden")}),function(X){var ne=X.className,Q=X.style;return b.createElement(Ra,{id:r,className:ne,style:Q},f)}))}var em=["style","className","title","eventKey","warnKey","disabled","internalPopupClose","children","itemIcon","expandIcon","popupClassName","popupOffset","popupStyle","onClick","onMouseEnter","onMouseLeave","onTitleClick","onTitleMouseEnter","onTitleMouseLeave"],tm=["active"],nm=b.forwardRef(function(e,r){var u=e.style,c=e.className,f=e.title,E=e.eventKey;e.warnKey;var C=e.disabled,A=e.internalPopupClose,R=e.children,M=e.itemIcon,F=e.expandIcon,j=e.popupClassName,B=e.popupOffset,H=e.popupStyle,q=e.onClick,W=e.onMouseEnter,J=e.onMouseLeave,G=e.onTitleClick,Y=e.onTitleMouseEnter,Z=e.onTitleMouseLeave,X=rn(e,em),ne=Vl(E),Q=b.useContext(wr),te=Q.prefixCls,se=Q.mode,le=Q.openKeys,ie=Q.disabled,pe=Q.overflowDisabled,ve=Q.activeKey,de=Q.selectedKeys,me=Q.itemIcon,Ee=Q.expandIcon,ye=Q.onItemClick,Ce=Q.onOpenChange,oe=Q.onActive,ae=b.useContext(La),be=ae._internalRenderSubMenuItem,Le=b.useContext(Bl),Ie=Le.isSubPathKey,Ae=Xi(),Se="".concat(te,"-submenu"),ke=ie||C,Me=b.useRef(),De=b.useRef(),Ke=M??me,Ve=F??Ee,at=le.includes(E),Ze=!pe&&at,Qe=Ie(de,E),yt=Ul(E,ke,Y,Z),ge=yt.active,Ge=rn(yt,tm),We=b.useState(!1),we=ze(We,2),ot=we[0],et=we[1],Tt=function(Ne){ke||et(Ne)},ut=function(Ne){Tt(!0),W==null||W({key:E,domEvent:Ne})},Ut=function(Ne){Tt(!1),J==null||J({key:E,domEvent:Ne})},Ft=b.useMemo(function(){return ge||(se!=="inline"?ot||Ie([ve],E):!1)},[se,ge,ve,ot,E,Ie]),vt=Wl(Ae.length),on=function(Ne){ke||(G==null||G({key:E,domEvent:Ne}),se==="inline"&&Ce(E,!at))},ht=Mi(function(Ct){q==null||q(Cs(Ct)),ye(Ct)}),pn=function(Ne){se!=="inline"&&Ce(E,Ne)},Wt=function(){oe(E)},wt=ne&&"".concat(ne,"-popup"),Kt=b.useMemo(function(){return b.createElement(Hl,{icon:se!=="horizontal"?Ve:void 0,props:Fe(Fe({},e),{},{isOpen:Ze,isSubMenu:!0})},b.createElement("i",{className:"".concat(Se,"-arrow")}))},[se,Ve,e,Ze,Se]),Et=b.createElement("div",qe({role:"menuitem",style:vt,className:"".concat(Se,"-title"),tabIndex:ke?null:-1,ref:Me,title:typeof f=="string"?f:null,"data-menu-id":pe&&ne?null:ne,"aria-expanded":Ze,"aria-haspopup":!0,"aria-controls":wt,"aria-disabled":ke,onClick:on,onFocus:Wt},Ge),f,Kt),kt=b.useRef(se);if(se!=="inline"&&Ae.length>1?kt.current="vertical":kt.current=se,!pe){var dt=kt.current;Et=b.createElement(Zf,{mode:dt,prefixCls:Se,visible:!A&&Ze&&se!=="inline",popupClassName:j,popupOffset:B,popupStyle:H,popup:b.createElement(ji,{mode:dt==="horizontal"?"vertical":dt},b.createElement(Ra,{id:wt,ref:De},R)),disabled:ke,onVisibleChange:pn},Et)}var Be=b.createElement(Fr.Item,qe({ref:r,role:"none"},X,{component:"li",style:u,className:Oe(Se,"".concat(Se,"-").concat(se),c,xt(xt(xt(xt({},"".concat(Se,"-open"),Ze),"".concat(Se,"-active"),Ft),"".concat(Se,"-selected"),Qe),"".concat(Se,"-disabled"),ke)),onMouseEnter:ut,onMouseLeave:Ut}),Et,!pe&&b.createElement(Qf,{id:wt,open:Ze,keyPath:Ae},R));return be&&(Be=be(Be,e,{selected:Qe,active:Ft,open:Ze,disabled:ke})),b.createElement(ji,{onItemClick:ht,mode:se==="horizontal"?"vertical":se,itemIcon:Ke,expandIcon:Ve},Be)}),Da=b.forwardRef(function(e,r){var u=e.eventKey,c=e.children,f=Xi(u),E=ka(c,f),C=Ds();b.useEffect(function(){if(C)return C.registerPath(u,f),function(){C.unregisterPath(u,f)}},[f]);var A;return C?A=E:A=b.createElement(nm,qe({ref:r},e),E),b.createElement(Kl.Provider,{value:f},A)});function Yl(e){var r=e.className,u=e.style,c=b.useContext(wr),f=c.prefixCls,E=Ds();return E?null:b.createElement("li",{role:"separator",className:Oe("".concat(f,"-item-divider"),r),style:u})}var rm=["className","title","eventKey","children"],im=b.forwardRef(function(e,r){var u=e.className,c=e.title;e.eventKey;var f=e.children,E=rn(e,rm),C=b.useContext(wr),A=C.prefixCls,R="".concat(A,"-item-group");return b.createElement("li",qe({ref:r,role:"presentation"},E,{onClick:function(F){return F.stopPropagation()},className:Oe(R,u)}),b.createElement("div",{role:"presentation",className:"".concat(R,"-title"),title:typeof c=="string"?c:void 0},c),b.createElement("ul",{role:"group",className:"".concat(R,"-list")},f))}),Jl=b.forwardRef(function(e,r){var u=e.eventKey,c=e.children,f=Xi(u),E=ka(c,f),C=Ds();return C?E:b.createElement(im,qe({ref:r},Xr(e,["warnKey"])),E)}),sm=["label","children","key","type","extra"];function $a(e,r,u){var c=r.item,f=r.group,E=r.submenu,C=r.divider;return(e||[]).map(function(A,R){if(A&&rr(A)==="object"){var M=A,F=M.label,j=M.children,B=M.key,H=M.type,q=M.extra,W=rn(M,sm),J=B??"tmp-".concat(R);return j||H==="group"?H==="group"?b.createElement(f,qe({key:J},W,{title:F}),$a(j,r,u)):b.createElement(E,qe({key:J},W,{title:F}),$a(j,r,u)):H==="divider"?b.createElement(C,qe({key:J},W)):b.createElement(c,qe({key:J},W,{extra:q}),F,(!!q||q===0)&&b.createElement("span",{className:"".concat(u,"-item-extra")},q))}return null}).filter(function(A){return A})}function du(e,r,u,c,f){var E=e,C=Fe({divider:Yl,item:Ms,group:Jl,submenu:Da},c);return r&&(E=$a(r,C,f)),ka(E,u)}var am=["prefixCls","rootClassName","style","className","tabIndex","items","children","direction","id","mode","inlineCollapsed","disabled","disabledOverflow","subMenuOpenDelay","subMenuCloseDelay","forceSubMenuRender","defaultOpenKeys","openKeys","activeKey","defaultActiveFirst","selectable","multiple","defaultSelectedKeys","selectedKeys","onSelect","onDeselect","inlineIndent","motion","defaultMotions","triggerSubMenuAction","builtinPlacements","itemIcon","expandIcon","overflowedIndicator","overflowedIndicatorPopupClassName","getPopupContainer","onClick","onOpenChange","onKeyDown","openAnimation","openTransitionName","_internalRenderMenuItem","_internalRenderSubMenuItem","_internalComponents"],ni=[],om=b.forwardRef(function(e,r){var u,c=e,f=c.prefixCls,E=f===void 0?"rc-menu":f,C=c.rootClassName,A=c.style,R=c.className,M=c.tabIndex,F=M===void 0?0:M,j=c.items,B=c.children,H=c.direction,q=c.id,W=c.mode,J=W===void 0?"vertical":W,G=c.inlineCollapsed,Y=c.disabled,Z=c.disabledOverflow,X=c.subMenuOpenDelay,ne=X===void 0?.1:X,Q=c.subMenuCloseDelay,te=Q===void 0?.1:Q,se=c.forceSubMenuRender,le=c.defaultOpenKeys,ie=c.openKeys,pe=c.activeKey,ve=c.defaultActiveFirst,de=c.selectable,me=de===void 0?!0:de,Ee=c.multiple,ye=Ee===void 0?!1:Ee,Ce=c.defaultSelectedKeys,oe=c.selectedKeys,ae=c.onSelect,be=c.onDeselect,Le=c.inlineIndent,Ie=Le===void 0?24:Le,Ae=c.motion,Se=c.defaultMotions,ke=c.triggerSubMenuAction,Me=ke===void 0?"hover":ke,De=c.builtinPlacements,Ke=c.itemIcon,Ve=c.expandIcon,at=c.overflowedIndicator,Ze=at===void 0?"...":at,Qe=c.overflowedIndicatorPopupClassName,yt=c.getPopupContainer,ge=c.onClick,Ge=c.onOpenChange,We=c.onKeyDown;c.openAnimation,c.openTransitionName;var we=c._internalRenderMenuItem,ot=c._internalRenderSubMenuItem,et=c._internalComponents,Tt=rn(c,am),ut=b.useMemo(function(){return[du(B,j,ni,et,E),du(B,j,ni,{},E)]},[B,j,et]),Ut=ze(ut,2),Ft=Ut[0],vt=Ut[1],on=b.useState(!1),ht=ze(on,2),pn=ht[0],Wt=ht[1],wt=b.useRef(),Kt=Ff(q),Et=H==="rtl",kt=vr(le,{value:ie,postState:function(tt){return tt||ni}}),dt=ze(kt,2),Be=dt[0],Ct=dt[1],Ne=function(tt){var Jt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;function Sn(){Ct(tt),Ge==null||Ge(tt)}Jt?tl.flushSync(Sn):Sn()},He=b.useState(Be),qt=ze(He,2),Pn=qt[0],An=qt[1],Xt=b.useRef(!1),sr=b.useMemo(function(){return(J==="inline"||J==="vertical")&&G?["vertical",G]:[J,!1]},[J,G]),Bt=ze(sr,2),en=Bt[0],zt=Bt[1],Vt=en==="inline",nt=b.useState(en),rt=ze(nt,2),Xe=rt[0],Lt=rt[1],Yt=b.useState(zt),cn=ze(Yt,2),$n=cn[0],Bn=cn[1];b.useEffect(function(){Lt(en),Bn(zt),Xt.current&&(Vt?Ct(Pn):Ne(ni))},[en,zt]);var Wn=b.useState(0),yn=ze(Wn,2),xn=yn[0],Lr=yn[1],ar=xn>=Ft.length-1||Xe!=="horizontal"||Z;b.useEffect(function(){Vt&&An(Be)},[Be]),b.useEffect(function(){return Xt.current=!0,function(){Xt.current=!1}},[]);var wn=zf(),Hn=wn.registerPath,mr=wn.unregisterPath,Xn=wn.refreshOverflowKeys,zn=wn.isSubPathKey,Rn=wn.getKeyPath,_n=wn.getKeys,Qn=wn.getSubPathKeys,fn=b.useMemo(function(){return{registerPath:Hn,unregisterPath:mr}},[Hn,mr]),Yn=b.useMemo(function(){return{isSubPathKey:zn}},[zn]);b.useEffect(function(){Xn(ar?ni:Ft.slice(xn+1).map(function(tn){return tn.key}))},[xn,ar]);var Pt=vr(pe||ve&&((u=Ft[0])===null||u===void 0?void 0:u.key),{value:pe}),Je=ze(Pt,2),$t=Je[0],Ht=Je[1],kn=Mi(function(tn){Ht(tn)}),bn=Mi(function(){Ht(void 0)});b.useImperativeHandle(r,function(){return{list:wt.current,focus:function(tt){var Jt,Sn=_n(),Ln=Ea(Sn,Kt),Tr=Ln.elements,gr=Ln.key2element,qn=Ln.element2key,jr=Oa(wt.current,Tr),Er=$t??(jr[0]?qn.get(jr[0]):(Jt=Ft.find(function(Jr){return!Jr.props.disabled}))===null||Jt===void 0?void 0:Jt.key),lr=gr.get(Er);if(Er&&lr){var Cr;lr==null||(Cr=lr.focus)===null||Cr===void 0||Cr.call(lr,tt)}}}});var Dn=vr(Ce||[],{value:oe,postState:function(tt){return Array.isArray(tt)?tt:tt==null?ni:[tt]}}),sn=ze(Dn,2),In=sn[0],Nn=sn[1],Jn=function(tt){if(me){var Jt=tt.key,Sn=In.includes(Jt),Ln;ye?Sn?Ln=In.filter(function(gr){return gr!==Jt}):Ln=[].concat(Kn(In),[Jt]):Ln=[Jt],Nn(Ln);var Tr=Fe(Fe({},tt),{},{selectedKeys:Ln});Sn?be==null||be(Tr):ae==null||ae(Tr)}!ye&&Be.length&&Xe!=="inline"&&Ne(ni)},Gt=Mi(function(tn){ge==null||ge(Cs(tn)),Jn(tn)}),er=Mi(function(tn,tt){var Jt=Be.filter(function(Ln){return Ln!==tn});if(tt)Jt.push(tn);else if(Xe!=="inline"){var Sn=Qn(tn);Jt=Jt.filter(function(Ln){return!Sn.has(Ln)})}ul(Be,Jt,!0)||Ne(Jt,!0)}),Mn=function(tt,Jt){var Sn=Jt??!Be.includes(tt);er(tt,Sn)},jt=Df(Xe,$t,Et,Kt,wt,_n,Rn,Ht,Mn,We);b.useEffect(function(){Wt(!0)},[]);var or=b.useMemo(function(){return{_internalRenderMenuItem:we,_internalRenderSubMenuItem:ot}},[we,ot]),ur=Xe!=="horizontal"||Z?Ft:Ft.map(function(tn,tt){return b.createElement(ji,{key:tn.key,overflowDisabled:tt>xn},tn)}),Or=b.createElement(Fr,qe({id:q,ref:wt,prefixCls:"".concat(E,"-overflow"),component:"ul",itemComponent:Ms,className:Oe(E,"".concat(E,"-root"),"".concat(E,"-").concat(Xe),R,xt(xt({},"".concat(E,"-inline-collapsed"),$n),"".concat(E,"-rtl"),Et),C),dir:H,style:A,role:"menu",tabIndex:F,data:ur,renderRawItem:function(tt){return tt},renderRawRest:function(tt){var Jt=tt.length,Sn=Jt?Ft.slice(-Jt):null;return b.createElement(Da,{eventKey:Ca,title:Ze,disabled:ar,internalPopupClose:Jt===0,popupClassName:Qe},Sn)},maxCount:Xe!=="horizontal"||Z?Fr.INVALIDATE:Fr.RESPONSIVE,ssr:"full","data-menu-list":!0,onVisibleChange:function(tt){Lr(tt)},onKeyDown:jt},Tt));return b.createElement(La.Provider,{value:or},b.createElement(Nl.Provider,{value:Kt},b.createElement(ji,{prefixCls:E,rootClassName:C,mode:Xe,openKeys:Be,rtl:Et,disabled:Y,motion:pn?Ae:null,defaultMotions:pn?Se:null,activeKey:$t,onActive:kn,onInactive:bn,selectedKeys:In,inlineIndent:Ie,subMenuOpenDelay:ne,subMenuCloseDelay:te,forceSubMenuRender:se,builtinPlacements:De,triggerSubMenuAction:Me,getPopupContainer:yt,itemIcon:Ke,expandIcon:Ve,onItemClick:Gt,onOpenChange:er},b.createElement(Bl.Provider,{value:Yn},Or),b.createElement("div",{style:{display:"none"},"aria-hidden":!0},b.createElement(jl.Provider,{value:fn},vt)))))}),Yi=om;Yi.Item=Ms;Yi.SubMenu=Da;Yi.ItemGroup=Jl;Yi.Divider=Yl;var um={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M176 511a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"ellipsis",theme:"outlined"},lm=function(r,u){return b.createElement(On,qe({},r,{ref:u,icon:um}))},cm=b.forwardRef(lm);function Ma(e){return ir(e,{inputAffixPadding:e.paddingXXS})}const Pa=e=>{const{controlHeight:r,fontSize:u,lineHeight:c,lineWidth:f,controlHeightSM:E,controlHeightLG:C,fontSizeLG:A,lineHeightLG:R,paddingSM:M,controlPaddingHorizontalSM:F,controlPaddingHorizontal:j,colorFillAlter:B,colorPrimaryHover:H,colorPrimary:q,controlOutlineWidth:W,controlOutline:J,colorErrorOutline:G,colorWarningOutline:Y,colorBgContainer:Z,inputFontSize:X,inputFontSizeLG:ne,inputFontSizeSM:Q}=e,te=X||u,se=Q||te,le=ne||A,ie=Math.round((r-te*c)/2*10)/10-f,pe=Math.round((E-se*c)/2*10)/10-f,ve=Math.ceil((C-le*R)/2*10)/10-f;return{paddingBlock:Math.max(ie,0),paddingBlockSM:Math.max(pe,0),paddingBlockLG:Math.max(ve,0),paddingInline:M-f,paddingInlineSM:F-f,paddingInlineLG:j-f,addonBg:B,activeBorderColor:q,hoverBorderColor:H,activeShadow:`0 0 0 ${W}px ${J}`,errorActiveShadow:`0 0 0 ${W}px ${G}`,warningActiveShadow:`0 0 0 ${W}px ${Y}`,hoverBg:Z,activeBg:Z,inputFontSize:te,inputFontSizeLG:le,inputFontSizeSM:se}},hm=e=>({borderColor:e.hoverBorderColor,backgroundColor:e.hoverBg}),za=e=>({color:e.colorTextDisabled,backgroundColor:e.colorBgContainerDisabled,borderColor:e.colorBorder,boxShadow:"none",cursor:"not-allowed",opacity:1,"input[disabled], textarea[disabled]":{cursor:"not-allowed"},"&:hover:not([disabled])":Object.assign({},hm(ir(e,{hoverBorderColor:e.colorBorder,hoverBg:e.colorBgContainerDisabled})))}),ql=(e,r)=>({background:e.colorBgContainer,borderWidth:e.lineWidth,borderStyle:e.lineType,borderColor:r.borderColor,"&:hover":{borderColor:r.hoverBorderColor,backgroundColor:e.hoverBg},"&:focus, &:focus-within":{borderColor:r.activeBorderColor,boxShadow:r.activeShadow,outline:0,backgroundColor:e.activeBg}}),pu=(e,r)=>({[`&${e.componentCls}-status-${r.status}:not(${e.componentCls}-disabled)`]:Object.assign(Object.assign({},ql(e,r)),{[`${e.componentCls}-prefix, ${e.componentCls}-suffix`]:{color:r.affixColor}}),[`&${e.componentCls}-status-${r.status}${e.componentCls}-disabled`]:{borderColor:r.borderColor}}),dm=(e,r)=>({"&-outlined":Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ql(e,{borderColor:e.colorBorder,hoverBorderColor:e.hoverBorderColor,activeBorderColor:e.activeBorderColor,activeShadow:e.activeShadow})),{[`&${e.componentCls}-disabled, &[disabled]`]:Object.assign({},za(e))}),pu(e,{status:"error",borderColor:e.colorError,hoverBorderColor:e.colorErrorBorderHover,activeBorderColor:e.colorError,activeShadow:e.errorActiveShadow,affixColor:e.colorError})),pu(e,{status:"warning",borderColor:e.colorWarning,hoverBorderColor:e.colorWarningBorderHover,activeBorderColor:e.colorWarning,activeShadow:e.warningActiveShadow,affixColor:e.colorWarning})),r)}),fu=(e,r)=>({[`&${e.componentCls}-group-wrapper-status-${r.status}`]:{[`${e.componentCls}-group-addon`]:{borderColor:r.addonBorderColor,color:r.addonColor}}}),pm=e=>({"&-outlined":Object.assign(Object.assign(Object.assign({[`${e.componentCls}-group`]:{"&-addon":{background:e.addonBg,border:`${$e(e.lineWidth)} ${e.lineType} ${e.colorBorder}`},"&-addon:first-child":{borderInlineEnd:0},"&-addon:last-child":{borderInlineStart:0}}},fu(e,{status:"error",addonBorderColor:e.colorError,addonColor:e.colorErrorText})),fu(e,{status:"warning",addonBorderColor:e.colorWarning,addonColor:e.colorWarningText})),{[`&${e.componentCls}-group-wrapper-disabled`]:{[`${e.componentCls}-group-addon`]:Object.assign({},za(e))}})}),fm=(e,r)=>{const{componentCls:u}=e;return{"&-borderless":Object.assign({background:"transparent",border:"none","&:focus, &:focus-within":{outline:"none"},[`&${u}-disabled, &[disabled]`]:{color:e.colorTextDisabled,cursor:"not-allowed"},[`&${u}-status-error`]:{"&, & input, & textarea":{color:e.colorError}},[`&${u}-status-warning`]:{"&, & input, & textarea":{color:e.colorWarning}}},r)}},Zl=(e,r)=>{var u;return{background:r.bg,borderWidth:e.lineWidth,borderStyle:e.lineType,borderColor:"transparent","input&, & input, textarea&, & textarea":{color:(u=r==null?void 0:r.inputColor)!==null&&u!==void 0?u:"unset"},"&:hover":{background:r.hoverBg},"&:focus, &:focus-within":{outline:0,borderColor:r.activeBorderColor,backgroundColor:e.activeBg}}},mu=(e,r)=>({[`&${e.componentCls}-status-${r.status}:not(${e.componentCls}-disabled)`]:Object.assign(Object.assign({},Zl(e,r)),{[`${e.componentCls}-prefix, ${e.componentCls}-suffix`]:{color:r.affixColor}})}),mm=(e,r)=>({"&-filled":Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Zl(e,{bg:e.colorFillTertiary,hoverBg:e.colorFillSecondary,activeBorderColor:e.activeBorderColor})),{[`&${e.componentCls}-disabled, &[disabled]`]:Object.assign({},za(e))}),mu(e,{status:"error",bg:e.colorErrorBg,hoverBg:e.colorErrorBgHover,activeBorderColor:e.colorError,inputColor:e.colorErrorText,affixColor:e.colorError})),mu(e,{status:"warning",bg:e.colorWarningBg,hoverBg:e.colorWarningBgHover,activeBorderColor:e.colorWarning,inputColor:e.colorWarningText,affixColor:e.colorWarning})),r)}),gu=(e,r)=>({[`&${e.componentCls}-group-wrapper-status-${r.status}`]:{[`${e.componentCls}-group-addon`]:{background:r.addonBg,color:r.addonColor}}}),gm=e=>({"&-filled":Object.assign(Object.assign(Object.assign({[`${e.componentCls}-group-addon`]:{background:e.colorFillTertiary,"&:last-child":{position:"static"}}},gu(e,{status:"error",addonBg:e.colorErrorBg,addonColor:e.colorErrorText})),gu(e,{status:"warning",addonBg:e.colorWarningBg,addonColor:e.colorWarningText})),{[`&${e.componentCls}-group-wrapper-disabled`]:{[`${e.componentCls}-group`]:{"&-addon":{background:e.colorFillTertiary,color:e.colorTextDisabled},"&-addon:first-child":{borderInlineStart:`${$e(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderTop:`${$e(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderBottom:`${$e(e.lineWidth)} ${e.lineType} ${e.colorBorder}`},"&-addon:last-child":{borderInlineEnd:`${$e(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderTop:`${$e(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderBottom:`${$e(e.lineWidth)} ${e.lineType} ${e.colorBorder}`}}}})}),Ql=(e,r)=>({background:e.colorBgContainer,borderWidth:`${$e(e.lineWidth)} 0`,borderStyle:`${e.lineType} none`,borderColor:`transparent transparent ${r.borderColor} transparent`,borderRadius:0,"&:hover":{borderColor:`transparent transparent ${r.borderColor} transparent`,backgroundColor:e.hoverBg},"&:focus, &:focus-within":{borderColor:`transparent transparent ${r.borderColor} transparent`,outline:0,backgroundColor:e.activeBg}}),yu=(e,r)=>({[`&${e.componentCls}-status-${r.status}:not(${e.componentCls}-disabled)`]:Object.assign(Object.assign({},Ql(e,r)),{[`${e.componentCls}-prefix, ${e.componentCls}-suffix`]:{color:r.affixColor}}),[`&${e.componentCls}-status-${r.status}${e.componentCls}-disabled`]:{borderColor:`transparent transparent ${r.borderColor} transparent`}}),ym=(e,r)=>({"&-underlined":Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ql(e,{borderColor:e.colorBorder,hoverBorderColor:e.hoverBorderColor,activeBorderColor:e.activeBorderColor,activeShadow:e.activeShadow})),{[`&${e.componentCls}-disabled, &[disabled]`]:{color:e.colorTextDisabled,boxShadow:"none",cursor:"not-allowed","&:hover":{borderColor:`transparent transparent ${e.colorBorder} transparent`}},"input[disabled], textarea[disabled]":{cursor:"not-allowed"}}),yu(e,{status:"error",borderColor:e.colorError,hoverBorderColor:e.colorErrorBorderHover,activeBorderColor:e.colorError,activeShadow:e.errorActiveShadow,affixColor:e.colorError})),yu(e,{status:"warning",borderColor:e.colorWarning,hoverBorderColor:e.colorWarningBorderHover,activeBorderColor:e.colorWarning,activeShadow:e.warningActiveShadow,affixColor:e.colorWarning})),r)}),xm=e=>({"&::-moz-placeholder":{opacity:1},"&::placeholder":{color:e,userSelect:"none"},"&:placeholder-shown":{textOverflow:"ellipsis"}}),ec=e=>{const{paddingBlockLG:r,lineHeightLG:u,borderRadiusLG:c,paddingInlineLG:f}=e;return{padding:`${$e(r)} ${$e(f)}`,fontSize:e.inputFontSizeLG,lineHeight:u,borderRadius:c}},tc=e=>({padding:`${$e(e.paddingBlockSM)} ${$e(e.paddingInlineSM)}`,fontSize:e.inputFontSizeSM,borderRadius:e.borderRadiusSM}),nc=e=>Object.assign(Object.assign({position:"relative",display:"inline-block",width:"100%",minWidth:0,padding:`${$e(e.paddingBlock)} ${$e(e.paddingInline)}`,color:e.colorText,fontSize:e.inputFontSize,lineHeight:e.lineHeight,borderRadius:e.borderRadius,transition:`all ${e.motionDurationMid}`},xm(e.colorTextPlaceholder)),{"&-lg":Object.assign({},ec(e)),"&-sm":Object.assign({},tc(e)),"&-rtl, &-textarea-rtl":{direction:"rtl"}}),bm=e=>{const{componentCls:r,antCls:u}=e;return{position:"relative",display:"table",width:"100%",borderCollapse:"separate",borderSpacing:0,"&[class*='col-']":{paddingInlineEnd:e.paddingXS,"&:last-child":{paddingInlineEnd:0}},[`&-lg ${r}, &-lg > ${r}-group-addon`]:Object.assign({},ec(e)),[`&-sm ${r}, &-sm > ${r}-group-addon`]:Object.assign({},tc(e)),[`&-lg ${u}-select-single ${u}-select-selector`]:{height:e.controlHeightLG},[`&-sm ${u}-select-single ${u}-select-selector`]:{height:e.controlHeightSM},[`> ${r}`]:{display:"table-cell","&:not(:first-child):not(:last-child)":{borderRadius:0}},[`${r}-group`]:{"&-addon, &-wrap":{display:"table-cell",width:1,whiteSpace:"nowrap",verticalAlign:"middle","&:not(:first-child):not(:last-child)":{borderRadius:0}},"&-wrap > *":{display:"block !important"},"&-addon":{position:"relative",padding:`0 ${$e(e.paddingInline)}`,color:e.colorText,fontWeight:"normal",fontSize:e.inputFontSize,textAlign:"center",borderRadius:e.borderRadius,transition:`all ${e.motionDurationSlow}`,lineHeight:1,[`${u}-select`]:{margin:`${$e(e.calc(e.paddingBlock).add(1).mul(-1).equal())} ${$e(e.calc(e.paddingInline).mul(-1).equal())}`,[`&${u}-select-single:not(${u}-select-customize-input):not(${u}-pagination-size-changer)`]:{[`${u}-select-selector`]:{backgroundColor:"inherit",border:`${$e(e.lineWidth)} ${e.lineType} transparent`,boxShadow:"none"}}},[`${u}-cascader-picker`]:{margin:`-9px ${$e(e.calc(e.paddingInline).mul(-1).equal())}`,backgroundColor:"transparent",[`${u}-cascader-input`]:{textAlign:"start",border:0,boxShadow:"none"}}}},[r]:{width:"100%",marginBottom:0,textAlign:"inherit","&:focus":{zIndex:1,borderInlineEndWidth:1},"&:hover":{zIndex:1,borderInlineEndWidth:1,[`${r}-search-with-button &`]:{zIndex:0}}},[`> ${r}:first-child, ${r}-group-addon:first-child`]:{borderStartEndRadius:0,borderEndEndRadius:0,[`${u}-select ${u}-select-selector`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`> ${r}-affix-wrapper`]:{[`&:not(:first-child) ${r}`]:{borderStartStartRadius:0,borderEndStartRadius:0},[`&:not(:last-child) ${r}`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`> ${r}:last-child, ${r}-group-addon:last-child`]:{borderStartStartRadius:0,borderEndStartRadius:0,[`${u}-select ${u}-select-selector`]:{borderStartStartRadius:0,borderEndStartRadius:0}},[`${r}-affix-wrapper`]:{"&:not(:last-child)":{borderStartEndRadius:0,borderEndEndRadius:0,[`${r}-search &`]:{borderStartStartRadius:e.borderRadius,borderEndStartRadius:e.borderRadius}},[`&:not(:first-child), ${r}-search &:not(:first-child)`]:{borderStartStartRadius:0,borderEndStartRadius:0}},[`&${r}-group-compact`]:Object.assign(Object.assign({display:"block"},Gi()),{[`${r}-group-addon, ${r}-group-wrap, > ${r}`]:{"&:not(:first-child):not(:last-child)":{borderInlineEndWidth:e.lineWidth,"&:hover, &:focus":{zIndex:1}}},"& > *":{display:"inline-flex",float:"none",verticalAlign:"top",borderRadius:0},[`
        & > ${r}-affix-wrapper,
        & > ${r}-number-affix-wrapper,
        & > ${u}-picker-range
      `]:{display:"inline-flex"},"& > *:not(:last-child)":{marginInlineEnd:e.calc(e.lineWidth).mul(-1).equal(),borderInlineEndWidth:e.lineWidth},[r]:{float:"none"},[`& > ${u}-select > ${u}-select-selector,
      & > ${u}-select-auto-complete ${r},
      & > ${u}-cascader-picker ${r},
      & > ${r}-group-wrapper ${r}`]:{borderInlineEndWidth:e.lineWidth,borderRadius:0,"&:hover, &:focus":{zIndex:1}},[`& > ${u}-select-focused`]:{zIndex:1},[`& > ${u}-select > ${u}-select-arrow`]:{zIndex:1},[`& > *:first-child,
      & > ${u}-select:first-child > ${u}-select-selector,
      & > ${u}-select-auto-complete:first-child ${r},
      & > ${u}-cascader-picker:first-child ${r}`]:{borderStartStartRadius:e.borderRadius,borderEndStartRadius:e.borderRadius},[`& > *:last-child,
      & > ${u}-select:last-child > ${u}-select-selector,
      & > ${u}-cascader-picker:last-child ${r},
      & > ${u}-cascader-picker-focused:last-child ${r}`]:{borderInlineEndWidth:e.lineWidth,borderStartEndRadius:e.borderRadius,borderEndEndRadius:e.borderRadius},[`& > ${u}-select-auto-complete ${r}`]:{verticalAlign:"top"},[`${r}-group-wrapper + ${r}-group-wrapper`]:{marginInlineStart:e.calc(e.lineWidth).mul(-1).equal(),[`${r}-affix-wrapper`]:{borderRadius:0}},[`${r}-group-wrapper:not(:last-child)`]:{[`&${r}-search > ${r}-group`]:{[`& > ${r}-group-addon > ${r}-search-button`]:{borderRadius:0},[`& > ${r}`]:{borderStartStartRadius:e.borderRadius,borderStartEndRadius:0,borderEndEndRadius:0,borderEndStartRadius:e.borderRadius}}}})}},vm=e=>{const{componentCls:r,controlHeightSM:u,lineWidth:c,calc:f}=e,C=f(u).sub(f(c).mul(2)).sub(16).div(2).equal();return{[r]:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ir(e)),nc(e)),dm(e)),mm(e)),fm(e)),ym(e)),{'&[type="color"]':{height:e.controlHeight,[`&${r}-lg`]:{height:e.controlHeightLG},[`&${r}-sm`]:{height:u,paddingTop:C,paddingBottom:C}},'&[type="search"]::-webkit-search-cancel-button, &[type="search"]::-webkit-search-decoration':{appearance:"none"}})}},wm=e=>{const{componentCls:r}=e;return{[`${r}-clear-icon`]:{margin:0,padding:0,lineHeight:0,color:e.colorTextQuaternary,fontSize:e.fontSizeIcon,verticalAlign:-1,cursor:"pointer",transition:`color ${e.motionDurationSlow}`,border:"none",outline:"none",backgroundColor:"transparent","&:hover":{color:e.colorIcon},"&:active":{color:e.colorText},"&-hidden":{visibility:"hidden"},"&-has-suffix":{margin:`0 ${$e(e.inputAffixPadding)}`}}}},Sm=e=>{const{componentCls:r,inputAffixPadding:u,colorTextDescription:c,motionDurationSlow:f,colorIcon:E,colorIconHover:C,iconCls:A}=e,R=`${r}-affix-wrapper`,M=`${r}-affix-wrapper-disabled`;return{[R]:Object.assign(Object.assign(Object.assign(Object.assign({},nc(e)),{display:"inline-flex",[`&:not(${r}-disabled):hover`]:{zIndex:1,[`${r}-search-with-button &`]:{zIndex:0}},"&-focused, &:focus":{zIndex:1},[`> input${r}`]:{padding:0},[`> input${r}, > textarea${r}`]:{fontSize:"inherit",border:"none",borderRadius:0,outline:"none",background:"transparent",color:"inherit","&::-ms-reveal":{display:"none"},"&:focus":{boxShadow:"none !important"}},"&::before":{display:"inline-block",width:0,visibility:"hidden",content:'"\\a0"'},[r]:{"&-prefix, &-suffix":{display:"flex",flex:"none",alignItems:"center","> *:not(:last-child)":{marginInlineEnd:e.paddingXS}},"&-show-count-suffix":{color:c,direction:"ltr"},"&-show-count-has-suffix":{marginInlineEnd:e.paddingXXS},"&-prefix":{marginInlineEnd:u},"&-suffix":{marginInlineStart:u}}}),wm(e)),{[`${A}${r}-password-icon`]:{color:E,cursor:"pointer",transition:`all ${f}`,"&:hover":{color:C}}}),[`${r}-underlined`]:{borderRadius:0},[M]:{[`${A}${r}-password-icon`]:{color:E,cursor:"not-allowed","&:hover":{color:E}}}}},Tm=e=>{const{componentCls:r,borderRadiusLG:u,borderRadiusSM:c}=e;return{[`${r}-group`]:Object.assign(Object.assign(Object.assign({},Ir(e)),bm(e)),{"&-rtl":{direction:"rtl"},"&-wrapper":Object.assign(Object.assign(Object.assign({display:"inline-block",width:"100%",textAlign:"start",verticalAlign:"top","&-rtl":{direction:"rtl"},"&-lg":{[`${r}-group-addon`]:{borderRadius:u,fontSize:e.inputFontSizeLG}},"&-sm":{[`${r}-group-addon`]:{borderRadius:c}}},pm(e)),gm(e)),{[`&:not(${r}-compact-first-item):not(${r}-compact-last-item)${r}-compact-item`]:{[`${r}, ${r}-group-addon`]:{borderRadius:0}},[`&:not(${r}-compact-last-item)${r}-compact-first-item`]:{[`${r}, ${r}-group-addon`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`&:not(${r}-compact-first-item)${r}-compact-last-item`]:{[`${r}, ${r}-group-addon`]:{borderStartStartRadius:0,borderEndStartRadius:0}},[`&:not(${r}-compact-last-item)${r}-compact-item`]:{[`${r}-affix-wrapper`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`&:not(${r}-compact-first-item)${r}-compact-item`]:{[`${r}-affix-wrapper`]:{borderStartStartRadius:0,borderEndStartRadius:0}}})})}},Em=e=>{const{componentCls:r,antCls:u}=e,c=`${r}-search`;return{[c]:{[r]:{"&:hover, &:focus":{[`+ ${r}-group-addon ${c}-button:not(${u}-btn-color-primary):not(${u}-btn-variant-text)`]:{borderInlineStartColor:e.colorPrimaryHover}}},[`${r}-affix-wrapper`]:{height:e.controlHeight,borderRadius:0},[`${r}-lg`]:{lineHeight:e.calc(e.lineHeightLG).sub(2e-4).equal()},[`> ${r}-group`]:{[`> ${r}-group-addon:last-child`]:{insetInlineStart:-1,padding:0,border:0,[`${c}-button`]:{marginInlineEnd:-1,borderStartStartRadius:0,borderEndStartRadius:0,boxShadow:"none"},[`${c}-button:not(${u}-btn-color-primary)`]:{color:e.colorTextDescription,"&:hover":{color:e.colorPrimaryHover},"&:active":{color:e.colorPrimaryActive},[`&${u}-btn-loading::before`]:{inset:0}}}},[`${c}-button`]:{height:e.controlHeight,"&:hover, &:focus":{zIndex:1}},"&-large":{[`${r}-affix-wrapper, ${c}-button`]:{height:e.controlHeightLG}},"&-small":{[`${r}-affix-wrapper, ${c}-button`]:{height:e.controlHeightSM}},"&-rtl":{direction:"rtl"},[`&${r}-compact-item`]:{[`&:not(${r}-compact-last-item)`]:{[`${r}-group-addon`]:{[`${r}-search-button`]:{marginInlineEnd:e.calc(e.lineWidth).mul(-1).equal(),borderRadius:0}}},[`&:not(${r}-compact-first-item)`]:{[`${r},${r}-affix-wrapper`]:{borderRadius:0}},[`> ${r}-group-addon ${r}-search-button,
        > ${r},
        ${r}-affix-wrapper`]:{"&:hover, &:focus, &:active":{zIndex:2}},[`> ${r}-affix-wrapper-focused`]:{zIndex:2}}}}},Cm=e=>{const{componentCls:r}=e;return{[`${r}-out-of-range`]:{[`&, & input, & textarea, ${r}-show-count-suffix, ${r}-data-count`]:{color:e.colorError}}}},$m=Sr(["Input","Shared"],e=>{const r=ir(e,Ma(e));return[vm(r),Sm(r)]},Pa,{resetFont:!1});Sr(["Input","Component"],e=>{const r=ir(e,Ma(e));return[Tm(r),Em(r),Cm(r),bd(r)]},Pa,{resetFont:!1});var _m={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8z"}},{tag:"path",attrs:{d:"M192 474h672q8 0 8 8v60q0 8-8 8H160q-8 0-8-8v-60q0-8 8-8z"}}]},name:"plus",theme:"outlined"},Im=function(r,u){return b.createElement(On,qe({},r,{ref:u,icon:_m}))},Lm=b.forwardRef(Im);const Ps=b.createContext(null);var Om=function(r){var u=r.activeTabOffset,c=r.horizontal,f=r.rtl,E=r.indicator,C=E===void 0?{}:E,A=C.size,R=C.align,M=R===void 0?"center":R,F=b.useState(),j=ze(F,2),B=j[0],H=j[1],q=b.useRef(),W=Ot.useCallback(function(G){return typeof A=="function"?A(G):typeof A=="number"?A:G},[A]);function J(){br.cancel(q.current)}return b.useEffect(function(){var G={};if(u)if(c){G.width=W(u.width);var Y=f?"right":"left";M==="start"&&(G[Y]=u[Y]),M==="center"&&(G[Y]=u[Y]+u.width/2,G.transform=f?"translateX(50%)":"translateX(-50%)"),M==="end"&&(G[Y]=u[Y]+u.width,G.transform="translateX(-100%)")}else G.height=W(u.height),M==="start"&&(G.top=u.top),M==="center"&&(G.top=u.top+u.height/2,G.transform="translateY(-50%)"),M==="end"&&(G.top=u.top+u.height,G.transform="translateY(-100%)");return J(),q.current=br(function(){var Z=B&&G&&Object.keys(G).every(function(X){var ne=G[X],Q=B[X];return typeof ne=="number"&&typeof Q=="number"?Math.round(ne)===Math.round(Q):ne===Q});Z||H(G)}),J},[JSON.stringify(u),c,f,M,W]),{style:B}},xu={width:0,height:0,left:0,top:0};function Am(e,r,u){return b.useMemo(function(){for(var c,f=new Map,E=r.get((c=e[0])===null||c===void 0?void 0:c.key)||xu,C=E.left+E.width,A=0;A<e.length;A+=1){var R=e[A].key,M=r.get(R);if(!M){var F;M=r.get((F=e[A-1])===null||F===void 0?void 0:F.key)||xu}var j=f.get(R)||Fe({},M);j.right=C-j.left-j.width,f.set(R,j)}return f},[e.map(function(c){return c.key}).join("_"),r,u])}function bu(e,r){var u=b.useRef(e),c=b.useState({}),f=ze(c,2),E=f[1];function C(A){var R=typeof A=="function"?A(u.current):A;R!==u.current&&r(R,u.current),u.current=R,E({})}return[u.current,C]}var Rm=.1,vu=.01,vs=20,wu=Math.pow(.995,vs);function km(e,r){var u=b.useState(),c=ze(u,2),f=c[0],E=c[1],C=b.useState(0),A=ze(C,2),R=A[0],M=A[1],F=b.useState(0),j=ze(F,2),B=j[0],H=j[1],q=b.useState(),W=ze(q,2),J=W[0],G=W[1],Y=b.useRef();function Z(le){var ie=le.touches[0],pe=ie.screenX,ve=ie.screenY;E({x:pe,y:ve}),window.clearInterval(Y.current)}function X(le){if(f){var ie=le.touches[0],pe=ie.screenX,ve=ie.screenY;E({x:pe,y:ve});var de=pe-f.x,me=ve-f.y;r(de,me);var Ee=Date.now();M(Ee),H(Ee-R),G({x:de,y:me})}}function ne(){if(f&&(E(null),G(null),J)){var le=J.x/B,ie=J.y/B,pe=Math.abs(le),ve=Math.abs(ie);if(Math.max(pe,ve)<Rm)return;var de=le,me=ie;Y.current=window.setInterval(function(){if(Math.abs(de)<vu&&Math.abs(me)<vu){window.clearInterval(Y.current);return}de*=wu,me*=wu,r(de*vs,me*vs)},vs)}}var Q=b.useRef();function te(le){var ie=le.deltaX,pe=le.deltaY,ve=0,de=Math.abs(ie),me=Math.abs(pe);de===me?ve=Q.current==="x"?ie:pe:de>me?(ve=ie,Q.current="x"):(ve=pe,Q.current="y"),r(-ve,-ve)&&le.preventDefault()}var se=b.useRef(null);se.current={onTouchStart:Z,onTouchMove:X,onTouchEnd:ne,onWheel:te},b.useEffect(function(){function le(de){se.current.onTouchStart(de)}function ie(de){se.current.onTouchMove(de)}function pe(de){se.current.onTouchEnd(de)}function ve(de){se.current.onWheel(de)}return document.addEventListener("touchmove",ie,{passive:!1}),document.addEventListener("touchend",pe,{passive:!0}),e.current.addEventListener("touchstart",le,{passive:!0}),e.current.addEventListener("wheel",ve,{passive:!1}),function(){document.removeEventListener("touchmove",ie),document.removeEventListener("touchend",pe)}},[])}function rc(e){var r=b.useState(0),u=ze(r,2),c=u[0],f=u[1],E=b.useRef(0),C=b.useRef();return C.current=e,pa(function(){var A;(A=C.current)===null||A===void 0||A.call(C)},[c]),function(){E.current===c&&(E.current+=1,f(E.current))}}function Dm(e){var r=b.useRef([]),u=b.useState({}),c=ze(u,2),f=c[1],E=b.useRef(typeof e=="function"?e():e),C=rc(function(){var R=E.current;r.current.forEach(function(M){R=M(R)}),r.current=[],E.current=R,f({})});function A(R){r.current.push(R),C()}return[E.current,A]}var Su={width:0,height:0,left:0,top:0,right:0};function Mm(e,r,u,c,f,E,C){var A=C.tabs,R=C.tabPosition,M=C.rtl,F,j,B;return["top","bottom"].includes(R)?(F="width",j=M?"right":"left",B=Math.abs(u)):(F="height",j="top",B=-u),b.useMemo(function(){if(!A.length)return[0,0];for(var H=A.length,q=H,W=0;W<H;W+=1){var J=e.get(A[W].key)||Su;if(Math.floor(J[j]+J[F])>Math.floor(B+r)){q=W-1;break}}for(var G=0,Y=H-1;Y>=0;Y-=1){var Z=e.get(A[Y].key)||Su;if(Z[j]<B){G=Y+1;break}}return G>=q?[0,0]:[G,q]},[e,r,c,f,E,B,R,A.map(function(H){return H.key}).join("_"),M])}function Tu(e){var r;return e instanceof Map?(r={},e.forEach(function(u,c){r[c]=u})):r=e,JSON.stringify(r)}var Pm="TABS_DQ";function ic(e){return String(e).replace(/"/g,Pm)}function Na(e,r,u,c){return!(!u||c||e===!1||e===void 0&&(r===!1||r===null))}var sc=b.forwardRef(function(e,r){var u=e.prefixCls,c=e.editable,f=e.locale,E=e.style;return!c||c.showAdd===!1?null:b.createElement("button",{ref:r,type:"button",className:"".concat(u,"-nav-add"),style:E,"aria-label":(f==null?void 0:f.addAriaLabel)||"Add tab",onClick:function(A){c.onEdit("add",{event:A})}},c.addIcon||"+")}),Eu=b.forwardRef(function(e,r){var u=e.position,c=e.prefixCls,f=e.extra;if(!f)return null;var E,C={};return rr(f)==="object"&&!b.isValidElement(f)?C=f:C.right=f,u==="right"&&(E=C.right),u==="left"&&(E=C.left),E?b.createElement("div",{className:"".concat(c,"-extra-content"),ref:r},E):null}),zm=b.forwardRef(function(e,r){var u=e.prefixCls,c=e.id,f=e.tabs,E=e.locale,C=e.mobile,A=e.more,R=A===void 0?{}:A,M=e.style,F=e.className,j=e.editable,B=e.tabBarGutter,H=e.rtl,q=e.removeAriaLabel,W=e.onTabClick,J=e.getPopupContainer,G=e.popupClassName,Y=b.useState(!1),Z=ze(Y,2),X=Z[0],ne=Z[1],Q=b.useState(null),te=ze(Q,2),se=te[0],le=te[1],ie=R.icon,pe=ie===void 0?"More":ie,ve="".concat(c,"-more-popup"),de="".concat(u,"-dropdown"),me=se!==null?"".concat(ve,"-").concat(se):null,Ee=E==null?void 0:E.dropdownAriaLabel;function ye(Ae,Se){Ae.preventDefault(),Ae.stopPropagation(),j.onEdit("remove",{key:Se,event:Ae})}var Ce=b.createElement(Yi,{onClick:function(Se){var ke=Se.key,Me=Se.domEvent;W(ke,Me),ne(!1)},prefixCls:"".concat(de,"-menu"),id:ve,tabIndex:-1,role:"listbox","aria-activedescendant":me,selectedKeys:[se],"aria-label":Ee!==void 0?Ee:"expanded dropdown"},f.map(function(Ae){var Se=Ae.closable,ke=Ae.disabled,Me=Ae.closeIcon,De=Ae.key,Ke=Ae.label,Ve=Na(Se,Me,j,ke);return b.createElement(Ms,{key:De,id:"".concat(ve,"-").concat(De),role:"option","aria-controls":c&&"".concat(c,"-panel-").concat(De),disabled:ke},b.createElement("span",null,Ke),Ve&&b.createElement("button",{type:"button","aria-label":q||"remove",tabIndex:0,className:"".concat(de,"-menu-item-remove"),onClick:function(Ze){Ze.stopPropagation(),ye(Ze,De)}},Me||j.removeIcon||"×"))}));function oe(Ae){for(var Se=f.filter(function(Ve){return!Ve.disabled}),ke=Se.findIndex(function(Ve){return Ve.key===se})||0,Me=Se.length,De=0;De<Me;De+=1){ke=(ke+Ae+Me)%Me;var Ke=Se[ke];if(!Ke.disabled){le(Ke.key);return}}}function ae(Ae){var Se=Ae.which;if(!X){[vn.DOWN,vn.SPACE,vn.ENTER].includes(Se)&&(ne(!0),Ae.preventDefault());return}switch(Se){case vn.UP:oe(-1),Ae.preventDefault();break;case vn.DOWN:oe(1),Ae.preventDefault();break;case vn.ESC:ne(!1);break;case vn.SPACE:case vn.ENTER:se!==null&&W(se,Ae);break}}b.useEffect(function(){var Ae=document.getElementById(me);Ae&&Ae.scrollIntoView&&Ae.scrollIntoView(!1)},[se]),b.useEffect(function(){X||le(null)},[X]);var be=xt({},H?"marginRight":"marginLeft",B);f.length||(be.visibility="hidden",be.order=1);var Le=Oe(xt({},"".concat(de,"-rtl"),H)),Ie=C?null:b.createElement($f,qe({prefixCls:de,overlay:Ce,visible:f.length?X:!1,onVisibleChange:ne,overlayClassName:Oe(Le,G),mouseEnterDelay:.1,mouseLeaveDelay:.1,getPopupContainer:J},R),b.createElement("button",{type:"button",className:"".concat(u,"-nav-more"),style:be,"aria-haspopup":"listbox","aria-controls":ve,id:"".concat(c,"-more"),"aria-expanded":X,onKeyDown:ae},pe));return b.createElement("div",{className:Oe("".concat(u,"-nav-operations"),F),style:M,ref:r},Ie,b.createElement(sc,{prefixCls:u,locale:E,editable:j}))});const Nm=b.memo(zm,function(e,r){return r.tabMoving});var Fm=function(r){var u=r.prefixCls,c=r.id,f=r.active,E=r.focus,C=r.tab,A=C.key,R=C.label,M=C.disabled,F=C.closeIcon,j=C.icon,B=r.closable,H=r.renderWrapper,q=r.removeAriaLabel,W=r.editable,J=r.onClick,G=r.onFocus,Y=r.onBlur,Z=r.onKeyDown,X=r.onMouseDown,ne=r.onMouseUp,Q=r.style,te=r.tabCount,se=r.currentPosition,le="".concat(u,"-tab"),ie=Na(B,F,W,M);function pe(ye){M||J(ye)}function ve(ye){ye.preventDefault(),ye.stopPropagation(),W.onEdit("remove",{key:A,event:ye})}var de=b.useMemo(function(){return j&&typeof R=="string"?b.createElement("span",null,R):R},[R,j]),me=b.useRef(null);b.useEffect(function(){E&&me.current&&me.current.focus()},[E]);var Ee=b.createElement("div",{key:A,"data-node-key":ic(A),className:Oe(le,xt(xt(xt(xt({},"".concat(le,"-with-remove"),ie),"".concat(le,"-active"),f),"".concat(le,"-disabled"),M),"".concat(le,"-focus"),E)),style:Q,onClick:pe},b.createElement("div",{ref:me,role:"tab","aria-selected":f,id:c&&"".concat(c,"-tab-").concat(A),className:"".concat(le,"-btn"),"aria-controls":c&&"".concat(c,"-panel-").concat(A),"aria-disabled":M,tabIndex:M?null:f?0:-1,onClick:function(Ce){Ce.stopPropagation(),pe(Ce)},onKeyDown:Z,onMouseDown:X,onMouseUp:ne,onFocus:G,onBlur:Y},E&&b.createElement("div",{"aria-live":"polite",style:{width:0,height:0,position:"absolute",overflow:"hidden",opacity:0}},"Tab ".concat(se," of ").concat(te)),j&&b.createElement("span",{className:"".concat(le,"-icon")},j),R&&de),ie&&b.createElement("button",{type:"button",role:"tab","aria-label":q||"remove",tabIndex:f?0:-1,className:"".concat(le,"-remove"),onClick:function(Ce){Ce.stopPropagation(),ve(Ce)}},F||W.removeIcon||"×"));return H?H(Ee):Ee},Vm=function(r,u){var c=r.offsetWidth,f=r.offsetHeight,E=r.offsetTop,C=r.offsetLeft,A=r.getBoundingClientRect(),R=A.width,M=A.height,F=A.left,j=A.top;return Math.abs(R-c)<1?[R,M,F-u.left,j-u.top]:[c,f,C,E]},yi=function(r){var u=r.current||{},c=u.offsetWidth,f=c===void 0?0:c,E=u.offsetHeight,C=E===void 0?0:E;if(r.current){var A=r.current.getBoundingClientRect(),R=A.width,M=A.height;if(Math.abs(R-f)<1)return[R,M]}return[f,C]},ps=function(r,u){return r[u?0:1]},Cu=b.forwardRef(function(e,r){var u=e.className,c=e.style,f=e.id,E=e.animated,C=e.activeKey,A=e.rtl,R=e.extra,M=e.editable,F=e.locale,j=e.tabPosition,B=e.tabBarGutter,H=e.children,q=e.onTabClick,W=e.onTabScroll,J=e.indicator,G=b.useContext(Ps),Y=G.prefixCls,Z=G.tabs,X=b.useRef(null),ne=b.useRef(null),Q=b.useRef(null),te=b.useRef(null),se=b.useRef(null),le=b.useRef(null),ie=b.useRef(null),pe=j==="top"||j==="bottom",ve=bu(0,function(Pt,Je){pe&&W&&W({direction:Pt>Je?"left":"right"})}),de=ze(ve,2),me=de[0],Ee=de[1],ye=bu(0,function(Pt,Je){!pe&&W&&W({direction:Pt>Je?"top":"bottom"})}),Ce=ze(ye,2),oe=Ce[0],ae=Ce[1],be=b.useState([0,0]),Le=ze(be,2),Ie=Le[0],Ae=Le[1],Se=b.useState([0,0]),ke=ze(Se,2),Me=ke[0],De=ke[1],Ke=b.useState([0,0]),Ve=ze(Ke,2),at=Ve[0],Ze=Ve[1],Qe=b.useState([0,0]),yt=ze(Qe,2),ge=yt[0],Ge=yt[1],We=Dm(new Map),we=ze(We,2),ot=we[0],et=we[1],Tt=Am(Z,ot,Me[0]),ut=ps(Ie,pe),Ut=ps(Me,pe),Ft=ps(at,pe),vt=ps(ge,pe),on=Math.floor(ut)<Math.floor(Ut+Ft),ht=on?ut-vt:ut-Ft,pn="".concat(Y,"-nav-operations-hidden"),Wt=0,wt=0;pe&&A?(Wt=0,wt=Math.max(0,Ut-ht)):(Wt=Math.min(0,ht-Ut),wt=0);function Kt(Pt){return Pt<Wt?Wt:Pt>wt?wt:Pt}var Et=b.useRef(null),kt=b.useState(),dt=ze(kt,2),Be=dt[0],Ct=dt[1];function Ne(){Ct(Date.now())}function He(){Et.current&&clearTimeout(Et.current)}km(te,function(Pt,Je){function $t(Ht,kn){Ht(function(bn){var Dn=Kt(bn+kn);return Dn})}return on?(pe?$t(Ee,Pt):$t(ae,Je),He(),Ne(),!0):!1}),b.useEffect(function(){return He(),Be&&(Et.current=setTimeout(function(){Ct(0)},100)),He},[Be]);var qt=Mm(Tt,ht,pe?me:oe,Ut,Ft,vt,Fe(Fe({},e),{},{tabs:Z})),Pn=ze(qt,2),An=Pn[0],Xt=Pn[1],sr=pr(function(){var Pt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:C,Je=Tt.get(Pt)||{width:0,height:0,left:0,right:0,top:0};if(pe){var $t=me;A?Je.right<me?$t=Je.right:Je.right+Je.width>me+ht&&($t=Je.right+Je.width-ht):Je.left<-me?$t=-Je.left:Je.left+Je.width>-me+ht&&($t=-(Je.left+Je.width-ht)),ae(0),Ee(Kt($t))}else{var Ht=oe;Je.top<-oe?Ht=-Je.top:Je.top+Je.height>-oe+ht&&(Ht=-(Je.top+Je.height-ht)),Ee(0),ae(Kt(Ht))}}),Bt=b.useState(),en=ze(Bt,2),zt=en[0],Vt=en[1],nt=b.useState(!1),rt=ze(nt,2),Xe=rt[0],Lt=rt[1],Yt=Z.filter(function(Pt){return!Pt.disabled}).map(function(Pt){return Pt.key}),cn=function(Je){var $t=Yt.indexOf(zt||C),Ht=Yt.length,kn=($t+Je+Ht)%Ht,bn=Yt[kn];Vt(bn)},$n=function(Je){var $t=Je.code,Ht=A&&pe,kn=Yt[0],bn=Yt[Yt.length-1];switch($t){case"ArrowLeft":{pe&&cn(Ht?1:-1);break}case"ArrowRight":{pe&&cn(Ht?-1:1);break}case"ArrowUp":{Je.preventDefault(),pe||cn(-1);break}case"ArrowDown":{Je.preventDefault(),pe||cn(1);break}case"Home":{Je.preventDefault(),Vt(kn);break}case"End":{Je.preventDefault(),Vt(bn);break}case"Enter":case"Space":{Je.preventDefault(),q(zt??C,Je);break}case"Backspace":case"Delete":{var Dn=Yt.indexOf(zt),sn=Z.find(function(Nn){return Nn.key===zt}),In=Na(sn==null?void 0:sn.closable,sn==null?void 0:sn.closeIcon,M,sn==null?void 0:sn.disabled);In&&(Je.preventDefault(),Je.stopPropagation(),M.onEdit("remove",{key:zt,event:Je}),Dn===Yt.length-1?cn(-1):cn(1));break}}},Bn={};pe?Bn[A?"marginRight":"marginLeft"]=B:Bn.marginTop=B;var Wn=Z.map(function(Pt,Je){var $t=Pt.key;return b.createElement(Fm,{id:f,prefixCls:Y,key:$t,tab:Pt,style:Je===0?void 0:Bn,closable:Pt.closable,editable:M,active:$t===C,focus:$t===zt,renderWrapper:H,removeAriaLabel:F==null?void 0:F.removeAriaLabel,tabCount:Yt.length,currentPosition:Je+1,onClick:function(kn){q($t,kn)},onKeyDown:$n,onFocus:function(){Xe||Vt($t),sr($t),Ne(),te.current&&(A||(te.current.scrollLeft=0),te.current.scrollTop=0)},onBlur:function(){Vt(void 0)},onMouseDown:function(){Lt(!0)},onMouseUp:function(){Lt(!1)}})}),yn=function(){return et(function(){var Je,$t=new Map,Ht=(Je=se.current)===null||Je===void 0?void 0:Je.getBoundingClientRect();return Z.forEach(function(kn){var bn,Dn=kn.key,sn=(bn=se.current)===null||bn===void 0?void 0:bn.querySelector('[data-node-key="'.concat(ic(Dn),'"]'));if(sn){var In=Vm(sn,Ht),Nn=ze(In,4),Jn=Nn[0],Gt=Nn[1],er=Nn[2],Mn=Nn[3];$t.set(Dn,{width:Jn,height:Gt,left:er,top:Mn})}}),$t})};b.useEffect(function(){yn()},[Z.map(function(Pt){return Pt.key}).join("_")]);var xn=rc(function(){var Pt=yi(X),Je=yi(ne),$t=yi(Q);Ae([Pt[0]-Je[0]-$t[0],Pt[1]-Je[1]-$t[1]]);var Ht=yi(ie);Ze(Ht);var kn=yi(le);Ge(kn);var bn=yi(se);De([bn[0]-Ht[0],bn[1]-Ht[1]]),yn()}),Lr=Z.slice(0,An),ar=Z.slice(Xt+1),wn=[].concat(Kn(Lr),Kn(ar)),Hn=Tt.get(C),mr=Om({activeTabOffset:Hn,horizontal:pe,indicator:J,rtl:A}),Xn=mr.style;b.useEffect(function(){sr()},[C,Wt,wt,Tu(Hn),Tu(Tt),pe]),b.useEffect(function(){xn()},[A]);var zn=!!wn.length,Rn="".concat(Y,"-nav-wrap"),_n,Qn,fn,Yn;return pe?A?(Qn=me>0,_n=me!==wt):(_n=me<0,Qn=me!==Wt):(fn=oe<0,Yn=oe!==Wt),b.createElement(_r,{onResize:xn},b.createElement("div",{ref:Os(r,X),role:"tablist","aria-orientation":pe?"horizontal":"vertical",className:Oe("".concat(Y,"-nav"),u),style:c,onKeyDown:function(){Ne()}},b.createElement(Eu,{ref:ne,position:"left",extra:R,prefixCls:Y}),b.createElement(_r,{onResize:xn},b.createElement("div",{className:Oe(Rn,xt(xt(xt(xt({},"".concat(Rn,"-ping-left"),_n),"".concat(Rn,"-ping-right"),Qn),"".concat(Rn,"-ping-top"),fn),"".concat(Rn,"-ping-bottom"),Yn)),ref:te},b.createElement(_r,{onResize:xn},b.createElement("div",{ref:se,className:"".concat(Y,"-nav-list"),style:{transform:"translate(".concat(me,"px, ").concat(oe,"px)"),transition:Be?"none":void 0}},Wn,b.createElement(sc,{ref:ie,prefixCls:Y,locale:F,editable:M,style:Fe(Fe({},Wn.length===0?void 0:Bn),{},{visibility:zn?"hidden":null})}),b.createElement("div",{className:Oe("".concat(Y,"-ink-bar"),xt({},"".concat(Y,"-ink-bar-animated"),E.inkBar)),style:Xn}))))),b.createElement(Nm,qe({},e,{removeAriaLabel:F==null?void 0:F.removeAriaLabel,ref:le,prefixCls:Y,tabs:wn,className:!zn&&pn,tabMoving:!!Be})),b.createElement(Eu,{ref:Q,position:"right",extra:R,prefixCls:Y})))}),ac=b.forwardRef(function(e,r){var u=e.prefixCls,c=e.className,f=e.style,E=e.id,C=e.active,A=e.tabKey,R=e.children;return b.createElement("div",{id:E&&"".concat(E,"-panel-").concat(A),role:"tabpanel",tabIndex:C?0:-1,"aria-labelledby":E&&"".concat(E,"-tab-").concat(A),"aria-hidden":!C,style:f,className:Oe(u,C&&"".concat(u,"-active"),c),ref:r},R)}),jm=["renderTabBar"],Km=["label","key"],Bm=function(r){var u=r.renderTabBar,c=rn(r,jm),f=b.useContext(Ps),E=f.tabs;if(u){var C=Fe(Fe({},c),{},{panes:E.map(function(A){var R=A.label,M=A.key,F=rn(A,Km);return b.createElement(ac,qe({tab:R,key:M,tabKey:M},F))})});return u(C,Cu)}return b.createElement(Cu,c)},Gm=["key","forceRender","style","className","destroyInactiveTabPane"],Um=function(r){var u=r.id,c=r.activeKey,f=r.animated,E=r.tabPosition,C=r.destroyInactiveTabPane,A=b.useContext(Ps),R=A.prefixCls,M=A.tabs,F=f.tabPane,j="".concat(R,"-tabpane");return b.createElement("div",{className:Oe("".concat(R,"-content-holder"))},b.createElement("div",{className:Oe("".concat(R,"-content"),"".concat(R,"-content-").concat(E),xt({},"".concat(R,"-content-animated"),F))},M.map(function(B){var H=B.key,q=B.forceRender,W=B.style,J=B.className,G=B.destroyInactiveTabPane,Y=rn(B,Gm),Z=H===c;return b.createElement(As,qe({key:H,visible:Z,forceRender:q,removeOnLeave:!!(C||G),leavedClassName:"".concat(j,"-hidden")},f.tabPaneMotion),function(X,ne){var Q=X.style,te=X.className;return b.createElement(ac,qe({},Y,{prefixCls:j,id:u,tabKey:H,animated:F,active:Z,style:Fe(Fe({},W),Q),className:Oe(J,te),ref:ne}))})})))};function Wm(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{inkBar:!0,tabPane:!1},r;return e===!1?r={inkBar:!1,tabPane:!1}:e===!0?r={inkBar:!0,tabPane:!1}:r=Fe({inkBar:!0},rr(e)==="object"?e:{}),r.tabPaneMotion&&r.tabPane===void 0&&(r.tabPane=!0),!r.tabPaneMotion&&r.tabPane&&(r.tabPane=!1),r}var Hm=["id","prefixCls","className","items","direction","activeKey","defaultActiveKey","editable","animated","tabPosition","tabBarGutter","tabBarStyle","tabBarExtraContent","locale","more","destroyInactiveTabPane","renderTabBar","onChange","onTabClick","onTabScroll","getPopupContainer","popupClassName","indicator"],$u=0,Xm=b.forwardRef(function(e,r){var u=e.id,c=e.prefixCls,f=c===void 0?"rc-tabs":c,E=e.className,C=e.items,A=e.direction,R=e.activeKey,M=e.defaultActiveKey,F=e.editable,j=e.animated,B=e.tabPosition,H=B===void 0?"top":B,q=e.tabBarGutter,W=e.tabBarStyle,J=e.tabBarExtraContent,G=e.locale,Y=e.more,Z=e.destroyInactiveTabPane,X=e.renderTabBar,ne=e.onChange,Q=e.onTabClick,te=e.onTabScroll,se=e.getPopupContainer,le=e.popupClassName,ie=e.indicator,pe=rn(e,Hm),ve=b.useMemo(function(){return(C||[]).filter(function(ge){return ge&&rr(ge)==="object"&&"key"in ge})},[C]),de=A==="rtl",me=Wm(j),Ee=b.useState(!1),ye=ze(Ee,2),Ce=ye[0],oe=ye[1];b.useEffect(function(){oe(El())},[]);var ae=vr(function(){var ge;return(ge=ve[0])===null||ge===void 0?void 0:ge.key},{value:R,defaultValue:M}),be=ze(ae,2),Le=be[0],Ie=be[1],Ae=b.useState(function(){return ve.findIndex(function(ge){return ge.key===Le})}),Se=ze(Ae,2),ke=Se[0],Me=Se[1];b.useEffect(function(){var ge=ve.findIndex(function(We){return We.key===Le});if(ge===-1){var Ge;ge=Math.max(0,Math.min(ke,ve.length-1)),Ie((Ge=ve[ge])===null||Ge===void 0?void 0:Ge.key)}Me(ge)},[ve.map(function(ge){return ge.key}).join("_"),Le,ke]);var De=vr(null,{value:u}),Ke=ze(De,2),Ve=Ke[0],at=Ke[1];b.useEffect(function(){u||(at("rc-tabs-".concat($u)),$u+=1)},[]);function Ze(ge,Ge){Q==null||Q(ge,Ge);var We=ge!==Le;Ie(ge),We&&(ne==null||ne(ge))}var Qe={id:Ve,activeKey:Le,animated:me,tabPosition:H,rtl:de,mobile:Ce},yt=Fe(Fe({},Qe),{},{editable:F,locale:G,more:Y,tabBarGutter:q,onTabClick:Ze,onTabScroll:te,extra:J,style:W,panes:null,getPopupContainer:se,popupClassName:le,indicator:ie});return b.createElement(Ps.Provider,{value:{tabs:ve,prefixCls:f}},b.createElement("div",qe({ref:r,id:u,className:Oe(f,"".concat(f,"-").concat(H),xt(xt(xt({},"".concat(f,"-mobile"),Ce),"".concat(f,"-editable"),F),"".concat(f,"-rtl"),de),E)},pe),b.createElement(Bm,qe({},yt,{renderTabBar:X})),b.createElement(Um,qe({destroyInactiveTabPane:Z},Qe,{animated:me}))))});const Ym={motionAppear:!1,motionEnter:!0,motionLeave:!0};function Jm(e,r={inkBar:!0,tabPane:!1}){let u;return r===!1?u={inkBar:!1,tabPane:!1}:r===!0?u={inkBar:!0,tabPane:!0}:u=Object.assign({inkBar:!0},typeof r=="object"?r:{}),u.tabPane&&(u.tabPaneMotion=Object.assign(Object.assign({},Ym),{motionName:al(e,"switch")})),u}var qm=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};function Zm(e){return e.filter(r=>r)}function Qm(e,r){if(e)return e.map(c=>{var f;const E=(f=c.destroyOnHidden)!==null&&f!==void 0?f:c.destroyInactiveTabPane;return Object.assign(Object.assign({},c),{destroyInactiveTabPane:E})});const u=ri(r).map(c=>{if(b.isValidElement(c)){const{key:f,props:E}=c,C=E||{},{tab:A}=C,R=qm(C,["tab"]);return Object.assign(Object.assign({key:String(f)},R),{label:A})}return null});return Zm(u)}const eg=e=>{const{componentCls:r,motionDurationSlow:u}=e;return[{[r]:{[`${r}-switch`]:{"&-appear, &-enter":{transition:"none","&-start":{opacity:0},"&-active":{opacity:1,transition:`opacity ${u}`}},"&-leave":{position:"absolute",transition:"none",inset:0,"&-start":{opacity:1},"&-active":{opacity:0,transition:`opacity ${u}`}}}}},[qo(e,"slide-up"),qo(e,"slide-down")]]},tg=e=>{const{componentCls:r,tabsCardPadding:u,cardBg:c,cardGutter:f,colorBorderSecondary:E,itemSelectedColor:C}=e;return{[`${r}-card`]:{[`> ${r}-nav, > div > ${r}-nav`]:{[`${r}-tab`]:{margin:0,padding:u,background:c,border:`${$e(e.lineWidth)} ${e.lineType} ${E}`,transition:`all ${e.motionDurationSlow} ${e.motionEaseInOut}`},[`${r}-tab-active`]:{color:C,background:e.colorBgContainer},[`${r}-tab-focus:has(${r}-tab-btn:focus-visible)`]:cl(e,-3),[`& ${r}-tab${r}-tab-focus ${r}-tab-btn:focus-visible`]:{outline:"none"},[`${r}-ink-bar`]:{visibility:"hidden"}},[`&${r}-top, &${r}-bottom`]:{[`> ${r}-nav, > div > ${r}-nav`]:{[`${r}-tab + ${r}-tab`]:{marginLeft:{_skip_check_:!0,value:$e(f)}}}},[`&${r}-top`]:{[`> ${r}-nav, > div > ${r}-nav`]:{[`${r}-tab`]:{borderRadius:`${$e(e.borderRadiusLG)} ${$e(e.borderRadiusLG)} 0 0`},[`${r}-tab-active`]:{borderBottomColor:e.colorBgContainer}}},[`&${r}-bottom`]:{[`> ${r}-nav, > div > ${r}-nav`]:{[`${r}-tab`]:{borderRadius:`0 0 ${$e(e.borderRadiusLG)} ${$e(e.borderRadiusLG)}`},[`${r}-tab-active`]:{borderTopColor:e.colorBgContainer}}},[`&${r}-left, &${r}-right`]:{[`> ${r}-nav, > div > ${r}-nav`]:{[`${r}-tab + ${r}-tab`]:{marginTop:$e(f)}}},[`&${r}-left`]:{[`> ${r}-nav, > div > ${r}-nav`]:{[`${r}-tab`]:{borderRadius:{_skip_check_:!0,value:`${$e(e.borderRadiusLG)} 0 0 ${$e(e.borderRadiusLG)}`}},[`${r}-tab-active`]:{borderRightColor:{_skip_check_:!0,value:e.colorBgContainer}}}},[`&${r}-right`]:{[`> ${r}-nav, > div > ${r}-nav`]:{[`${r}-tab`]:{borderRadius:{_skip_check_:!0,value:`0 ${$e(e.borderRadiusLG)} ${$e(e.borderRadiusLG)} 0`}},[`${r}-tab-active`]:{borderLeftColor:{_skip_check_:!0,value:e.colorBgContainer}}}}}}},ng=e=>{const{componentCls:r,itemHoverColor:u,dropdownEdgeChildVerticalPadding:c}=e;return{[`${r}-dropdown`]:Object.assign(Object.assign({},Ir(e)),{position:"absolute",top:-9999,left:{_skip_check_:!0,value:-9999},zIndex:e.zIndexPopup,display:"block","&-hidden":{display:"none"},[`${r}-dropdown-menu`]:{maxHeight:e.tabsDropdownHeight,margin:0,padding:`${$e(c)} 0`,overflowX:"hidden",overflowY:"auto",textAlign:{_skip_check_:!0,value:"left"},listStyleType:"none",backgroundColor:e.colorBgContainer,backgroundClip:"padding-box",borderRadius:e.borderRadiusLG,outline:"none",boxShadow:e.boxShadowSecondary,"&-item":Object.assign(Object.assign({},Rs),{display:"flex",alignItems:"center",minWidth:e.tabsDropdownWidth,margin:0,padding:`${$e(e.paddingXXS)} ${$e(e.paddingSM)}`,color:e.colorText,fontWeight:"normal",fontSize:e.fontSize,lineHeight:e.lineHeight,cursor:"pointer",transition:`all ${e.motionDurationSlow}`,"> span":{flex:1,whiteSpace:"nowrap"},"&-remove":{flex:"none",marginLeft:{_skip_check_:!0,value:e.marginSM},color:e.colorIcon,fontSize:e.fontSizeSM,background:"transparent",border:0,cursor:"pointer","&:hover":{color:u}},"&:hover":{background:e.controlItemBgHover},"&-disabled":{"&, &:hover":{color:e.colorTextDisabled,background:"transparent",cursor:"not-allowed"}}})}})}},rg=e=>{const{componentCls:r,margin:u,colorBorderSecondary:c,horizontalMargin:f,verticalItemPadding:E,verticalItemMargin:C,calc:A}=e;return{[`${r}-top, ${r}-bottom`]:{flexDirection:"column",[`> ${r}-nav, > div > ${r}-nav`]:{margin:f,"&::before":{position:"absolute",right:{_skip_check_:!0,value:0},left:{_skip_check_:!0,value:0},borderBottom:`${$e(e.lineWidth)} ${e.lineType} ${c}`,content:"''"},[`${r}-ink-bar`]:{height:e.lineWidthBold,"&-animated":{transition:`width ${e.motionDurationSlow}, left ${e.motionDurationSlow},
            right ${e.motionDurationSlow}`}},[`${r}-nav-wrap`]:{"&::before, &::after":{top:0,bottom:0,width:e.controlHeight},"&::before":{left:{_skip_check_:!0,value:0},boxShadow:e.boxShadowTabsOverflowLeft},"&::after":{right:{_skip_check_:!0,value:0},boxShadow:e.boxShadowTabsOverflowRight},[`&${r}-nav-wrap-ping-left::before`]:{opacity:1},[`&${r}-nav-wrap-ping-right::after`]:{opacity:1}}}},[`${r}-top`]:{[`> ${r}-nav,
        > div > ${r}-nav`]:{"&::before":{bottom:0},[`${r}-ink-bar`]:{bottom:0}}},[`${r}-bottom`]:{[`> ${r}-nav, > div > ${r}-nav`]:{order:1,marginTop:u,marginBottom:0,"&::before":{top:0},[`${r}-ink-bar`]:{top:0}},[`> ${r}-content-holder, > div > ${r}-content-holder`]:{order:0}},[`${r}-left, ${r}-right`]:{[`> ${r}-nav, > div > ${r}-nav`]:{flexDirection:"column",minWidth:A(e.controlHeight).mul(1.25).equal(),[`${r}-tab`]:{padding:E,textAlign:"center"},[`${r}-tab + ${r}-tab`]:{margin:C},[`${r}-nav-wrap`]:{flexDirection:"column","&::before, &::after":{right:{_skip_check_:!0,value:0},left:{_skip_check_:!0,value:0},height:e.controlHeight},"&::before":{top:0,boxShadow:e.boxShadowTabsOverflowTop},"&::after":{bottom:0,boxShadow:e.boxShadowTabsOverflowBottom},[`&${r}-nav-wrap-ping-top::before`]:{opacity:1},[`&${r}-nav-wrap-ping-bottom::after`]:{opacity:1}},[`${r}-ink-bar`]:{width:e.lineWidthBold,"&-animated":{transition:`height ${e.motionDurationSlow}, top ${e.motionDurationSlow}`}},[`${r}-nav-list, ${r}-nav-operations`]:{flex:"1 0 auto",flexDirection:"column"}}},[`${r}-left`]:{[`> ${r}-nav, > div > ${r}-nav`]:{[`${r}-ink-bar`]:{right:{_skip_check_:!0,value:0}}},[`> ${r}-content-holder, > div > ${r}-content-holder`]:{marginLeft:{_skip_check_:!0,value:$e(A(e.lineWidth).mul(-1).equal())},borderLeft:{_skip_check_:!0,value:`${$e(e.lineWidth)} ${e.lineType} ${e.colorBorder}`},[`> ${r}-content > ${r}-tabpane`]:{paddingLeft:{_skip_check_:!0,value:e.paddingLG}}}},[`${r}-right`]:{[`> ${r}-nav, > div > ${r}-nav`]:{order:1,[`${r}-ink-bar`]:{left:{_skip_check_:!0,value:0}}},[`> ${r}-content-holder, > div > ${r}-content-holder`]:{order:0,marginRight:{_skip_check_:!0,value:A(e.lineWidth).mul(-1).equal()},borderRight:{_skip_check_:!0,value:`${$e(e.lineWidth)} ${e.lineType} ${e.colorBorder}`},[`> ${r}-content > ${r}-tabpane`]:{paddingRight:{_skip_check_:!0,value:e.paddingLG}}}}}},ig=e=>{const{componentCls:r,cardPaddingSM:u,cardPaddingLG:c,cardHeightSM:f,cardHeightLG:E,horizontalItemPaddingSM:C,horizontalItemPaddingLG:A}=e;return{[r]:{"&-small":{[`> ${r}-nav`]:{[`${r}-tab`]:{padding:C,fontSize:e.titleFontSizeSM}}},"&-large":{[`> ${r}-nav`]:{[`${r}-tab`]:{padding:A,fontSize:e.titleFontSizeLG,lineHeight:e.lineHeightLG}}}},[`${r}-card`]:{[`&${r}-small`]:{[`> ${r}-nav`]:{[`${r}-tab`]:{padding:u},[`${r}-nav-add`]:{minWidth:f,minHeight:f}},[`&${r}-bottom`]:{[`> ${r}-nav ${r}-tab`]:{borderRadius:`0 0 ${$e(e.borderRadius)} ${$e(e.borderRadius)}`}},[`&${r}-top`]:{[`> ${r}-nav ${r}-tab`]:{borderRadius:`${$e(e.borderRadius)} ${$e(e.borderRadius)} 0 0`}},[`&${r}-right`]:{[`> ${r}-nav ${r}-tab`]:{borderRadius:{_skip_check_:!0,value:`0 ${$e(e.borderRadius)} ${$e(e.borderRadius)} 0`}}},[`&${r}-left`]:{[`> ${r}-nav ${r}-tab`]:{borderRadius:{_skip_check_:!0,value:`${$e(e.borderRadius)} 0 0 ${$e(e.borderRadius)}`}}}},[`&${r}-large`]:{[`> ${r}-nav`]:{[`${r}-tab`]:{padding:c},[`${r}-nav-add`]:{minWidth:E,minHeight:E}}}}}},sg=e=>{const{componentCls:r,itemActiveColor:u,itemHoverColor:c,iconCls:f,tabsHorizontalItemMargin:E,horizontalItemPadding:C,itemSelectedColor:A,itemColor:R}=e,M=`${r}-tab`;return{[M]:{position:"relative",WebkitTouchCallout:"none",WebkitTapHighlightColor:"transparent",display:"inline-flex",alignItems:"center",padding:C,fontSize:e.titleFontSize,background:"transparent",border:0,outline:"none",cursor:"pointer",color:R,"&-btn, &-remove":{"&:focus:not(:focus-visible), &:active":{color:u}},"&-btn":{outline:"none",transition:`all ${e.motionDurationSlow}`,[`${M}-icon:not(:last-child)`]:{marginInlineEnd:e.marginSM}},"&-remove":Object.assign({flex:"none",marginRight:{_skip_check_:!0,value:e.calc(e.marginXXS).mul(-1).equal()},marginLeft:{_skip_check_:!0,value:e.marginXS},color:e.colorIcon,fontSize:e.fontSizeSM,background:"transparent",border:"none",outline:"none",cursor:"pointer",transition:`all ${e.motionDurationSlow}`,"&:hover":{color:e.colorTextHeading}},ga(e)),"&:hover":{color:c},[`&${M}-active ${M}-btn`]:{color:A,textShadow:e.tabsActiveTextShadow},[`&${M}-focus ${M}-btn:focus-visible`]:cl(e),[`&${M}-disabled`]:{color:e.colorTextDisabled,cursor:"not-allowed"},[`&${M}-disabled ${M}-btn, &${M}-disabled ${r}-remove`]:{"&:focus, &:active":{color:e.colorTextDisabled}},[`& ${M}-remove ${f}`]:{margin:0},[`${f}:not(:last-child)`]:{marginRight:{_skip_check_:!0,value:e.marginSM}}},[`${M} + ${M}`]:{margin:{_skip_check_:!0,value:E}}}},ag=e=>{const{componentCls:r,tabsHorizontalItemMarginRTL:u,iconCls:c,cardGutter:f,calc:E}=e;return{[`${r}-rtl`]:{direction:"rtl",[`${r}-nav`]:{[`${r}-tab`]:{margin:{_skip_check_:!0,value:u},[`${r}-tab:last-of-type`]:{marginLeft:{_skip_check_:!0,value:0}},[c]:{marginRight:{_skip_check_:!0,value:0},marginLeft:{_skip_check_:!0,value:$e(e.marginSM)}},[`${r}-tab-remove`]:{marginRight:{_skip_check_:!0,value:$e(e.marginXS)},marginLeft:{_skip_check_:!0,value:$e(E(e.marginXXS).mul(-1).equal())},[c]:{margin:0}}}},[`&${r}-left`]:{[`> ${r}-nav`]:{order:1},[`> ${r}-content-holder`]:{order:0}},[`&${r}-right`]:{[`> ${r}-nav`]:{order:0},[`> ${r}-content-holder`]:{order:1}},[`&${r}-card${r}-top, &${r}-card${r}-bottom`]:{[`> ${r}-nav, > div > ${r}-nav`]:{[`${r}-tab + ${r}-tab`]:{marginRight:{_skip_check_:!0,value:f},marginLeft:{_skip_check_:!0,value:0}}}}},[`${r}-dropdown-rtl`]:{direction:"rtl"},[`${r}-menu-item`]:{[`${r}-dropdown-rtl`]:{textAlign:{_skip_check_:!0,value:"right"}}}}},og=e=>{const{componentCls:r,tabsCardPadding:u,cardHeight:c,cardGutter:f,itemHoverColor:E,itemActiveColor:C,colorBorderSecondary:A}=e;return{[r]:Object.assign(Object.assign(Object.assign(Object.assign({},Ir(e)),{display:"flex",[`> ${r}-nav, > div > ${r}-nav`]:{position:"relative",display:"flex",flex:"none",alignItems:"center",[`${r}-nav-wrap`]:{position:"relative",display:"flex",flex:"auto",alignSelf:"stretch",overflow:"hidden",whiteSpace:"nowrap",transform:"translate(0)","&::before, &::after":{position:"absolute",zIndex:1,opacity:0,transition:`opacity ${e.motionDurationSlow}`,content:"''",pointerEvents:"none"}},[`${r}-nav-list`]:{position:"relative",display:"flex",transition:`opacity ${e.motionDurationSlow}`},[`${r}-nav-operations`]:{display:"flex",alignSelf:"stretch"},[`${r}-nav-operations-hidden`]:{position:"absolute",visibility:"hidden",pointerEvents:"none"},[`${r}-nav-more`]:{position:"relative",padding:u,background:"transparent",border:0,color:e.colorText,"&::after":{position:"absolute",right:{_skip_check_:!0,value:0},bottom:0,left:{_skip_check_:!0,value:0},height:e.calc(e.controlHeightLG).div(8).equal(),transform:"translateY(100%)",content:"''"}},[`${r}-nav-add`]:Object.assign({minWidth:c,minHeight:c,marginLeft:{_skip_check_:!0,value:f},background:"transparent",border:`${$e(e.lineWidth)} ${e.lineType} ${A}`,borderRadius:`${$e(e.borderRadiusLG)} ${$e(e.borderRadiusLG)} 0 0`,outline:"none",cursor:"pointer",color:e.colorText,transition:`all ${e.motionDurationSlow} ${e.motionEaseInOut}`,"&:hover":{color:E},"&:active, &:focus:not(:focus-visible)":{color:C}},ga(e,-3))},[`${r}-extra-content`]:{flex:"none"},[`${r}-ink-bar`]:{position:"absolute",background:e.inkBarColor,pointerEvents:"none"}}),sg(e)),{[`${r}-content`]:{position:"relative",width:"100%"},[`${r}-content-holder`]:{flex:"auto",minWidth:0,minHeight:0},[`${r}-tabpane`]:Object.assign(Object.assign({},ga(e)),{"&-hidden":{display:"none"}})}),[`${r}-centered`]:{[`> ${r}-nav, > div > ${r}-nav`]:{[`${r}-nav-wrap`]:{[`&:not([class*='${r}-nav-wrap-ping']) > ${r}-nav-list`]:{margin:"auto"}}}}}},ug=e=>{const{cardHeight:r,cardHeightSM:u,cardHeightLG:c,controlHeight:f,controlHeightLG:E}=e,C=r||E,A=u||f,R=c||E+8;return{zIndexPopup:e.zIndexPopupBase+50,cardBg:e.colorFillAlter,cardHeight:C,cardHeightSM:A,cardHeightLG:R,cardPadding:`${(C-e.fontHeight)/2-e.lineWidth}px ${e.padding}px`,cardPaddingSM:`${(A-e.fontHeight)/2-e.lineWidth}px ${e.paddingXS}px`,cardPaddingLG:`${(R-e.fontHeightLG)/2-e.lineWidth}px ${e.padding}px`,titleFontSize:e.fontSize,titleFontSizeLG:e.fontSizeLG,titleFontSizeSM:e.fontSize,inkBarColor:e.colorPrimary,horizontalMargin:`0 0 ${e.margin}px 0`,horizontalItemGutter:32,horizontalItemMargin:"",horizontalItemMarginRTL:"",horizontalItemPadding:`${e.paddingSM}px 0`,horizontalItemPaddingSM:`${e.paddingXS}px 0`,horizontalItemPaddingLG:`${e.padding}px 0`,verticalItemPadding:`${e.paddingXS}px ${e.paddingLG}px`,verticalItemMargin:`${e.margin}px 0 0 0`,itemColor:e.colorText,itemSelectedColor:e.colorPrimary,itemHoverColor:e.colorPrimaryHover,itemActiveColor:e.colorPrimaryActive,cardGutter:e.marginXXS/2}},lg=Sr("Tabs",e=>{const r=ir(e,{tabsCardPadding:e.cardPadding,dropdownEdgeChildVerticalPadding:e.paddingXXS,tabsActiveTextShadow:"0 0 0.25px currentcolor",tabsDropdownHeight:200,tabsDropdownWidth:120,tabsHorizontalItemMargin:`0 0 0 ${$e(e.horizontalItemGutter)}`,tabsHorizontalItemMarginRTL:`0 0 0 ${$e(e.horizontalItemGutter)}`});return[ig(r),ag(r),rg(r),ng(r),tg(r),og(r),eg(r)]},ug),cg=()=>null;var hg=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};const oc=e=>{var r,u,c,f,E,C,A,R,M,F,j;const{type:B,className:H,rootClassName:q,size:W,onEdit:J,hideAdd:G,centered:Y,addIcon:Z,removeIcon:X,moreIcon:ne,more:Q,popupClassName:te,children:se,items:le,animated:ie,style:pe,indicatorSize:ve,indicator:de,destroyInactiveTabPane:me,destroyOnHidden:Ee}=e,ye=hg(e,["type","className","rootClassName","size","onEdit","hideAdd","centered","addIcon","removeIcon","moreIcon","more","popupClassName","children","items","animated","style","indicatorSize","indicator","destroyInactiveTabPane","destroyOnHidden"]),{prefixCls:Ce}=ye,{direction:oe,tabs:ae,getPrefixCls:be,getPopupContainer:Le}=b.useContext(fr),Ie=be("tabs",Ce),Ae=hl(Ie),[Se,ke,Me]=lg(Ie,Ae);let De;B==="editable-card"&&(De={onEdit:(ge,{key:Ge,event:We})=>{J==null||J(ge==="add"?We:Ge,ge)},removeIcon:(r=X??(ae==null?void 0:ae.removeIcon))!==null&&r!==void 0?r:b.createElement(dl,null),addIcon:(Z??(ae==null?void 0:ae.addIcon))||b.createElement(Lm,null),showAdd:G!==!0});const Ke=be(),Ve=Ui(W),at=Qm(le,se),Ze=Jm(Ie,ie),Qe=Object.assign(Object.assign({},ae==null?void 0:ae.style),pe),yt={align:(u=de==null?void 0:de.align)!==null&&u!==void 0?u:(c=ae==null?void 0:ae.indicator)===null||c===void 0?void 0:c.align,size:(A=(E=(f=de==null?void 0:de.size)!==null&&f!==void 0?f:ve)!==null&&E!==void 0?E:(C=ae==null?void 0:ae.indicator)===null||C===void 0?void 0:C.size)!==null&&A!==void 0?A:ae==null?void 0:ae.indicatorSize};return Se(b.createElement(Xm,Object.assign({direction:oe,getPopupContainer:Le},ye,{items:at,className:Oe({[`${Ie}-${Ve}`]:Ve,[`${Ie}-card`]:["card","editable-card"].includes(B),[`${Ie}-editable-card`]:B==="editable-card",[`${Ie}-centered`]:Y},ae==null?void 0:ae.className,H,q,ke,Me,Ae),popupClassName:Oe(te,ke,Me,Ae),style:Qe,editable:De,more:Object.assign({icon:(j=(F=(M=(R=ae==null?void 0:ae.more)===null||R===void 0?void 0:R.icon)!==null&&M!==void 0?M:ae==null?void 0:ae.moreIcon)!==null&&F!==void 0?F:ne)!==null&&j!==void 0?j:b.createElement(cm,null),transitionName:`${Ke}-slide-up`},Q),prefixCls:Ie,animated:Ze,indicator:yt,destroyInactiveTabPane:Ee??me})))};oc.TabPane=cg;var dg=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};const uc=e=>{var{prefixCls:r,className:u,hoverable:c=!0}=e,f=dg(e,["prefixCls","className","hoverable"]);const{getPrefixCls:E}=b.useContext(fr),C=E("card",r),A=Oe(`${C}-grid`,u,{[`${C}-grid-hoverable`]:c});return b.createElement("div",Object.assign({},f,{className:A}))},pg=e=>{const{antCls:r,componentCls:u,headerHeight:c,headerPadding:f,tabsMarginBottom:E}=e;return Object.assign(Object.assign({display:"flex",justifyContent:"center",flexDirection:"column",minHeight:c,marginBottom:-1,padding:`0 ${$e(f)}`,color:e.colorTextHeading,fontWeight:e.fontWeightStrong,fontSize:e.headerFontSize,background:e.headerBg,borderBottom:`${$e(e.lineWidth)} ${e.lineType} ${e.colorBorderSecondary}`,borderRadius:`${$e(e.borderRadiusLG)} ${$e(e.borderRadiusLG)} 0 0`},Gi()),{"&-wrapper":{width:"100%",display:"flex",alignItems:"center"},"&-title":Object.assign(Object.assign({display:"inline-block",flex:1},Rs),{[`
          > ${u}-typography,
          > ${u}-typography-edit-content
        `]:{insetInlineStart:0,marginTop:0,marginBottom:0}}),[`${r}-tabs-top`]:{clear:"both",marginBottom:E,color:e.colorText,fontWeight:"normal",fontSize:e.fontSize,"&-bar":{borderBottom:`${$e(e.lineWidth)} ${e.lineType} ${e.colorBorderSecondary}`}}})},fg=e=>{const{cardPaddingBase:r,colorBorderSecondary:u,cardShadow:c,lineWidth:f}=e;return{width:"33.33%",padding:r,border:0,borderRadius:0,boxShadow:`
      ${$e(f)} 0 0 0 ${u},
      0 ${$e(f)} 0 0 ${u},
      ${$e(f)} ${$e(f)} 0 0 ${u},
      ${$e(f)} 0 0 0 ${u} inset,
      0 ${$e(f)} 0 0 ${u} inset;
    `,transition:`all ${e.motionDurationMid}`,"&-hoverable:hover":{position:"relative",zIndex:1,boxShadow:c}}},mg=e=>{const{componentCls:r,iconCls:u,actionsLiMargin:c,cardActionsIconSize:f,colorBorderSecondary:E,actionsBg:C}=e;return Object.assign(Object.assign({margin:0,padding:0,listStyle:"none",background:C,borderTop:`${$e(e.lineWidth)} ${e.lineType} ${E}`,display:"flex",borderRadius:`0 0 ${$e(e.borderRadiusLG)} ${$e(e.borderRadiusLG)}`},Gi()),{"& > li":{margin:c,color:e.colorTextDescription,textAlign:"center","> span":{position:"relative",display:"block",minWidth:e.calc(e.cardActionsIconSize).mul(2).equal(),fontSize:e.fontSize,lineHeight:e.lineHeight,cursor:"pointer","&:hover":{color:e.colorPrimary,transition:`color ${e.motionDurationMid}`},[`a:not(${r}-btn), > ${u}`]:{display:"inline-block",width:"100%",color:e.colorIcon,lineHeight:$e(e.fontHeight),transition:`color ${e.motionDurationMid}`,"&:hover":{color:e.colorPrimary}},[`> ${u}`]:{fontSize:f,lineHeight:$e(e.calc(f).mul(e.lineHeight).equal())}},"&:not(:last-child)":{borderInlineEnd:`${$e(e.lineWidth)} ${e.lineType} ${E}`}}})},gg=e=>Object.assign(Object.assign({margin:`${$e(e.calc(e.marginXXS).mul(-1).equal())} 0`,display:"flex"},Gi()),{"&-avatar":{paddingInlineEnd:e.padding},"&-detail":{overflow:"hidden",flex:1,"> div:not(:last-child)":{marginBottom:e.marginXS}},"&-title":Object.assign({color:e.colorTextHeading,fontWeight:e.fontWeightStrong,fontSize:e.fontSizeLG},Rs),"&-description":{color:e.colorTextDescription}}),yg=e=>{const{componentCls:r,colorFillAlter:u,headerPadding:c,bodyPadding:f}=e;return{[`${r}-head`]:{padding:`0 ${$e(c)}`,background:u,"&-title":{fontSize:e.fontSize}},[`${r}-body`]:{padding:`${$e(e.padding)} ${$e(f)}`}}},xg=e=>{const{componentCls:r}=e;return{overflow:"hidden",[`${r}-body`]:{userSelect:"none"}}},bg=e=>{const{componentCls:r,cardShadow:u,cardHeadPadding:c,colorBorderSecondary:f,boxShadowTertiary:E,bodyPadding:C,extraColor:A}=e;return{[r]:Object.assign(Object.assign({},Ir(e)),{position:"relative",background:e.colorBgContainer,borderRadius:e.borderRadiusLG,[`&:not(${r}-bordered)`]:{boxShadow:E},[`${r}-head`]:pg(e),[`${r}-extra`]:{marginInlineStart:"auto",color:A,fontWeight:"normal",fontSize:e.fontSize},[`${r}-body`]:Object.assign({padding:C,borderRadius:`0 0 ${$e(e.borderRadiusLG)} ${$e(e.borderRadiusLG)}`},Gi()),[`${r}-grid`]:fg(e),[`${r}-cover`]:{"> *":{display:"block",width:"100%",borderRadius:`${$e(e.borderRadiusLG)} ${$e(e.borderRadiusLG)} 0 0`}},[`${r}-actions`]:mg(e),[`${r}-meta`]:gg(e)}),[`${r}-bordered`]:{border:`${$e(e.lineWidth)} ${e.lineType} ${f}`,[`${r}-cover`]:{marginTop:-1,marginInlineStart:-1,marginInlineEnd:-1}},[`${r}-hoverable`]:{cursor:"pointer",transition:`box-shadow ${e.motionDurationMid}, border-color ${e.motionDurationMid}`,"&:hover":{borderColor:"transparent",boxShadow:u}},[`${r}-contain-grid`]:{borderRadius:`${$e(e.borderRadiusLG)} ${$e(e.borderRadiusLG)} 0 0 `,[`${r}-body`]:{display:"flex",flexWrap:"wrap"},[`&:not(${r}-loading) ${r}-body`]:{marginBlockStart:e.calc(e.lineWidth).mul(-1).equal(),marginInlineStart:e.calc(e.lineWidth).mul(-1).equal(),padding:0}},[`${r}-contain-tabs`]:{[`> div${r}-head`]:{minHeight:0,[`${r}-head-title, ${r}-extra`]:{paddingTop:c}}},[`${r}-type-inner`]:yg(e),[`${r}-loading`]:xg(e),[`${r}-rtl`]:{direction:"rtl"}}},vg=e=>{const{componentCls:r,bodyPaddingSM:u,headerPaddingSM:c,headerHeightSM:f,headerFontSizeSM:E}=e;return{[`${r}-small`]:{[`> ${r}-head`]:{minHeight:f,padding:`0 ${$e(c)}`,fontSize:E,[`> ${r}-head-wrapper`]:{[`> ${r}-extra`]:{fontSize:e.fontSize}}},[`> ${r}-body`]:{padding:u}},[`${r}-small${r}-contain-tabs`]:{[`> ${r}-head`]:{[`${r}-head-title, ${r}-extra`]:{paddingTop:0,display:"flex",alignItems:"center"}}}}},wg=e=>{var r,u;return{headerBg:"transparent",headerFontSize:e.fontSizeLG,headerFontSizeSM:e.fontSize,headerHeight:e.fontSizeLG*e.lineHeightLG+e.padding*2,headerHeightSM:e.fontSize*e.lineHeight+e.paddingXS*2,actionsBg:e.colorBgContainer,actionsLiMargin:`${e.paddingSM}px 0`,tabsMarginBottom:-e.padding-e.lineWidth,extraColor:e.colorText,bodyPaddingSM:12,headerPaddingSM:12,bodyPadding:(r=e.bodyPadding)!==null&&r!==void 0?r:e.paddingLG,headerPadding:(u=e.headerPadding)!==null&&u!==void 0?u:e.paddingLG}},Sg=Sr("Card",e=>{const r=ir(e,{cardShadow:e.boxShadowCard,cardHeadPadding:e.padding,cardPaddingBase:e.paddingLG,cardActionsIconSize:e.fontSize});return[bg(r),vg(r)]},wg);var _u=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};const Tg=e=>{const{actionClasses:r,actions:u=[],actionStyle:c}=e;return b.createElement("ul",{className:r,style:c},u.map((f,E)=>{const C=`action-${E}`;return b.createElement("li",{style:{width:`${100/u.length}%`},key:C},b.createElement("span",null,f))}))},Eg=b.forwardRef((e,r)=>{const{prefixCls:u,className:c,rootClassName:f,style:E,extra:C,headStyle:A={},bodyStyle:R={},title:M,loading:F,bordered:j,variant:B,size:H,type:q,cover:W,actions:J,tabList:G,children:Y,activeTabKey:Z,defaultActiveTabKey:X,tabBarExtraContent:ne,hoverable:Q,tabProps:te={},classNames:se,styles:le}=e,ie=_u(e,["prefixCls","className","rootClassName","style","extra","headStyle","bodyStyle","title","loading","bordered","variant","size","type","cover","actions","tabList","children","activeTabKey","defaultActiveTabKey","tabBarExtraContent","hoverable","tabProps","classNames","styles"]),{getPrefixCls:pe,direction:ve,card:de}=b.useContext(fr),[me]=Il("card",B,j),Ee=Tt=>{var ut;(ut=e.onTabChange)===null||ut===void 0||ut.call(e,Tt)},ye=Tt=>{var ut;return Oe((ut=de==null?void 0:de.classNames)===null||ut===void 0?void 0:ut[Tt],se==null?void 0:se[Tt])},Ce=Tt=>{var ut;return Object.assign(Object.assign({},(ut=de==null?void 0:de.styles)===null||ut===void 0?void 0:ut[Tt]),le==null?void 0:le[Tt])},oe=b.useMemo(()=>{let Tt=!1;return b.Children.forEach(Y,ut=>{(ut==null?void 0:ut.type)===uc&&(Tt=!0)}),Tt},[Y]),ae=pe("card",u),[be,Le,Ie]=Sg(ae),Ae=b.createElement(vd,{loading:!0,active:!0,paragraph:{rows:4},title:!1},Y),Se=Z!==void 0,ke=Object.assign(Object.assign({},te),{[Se?"activeKey":"defaultActiveKey"]:Se?Z:X,tabBarExtraContent:ne});let Me;const De=Ui(H),Ke=!De||De==="default"?"large":De,Ve=G?b.createElement(oc,Object.assign({size:Ke},ke,{className:`${ae}-head-tabs`,onChange:Ee,items:G.map(Tt=>{var{tab:ut}=Tt,Ut=_u(Tt,["tab"]);return Object.assign({label:ut},Ut)})})):null;if(M||C||Ve){const Tt=Oe(`${ae}-head`,ye("header")),ut=Oe(`${ae}-head-title`,ye("title")),Ut=Oe(`${ae}-extra`,ye("extra")),Ft=Object.assign(Object.assign({},A),Ce("header"));Me=b.createElement("div",{className:Tt,style:Ft},b.createElement("div",{className:`${ae}-head-wrapper`},M&&b.createElement("div",{className:ut,style:Ce("title")},M),C&&b.createElement("div",{className:Ut,style:Ce("extra")},C)),Ve)}const at=Oe(`${ae}-cover`,ye("cover")),Ze=W?b.createElement("div",{className:at,style:Ce("cover")},W):null,Qe=Oe(`${ae}-body`,ye("body")),yt=Object.assign(Object.assign({},R),Ce("body")),ge=b.createElement("div",{className:Qe,style:yt},F?Ae:Y),Ge=Oe(`${ae}-actions`,ye("actions")),We=J!=null&&J.length?b.createElement(Tg,{actionClasses:Ge,actionStyle:Ce("actions"),actions:J}):null,we=Xr(ie,["onTabChange"]),ot=Oe(ae,de==null?void 0:de.className,{[`${ae}-loading`]:F,[`${ae}-bordered`]:me!=="borderless",[`${ae}-hoverable`]:Q,[`${ae}-contain-grid`]:oe,[`${ae}-contain-tabs`]:G==null?void 0:G.length,[`${ae}-${De}`]:De,[`${ae}-type-${q}`]:!!q,[`${ae}-rtl`]:ve==="rtl"},c,f,Le,Ie),et=Object.assign(Object.assign({},de==null?void 0:de.style),E);return be(b.createElement("div",Object.assign({ref:r},we,{className:ot,style:et}),Me,Ze,ge,We))});var Cg=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};const $g=e=>{const{prefixCls:r,className:u,avatar:c,title:f,description:E}=e,C=Cg(e,["prefixCls","className","avatar","title","description"]),{getPrefixCls:A}=b.useContext(fr),R=A("card",r),M=Oe(`${R}-meta`,u),F=c?b.createElement("div",{className:`${R}-meta-avatar`},c):null,j=f?b.createElement("div",{className:`${R}-meta-title`},f):null,B=E?b.createElement("div",{className:`${R}-meta-description`},E):null,H=j||B?b.createElement("div",{className:`${R}-meta-detail`},j,B):null;return b.createElement("div",Object.assign({},C,{className:M}),F,H)},Ki=Eg;Ki.Grid=uc;Ki.Meta=$g;const lc=b.createContext({});var _g=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};function Iu(e){return typeof e=="number"?`${e} ${e} auto`:/^\d+(\.\d+)?(px|em|rem|%)$/.test(e)?`0 0 ${e}`:e}const Ig=["xs","sm","md","lg","xl","xxl"],Lu=b.forwardRef((e,r)=>{const{getPrefixCls:u,direction:c}=b.useContext(fr),{gutter:f,wrap:E}=b.useContext(lc),{prefixCls:C,span:A,order:R,offset:M,push:F,pull:j,className:B,children:H,flex:q,style:W}=e,J=_g(e,["prefixCls","span","order","offset","push","pull","className","children","flex","style"]),G=u("col",C),[Y,Z,X]=wd(G),ne={};let Q={};Ig.forEach(le=>{let ie={};const pe=e[le];typeof pe=="number"?ie.span=pe:typeof pe=="object"&&(ie=pe||{}),delete J[le],Q=Object.assign(Object.assign({},Q),{[`${G}-${le}-${ie.span}`]:ie.span!==void 0,[`${G}-${le}-order-${ie.order}`]:ie.order||ie.order===0,[`${G}-${le}-offset-${ie.offset}`]:ie.offset||ie.offset===0,[`${G}-${le}-push-${ie.push}`]:ie.push||ie.push===0,[`${G}-${le}-pull-${ie.pull}`]:ie.pull||ie.pull===0,[`${G}-rtl`]:c==="rtl"}),ie.flex&&(Q[`${G}-${le}-flex`]=!0,ne[`--${G}-${le}-flex`]=Iu(ie.flex))});const te=Oe(G,{[`${G}-${A}`]:A!==void 0,[`${G}-order-${R}`]:R,[`${G}-offset-${M}`]:M,[`${G}-push-${F}`]:F,[`${G}-pull-${j}`]:j},B,Q,Z,X),se={};if(f&&f[0]>0){const le=f[0]/2;se.paddingLeft=le,se.paddingRight=le}return q&&(se.flex=Iu(q),E===!1&&!se.minWidth&&(se.minWidth=0)),Y(b.createElement("div",Object.assign({},J,{style:Object.assign(Object.assign(Object.assign({},se),W),ne),className:te,ref:r}),H))});function Lg(e,r){const u=[void 0,void 0],c=Array.isArray(e)?e:[e,void 0],f=r||{xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0};return c.forEach((E,C)=>{if(typeof E=="object"&&E!==null)for(let A=0;A<vi.length;A++){const R=vi[A];if(f[R]&&E[R]!==void 0){u[C]=E[R];break}}else u[C]=E}),u}var Og=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};function Ou(e,r){const[u,c]=b.useState(typeof e=="string"?e:""),f=()=>{if(typeof e=="string"&&c(e),typeof e=="object")for(let E=0;E<vi.length;E++){const C=vi[E];if(!r||!r[C])continue;const A=e[C];if(A!==void 0){c(A);return}}};return b.useEffect(()=>{f()},[JSON.stringify(e),r]),u}const Ag=b.forwardRef((e,r)=>{const{prefixCls:u,justify:c,align:f,className:E,style:C,children:A,gutter:R=0,wrap:M}=e,F=Og(e,["prefixCls","justify","align","className","style","children","gutter","wrap"]),{getPrefixCls:j,direction:B}=b.useContext(fr),H=Al(!0,null),q=Ou(f,H),W=Ou(c,H),J=j("row",u),[G,Y,Z]=Sd(J),X=Lg(R,H),ne=Oe(J,{[`${J}-no-wrap`]:M===!1,[`${J}-${W}`]:W,[`${J}-${q}`]:q,[`${J}-rtl`]:B==="rtl"},E,Y,Z),Q={},te=X[0]!=null&&X[0]>0?X[0]/-2:void 0;te&&(Q.marginLeft=te,Q.marginRight=te);const[se,le]=X;Q.rowGap=le;const ie=b.useMemo(()=>({gutter:[se,le],wrap:M}),[se,le,M]);return G(b.createElement(lc.Provider,{value:ie},b.createElement("div",Object.assign({},F,{className:ne,style:Object.assign(Object.assign({},Q),C),ref:r}),A)))}),Rg=e=>{const{componentCls:r}=e;return{[r]:{"&-horizontal":{[`&${r}`]:{"&-sm":{marginBlock:e.marginXS},"&-md":{marginBlock:e.margin}}}}}},kg=e=>{const{componentCls:r,sizePaddingEdgeHorizontal:u,colorSplit:c,lineWidth:f,textPaddingInline:E,orientationMargin:C,verticalMarginInline:A}=e;return{[r]:Object.assign(Object.assign({},Ir(e)),{borderBlockStart:`${$e(f)} solid ${c}`,"&-vertical":{position:"relative",top:"-0.06em",display:"inline-block",height:"0.9em",marginInline:A,marginBlock:0,verticalAlign:"middle",borderTop:0,borderInlineStart:`${$e(f)} solid ${c}`},"&-horizontal":{display:"flex",clear:"both",width:"100%",minWidth:"100%",margin:`${$e(e.marginLG)} 0`},[`&-horizontal${r}-with-text`]:{display:"flex",alignItems:"center",margin:`${$e(e.dividerHorizontalWithTextGutterMargin)} 0`,color:e.colorTextHeading,fontWeight:500,fontSize:e.fontSizeLG,whiteSpace:"nowrap",textAlign:"center",borderBlockStart:`0 ${c}`,"&::before, &::after":{position:"relative",width:"50%",borderBlockStart:`${$e(f)} solid transparent`,borderBlockStartColor:"inherit",borderBlockEnd:0,transform:"translateY(50%)",content:"''"}},[`&-horizontal${r}-with-text-start`]:{"&::before":{width:`calc(${C} * 100%)`},"&::after":{width:`calc(100% - ${C} * 100%)`}},[`&-horizontal${r}-with-text-end`]:{"&::before":{width:`calc(100% - ${C} * 100%)`},"&::after":{width:`calc(${C} * 100%)`}},[`${r}-inner-text`]:{display:"inline-block",paddingBlock:0,paddingInline:E},"&-dashed":{background:"none",borderColor:c,borderStyle:"dashed",borderWidth:`${$e(f)} 0 0`},[`&-horizontal${r}-with-text${r}-dashed`]:{"&::before, &::after":{borderStyle:"dashed none none"}},[`&-vertical${r}-dashed`]:{borderInlineStartWidth:f,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},"&-dotted":{background:"none",borderColor:c,borderStyle:"dotted",borderWidth:`${$e(f)} 0 0`},[`&-horizontal${r}-with-text${r}-dotted`]:{"&::before, &::after":{borderStyle:"dotted none none"}},[`&-vertical${r}-dotted`]:{borderInlineStartWidth:f,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},[`&-plain${r}-with-text`]:{color:e.colorText,fontWeight:"normal",fontSize:e.fontSize},[`&-horizontal${r}-with-text-start${r}-no-default-orientation-margin-start`]:{"&::before":{width:0},"&::after":{width:"100%"},[`${r}-inner-text`]:{paddingInlineStart:u}},[`&-horizontal${r}-with-text-end${r}-no-default-orientation-margin-end`]:{"&::before":{width:"100%"},"&::after":{width:0},[`${r}-inner-text`]:{paddingInlineEnd:u}}})}},Dg=e=>({textPaddingInline:"1em",orientationMargin:.05,verticalMarginInline:e.marginXS}),Mg=Sr("Divider",e=>{const r=ir(e,{dividerHorizontalWithTextGutterMargin:e.margin,sizePaddingEdgeHorizontal:0});return[kg(r),Rg(r)]},Dg,{unitless:{orientationMargin:!0}});var Pg=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};const zg={small:"sm",middle:"md"},Ng=e=>{const{getPrefixCls:r,direction:u,className:c,style:f}=wi("divider"),{prefixCls:E,type:C="horizontal",orientation:A="center",orientationMargin:R,className:M,rootClassName:F,children:j,dashed:B,variant:H="solid",plain:q,style:W,size:J}=e,G=Pg(e,["prefixCls","type","orientation","orientationMargin","className","rootClassName","children","dashed","variant","plain","style","size"]),Y=r("divider",E),[Z,X,ne]=Mg(Y),Q=Ui(J),te=zg[Q],se=!!j,le=b.useMemo(()=>A==="left"?u==="rtl"?"end":"start":A==="right"?u==="rtl"?"start":"end":A,[u,A]),ie=le==="start"&&R!=null,pe=le==="end"&&R!=null,ve=Oe(Y,c,X,ne,`${Y}-${C}`,{[`${Y}-with-text`]:se,[`${Y}-with-text-${le}`]:se,[`${Y}-dashed`]:!!B,[`${Y}-${H}`]:H!=="solid",[`${Y}-plain`]:!!q,[`${Y}-rtl`]:u==="rtl",[`${Y}-no-default-orientation-margin-start`]:ie,[`${Y}-no-default-orientation-margin-end`]:pe,[`${Y}-${te}`]:!!te},M,F),de=b.useMemo(()=>typeof R=="number"?R:/^\d+$/.test(R)?Number(R):R,[R]),me={marginInlineStart:ie?de:void 0,marginInlineEnd:pe?de:void 0};return Z(b.createElement("div",Object.assign({className:ve,style:Object.assign(Object.assign({},f),W)},G,{role:"separator"}),j&&C!=="vertical"&&b.createElement("span",{className:`${Y}-inner-text`,style:me},j)))};function Fg(e){return!!(e.addonBefore||e.addonAfter)}function Vg(e){return!!(e.prefix||e.suffix||e.allowClear)}function Au(e,r,u){var c=r.cloneNode(!0),f=Object.create(e,{target:{value:c},currentTarget:{value:c}});return c.value=u,typeof r.selectionStart=="number"&&typeof r.selectionEnd=="number"&&(c.selectionStart=r.selectionStart,c.selectionEnd=r.selectionEnd),c.setSelectionRange=function(){r.setSelectionRange.apply(r,arguments)},f}function Ru(e,r,u,c){if(u){var f=r;if(r.type==="click"){f=Au(r,e,""),u(f);return}if(e.type!=="file"&&c!==void 0){f=Au(r,e,c),u(f);return}u(f)}}function jg(e,r){if(e){e.focus(r);var u=r||{},c=u.cursor;if(c){var f=e.value.length;switch(c){case"start":e.setSelectionRange(0,0);break;case"end":e.setSelectionRange(f,f);break;default:e.setSelectionRange(0,f)}}}}var Kg=Ot.forwardRef(function(e,r){var u,c,f,E=e.inputElement,C=e.children,A=e.prefixCls,R=e.prefix,M=e.suffix,F=e.addonBefore,j=e.addonAfter,B=e.className,H=e.style,q=e.disabled,W=e.readOnly,J=e.focused,G=e.triggerFocus,Y=e.allowClear,Z=e.value,X=e.handleReset,ne=e.hidden,Q=e.classes,te=e.classNames,se=e.dataAttrs,le=e.styles,ie=e.components,pe=e.onClear,ve=C??E,de=(ie==null?void 0:ie.affixWrapper)||"span",me=(ie==null?void 0:ie.groupWrapper)||"span",Ee=(ie==null?void 0:ie.wrapper)||"span",ye=(ie==null?void 0:ie.groupAddon)||"span",Ce=b.useRef(null),oe=function(Ge){var We;(We=Ce.current)!==null&&We!==void 0&&We.contains(Ge.target)&&(G==null||G())},ae=Vg(e),be=b.cloneElement(ve,{value:Z,className:Oe((u=ve.props)===null||u===void 0?void 0:u.className,!ae&&(te==null?void 0:te.variant))||null}),Le=b.useRef(null);if(Ot.useImperativeHandle(r,function(){return{nativeElement:Le.current||Ce.current}}),ae){var Ie=null;if(Y){var Ae=!q&&!W&&Z,Se="".concat(A,"-clear-icon"),ke=rr(Y)==="object"&&Y!==null&&Y!==void 0&&Y.clearIcon?Y.clearIcon:"✖";Ie=Ot.createElement("button",{type:"button",tabIndex:-1,onClick:function(Ge){X==null||X(Ge),pe==null||pe()},onMouseDown:function(Ge){return Ge.preventDefault()},className:Oe(Se,xt(xt({},"".concat(Se,"-hidden"),!Ae),"".concat(Se,"-has-suffix"),!!M))},ke)}var Me="".concat(A,"-affix-wrapper"),De=Oe(Me,xt(xt(xt(xt(xt({},"".concat(A,"-disabled"),q),"".concat(Me,"-disabled"),q),"".concat(Me,"-focused"),J),"".concat(Me,"-readonly"),W),"".concat(Me,"-input-with-clear-btn"),M&&Y&&Z),Q==null?void 0:Q.affixWrapper,te==null?void 0:te.affixWrapper,te==null?void 0:te.variant),Ke=(M||Y)&&Ot.createElement("span",{className:Oe("".concat(A,"-suffix"),te==null?void 0:te.suffix),style:le==null?void 0:le.suffix},Ie,M);be=Ot.createElement(de,qe({className:De,style:le==null?void 0:le.affixWrapper,onClick:oe},se==null?void 0:se.affixWrapper,{ref:Ce}),R&&Ot.createElement("span",{className:Oe("".concat(A,"-prefix"),te==null?void 0:te.prefix),style:le==null?void 0:le.prefix},R),be,Ke)}if(Fg(e)){var Ve="".concat(A,"-group"),at="".concat(Ve,"-addon"),Ze="".concat(Ve,"-wrapper"),Qe=Oe("".concat(A,"-wrapper"),Ve,Q==null?void 0:Q.wrapper,te==null?void 0:te.wrapper),yt=Oe(Ze,xt({},"".concat(Ze,"-disabled"),q),Q==null?void 0:Q.group,te==null?void 0:te.groupWrapper);be=Ot.createElement(me,{className:yt,ref:Le},Ot.createElement(Ee,{className:Qe},F&&Ot.createElement(ye,{className:at},F),be,j&&Ot.createElement(ye,{className:at},j)))}return Ot.cloneElement(be,{className:Oe((c=be.props)===null||c===void 0?void 0:c.className,B)||null,style:Fe(Fe({},(f=be.props)===null||f===void 0?void 0:f.style),H),hidden:ne})}),Bg=["show"];function Gg(e,r){return b.useMemo(function(){var u={};r&&(u.show=rr(r)==="object"&&r.formatter?r.formatter:!!r),u=Fe(Fe({},u),e);var c=u,f=c.show,E=rn(c,Bg);return Fe(Fe({},E),{},{show:!!f,showFormatter:typeof f=="function"?f:void 0,strategy:E.strategy||function(C){return C.length}})},[e,r])}const Ug=e=>{let r;return typeof e=="object"&&(e!=null&&e.clearIcon)?r=e:e&&(r={clearIcon:Ot.createElement(pl,null)}),r},Wg={xxl:3,xl:3,lg:3,md:3,sm:2,xs:1},Fa=Ot.createContext({});var Hg=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};const Xg=e=>ri(e).map(r=>Object.assign(Object.assign({},r==null?void 0:r.props),{key:r.key}));function Yg(e,r,u){const c=b.useMemo(()=>r||Xg(u),[r,u]);return b.useMemo(()=>c.map(E=>{var{span:C}=E,A=Hg(E,["span"]);return C==="filled"?Object.assign(Object.assign({},A),{filled:!0}):Object.assign(Object.assign({},A),{span:typeof C=="number"?C:Ol(e,C)})}),[c,e])}var Jg=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};function qg(e,r){let u=[],c=[],f=!1,E=0;return e.filter(C=>C).forEach(C=>{const{filled:A}=C,R=Jg(C,["filled"]);if(A){c.push(R),u.push(c),c=[],E=0;return}const M=r-E;E+=C.span||1,E>=r?(E>r?(f=!0,c.push(Object.assign(Object.assign({},R),{span:M}))):c.push(R),u.push(c),c=[],E=0):c.push(R)}),c.length>0&&u.push(c),u=u.map(C=>{const A=C.reduce((R,M)=>R+(M.span||1),0);if(A<r){const R=C[C.length-1];return R.span=r-(A-(R.span||1)),C}return C}),[u,f]}const Zg=(e,r)=>{const[u,c]=b.useMemo(()=>qg(r,e),[r,e]);return u},Qg=({children:e})=>e;function ku(e){return e!=null}const Zs=e=>{const{itemPrefixCls:r,component:u,span:c,className:f,style:E,labelStyle:C,contentStyle:A,bordered:R,label:M,content:F,colon:j,type:B,styles:H}=e,q=u,W=b.useContext(Fa),{classNames:J}=W;return R?b.createElement(q,{className:Oe({[`${r}-item-label`]:B==="label",[`${r}-item-content`]:B==="content",[`${J==null?void 0:J.label}`]:B==="label",[`${J==null?void 0:J.content}`]:B==="content"},f),style:E,colSpan:c},ku(M)&&b.createElement("span",{style:Object.assign(Object.assign({},C),H==null?void 0:H.label)},M),ku(F)&&b.createElement("span",{style:Object.assign(Object.assign({},C),H==null?void 0:H.content)},F)):b.createElement(q,{className:Oe(`${r}-item`,f),style:E,colSpan:c},b.createElement("div",{className:`${r}-item-container`},(M||M===0)&&b.createElement("span",{className:Oe(`${r}-item-label`,J==null?void 0:J.label,{[`${r}-item-no-colon`]:!j}),style:Object.assign(Object.assign({},C),H==null?void 0:H.label)},M),(F||F===0)&&b.createElement("span",{className:Oe(`${r}-item-content`,J==null?void 0:J.content),style:Object.assign(Object.assign({},A),H==null?void 0:H.content)},F)))};function Qs(e,{colon:r,prefixCls:u,bordered:c},{component:f,type:E,showLabel:C,showContent:A,labelStyle:R,contentStyle:M,styles:F}){return e.map(({label:j,children:B,prefixCls:H=u,className:q,style:W,labelStyle:J,contentStyle:G,span:Y=1,key:Z,styles:X},ne)=>typeof f=="string"?b.createElement(Zs,{key:`${E}-${Z||ne}`,className:q,style:W,styles:{label:Object.assign(Object.assign(Object.assign(Object.assign({},R),F==null?void 0:F.label),J),X==null?void 0:X.label),content:Object.assign(Object.assign(Object.assign(Object.assign({},M),F==null?void 0:F.content),G),X==null?void 0:X.content)},span:Y,colon:r,component:f,itemPrefixCls:H,bordered:c,label:C?j:null,content:A?B:null,type:E}):[b.createElement(Zs,{key:`label-${Z||ne}`,className:q,style:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},R),F==null?void 0:F.label),W),J),X==null?void 0:X.label),span:1,colon:r,component:f[0],itemPrefixCls:H,bordered:c,label:j,type:"label"}),b.createElement(Zs,{key:`content-${Z||ne}`,className:q,style:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},M),F==null?void 0:F.content),W),G),X==null?void 0:X.content),span:Y*2-1,component:f[1],itemPrefixCls:H,bordered:c,content:B,type:"content"})])}const ey=e=>{const r=b.useContext(Fa),{prefixCls:u,vertical:c,row:f,index:E,bordered:C}=e;return c?b.createElement(b.Fragment,null,b.createElement("tr",{key:`label-${E}`,className:`${u}-row`},Qs(f,e,Object.assign({component:"th",type:"label",showLabel:!0},r))),b.createElement("tr",{key:`content-${E}`,className:`${u}-row`},Qs(f,e,Object.assign({component:"td",type:"content",showContent:!0},r)))):b.createElement("tr",{key:E,className:`${u}-row`},Qs(f,e,Object.assign({component:C?["th","td"]:"td",type:"item",showLabel:!0,showContent:!0},r)))},ty=e=>{const{componentCls:r,labelBg:u}=e;return{[`&${r}-bordered`]:{[`> ${r}-view`]:{border:`${$e(e.lineWidth)} ${e.lineType} ${e.colorSplit}`,"> table":{tableLayout:"auto"},[`${r}-row`]:{borderBottom:`${$e(e.lineWidth)} ${e.lineType} ${e.colorSplit}`,"&:first-child":{"> th:first-child, > td:first-child":{borderStartStartRadius:e.borderRadiusLG}},"&:last-child":{borderBottom:"none","> th:first-child, > td:first-child":{borderEndStartRadius:e.borderRadiusLG}},[`> ${r}-item-label, > ${r}-item-content`]:{padding:`${$e(e.padding)} ${$e(e.paddingLG)}`,borderInlineEnd:`${$e(e.lineWidth)} ${e.lineType} ${e.colorSplit}`,"&:last-child":{borderInlineEnd:"none"}},[`> ${r}-item-label`]:{color:e.colorTextSecondary,backgroundColor:u,"&::after":{display:"none"}}}},[`&${r}-middle`]:{[`${r}-row`]:{[`> ${r}-item-label, > ${r}-item-content`]:{padding:`${$e(e.paddingSM)} ${$e(e.paddingLG)}`}}},[`&${r}-small`]:{[`${r}-row`]:{[`> ${r}-item-label, > ${r}-item-content`]:{padding:`${$e(e.paddingXS)} ${$e(e.padding)}`}}}}}},ny=e=>{const{componentCls:r,extraColor:u,itemPaddingBottom:c,itemPaddingEnd:f,colonMarginRight:E,colonMarginLeft:C,titleMarginBottom:A}=e;return{[r]:Object.assign(Object.assign(Object.assign({},Ir(e)),ty(e)),{"&-rtl":{direction:"rtl"},[`${r}-header`]:{display:"flex",alignItems:"center",marginBottom:A},[`${r}-title`]:Object.assign(Object.assign({},Rs),{flex:"auto",color:e.titleColor,fontWeight:e.fontWeightStrong,fontSize:e.fontSizeLG,lineHeight:e.lineHeightLG}),[`${r}-extra`]:{marginInlineStart:"auto",color:u,fontSize:e.fontSize},[`${r}-view`]:{width:"100%",borderRadius:e.borderRadiusLG,table:{width:"100%",tableLayout:"fixed",borderCollapse:"collapse"}},[`${r}-row`]:{"> th, > td":{paddingBottom:c,paddingInlineEnd:f},"> th:last-child, > td:last-child":{paddingInlineEnd:0},"&:last-child":{borderBottom:"none","> th, > td":{paddingBottom:0}}},[`${r}-item-label`]:{color:e.labelColor,fontWeight:"normal",fontSize:e.fontSize,lineHeight:e.lineHeight,textAlign:"start","&::after":{content:'":"',position:"relative",top:-.5,marginInline:`${$e(C)} ${$e(E)}`},[`&${r}-item-no-colon::after`]:{content:'""'}},[`${r}-item-no-label`]:{"&::after":{margin:0,content:'""'}},[`${r}-item-content`]:{display:"table-cell",flex:1,color:e.contentColor,fontSize:e.fontSize,lineHeight:e.lineHeight,wordBreak:"break-word",overflowWrap:"break-word"},[`${r}-item`]:{paddingBottom:0,verticalAlign:"top","&-container":{display:"flex",[`${r}-item-label`]:{display:"inline-flex",alignItems:"baseline"},[`${r}-item-content`]:{display:"inline-flex",alignItems:"baseline",minWidth:"1em"}}},"&-middle":{[`${r}-row`]:{"> th, > td":{paddingBottom:e.paddingSM}}},"&-small":{[`${r}-row`]:{"> th, > td":{paddingBottom:e.paddingXS}}}})}},ry=e=>({labelBg:e.colorFillAlter,labelColor:e.colorTextTertiary,titleColor:e.colorText,titleMarginBottom:e.fontSizeSM*e.lineHeightSM,itemPaddingBottom:e.padding,itemPaddingEnd:e.padding,colonMarginRight:e.marginXS,colonMarginLeft:e.marginXXS/2,contentColor:e.colorText,extraColor:e.colorText}),iy=Sr("Descriptions",e=>{const r=ir(e,{});return ny(r)},ry);var sy=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};const xi=e=>{const{prefixCls:r,title:u,extra:c,column:f,colon:E=!0,bordered:C,layout:A,children:R,className:M,rootClassName:F,style:j,size:B,labelStyle:H,contentStyle:q,styles:W,items:J,classNames:G}=e,Y=sy(e,["prefixCls","title","extra","column","colon","bordered","layout","children","className","rootClassName","style","size","labelStyle","contentStyle","styles","items","classNames"]),{getPrefixCls:Z,direction:X,className:ne,style:Q,classNames:te,styles:se}=wi("descriptions"),le=Z("descriptions",r),ie=Al(),pe=b.useMemo(()=>{var ae;return typeof f=="number"?f:(ae=Ol(ie,Object.assign(Object.assign({},Wg),f)))!==null&&ae!==void 0?ae:3},[ie,f]),ve=Yg(ie,J,R),de=Ui(B),me=Zg(pe,ve),[Ee,ye,Ce]=iy(le),oe=b.useMemo(()=>({labelStyle:H,contentStyle:q,styles:{content:Object.assign(Object.assign({},se.content),W==null?void 0:W.content),label:Object.assign(Object.assign({},se.label),W==null?void 0:W.label)},classNames:{label:Oe(te.label,G==null?void 0:G.label),content:Oe(te.content,G==null?void 0:G.content)}}),[H,q,W,G,te,se]);return Ee(b.createElement(Fa.Provider,{value:oe},b.createElement("div",Object.assign({className:Oe(le,ne,te.root,G==null?void 0:G.root,{[`${le}-${de}`]:de&&de!=="default",[`${le}-bordered`]:!!C,[`${le}-rtl`]:X==="rtl"},M,F,ye,Ce),style:Object.assign(Object.assign(Object.assign(Object.assign({},Q),se.root),W==null?void 0:W.root),j)},Y),(u||c)&&b.createElement("div",{className:Oe(`${le}-header`,te.header,G==null?void 0:G.header),style:Object.assign(Object.assign({},se.header),W==null?void 0:W.header)},u&&b.createElement("div",{className:Oe(`${le}-title`,te.title,G==null?void 0:G.title),style:Object.assign(Object.assign({},se.title),W==null?void 0:W.title)},u),c&&b.createElement("div",{className:Oe(`${le}-extra`,te.extra,G==null?void 0:G.extra),style:Object.assign(Object.assign({},se.extra),W==null?void 0:W.extra)},c)),b.createElement("div",{className:`${le}-view`},b.createElement("table",null,b.createElement("tbody",null,me.map((ae,be)=>b.createElement(ey,{key:be,index:be,colon:E,prefixCls:le,vertical:A==="vertical",bordered:C,row:ae}))))))))};xi.Item=Qg;function Du(e){return["small","middle","large"].includes(e)}function Mu(e){return e?typeof e=="number"&&!Number.isNaN(e):!1}const cc=Ot.createContext({latestIndex:0}),ay=cc.Provider,oy=({className:e,index:r,children:u,split:c,style:f})=>{const{latestIndex:E}=b.useContext(cc);return u==null?null:b.createElement(b.Fragment,null,b.createElement("div",{className:e,style:f},u),r<E&&c&&b.createElement("span",{className:`${e}-split`},c))};var uy=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};const ly=b.forwardRef((e,r)=>{var u;const{getPrefixCls:c,direction:f,size:E,className:C,style:A,classNames:R,styles:M}=wi("space"),{size:F=E??"small",align:j,className:B,rootClassName:H,children:q,direction:W="horizontal",prefixCls:J,split:G,style:Y,wrap:Z=!1,classNames:X,styles:ne}=e,Q=uy(e,["size","align","className","rootClassName","children","direction","prefixCls","split","style","wrap","classNames","styles"]),[te,se]=Array.isArray(F)?F:[F,F],le=Du(se),ie=Du(te),pe=Mu(se),ve=Mu(te),de=ri(q,{keepEmpty:!0}),me=j===void 0&&W==="horizontal"?"center":j,Ee=c("space",J),[ye,Ce,oe]=Td(Ee),ae=Oe(Ee,C,Ce,`${Ee}-${W}`,{[`${Ee}-rtl`]:f==="rtl",[`${Ee}-align-${me}`]:me,[`${Ee}-gap-row-${se}`]:le,[`${Ee}-gap-col-${te}`]:ie},B,H,oe),be=Oe(`${Ee}-item`,(u=X==null?void 0:X.item)!==null&&u!==void 0?u:R.item);let Le=0;const Ie=de.map((ke,Me)=>{var De;ke!=null&&(Le=Me);const Ke=(ke==null?void 0:ke.key)||`${be}-${Me}`;return b.createElement(oy,{className:be,key:Ke,index:Me,split:G,style:(De=ne==null?void 0:ne.item)!==null&&De!==void 0?De:M.item},ke)}),Ae=b.useMemo(()=>({latestIndex:Le}),[Le]);if(de.length===0)return null;const Se={};return Z&&(Se.flexWrap="wrap"),!ie&&ve&&(Se.columnGap=te),!le&&pe&&(Se.rowGap=se),ye(b.createElement("div",Object.assign({ref:r,className:ae,style:Object.assign(Object.assign(Object.assign({},Se),A),Y)},Q),b.createElement(ay,{value:Ae},Ie)))}),hc=ly;hc.Compact=Ed;var cy={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258c161.3 0 279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766zm-4-430c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z"}}]},name:"eye",theme:"outlined"},hy=function(r,u){return b.createElement(On,qe({},r,{ref:u,icon:cy}))},dy=b.forwardRef(hy),py={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M942.2 486.2Q889.47 375.11 816.7 305l-50.88 50.88C807.31 395.53 843.45 447.4 874.7 512 791.5 684.2 673.4 766 512 766q-72.67 0-133.87-22.38L323 798.75Q408 838 512 838q288.3 0 430.2-300.3a60.29 60.29 0 000-51.5zm-63.57-320.64L836 122.88a8 8 0 00-11.32 0L715.31 232.2Q624.86 186 512 186q-288.3 0-430.2 300.3a60.3 60.3 0 000 51.5q56.69 119.4 136.5 191.41L112.48 835a8 8 0 000 11.31L155.17 889a8 8 0 0011.31 0l712.15-712.12a8 8 0 000-11.32zM149.3 512C232.6 339.8 350.7 258 512 258c54.54 0 104.13 9.36 149.12 28.39l-70.3 70.3a176 176 0 00-238.13 238.13l-83.42 83.42C223.1 637.49 183.3 582.28 149.3 512zm246.7 0a112.11 112.11 0 01146.2-106.69L401.31 546.2A112 112 0 01396 512z"}},{tag:"path",attrs:{d:"M508 624c-3.46 0-6.87-.16-10.25-.47l-52.82 52.82a176.09 176.09 0 00227.42-227.42l-52.82 52.82c.31 3.38.47 6.79.47 10.25a111.94 111.94 0 01-112 112z"}}]},name:"eye-invisible",theme:"outlined"},fy=function(r,u){return b.createElement(On,qe({},r,{ref:u,icon:py}))},my=b.forwardRef(fy),gy=`
  min-height:0 !important;
  max-height:none !important;
  height:0 !important;
  visibility:hidden !important;
  overflow:hidden !important;
  position:absolute !important;
  z-index:-1000 !important;
  top:0 !important;
  right:0 !important;
  pointer-events: none !important;
`,yy=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","font-variant","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing","word-break","white-space"],ea={},nr;function xy(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,u=e.getAttribute("id")||e.getAttribute("data-reactid")||e.getAttribute("name");if(r&&ea[u])return ea[u];var c=window.getComputedStyle(e),f=c.getPropertyValue("box-sizing")||c.getPropertyValue("-moz-box-sizing")||c.getPropertyValue("-webkit-box-sizing"),E=parseFloat(c.getPropertyValue("padding-bottom"))+parseFloat(c.getPropertyValue("padding-top")),C=parseFloat(c.getPropertyValue("border-bottom-width"))+parseFloat(c.getPropertyValue("border-top-width")),A=yy.map(function(M){return"".concat(M,":").concat(c.getPropertyValue(M))}).join(";"),R={sizingStyle:A,paddingSize:E,borderSize:C,boxSizing:f};return r&&u&&(ea[u]=R),R}function by(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;nr||(nr=document.createElement("textarea"),nr.setAttribute("tab-index","-1"),nr.setAttribute("aria-hidden","true"),nr.setAttribute("name","hiddenTextarea"),document.body.appendChild(nr)),e.getAttribute("wrap")?nr.setAttribute("wrap",e.getAttribute("wrap")):nr.removeAttribute("wrap");var f=xy(e,r),E=f.paddingSize,C=f.borderSize,A=f.boxSizing,R=f.sizingStyle;nr.setAttribute("style","".concat(R,";").concat(gy)),nr.value=e.value||e.placeholder||"";var M=void 0,F=void 0,j,B=nr.scrollHeight;if(A==="border-box"?B+=C:A==="content-box"&&(B-=E),u!==null||c!==null){nr.value=" ";var H=nr.scrollHeight-E;u!==null&&(M=H*u,A==="border-box"&&(M=M+E+C),B=Math.max(M,B)),c!==null&&(F=H*c,A==="border-box"&&(F=F+E+C),j=B>F?"":"hidden",B=Math.min(F,B))}var q={height:B,overflowY:j,resize:"none"};return M&&(q.minHeight=M),F&&(q.maxHeight=F),q}var vy=["prefixCls","defaultValue","value","autoSize","onResize","className","style","disabled","onChange","onInternalAutoSize"],ta=0,na=1,ra=2,wy=b.forwardRef(function(e,r){var u=e,c=u.prefixCls,f=u.defaultValue,E=u.value,C=u.autoSize,A=u.onResize,R=u.className,M=u.style,F=u.disabled,j=u.onChange;u.onInternalAutoSize;var B=rn(u,vy),H=vr(f,{value:E,postState:function(Se){return Se??""}}),q=ze(H,2),W=q[0],J=q[1],G=function(Se){J(Se.target.value),j==null||j(Se)},Y=b.useRef();b.useImperativeHandle(r,function(){return{textArea:Y.current}});var Z=b.useMemo(function(){return C&&rr(C)==="object"?[C.minRows,C.maxRows]:[]},[C]),X=ze(Z,2),ne=X[0],Q=X[1],te=!!C,se=function(){try{if(document.activeElement===Y.current){var Se=Y.current,ke=Se.selectionStart,Me=Se.selectionEnd,De=Se.scrollTop;Y.current.setSelectionRange(ke,Me),Y.current.scrollTop=De}}catch{}},le=b.useState(ra),ie=ze(le,2),pe=ie[0],ve=ie[1],de=b.useState(),me=ze(de,2),Ee=me[0],ye=me[1],Ce=function(){ve(ta)};Cn(function(){te&&Ce()},[E,ne,Q,te]),Cn(function(){if(pe===ta)ve(na);else if(pe===na){var Ae=by(Y.current,!1,ne,Q);ve(ra),ye(Ae)}else se()},[pe]);var oe=b.useRef(),ae=function(){br.cancel(oe.current)},be=function(Se){pe===ra&&(A==null||A(Se),C&&(ae(),oe.current=br(function(){Ce()})))};b.useEffect(function(){return ae},[]);var Le=te?Ee:null,Ie=Fe(Fe({},M),Le);return(pe===ta||pe===na)&&(Ie.overflowY="hidden",Ie.overflowX="hidden"),b.createElement(_r,{onResize:be,disabled:!(C||A)},b.createElement("textarea",qe({},B,{ref:Y,style:Ie,className:Oe(c,R,xt({},"".concat(c,"-disabled"),F)),disabled:F,value:W,onChange:G})))}),Sy=["defaultValue","value","onFocus","onBlur","onChange","allowClear","maxLength","onCompositionStart","onCompositionEnd","suffix","prefixCls","showCount","count","className","style","disabled","hidden","classNames","styles","onResize","onClear","onPressEnter","readOnly","autoSize","onKeyDown"],Ty=Ot.forwardRef(function(e,r){var u,c=e.defaultValue,f=e.value,E=e.onFocus,C=e.onBlur,A=e.onChange,R=e.allowClear,M=e.maxLength,F=e.onCompositionStart,j=e.onCompositionEnd,B=e.suffix,H=e.prefixCls,q=H===void 0?"rc-textarea":H,W=e.showCount,J=e.count,G=e.className,Y=e.style,Z=e.disabled,X=e.hidden,ne=e.classNames,Q=e.styles,te=e.onResize,se=e.onClear,le=e.onPressEnter,ie=e.readOnly,pe=e.autoSize,ve=e.onKeyDown,de=rn(e,Sy),me=vr(c,{value:f,defaultValue:c}),Ee=ze(me,2),ye=Ee[0],Ce=Ee[1],oe=ye==null?"":String(ye),ae=Ot.useState(!1),be=ze(ae,2),Le=be[0],Ie=be[1],Ae=Ot.useRef(!1),Se=Ot.useState(null),ke=ze(Se,2),Me=ke[0],De=ke[1],Ke=b.useRef(null),Ve=b.useRef(null),at=function(){var Be;return(Be=Ve.current)===null||Be===void 0?void 0:Be.textArea},Ze=function(){at().focus()};b.useImperativeHandle(r,function(){var dt;return{resizableTextArea:Ve.current,focus:Ze,blur:function(){at().blur()},nativeElement:((dt=Ke.current)===null||dt===void 0?void 0:dt.nativeElement)||at()}}),b.useEffect(function(){Ie(function(dt){return!Z&&dt})},[Z]);var Qe=Ot.useState(null),yt=ze(Qe,2),ge=yt[0],Ge=yt[1];Ot.useEffect(function(){if(ge){var dt;(dt=at()).setSelectionRange.apply(dt,Kn(ge))}},[ge]);var We=Gg(J,W),we=(u=We.max)!==null&&u!==void 0?u:M,ot=Number(we)>0,et=We.strategy(oe),Tt=!!we&&et>we,ut=function(Be,Ct){var Ne=Ct;!Ae.current&&We.exceedFormatter&&We.max&&We.strategy(Ct)>We.max&&(Ne=We.exceedFormatter(Ct,{max:We.max}),Ct!==Ne&&Ge([at().selectionStart||0,at().selectionEnd||0])),Ce(Ne),Ru(Be.currentTarget,Be,A,Ne)},Ut=function(Be){Ae.current=!0,F==null||F(Be)},Ft=function(Be){Ae.current=!1,ut(Be,Be.currentTarget.value),j==null||j(Be)},vt=function(Be){ut(Be,Be.target.value)},on=function(Be){Be.key==="Enter"&&le&&le(Be),ve==null||ve(Be)},ht=function(Be){Ie(!0),E==null||E(Be)},pn=function(Be){Ie(!1),C==null||C(Be)},Wt=function(Be){Ce(""),Ze(),Ru(at(),Be,A)},wt=B,Kt;We.show&&(We.showFormatter?Kt=We.showFormatter({value:oe,count:et,maxLength:we}):Kt="".concat(et).concat(ot?" / ".concat(we):""),wt=Ot.createElement(Ot.Fragment,null,wt,Ot.createElement("span",{className:Oe("".concat(q,"-data-count"),ne==null?void 0:ne.count),style:Q==null?void 0:Q.count},Kt)));var Et=function(Be){var Ct;te==null||te(Be),(Ct=at())!==null&&Ct!==void 0&&Ct.style.height&&De(!0)},kt=!pe&&!W&&!R;return Ot.createElement(Kg,{ref:Ke,value:oe,allowClear:R,handleReset:Wt,suffix:wt,prefixCls:q,classNames:Fe(Fe({},ne),{},{affixWrapper:Oe(ne==null?void 0:ne.affixWrapper,xt(xt({},"".concat(q,"-show-count"),W),"".concat(q,"-textarea-allow-clear"),R))}),disabled:Z,focused:Le,className:Oe(G,Tt&&"".concat(q,"-out-of-range")),style:Fe(Fe({},Y),Me&&!kt?{height:"auto"}:{}),dataAttrs:{affixWrapper:{"data-count":typeof Kt=="string"?Kt:void 0}},hidden:X,readOnly:ie,onClear:se},Ot.createElement(wy,qe({},de,{autoSize:pe,maxLength:M,onKeyDown:on,onChange:vt,onFocus:ht,onBlur:pn,onCompositionStart:Ut,onCompositionEnd:Ft,className:Oe(ne==null?void 0:ne.textarea),style:Fe(Fe({},Q==null?void 0:Q.textarea),{},{resize:Y==null?void 0:Y.resize}),disabled:Z,prefixCls:q,onResize:Et,ref:Ve,readOnly:ie})))});const Ey=e=>{const{componentCls:r,paddingLG:u}=e,c=`${r}-textarea`;return{[`textarea${r}`]:{maxWidth:"100%",height:"auto",minHeight:e.controlHeight,lineHeight:e.lineHeight,verticalAlign:"bottom",transition:`all ${e.motionDurationSlow}`,resize:"vertical",[`&${r}-mouse-active`]:{transition:`all ${e.motionDurationSlow}, height 0s, width 0s`}},[`${r}-textarea-affix-wrapper-resize-dirty`]:{width:"auto"},[c]:{position:"relative","&-show-count":{[`${r}-data-count`]:{position:"absolute",bottom:e.calc(e.fontSize).mul(e.lineHeight).mul(-1).equal(),insetInlineEnd:0,color:e.colorTextDescription,whiteSpace:"nowrap",pointerEvents:"none"}},[`
        &-allow-clear > ${r},
        &-affix-wrapper${c}-has-feedback ${r}
      `]:{paddingInlineEnd:u},[`&-affix-wrapper${r}-affix-wrapper`]:{padding:0,[`> textarea${r}`]:{fontSize:"inherit",border:"none",outline:"none",background:"transparent",minHeight:e.calc(e.controlHeight).sub(e.calc(e.lineWidth).mul(2)).equal(),"&:focus":{boxShadow:"none !important"}},[`${r}-suffix`]:{margin:0,"> *:not(:last-child)":{marginInline:0},[`${r}-clear-icon`]:{position:"absolute",insetInlineEnd:e.paddingInline,insetBlockStart:e.paddingXS},[`${c}-suffix`]:{position:"absolute",top:0,insetInlineEnd:e.paddingInline,bottom:0,zIndex:1,display:"inline-flex",alignItems:"center",margin:"auto",pointerEvents:"none"}}},[`&-affix-wrapper${r}-affix-wrapper-rtl`]:{[`${r}-suffix`]:{[`${r}-data-count`]:{direction:"ltr",insetInlineStart:0}}},[`&-affix-wrapper${r}-affix-wrapper-sm`]:{[`${r}-suffix`]:{[`${r}-clear-icon`]:{insetInlineEnd:e.paddingInlineSM}}}}}},Cy=Sr(["Input","TextArea"],e=>{const r=ir(e,Ma(e));return[Ey(r)]},Pa,{resetFont:!1});var $y=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};const _y=b.forwardRef((e,r)=>{var u;const{prefixCls:c,bordered:f=!0,size:E,disabled:C,status:A,allowClear:R,classNames:M,rootClassName:F,className:j,style:B,styles:H,variant:q,showCount:W,onMouseDown:J,onResize:G}=e,Y=$y(e,["prefixCls","bordered","size","disabled","status","allowClear","classNames","rootClassName","className","style","styles","variant","showCount","onMouseDown","onResize"]),{getPrefixCls:Z,direction:X,allowClear:ne,autoComplete:Q,className:te,style:se,classNames:le,styles:ie}=wi("textArea"),pe=b.useContext(Cd),ve=C??pe,{status:de,hasFeedback:me,feedbackIcon:Ee}=b.useContext($d),ye=Gp(de,A),Ce=b.useRef(null);b.useImperativeHandle(r,()=>{var We;return{resizableTextArea:(We=Ce.current)===null||We===void 0?void 0:We.resizableTextArea,focus:we=>{var ot,et;jg((et=(ot=Ce.current)===null||ot===void 0?void 0:ot.resizableTextArea)===null||et===void 0?void 0:et.textArea,we)},blur:()=>{var we;return(we=Ce.current)===null||we===void 0?void 0:we.blur()}}});const oe=Z("input",c),ae=hl(oe),[be,Le,Ie]=$m(oe,F),[Ae]=Cy(oe,ae),{compactSize:Se,compactItemClassnames:ke}=_d(oe,X),Me=Ui(We=>{var we;return(we=E??Se)!==null&&we!==void 0?we:We}),[De,Ke]=Il("textArea",q,f),Ve=Ug(R??ne),[at,Ze]=b.useState(!1),[Qe,yt]=b.useState(!1),ge=We=>{Ze(!0),J==null||J(We);const we=()=>{Ze(!1),document.removeEventListener("mouseup",we)};document.addEventListener("mouseup",we)},Ge=We=>{var we,ot;if(G==null||G(We),at&&typeof getComputedStyle=="function"){const et=(ot=(we=Ce.current)===null||we===void 0?void 0:we.nativeElement)===null||ot===void 0?void 0:ot.querySelector("textarea");et&&getComputedStyle(et).resize==="both"&&yt(!0)}};return be(Ae(b.createElement(Ty,Object.assign({autoComplete:Q},Y,{style:Object.assign(Object.assign({},se),B),styles:Object.assign(Object.assign({},ie),H),disabled:ve,allowClear:Ve,className:Oe(Ie,ae,j,F,ke,te,Qe&&`${oe}-textarea-affix-wrapper-resize-dirty`),classNames:Object.assign(Object.assign(Object.assign({},M),le),{textarea:Oe({[`${oe}-sm`]:Me==="small",[`${oe}-lg`]:Me==="large"},Le,M==null?void 0:M.textarea,le.textarea,at&&`${oe}-mouse-active`),variant:Oe({[`${oe}-${De}`]:Ke},Bp(oe,ye)),affixWrapper:Oe(`${oe}-textarea-affix-wrapper`,{[`${oe}-affix-wrapper-rtl`]:X==="rtl",[`${oe}-affix-wrapper-sm`]:Me==="small",[`${oe}-affix-wrapper-lg`]:Me==="large",[`${oe}-textarea-show-count`]:W||((u=e.count)===null||u===void 0?void 0:u.show)},Le)}),prefixCls:oe,suffix:me&&b.createElement("span",{className:`${oe}-textarea-suffix`},Ee),showCount:W,ref:Ce,onResize:Ge,onMouseDown:ge}))))}),Iy=(e,r=!1)=>r&&e==null?[]:Array.isArray(e)?e:[e];var Ly={percent:0,prefixCls:"rc-progress",strokeColor:"#2db7f5",strokeLinecap:"round",strokeWidth:1,trailColor:"#D9D9D9",trailWidth:1,gapPosition:"bottom"},Oy=function(){var r=b.useRef([]),u=b.useRef(null);return b.useEffect(function(){var c=Date.now(),f=!1;r.current.forEach(function(E){if(E){f=!0;var C=E.style;C.transitionDuration=".3s, .3s, .3s, .06s",u.current&&c-u.current<100&&(C.transitionDuration="0s, 0s")}}),f&&(u.current=Date.now())}),r.current},Pu=0,Ay=el();function Ry(){var e;return Ay?(e=Pu,Pu+=1):e="TEST_OR_SSR",e}const ky=function(e){var r=b.useState(),u=ze(r,2),c=u[0],f=u[1];return b.useEffect(function(){f("rc_progress_".concat(Ry()))},[]),e||c};var zu=function(r){var u=r.bg,c=r.children;return b.createElement("div",{style:{width:"100%",height:"100%",background:u}},c)};function Nu(e,r){return Object.keys(e).map(function(u){var c=parseFloat(u),f="".concat(Math.floor(c*r),"%");return"".concat(e[u]," ").concat(f)})}var Dy=b.forwardRef(function(e,r){var u=e.prefixCls,c=e.color,f=e.gradientId,E=e.radius,C=e.style,A=e.ptg,R=e.strokeLinecap,M=e.strokeWidth,F=e.size,j=e.gapDegree,B=c&&rr(c)==="object",H=B?"#FFF":void 0,q=F/2,W=b.createElement("circle",{className:"".concat(u,"-circle-path"),r:E,cx:q,cy:q,stroke:H,strokeLinecap:R,strokeWidth:M,opacity:A===0?0:1,style:C,ref:r});if(!B)return W;var J="".concat(f,"-conic"),G=j?"".concat(180+j/2,"deg"):"0deg",Y=Nu(c,(360-j)/360),Z=Nu(c,1),X="conic-gradient(from ".concat(G,", ").concat(Y.join(", "),")"),ne="linear-gradient(to ".concat(j?"bottom":"top",", ").concat(Z.join(", "),")");return b.createElement(b.Fragment,null,b.createElement("mask",{id:J},W),b.createElement("foreignObject",{x:0,y:0,width:F,height:F,mask:"url(#".concat(J,")")},b.createElement(zu,{bg:ne},b.createElement(zu,{bg:X}))))}),Pi=100,ia=function(r,u,c,f,E,C,A,R,M,F){var j=arguments.length>10&&arguments[10]!==void 0?arguments[10]:0,B=c/100*360*((360-C)/360),H=C===0?0:{bottom:0,top:180,left:90,right:-90}[A],q=(100-f)/100*u;M==="round"&&f!==100&&(q+=F/2,q>=u&&(q=u-.01));var W=Pi/2;return{stroke:typeof R=="string"?R:void 0,strokeDasharray:"".concat(u,"px ").concat(r),strokeDashoffset:q+j,transform:"rotate(".concat(E+B+H,"deg)"),transformOrigin:"".concat(W,"px ").concat(W,"px"),transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s, opacity .3s ease 0s",fillOpacity:0}},My=["id","prefixCls","steps","strokeWidth","trailWidth","gapDegree","gapPosition","trailColor","strokeLinecap","style","className","strokeColor","percent"];function Fu(e){var r=e??[];return Array.isArray(r)?r:[r]}var Py=function(r){var u=Fe(Fe({},Ly),r),c=u.id,f=u.prefixCls,E=u.steps,C=u.strokeWidth,A=u.trailWidth,R=u.gapDegree,M=R===void 0?0:R,F=u.gapPosition,j=u.trailColor,B=u.strokeLinecap,H=u.style,q=u.className,W=u.strokeColor,J=u.percent,G=rn(u,My),Y=Pi/2,Z=ky(c),X="".concat(Z,"-gradient"),ne=Y-C/2,Q=Math.PI*2*ne,te=M>0?90+M/2:-90,se=Q*((360-M)/360),le=rr(E)==="object"?E:{count:E,gap:2},ie=le.count,pe=le.gap,ve=Fu(J),de=Fu(W),me=de.find(function(Le){return Le&&rr(Le)==="object"}),Ee=me&&rr(me)==="object",ye=Ee?"butt":B,Ce=ia(Q,se,0,100,te,M,F,j,ye,C),oe=Oy(),ae=function(){var Ie=0;return ve.map(function(Ae,Se){var ke=de[Se]||de[de.length-1],Me=ia(Q,se,Ie,Ae,te,M,F,ke,ye,C);return Ie+=Ae,b.createElement(Dy,{key:Se,color:ke,ptg:Ae,radius:ne,prefixCls:f,gradientId:X,style:Me,strokeLinecap:ye,strokeWidth:C,gapDegree:M,ref:function(Ke){oe[Se]=Ke},size:Pi})}).reverse()},be=function(){var Ie=Math.round(ie*(ve[0]/100)),Ae=100/ie,Se=0;return new Array(ie).fill(null).map(function(ke,Me){var De=Me<=Ie-1?de[0]:j,Ke=De&&rr(De)==="object"?"url(#".concat(X,")"):void 0,Ve=ia(Q,se,Se,Ae,te,M,F,De,"butt",C,pe);return Se+=(se-Ve.strokeDashoffset+pe)*100/se,b.createElement("circle",{key:Me,className:"".concat(f,"-circle-path"),r:ne,cx:Y,cy:Y,stroke:Ke,strokeWidth:C,opacity:1,style:Ve,ref:function(Ze){oe[Me]=Ze}})})};return b.createElement("svg",qe({className:Oe("".concat(f,"-circle"),q),viewBox:"0 0 ".concat(Pi," ").concat(Pi),style:H,id:c,role:"presentation"},G),!ie&&b.createElement("circle",{className:"".concat(f,"-circle-trail"),r:ne,cx:Y,cy:Y,stroke:j,strokeLinecap:ye,strokeWidth:A||C,style:Ce}),ie?be():ae())};function Hr(e){return!e||e<0?0:e>100?100:e}function $s({success:e,successPercent:r}){let u=r;return e&&"progress"in e&&(u=e.progress),e&&"percent"in e&&(u=e.percent),u}const zy=({percent:e,success:r,successPercent:u})=>{const c=Hr($s({success:r,successPercent:u}));return[c,Hr(Hr(e)-c)]},Ny=({success:e={},strokeColor:r})=>{const{strokeColor:u}=e;return[u||ya.green,r||null]},zs=(e,r,u)=>{var c,f,E,C;let A=-1,R=-1;if(r==="step"){const M=u.steps,F=u.strokeWidth;typeof e=="string"||typeof e>"u"?(A=e==="small"?2:14,R=F??8):typeof e=="number"?[A,R]=[e,e]:[A=14,R=8]=Array.isArray(e)?e:[e.width,e.height],A*=M}else if(r==="line"){const M=u==null?void 0:u.strokeWidth;typeof e=="string"||typeof e>"u"?R=M||(e==="small"?6:8):typeof e=="number"?[A,R]=[e,e]:[A=-1,R=8]=Array.isArray(e)?e:[e.width,e.height]}else(r==="circle"||r==="dashboard")&&(typeof e=="string"||typeof e>"u"?[A,R]=e==="small"?[60,60]:[120,120]:typeof e=="number"?[A,R]=[e,e]:Array.isArray(e)&&(A=(f=(c=e[0])!==null&&c!==void 0?c:e[1])!==null&&f!==void 0?f:120,R=(C=(E=e[0])!==null&&E!==void 0?E:e[1])!==null&&C!==void 0?C:120));return[A,R]},Fy=3,Vy=e=>Fy/e*100,jy=e=>{const{prefixCls:r,trailColor:u=null,strokeLinecap:c="round",gapPosition:f,gapDegree:E,width:C=120,type:A,children:R,success:M,size:F=C,steps:j}=e,[B,H]=zs(F,"circle");let{strokeWidth:q}=e;q===void 0&&(q=Math.max(Vy(B),6));const W={width:B,height:H,fontSize:B*.15+6},J=b.useMemo(()=>{if(E||E===0)return E;if(A==="dashboard")return 75},[E,A]),G=zy(e),Y=f||A==="dashboard"&&"bottom"||void 0,Z=Object.prototype.toString.call(e.strokeColor)==="[object Object]",X=Ny({success:M,strokeColor:e.strokeColor}),ne=Oe(`${r}-inner`,{[`${r}-circle-gradient`]:Z}),Q=b.createElement(Py,{steps:j,percent:j?G[1]:G,strokeWidth:q,trailWidth:q,strokeColor:j?X[1]:X,strokeLinecap:c,trailColor:u,prefixCls:r,gapDegree:J,gapPosition:Y}),te=B<=20,se=b.createElement("div",{className:ne,style:W},Q,!te&&R);return te?b.createElement(Hi,{title:R},se):se},_s="--progress-line-stroke-color",dc="--progress-percent",Vu=e=>{const r=e?"100%":"-100%";return new Vr(`antProgress${e?"RTL":"LTR"}Active`,{"0%":{transform:`translateX(${r}) scaleX(0)`,opacity:.1},"20%":{transform:`translateX(${r}) scaleX(0)`,opacity:.5},to:{transform:"translateX(0) scaleX(1)",opacity:0}})},Ky=e=>{const{componentCls:r,iconCls:u}=e;return{[r]:Object.assign(Object.assign({},Ir(e)),{display:"inline-block","&-rtl":{direction:"rtl"},"&-line":{position:"relative",width:"100%",fontSize:e.fontSize},[`${r}-outer`]:{display:"inline-flex",alignItems:"center",width:"100%"},[`${r}-inner`]:{position:"relative",display:"inline-block",width:"100%",flex:1,overflow:"hidden",verticalAlign:"middle",backgroundColor:e.remainingColor,borderRadius:e.lineBorderRadius},[`${r}-inner:not(${r}-circle-gradient)`]:{[`${r}-circle-path`]:{stroke:e.defaultColor}},[`${r}-success-bg, ${r}-bg`]:{position:"relative",background:e.defaultColor,borderRadius:e.lineBorderRadius,transition:`all ${e.motionDurationSlow} ${e.motionEaseInOutCirc}`},[`${r}-layout-bottom`]:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",[`${r}-text`]:{width:"max-content",marginInlineStart:0,marginTop:e.marginXXS}},[`${r}-bg`]:{overflow:"hidden","&::after":{content:'""',background:{_multi_value_:!0,value:["inherit",`var(${_s})`]},height:"100%",width:`calc(1 / var(${dc}) * 100%)`,display:"block"},[`&${r}-bg-inner`]:{minWidth:"max-content","&::after":{content:"none"},[`${r}-text-inner`]:{color:e.colorWhite,[`&${r}-text-bright`]:{color:"rgba(0, 0, 0, 0.45)"}}}},[`${r}-success-bg`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,backgroundColor:e.colorSuccess},[`${r}-text`]:{display:"inline-block",marginInlineStart:e.marginXS,color:e.colorText,lineHeight:1,width:"2em",whiteSpace:"nowrap",textAlign:"start",verticalAlign:"middle",wordBreak:"normal",[u]:{fontSize:e.fontSize},[`&${r}-text-outer`]:{width:"max-content"},[`&${r}-text-outer${r}-text-start`]:{width:"max-content",marginInlineStart:0,marginInlineEnd:e.marginXS}},[`${r}-text-inner`]:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%",marginInlineStart:0,padding:`0 ${$e(e.paddingXXS)}`,[`&${r}-text-start`]:{justifyContent:"start"},[`&${r}-text-end`]:{justifyContent:"end"}},[`&${r}-status-active`]:{[`${r}-bg::before`]:{position:"absolute",inset:0,backgroundColor:e.colorBgContainer,borderRadius:e.lineBorderRadius,opacity:0,animationName:Vu(),animationDuration:e.progressActiveMotionDuration,animationTimingFunction:e.motionEaseOutQuint,animationIterationCount:"infinite",content:'""'}},[`&${r}-rtl${r}-status-active`]:{[`${r}-bg::before`]:{animationName:Vu(!0)}},[`&${r}-status-exception`]:{[`${r}-bg`]:{backgroundColor:e.colorError},[`${r}-text`]:{color:e.colorError}},[`&${r}-status-exception ${r}-inner:not(${r}-circle-gradient)`]:{[`${r}-circle-path`]:{stroke:e.colorError}},[`&${r}-status-success`]:{[`${r}-bg`]:{backgroundColor:e.colorSuccess},[`${r}-text`]:{color:e.colorSuccess}},[`&${r}-status-success ${r}-inner:not(${r}-circle-gradient)`]:{[`${r}-circle-path`]:{stroke:e.colorSuccess}}})}},By=e=>{const{componentCls:r,iconCls:u}=e;return{[r]:{[`${r}-circle-trail`]:{stroke:e.remainingColor},[`&${r}-circle ${r}-inner`]:{position:"relative",lineHeight:1,backgroundColor:"transparent"},[`&${r}-circle ${r}-text`]:{position:"absolute",insetBlockStart:"50%",insetInlineStart:0,width:"100%",margin:0,padding:0,color:e.circleTextColor,fontSize:e.circleTextFontSize,lineHeight:1,whiteSpace:"normal",textAlign:"center",transform:"translateY(-50%)",[u]:{fontSize:e.circleIconFontSize}},[`${r}-circle&-status-exception`]:{[`${r}-text`]:{color:e.colorError}},[`${r}-circle&-status-success`]:{[`${r}-text`]:{color:e.colorSuccess}}},[`${r}-inline-circle`]:{lineHeight:1,[`${r}-inner`]:{verticalAlign:"bottom"}}}},Gy=e=>{const{componentCls:r}=e;return{[r]:{[`${r}-steps`]:{display:"inline-block","&-outer":{display:"flex",flexDirection:"row",alignItems:"center"},"&-item":{flexShrink:0,minWidth:e.progressStepMinWidth,marginInlineEnd:e.progressStepMarginInlineEnd,backgroundColor:e.remainingColor,transition:`all ${e.motionDurationSlow}`,"&-active":{backgroundColor:e.defaultColor}}}}}},Uy=e=>{const{componentCls:r,iconCls:u}=e;return{[r]:{[`${r}-small&-line, ${r}-small&-line ${r}-text ${u}`]:{fontSize:e.fontSizeSM}}}},Wy=e=>({circleTextColor:e.colorText,defaultColor:e.colorInfo,remainingColor:e.colorFillSecondary,lineBorderRadius:100,circleTextFontSize:"1em",circleIconFontSize:`${e.fontSize/e.fontSizeSM}em`}),Hy=Sr("Progress",e=>{const r=e.calc(e.marginXXS).div(2).equal(),u=ir(e,{progressStepMarginInlineEnd:r,progressStepMinWidth:r,progressActiveMotionDuration:"2.4s"});return[Ky(u),By(u),Gy(u),Uy(u)]},Wy);var Xy=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};const Yy=e=>{let r=[];return Object.keys(e).forEach(u=>{const c=parseFloat(u.replace(/%/g,""));Number.isNaN(c)||r.push({key:c,value:e[u]})}),r=r.sort((u,c)=>u.key-c.key),r.map(({key:u,value:c})=>`${c} ${u}%`).join(", ")},Jy=(e,r)=>{const{from:u=ya.blue,to:c=ya.blue,direction:f=r==="rtl"?"to left":"to right"}=e,E=Xy(e,["from","to","direction"]);if(Object.keys(E).length!==0){const A=Yy(E),R=`linear-gradient(${f}, ${A})`;return{background:R,[_s]:R}}const C=`linear-gradient(${f}, ${u}, ${c})`;return{background:C,[_s]:C}},qy=e=>{const{prefixCls:r,direction:u,percent:c,size:f,strokeWidth:E,strokeColor:C,strokeLinecap:A="round",children:R,trailColor:M=null,percentPosition:F,success:j}=e,{align:B,type:H}=F,q=C&&typeof C!="string"?Jy(C,u):{[_s]:C,background:C},W=A==="square"||A==="butt"?0:void 0,J=f??[-1,E||(f==="small"?6:8)],[G,Y]=zs(J,"line",{strokeWidth:E}),Z={backgroundColor:M||void 0,borderRadius:W},X=Object.assign(Object.assign({width:`${Hr(c)}%`,height:Y,borderRadius:W},q),{[dc]:Hr(c)/100}),ne=$s(e),Q={width:`${Hr(ne)}%`,height:Y,borderRadius:W,backgroundColor:j==null?void 0:j.strokeColor},te={width:G<0?"100%":G},se=b.createElement("div",{className:`${r}-inner`,style:Z},b.createElement("div",{className:Oe(`${r}-bg`,`${r}-bg-${H}`),style:X},H==="inner"&&R),ne!==void 0&&b.createElement("div",{className:`${r}-success-bg`,style:Q})),le=H==="outer"&&B==="start",ie=H==="outer"&&B==="end";return H==="outer"&&B==="center"?b.createElement("div",{className:`${r}-layout-bottom`},se,R):b.createElement("div",{className:`${r}-outer`,style:te},le&&R,se,ie&&R)},Zy=e=>{const{size:r,steps:u,rounding:c=Math.round,percent:f=0,strokeWidth:E=8,strokeColor:C,trailColor:A=null,prefixCls:R,children:M}=e,F=c(u*(f/100)),B=r??[r==="small"?2:14,E],[H,q]=zs(B,"step",{steps:u,strokeWidth:E}),W=H/u,J=Array.from({length:u});for(let G=0;G<u;G++){const Y=Array.isArray(C)?C[G]:C;J[G]=b.createElement("div",{key:G,className:Oe(`${R}-steps-item`,{[`${R}-steps-item-active`]:G<=F-1}),style:{backgroundColor:G<=F-1?Y:A,width:W,height:q}})}return b.createElement("div",{className:`${R}-steps-outer`},J,M)};var Qy=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};const e0=["normal","exception","active","success"],t0=b.forwardRef((e,r)=>{const{prefixCls:u,className:c,rootClassName:f,steps:E,strokeColor:C,percent:A=0,size:R="default",showInfo:M=!0,type:F="line",status:j,format:B,style:H,percentPosition:q={}}=e,W=Qy(e,["prefixCls","className","rootClassName","steps","strokeColor","percent","size","showInfo","type","status","format","style","percentPosition"]),{align:J="end",type:G="outer"}=q,Y=Array.isArray(C)?C[0]:C,Z=typeof C=="string"||Array.isArray(C)?C:void 0,X=b.useMemo(()=>{if(Y){const ae=typeof Y=="string"?Y:Object.values(Y)[0];return new fl(ae).isLight()}return!1},[C]),ne=b.useMemo(()=>{var ae,be;const Le=$s(e);return parseInt(Le!==void 0?(ae=Le??0)===null||ae===void 0?void 0:ae.toString():(be=A??0)===null||be===void 0?void 0:be.toString(),10)},[A,e.success,e.successPercent]),Q=b.useMemo(()=>!e0.includes(j)&&ne>=100?"success":j||"normal",[j,ne]),{getPrefixCls:te,direction:se,progress:le}=b.useContext(fr),ie=te("progress",u),[pe,ve,de]=Hy(ie),me=F==="line",Ee=me&&!E,ye=b.useMemo(()=>{if(!M)return null;const ae=$s(e);let be;const Le=B||(Ae=>`${Ae}%`),Ie=me&&X&&G==="inner";return G==="inner"||B||Q!=="exception"&&Q!=="success"?be=Le(Hr(A),Hr(ae)):Q==="exception"?be=me?b.createElement(pl,null):b.createElement(dl,null):Q==="success"&&(be=me?b.createElement(Id,null):b.createElement(Ll,null)),b.createElement("span",{className:Oe(`${ie}-text`,{[`${ie}-text-bright`]:Ie,[`${ie}-text-${J}`]:Ee,[`${ie}-text-${G}`]:Ee}),title:typeof be=="string"?be:void 0},be)},[M,A,ne,Q,F,ie,B]);let Ce;F==="line"?Ce=E?b.createElement(Zy,Object.assign({},e,{strokeColor:Z,prefixCls:ie,steps:typeof E=="object"?E.count:E}),ye):b.createElement(qy,Object.assign({},e,{strokeColor:Y,prefixCls:ie,direction:se,percentPosition:{align:J,type:G}}),ye):(F==="circle"||F==="dashboard")&&(Ce=b.createElement(jy,Object.assign({},e,{strokeColor:Y,prefixCls:ie,progressStatus:Q}),ye));const oe=Oe(ie,`${ie}-status-${Q}`,{[`${ie}-${F==="dashboard"&&"circle"||F}`]:F!=="line",[`${ie}-inline-circle`]:F==="circle"&&zs(R,"circle")[0]<=20,[`${ie}-line`]:Ee,[`${ie}-line-align-${J}`]:Ee,[`${ie}-line-position-${G}`]:Ee,[`${ie}-steps`]:E,[`${ie}-show-info`]:M,[`${ie}-${R}`]:typeof R=="string",[`${ie}-rtl`]:se==="rtl"},le==null?void 0:le.className,c,f,ve,de);return pe(b.createElement("div",Object.assign({ref:r,style:Object.assign(Object.assign({},le==null?void 0:le.style),H),className:oe,role:"progressbar","aria-valuenow":ne,"aria-valuemin":0,"aria-valuemax":100},Xr(W,["trailColor","strokeWidth","width","gapDegree","gapPosition","strokeLinecap","success","successPercent"])),Ce))});var n0={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M917.7 148.8l-42.4-42.4c-1.6-1.6-3.6-2.3-5.7-2.3s-4.1.8-5.7 2.3l-76.1 76.1a199.27 199.27 0 00-112.1-34.3c-51.2 0-102.4 19.5-141.5 58.6L432.3 308.7a8.03 8.03 0 000 11.3L704 591.7c1.6 1.6 3.6 2.3 5.7 2.3 2 0 4.1-.8 5.7-2.3l101.9-101.9c68.9-69 77-175.7 24.3-253.5l76.1-76.1c3.1-3.2 3.1-8.3 0-11.4zM769.1 441.7l-59.4 59.4-186.8-186.8 59.4-59.4c24.9-24.9 58.1-38.7 93.4-38.7 35.3 0 68.4 13.7 93.4 38.7 24.9 24.9 38.7 58.1 38.7 93.4 0 35.3-13.8 68.4-38.7 93.4zm-190.2 105a8.03 8.03 0 00-11.3 0L501 613.3 410.7 523l66.7-66.7c3.1-3.1 3.1-8.2 0-11.3L441 408.6a8.03 8.03 0 00-11.3 0L363 475.3l-43-43a7.85 7.85 0 00-5.7-2.3c-2 0-4.1.8-5.7 2.3L206.8 534.2c-68.9 69-77 175.7-24.3 253.5l-76.1 76.1a8.03 8.03 0 000 11.3l42.4 42.4c1.6 1.6 3.6 2.3 5.7 2.3s4.1-.8 5.7-2.3l76.1-76.1c33.7 22.9 72.9 34.3 112.1 34.3 51.2 0 102.4-19.5 141.5-58.6l101.9-101.9c3.1-3.1 3.1-8.2 0-11.3l-43-43 66.7-66.7c3.1-3.1 3.1-8.2 0-11.3l-36.6-36.2zM441.7 769.1a131.32 131.32 0 01-93.4 38.7c-35.3 0-68.4-13.7-93.4-38.7a131.32 131.32 0 01-38.7-93.4c0-35.3 13.7-68.4 38.7-93.4l59.4-59.4 186.8 186.8-59.4 59.4z"}}]},name:"api",theme:"outlined"},r0=function(r,u){return b.createElement(On,qe({},r,{ref:u,icon:n0}))},i0=b.forwardRef(r0),s0={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M304 280h56c4.4 0 8-3.6 8-8 0-28.3 5.9-53.2 17.1-73.5 10.6-19.4 26-34.8 45.4-45.4C450.9 142 475.7 136 504 136h16c28.3 0 53.2 5.9 73.5 17.1 19.4 10.6 34.8 26 45.4 45.4C650 218.9 656 243.7 656 272c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8 0-40-8.8-76.7-25.9-108.1a184.31 184.31 0 00-74-74C596.7 72.8 560 64 520 64h-16c-40 0-76.7 8.8-108.1 25.9a184.31 184.31 0 00-74 74C304.8 195.3 296 232 296 272c0 4.4 3.6 8 8 8z"}},{tag:"path",attrs:{d:"M940 512H792V412c76.8 0 139-62.2 139-139 0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8a63 63 0 01-63 63H232a63 63 0 01-63-63c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8 0 76.8 62.2 139 139 139v100H84c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h148v96c0 6.5.2 13 .7 19.3C164.1 728.6 116 796.7 116 876c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8 0-44.2 23.9-82.9 59.6-103.7a273 273 0 0022.7 49c24.3 41.5 59 76.2 100.5 100.5S460.5 960 512 960s99.8-13.9 141.3-38.2a281.38 281.38 0 00123.2-149.5A120 120 0 01836 876c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8 0-79.3-48.1-147.4-116.7-176.7.4-6.4.7-12.8.7-19.3v-96h148c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM716 680c0 36.8-9.7 72-27.8 102.9-17.7 30.3-43 55.6-73.3 73.3C584 874.3 548.8 884 512 884s-72-9.7-102.9-27.8c-30.3-17.7-55.6-43-73.3-73.3A202.75 202.75 0 01308 680V412h408v268z"}}]},name:"bug",theme:"outlined"},a0=function(r,u){return b.createElement(On,qe({},r,{ref:u,icon:s0}))},o0=b.forwardRef(a0),u0={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"},l0=function(r,u){return b.createElement(On,qe({},r,{ref:u,icon:u0}))},c0=b.forwardRef(l0),h0={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M516 673c0 4.4 3.4 8 7.5 8h185c4.1 0 7.5-3.6 7.5-8v-48c0-4.4-3.4-8-7.5-8h-185c-4.1 0-7.5 3.6-7.5 8v48zm-194.9 6.1l192-161c3.8-3.2 3.8-9.1 0-12.3l-192-160.9A7.95 7.95 0 00308 351v62.7c0 2.4 1 4.6 2.9 6.1L420.7 512l-109.8 92.2a8.1 8.1 0 00-2.9 6.1V673c0 6.8 7.9 10.5 13.1 6.1zM880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"code",theme:"outlined"},d0=function(r,u){return b.createElement(On,qe({},r,{ref:u,icon:h0}))},p0=b.forwardRef(d0),f0={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2L263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"}}]},name:"copy",theme:"outlined"},m0=function(r,u){return b.createElement(On,qe({},r,{ref:u,icon:f0}))},g0=b.forwardRef(m0),y0={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888.3 693.2c-42.5-24.6-94.3-18-129.2 12.8l-53-30.7V523.6c0-15.7-8.4-30.3-22-38.1l-136-78.3v-67.1c44.2-15 76-56.8 76-106.1 0-61.9-50.1-112-112-112s-112 50.1-112 112c0 49.3 31.8 91.1 76 106.1v67.1l-136 78.3c-13.6 7.8-22 22.4-22 38.1v151.6l-53 30.7c-34.9-30.8-86.8-37.4-129.2-12.8-53.5 31-71.7 99.4-41 152.9 30.8 53.5 98.9 71.9 152.2 41 42.5-24.6 62.7-73 53.6-118.8l48.7-28.3 140.6 81c6.8 3.9 14.4 5.9 22 5.9s15.2-2 22-5.9L674.5 740l48.7 28.3c-9.1 45.7 11.2 94.2 53.6 118.8 53.3 30.9 121.5 12.6 152.2-41 30.8-53.6 12.6-122-40.7-152.9zm-673 138.4a47.6 47.6 0 01-65.2-17.6c-13.2-22.9-5.4-52.3 17.5-65.5a47.6 47.6 0 0165.2 17.6c13.2 22.9 5.4 52.3-17.5 65.5zM522 463.8zM464 234a48.01 48.01 0 0196 0 48.01 48.01 0 01-96 0zm170 446.2l-122 70.3-122-70.3V539.8l122-70.3 122 70.3v140.4zm239.9 133.9c-13.2 22.9-42.4 30.8-65.2 17.6-22.8-13.2-30.7-42.6-17.5-65.5s42.4-30.8 65.2-17.6c22.9 13.2 30.7 42.5 17.5 65.5z"}}]},name:"deployment-unit",theme:"outlined"},x0=function(r,u){return b.createElement(On,qe({},r,{ref:u,icon:y0}))},b0=b.forwardRef(x0),v0={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"},w0=function(r,u){return b.createElement(On,qe({},r,{ref:u,icon:v0}))},S0=b.forwardRef(w0),T0={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 170h-60c-4.4 0-8 3.6-8 8v518H310v-73c0-6.7-7.8-10.5-13-6.3l-141.9 112a8 8 0 000 12.6l141.9 112c5.3 4.2 13 .4 13-6.3v-75h498c35.3 0 64-28.7 64-64V178c0-4.4-3.6-8-8-8z"}}]},name:"enter",theme:"outlined"},E0=function(r,u){return b.createElement(On,qe({},r,{ref:u,icon:T0}))},C0=b.forwardRef(E0),$0={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 472a40 40 0 1080 0 40 40 0 10-80 0zm367 352.9L696.3 352V178H768v-68H256v68h71.7v174L145 824.9c-2.8 7.4-4.3 15.2-4.3 23.1 0 35.3 28.7 64 64 64h614.6c7.9 0 15.7-1.5 23.1-4.3 33-12.7 49.4-49.8 36.6-82.8zM395.7 364.7V180h232.6v184.7L719.2 600c-20.7-5.3-42.1-8-63.9-8-61.2 0-119.2 21.5-165.3 60a188.78 188.78 0 01-121.3 43.9c-32.7 0-64.1-8.3-91.8-23.7l118.8-307.5zM210.5 844l41.7-107.8c35.7 18.1 75.4 27.8 116.6 27.8 61.2 0 119.2-21.5 165.3-60 33.9-28.2 76.3-43.9 121.3-43.9 35 0 68.4 9.5 97.6 27.1L813.5 844h-603z"}}]},name:"experiment",theme:"outlined"},_0=function(r,u){return b.createElement(On,qe({},r,{ref:u,icon:$0}))},I0=b.forwardRef(_0),L0={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M640.6 429.8h257.1c7.9 0 14.3-6.4 14.3-14.3V158.3c0-7.9-6.4-14.3-14.3-14.3H640.6c-7.9 0-14.3 6.4-14.3 14.3v92.9H490.6c-3.9 0-7.1 3.2-7.1 7.1v221.5h-85.7v-96.5c0-7.9-6.4-14.3-14.3-14.3H126.3c-7.9 0-14.3 6.4-14.3 14.3v257.2c0 7.9 6.4 14.3 14.3 14.3h257.1c7.9 0 14.3-6.4 14.3-14.3V544h85.7v221.5c0 3.9 3.2 7.1 7.1 7.1h135.7v92.9c0 7.9 6.4 14.3 14.3 14.3h257.1c7.9 0 14.3-6.4 14.3-14.3v-257c0-7.9-6.4-14.3-14.3-14.3h-257c-7.9 0-14.3 6.4-14.3 14.3v100h-78.6v-393h78.6v100c0 7.9 6.4 14.3 14.3 14.3zm53.5-217.9h150V362h-150V211.9zM329.9 587h-150V437h150v150zm364.2 75.1h150v150.1h-150V662.1z"}}]},name:"partition",theme:"outlined"},O0=function(r,u){return b.createElement(On,qe({},r,{ref:u,icon:L0}))},A0=b.forwardRef(O0),R0={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"},k0=function(r,u){return b.createElement(On,qe({},r,{ref:u,icon:R0}))},D0=b.forwardRef(k0),M0={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M300 328a60 60 0 10120 0 60 60 0 10-120 0zM852 64H172c-17.7 0-32 14.3-32 32v660c0 17.7 14.3 32 32 32h680c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-32 660H204V128h616v596zM604 328a60 60 0 10120 0 60 60 0 10-120 0zm250.2 556H169.8c-16.5 0-29.8 14.3-29.8 32v36c0 4.4 3.3 8 7.4 8h729.1c4.1 0 7.4-3.6 7.4-8v-36c.1-17.7-13.2-32-29.7-32zM664 508H360c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"robot",theme:"outlined"},P0=function(r,u){return b.createElement(On,qe({},r,{ref:u,icon:M0}))},pc=b.forwardRef(P0),z0={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 736c0-111.6-65.4-208-160-252.9V317.3c0-15.1-5.3-29.7-15.1-41.2L536.5 95.4C530.1 87.8 521 84 512 84s-18.1 3.8-24.5 11.4L335.1 276.1a63.97 63.97 0 00-15.1 41.2v165.8C225.4 528 160 624.4 160 736h156.5c-2.3 7.2-3.5 15-3.5 23.8 0 22.1 7.6 43.7 21.4 60.8a97.2 97.2 0 0043.1 30.6c23.1 54 75.6 88.8 134.5 88.8 29.1 0 57.3-8.6 81.4-24.8 23.6-15.8 41.9-37.9 53-64a97 97 0 0043.1-30.5 97.52 97.52 0 0021.4-60.8c0-8.4-1.1-16.4-3.1-23.8H864zM762.3 621.4c9.4 14.6 17 30.3 22.5 46.6H700V558.7a211.6 211.6 0 0162.3 62.7zM388 483.1V318.8l124-147 124 147V668H388V483.1zM239.2 668c5.5-16.3 13.1-32 22.5-46.6 16.3-25.2 37.5-46.5 62.3-62.7V668h-84.8zm388.9 116.2c-5.2 3-11.2 4.2-17.1 3.4l-19.5-2.4-2.8 19.4c-5.4 37.9-38.4 66.5-76.7 66.5-38.3 0-71.3-28.6-76.7-66.5l-2.8-19.5-19.5 2.5a27.7 27.7 0 01-17.1-3.5c-8.7-5-14.1-14.3-14.1-24.4 0-10.6 5.9-19.4 14.6-23.8h231.3c8.8 4.5 14.6 13.3 14.6 23.8-.1 10.2-5.5 19.6-14.2 24.5zM464 400a48 48 0 1096 0 48 48 0 10-96 0z"}}]},name:"rocket",theme:"outlined"},N0=function(r,u){return b.createElement(On,qe({},r,{ref:u,icon:z0}))},F0=b.forwardRef(N0),V0={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"},j0=function(r,u){return b.createElement(On,qe({},r,{ref:u,icon:V0}))},fc=b.forwardRef(j0);const K0=e=>{const{paddingXXS:r,lineWidth:u,tagPaddingHorizontal:c,componentCls:f,calc:E}=e,C=E(c).sub(u).equal(),A=E(r).sub(u).equal();return{[f]:Object.assign(Object.assign({},Ir(e)),{display:"inline-block",height:"auto",marginInlineEnd:e.marginXS,paddingInline:C,fontSize:e.tagFontSize,lineHeight:e.tagLineHeight,whiteSpace:"nowrap",background:e.defaultBg,border:`${$e(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderRadius:e.borderRadiusSM,opacity:1,transition:`all ${e.motionDurationMid}`,textAlign:"start",position:"relative",[`&${f}-rtl`]:{direction:"rtl"},"&, a, a:hover":{color:e.defaultColor},[`${f}-close-icon`]:{marginInlineStart:A,fontSize:e.tagIconSize,color:e.colorIcon,cursor:"pointer",transition:`all ${e.motionDurationMid}`,"&:hover":{color:e.colorTextHeading}},[`&${f}-has-color`]:{borderColor:"transparent",[`&, a, a:hover, ${e.iconCls}-close, ${e.iconCls}-close:hover`]:{color:e.colorTextLightSolid}},"&-checkable":{backgroundColor:"transparent",borderColor:"transparent",cursor:"pointer",[`&:not(${f}-checkable-checked):hover`]:{color:e.colorPrimary,backgroundColor:e.colorFillSecondary},"&:active, &-checked":{color:e.colorTextLightSolid},"&-checked":{backgroundColor:e.colorPrimary,"&:hover":{backgroundColor:e.colorPrimaryHover}},"&:active":{backgroundColor:e.colorPrimaryActive}},"&-hidden":{display:"none"},[`> ${e.iconCls} + span, > span + ${e.iconCls}`]:{marginInlineStart:C}}),[`${f}-borderless`]:{borderColor:"transparent",background:e.tagBorderlessBg}}},Va=e=>{const{lineWidth:r,fontSizeIcon:u,calc:c}=e,f=e.fontSizeSM;return ir(e,{tagFontSize:f,tagLineHeight:$e(c(e.lineHeightSM).mul(f).equal()),tagIconSize:c(u).sub(c(r).mul(2)).equal(),tagPaddingHorizontal:8,tagBorderlessBg:e.defaultBg})},ja=e=>({defaultBg:new fl(e.colorFillQuaternary).onBackground(e.colorBgContainer).toHexString(),defaultColor:e.colorText}),mc=Sr("Tag",e=>{const r=Va(e);return K0(r)},ja);var B0=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};const G0=b.forwardRef((e,r)=>{const{prefixCls:u,style:c,className:f,checked:E,onChange:C,onClick:A}=e,R=B0(e,["prefixCls","style","className","checked","onChange","onClick"]),{getPrefixCls:M,tag:F}=b.useContext(fr),j=G=>{C==null||C(!E),A==null||A(G)},B=M("tag",u),[H,q,W]=mc(B),J=Oe(B,`${B}-checkable`,{[`${B}-checkable-checked`]:E},F==null?void 0:F.className,f,q,W);return H(b.createElement("span",Object.assign({},R,{ref:r,style:Object.assign(Object.assign({},c),F==null?void 0:F.style),className:J,onClick:j})))}),U0=e=>Tl(e,(r,{textColor:u,lightBorderColor:c,lightColor:f,darkColor:E})=>({[`${e.componentCls}${e.componentCls}-${r}`]:{color:u,background:f,borderColor:c,"&-inverse":{color:e.colorTextLightSolid,background:E,borderColor:E},[`&${e.componentCls}-borderless`]:{borderColor:"transparent"}}})),W0=ml(["Tag","preset"],e=>{const r=Va(e);return U0(r)},ja);function H0(e){return typeof e!="string"?e:e.charAt(0).toUpperCase()+e.slice(1)}const fs=(e,r,u)=>{const c=H0(u);return{[`${e.componentCls}${e.componentCls}-${r}`]:{color:e[`color${u}`],background:e[`color${c}Bg`],borderColor:e[`color${c}Border`],[`&${e.componentCls}-borderless`]:{borderColor:"transparent"}}}},X0=ml(["Tag","status"],e=>{const r=Va(e);return[fs(r,"success","Success"),fs(r,"processing","Info"),fs(r,"error","Error"),fs(r,"warning","Warning")]},ja);var Y0=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};const J0=b.forwardRef((e,r)=>{const{prefixCls:u,className:c,rootClassName:f,style:E,children:C,icon:A,color:R,onClose:M,bordered:F=!0,visible:j}=e,B=Y0(e,["prefixCls","className","rootClassName","style","children","icon","color","onClose","bordered","visible"]),{getPrefixCls:H,direction:q,tag:W}=b.useContext(fr),[J,G]=b.useState(!0),Y=Xr(B,["closeIcon","closable"]);b.useEffect(()=>{j!==void 0&&G(j)},[j]);const Z=Pl(R),X=mf(R),ne=Z||X,Q=Object.assign(Object.assign({backgroundColor:R&&!ne?R:void 0},W==null?void 0:W.style),E),te=H("tag",u),[se,le,ie]=mc(te),pe=Oe(te,W==null?void 0:W.className,{[`${te}-${R}`]:ne,[`${te}-has-color`]:R&&!ne,[`${te}-hidden`]:!J,[`${te}-rtl`]:q==="rtl",[`${te}-borderless`]:!F},c,f,le,ie),ve=oe=>{oe.stopPropagation(),M==null||M(oe),!oe.defaultPrevented&&G(!1)},[,de]=Ld(Xo(e),Xo(W),{closable:!1,closeIconRender:oe=>{const ae=b.createElement("span",{className:`${te}-close-icon`,onClick:ve},oe);return Od(oe,ae,be=>({onClick:Le=>{var Ie;(Ie=be==null?void 0:be.onClick)===null||Ie===void 0||Ie.call(be,Le),ve(Le)},className:Oe(be==null?void 0:be.className,`${te}-close-icon`)}))}}),me=typeof B.onClick=="function"||C&&C.type==="a",Ee=A||null,ye=Ee?b.createElement(b.Fragment,null,Ee,C&&b.createElement("span",null,C)):C,Ce=b.createElement("span",Object.assign({},Y,{ref:r,className:pe,style:Q}),ye,de,Z&&b.createElement(W0,{key:"preset",prefixCls:te}),X&&b.createElement(X0,{key:"status",prefixCls:te}));return se(me?b.createElement(Ad,{component:"Tag"},Ce):Ce)}),zi=J0;zi.CheckableTag=G0;const q0=(e,r,u,c)=>{const{titleMarginBottom:f,fontWeightStrong:E}=c;return{marginBottom:f,color:u,fontWeight:E,fontSize:e,lineHeight:r}},Z0=e=>{const r=[1,2,3,4,5],u={};return r.forEach(c=>{u[`
      h${c}&,
      div&-h${c},
      div&-h${c} > textarea,
      h${c}
    `]=q0(e[`fontSizeHeading${c}`],e[`lineHeightHeading${c}`],e.colorTextHeading,e)}),u},Q0=e=>{const{componentCls:r}=e;return{"a&, a":Object.assign(Object.assign({},gl(e)),{userSelect:"text",[`&[disabled], &${r}-disabled`]:{color:e.colorTextDisabled,cursor:"not-allowed","&:active, &:hover":{color:e.colorTextDisabled},"&:active":{pointerEvents:"none"}}})}},ex=e=>({code:{margin:"0 0.2em",paddingInline:"0.4em",paddingBlock:"0.2em 0.1em",fontSize:"85%",fontFamily:e.fontFamilyCode,background:"rgba(150, 150, 150, 0.1)",border:"1px solid rgba(100, 100, 100, 0.2)",borderRadius:3},kbd:{margin:"0 0.2em",paddingInline:"0.4em",paddingBlock:"0.15em 0.1em",fontSize:"90%",fontFamily:e.fontFamilyCode,background:"rgba(150, 150, 150, 0.06)",border:"1px solid rgba(100, 100, 100, 0.2)",borderBottomWidth:2,borderRadius:3},mark:{padding:0,backgroundColor:Rd[2]},"u, ins":{textDecoration:"underline",textDecorationSkipInk:"auto"},"s, del":{textDecoration:"line-through"},strong:{fontWeight:e.fontWeightStrong},"ul, ol":{marginInline:0,marginBlock:"0 1em",padding:0,li:{marginInline:"20px 0",marginBlock:0,paddingInline:"4px 0",paddingBlock:0}},ul:{listStyleType:"circle",ul:{listStyleType:"disc"}},ol:{listStyleType:"decimal"},"pre, blockquote":{margin:"1em 0"},pre:{padding:"0.4em 0.6em",whiteSpace:"pre-wrap",wordWrap:"break-word",background:"rgba(150, 150, 150, 0.1)",border:"1px solid rgba(100, 100, 100, 0.2)",borderRadius:3,fontFamily:e.fontFamilyCode,code:{display:"inline",margin:0,padding:0,fontSize:"inherit",fontFamily:"inherit",background:"transparent",border:0}},blockquote:{paddingInline:"0.6em 0",paddingBlock:0,borderInlineStart:"4px solid rgba(100, 100, 100, 0.2)",opacity:.85}}),tx=e=>{const{componentCls:r,paddingSM:u}=e,c=u;return{"&-edit-content":{position:"relative","div&":{insetInlineStart:e.calc(e.paddingSM).mul(-1).equal(),marginTop:e.calc(c).mul(-1).equal(),marginBottom:`calc(1em - ${$e(c)})`},[`${r}-edit-content-confirm`]:{position:"absolute",insetInlineEnd:e.calc(e.marginXS).add(2).equal(),insetBlockEnd:e.marginXS,color:e.colorIcon,fontWeight:"normal",fontSize:e.fontSize,fontStyle:"normal",pointerEvents:"none"},textarea:{margin:"0!important",MozTransition:"none",height:"1em"}}}},nx=e=>({[`${e.componentCls}-copy-success`]:{"\n    &,\n    &:hover,\n    &:focus":{color:e.colorSuccess}},[`${e.componentCls}-copy-icon-only`]:{marginInlineStart:0}}),rx=()=>({"\n  a&-ellipsis,\n  span&-ellipsis\n  ":{display:"inline-block",maxWidth:"100%"},"&-ellipsis-single-line":{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis","a&, span&":{verticalAlign:"bottom"},"> code":{paddingBlock:0,maxWidth:"calc(100% - 1.2em)",display:"inline-block",overflow:"hidden",textOverflow:"ellipsis",verticalAlign:"bottom",boxSizing:"content-box"}},"&-ellipsis-multiple-line":{display:"-webkit-box",overflow:"hidden",WebkitLineClamp:3,WebkitBoxOrient:"vertical"}}),ix=e=>{const{componentCls:r,titleMarginTop:u}=e;return{[r]:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({color:e.colorText,wordBreak:"break-word",lineHeight:e.lineHeight,[`&${r}-secondary`]:{color:e.colorTextDescription},[`&${r}-success`]:{color:e.colorSuccessText},[`&${r}-warning`]:{color:e.colorWarningText},[`&${r}-danger`]:{color:e.colorErrorText,"a&:active, a&:focus":{color:e.colorErrorTextActive},"a&:hover":{color:e.colorErrorTextHover}},[`&${r}-disabled`]:{color:e.colorTextDisabled,cursor:"not-allowed",userSelect:"none"},"\n        div&,\n        p\n      ":{marginBottom:"1em"}},Z0(e)),{[`
      & + h1${r},
      & + h2${r},
      & + h3${r},
      & + h4${r},
      & + h5${r}
      `]:{marginTop:u},"\n      div,\n      ul,\n      li,\n      p,\n      h1,\n      h2,\n      h3,\n      h4,\n      h5":{"\n        + h1,\n        + h2,\n        + h3,\n        + h4,\n        + h5\n        ":{marginTop:u}}}),ex(e)),Q0(e)),{[`
        ${r}-expand,
        ${r}-collapse,
        ${r}-edit,
        ${r}-copy
      `]:Object.assign(Object.assign({},gl(e)),{marginInlineStart:e.marginXXS})}),tx(e)),nx(e)),rx()),{"&-rtl":{direction:"rtl"}})}},sx=()=>({titleMarginTop:"1.2em",titleMarginBottom:"0.5em"}),gc=Sr("Typography",e=>[ix(e)],sx),ax=e=>{const{prefixCls:r,"aria-label":u,className:c,style:f,direction:E,maxLength:C,autoSize:A=!0,value:R,onSave:M,onCancel:F,onEnd:j,component:B,enterIcon:H=b.createElement(C0,null)}=e,q=b.useRef(null),W=b.useRef(!1),J=b.useRef(null),[G,Y]=b.useState(R);b.useEffect(()=>{Y(R)},[R]),b.useEffect(()=>{var me;if(!((me=q.current)===null||me===void 0)&&me.resizableTextArea){const{textArea:Ee}=q.current.resizableTextArea;Ee.focus();const{length:ye}=Ee.value;Ee.setSelectionRange(ye,ye)}},[]);const Z=({target:me})=>{Y(me.value.replace(/[\n\r]/g,""))},X=()=>{W.current=!0},ne=()=>{W.current=!1},Q=({keyCode:me})=>{W.current||(J.current=me)},te=()=>{M(G.trim())},se=({keyCode:me,ctrlKey:Ee,altKey:ye,metaKey:Ce,shiftKey:oe})=>{J.current!==me||W.current||Ee||ye||Ce||oe||(me===vn.ENTER?(te(),j==null||j()):me===vn.ESC&&F())},le=()=>{te()},[ie,pe,ve]=gc(r),de=Oe(r,`${r}-edit-content`,{[`${r}-rtl`]:E==="rtl",[`${r}-${B}`]:!!B},c,pe,ve);return ie(b.createElement("div",{className:de,style:f},b.createElement(_y,{ref:q,maxLength:C,value:G,onChange:Z,onKeyDown:Q,onKeyUp:se,onCompositionStart:X,onCompositionEnd:ne,onBlur:le,"aria-label":u,rows:1,autoSize:A}),H!==null?ol(H,{className:`${r}-edit-content-confirm`}):null))};var sa,ju;function ox(){return ju||(ju=1,sa=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var r=document.activeElement,u=[],c=0;c<e.rangeCount;c++)u.push(e.getRangeAt(c));switch(r.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":r.blur();break;default:r=null;break}return e.removeAllRanges(),function(){e.type==="Caret"&&e.removeAllRanges(),e.rangeCount||u.forEach(function(f){e.addRange(f)}),r&&r.focus()}}),sa}var aa,Ku;function ux(){if(Ku)return aa;Ku=1;var e=ox(),r={"text/plain":"Text","text/html":"Url",default:"Text"},u="Copy to clipboard: #{key}, Enter";function c(E){var C=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return E.replace(/#{\s*key\s*}/g,C)}function f(E,C){var A,R,M,F,j,B,H=!1;C||(C={}),A=C.debug||!1;try{M=e(),F=document.createRange(),j=document.getSelection(),B=document.createElement("span"),B.textContent=E,B.ariaHidden="true",B.style.all="unset",B.style.position="fixed",B.style.top=0,B.style.clip="rect(0, 0, 0, 0)",B.style.whiteSpace="pre",B.style.webkitUserSelect="text",B.style.MozUserSelect="text",B.style.msUserSelect="text",B.style.userSelect="text",B.addEventListener("copy",function(W){if(W.stopPropagation(),C.format)if(W.preventDefault(),typeof W.clipboardData>"u"){A&&console.warn("unable to use e.clipboardData"),A&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var J=r[C.format]||r.default;window.clipboardData.setData(J,E)}else W.clipboardData.clearData(),W.clipboardData.setData(C.format,E);C.onCopy&&(W.preventDefault(),C.onCopy(W.clipboardData))}),document.body.appendChild(B),F.selectNodeContents(B),j.addRange(F);var q=document.execCommand("copy");if(!q)throw new Error("copy command was unsuccessful");H=!0}catch(W){A&&console.error("unable to copy using execCommand: ",W),A&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(C.format||"text",E),C.onCopy&&C.onCopy(window.clipboardData),H=!0}catch(J){A&&console.error("unable to copy using clipboardData: ",J),A&&console.error("falling back to prompt"),R=c("message"in C?C.message:u),window.prompt(R,E)}}finally{j&&(typeof j.removeRange=="function"?j.removeRange(F):j.removeAllRanges()),B&&document.body.removeChild(B),M()}return H}return aa=f,aa}var lx=ux();const cx=kd(lx);var hx=function(e,r,u,c){function f(E){return E instanceof u?E:new u(function(C){C(E)})}return new(u||(u=Promise))(function(E,C){function A(F){try{M(c.next(F))}catch(j){C(j)}}function R(F){try{M(c.throw(F))}catch(j){C(j)}}function M(F){F.done?E(F.value):f(F.value).then(A,R)}M((c=c.apply(e,r||[])).next())})};const dx=({copyConfig:e,children:r})=>{const[u,c]=b.useState(!1),[f,E]=b.useState(!1),C=b.useRef(null),A=()=>{C.current&&clearTimeout(C.current)},R={};e.format&&(R.format=e.format),b.useEffect(()=>A,[]);const M=pr(F=>hx(void 0,void 0,void 0,function*(){var j;F==null||F.preventDefault(),F==null||F.stopPropagation(),E(!0);try{const B=typeof e.text=="function"?yield e.text():e.text;cx(B||Iy(r,!0).join("")||"",R),E(!1),c(!0),A(),C.current=setTimeout(()=>{c(!1)},3e3),(j=e.onCopy)===null||j===void 0||j.call(e,F)}catch(B){throw E(!1),B}}));return{copied:u,copyLoading:f,onClick:M}};function oa(e,r){return b.useMemo(()=>{const u=!!e;return[u,Object.assign(Object.assign({},r),u&&typeof e=="object"?e:null)]},[e])}const px=e=>{const r=b.useRef(void 0);return b.useEffect(()=>{r.current=e}),r.current},fx=(e,r,u)=>b.useMemo(()=>e===!0?{title:r??u}:b.isValidElement(e)?{title:e}:typeof e=="object"?Object.assign({title:r??u},e):{title:e},[e,r,u]);var mx=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};const yc=b.forwardRef((e,r)=>{const{prefixCls:u,component:c="article",className:f,rootClassName:E,setContentRef:C,children:A,direction:R,style:M}=e,F=mx(e,["prefixCls","component","className","rootClassName","setContentRef","children","direction","style"]),{getPrefixCls:j,direction:B,className:H,style:q}=wi("typography"),W=R??B,J=C?Bi(r,C):r,G=j("typography",u),[Y,Z,X]=gc(G),ne=Oe(G,H,{[`${G}-rtl`]:W==="rtl"},f,E,Z,X),Q=Object.assign(Object.assign({},q),M);return Y(b.createElement(c,Object.assign({className:ne,style:Q,ref:J},F),A))});function Bu(e){return e===!1?[!1,!1]:Array.isArray(e)?e:[e]}function ua(e,r,u){return e===!0||e===void 0?r:e||u&&r}function gx(e){const r=document.createElement("em");e.appendChild(r);const u=e.getBoundingClientRect(),c=r.getBoundingClientRect();return e.removeChild(r),u.left>c.left||c.right>u.right||u.top>c.top||c.bottom>u.bottom}const Ka=e=>["string","number"].includes(typeof e),yx=({prefixCls:e,copied:r,locale:u,iconOnly:c,tooltips:f,icon:E,tabIndex:C,onCopy:A,loading:R})=>{const M=Bu(f),F=Bu(E),{copied:j,copy:B}=u??{},H=r?j:B,q=ua(M[r?1:0],H),W=typeof q=="string"?q:H;return b.createElement(Hi,{title:q},b.createElement("button",{type:"button",className:Oe(`${e}-copy`,{[`${e}-copy-success`]:r,[`${e}-copy-icon-only`]:c}),onClick:A,"aria-label":W,tabIndex:C},r?ua(F[1],b.createElement(Ll,null),!0):ua(F[0],R?b.createElement(Dd,null):b.createElement(g0,null),!0)))},ms=b.forwardRef(({style:e,children:r},u)=>{const c=b.useRef(null);return b.useImperativeHandle(u,()=>({isExceed:()=>{const f=c.current;return f.scrollHeight>f.clientHeight},getHeight:()=>c.current.clientHeight})),b.createElement("span",{"aria-hidden":!0,ref:c,style:Object.assign({position:"fixed",display:"block",left:0,top:0,pointerEvents:"none",backgroundColor:"rgba(255, 0, 0, 0.65)"},e)},r)}),xx=e=>e.reduce((r,u)=>r+(Ka(u)?String(u).length:1),0);function Gu(e,r){let u=0;const c=[];for(let f=0;f<e.length;f+=1){if(u===r)return c;const E=e[f],A=Ka(E)?String(E).length:1,R=u+A;if(R>r){const M=r-u;return c.push(String(E).slice(0,M)),c}c.push(E),u=R}return e}const la=0,ca=1,ha=2,da=3,Uu=4,gs={display:"-webkit-box",overflow:"hidden",WebkitBoxOrient:"vertical"};function bx(e){const{enableMeasure:r,width:u,text:c,children:f,rows:E,expanded:C,miscDeps:A,onEllipsis:R}=e,M=b.useMemo(()=>ri(c),[c]),F=b.useMemo(()=>xx(M),[c]),j=b.useMemo(()=>f(M,!1),[c]),[B,H]=b.useState(null),q=b.useRef(null),W=b.useRef(null),J=b.useRef(null),G=b.useRef(null),Y=b.useRef(null),[Z,X]=b.useState(!1),[ne,Q]=b.useState(la),[te,se]=b.useState(0),[le,ie]=b.useState(null);Cn(()=>{Q(r&&u&&F?ca:la)},[u,c,E,r,M]),Cn(()=>{var me,Ee,ye,Ce;if(ne===ca){Q(ha);const oe=W.current&&getComputedStyle(W.current).whiteSpace;ie(oe)}else if(ne===ha){const oe=!!(!((me=J.current)===null||me===void 0)&&me.isExceed());Q(oe?da:Uu),H(oe?[0,F]:null),X(oe);const ae=((Ee=J.current)===null||Ee===void 0?void 0:Ee.getHeight())||0,be=E===1?0:((ye=G.current)===null||ye===void 0?void 0:ye.getHeight())||0,Le=((Ce=Y.current)===null||Ce===void 0?void 0:Ce.getHeight())||0,Ie=Math.max(ae,be+Le);se(Ie+1),R(oe)}},[ne]);const pe=B?Math.ceil((B[0]+B[1])/2):0;Cn(()=>{var me;const[Ee,ye]=B||[0,0];if(Ee!==ye){const oe=(((me=q.current)===null||me===void 0?void 0:me.getHeight())||0)>te;let ae=pe;ye-Ee===1&&(ae=oe?Ee:ye),H(oe?[Ee,ae]:[ae,ye])}},[B,pe]);const ve=b.useMemo(()=>{if(!r)return f(M,!1);if(ne!==da||!B||B[0]!==B[1]){const me=f(M,!1);return[Uu,la].includes(ne)?me:b.createElement("span",{style:Object.assign(Object.assign({},gs),{WebkitLineClamp:E})},me)}return f(C?M:Gu(M,B[0]),Z)},[C,ne,B,M].concat(Kn(A))),de={width:u,margin:0,padding:0,whiteSpace:le==="nowrap"?"normal":"inherit"};return b.createElement(b.Fragment,null,ve,ne===ha&&b.createElement(b.Fragment,null,b.createElement(ms,{style:Object.assign(Object.assign(Object.assign({},de),gs),{WebkitLineClamp:E}),ref:J},j),b.createElement(ms,{style:Object.assign(Object.assign(Object.assign({},de),gs),{WebkitLineClamp:E-1}),ref:G},j),b.createElement(ms,{style:Object.assign(Object.assign(Object.assign({},de),gs),{WebkitLineClamp:1}),ref:Y},f([],!0))),ne===da&&B&&B[0]!==B[1]&&b.createElement(ms,{style:Object.assign(Object.assign({},de),{top:400}),ref:q},f(Gu(M,pe),!0)),ne===ca&&b.createElement("span",{style:{whiteSpace:"inherit"},ref:W}))}const vx=({enableEllipsis:e,isEllipsis:r,children:u,tooltipProps:c})=>!(c!=null&&c.title)||!e?u:b.createElement(Hi,Object.assign({open:r?void 0:!1},c),u);var wx=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};function Sx({mark:e,code:r,underline:u,delete:c,strong:f,keyboard:E,italic:C},A){let R=A;function M(F,j){j&&(R=b.createElement(F,{},R))}return M("strong",f),M("u",u),M("del",c),M("code",r),M("mark",e),M("kbd",E),M("i",C),R}const Tx="...",Wu=["delete","mark","code","underline","strong","keyboard","italic"],Ns=b.forwardRef((e,r)=>{var u;const{prefixCls:c,className:f,style:E,type:C,disabled:A,children:R,ellipsis:M,editable:F,copyable:j,component:B,title:H}=e,q=wx(e,["prefixCls","className","style","type","disabled","children","ellipsis","editable","copyable","component","title"]),{getPrefixCls:W,direction:J}=b.useContext(fr),[G]=Md("Text"),Y=b.useRef(null),Z=b.useRef(null),X=W("typography",c),ne=Xr(q,Wu),[Q,te]=oa(F),[se,le]=vr(!1,{value:te.editing}),{triggerType:ie=["icon"]}=te,pe=Ne=>{var He;Ne&&((He=te.onStart)===null||He===void 0||He.call(te)),le(Ne)},ve=px(se);Cn(()=>{var Ne;!se&&ve&&((Ne=Z.current)===null||Ne===void 0||Ne.focus())},[se]);const de=Ne=>{Ne==null||Ne.preventDefault(),pe(!0)},me=Ne=>{var He;(He=te.onChange)===null||He===void 0||He.call(te,Ne),pe(!1)},Ee=()=>{var Ne;(Ne=te.onCancel)===null||Ne===void 0||Ne.call(te),pe(!1)},[ye,Ce]=oa(j),{copied:oe,copyLoading:ae,onClick:be}=dx({copyConfig:Ce,children:R}),[Le,Ie]=b.useState(!1),[Ae,Se]=b.useState(!1),[ke,Me]=b.useState(!1),[De,Ke]=b.useState(!1),[Ve,at]=b.useState(!0),[Ze,Qe]=oa(M,{expandable:!1,symbol:Ne=>Ne?G==null?void 0:G.collapse:G==null?void 0:G.expand}),[yt,ge]=vr(Qe.defaultExpanded||!1,{value:Qe.expanded}),Ge=Ze&&(!yt||Qe.expandable==="collapsible"),{rows:We=1}=Qe,we=b.useMemo(()=>Ge&&(Qe.suffix!==void 0||Qe.onEllipsis||Qe.expandable||Q||ye),[Ge,Qe,Q,ye]);Cn(()=>{Ze&&!we&&(Ie(Zo("webkitLineClamp")),Se(Zo("textOverflow")))},[we,Ze]);const[ot,et]=b.useState(Ge),Tt=b.useMemo(()=>we?!1:We===1?Ae:Le,[we,Ae,Le]);Cn(()=>{et(Tt&&Ge)},[Tt,Ge]);const ut=Ge&&(ot?De:ke),Ut=Ge&&We===1&&ot,Ft=Ge&&We>1&&ot,vt=(Ne,He)=>{var qt;ge(He.expanded),(qt=Qe.onExpand)===null||qt===void 0||qt.call(Qe,Ne,He)},[on,ht]=b.useState(0),pn=({offsetWidth:Ne})=>{ht(Ne)},Wt=Ne=>{var He;Me(Ne),ke!==Ne&&((He=Qe.onEllipsis)===null||He===void 0||He.call(Qe,Ne))};b.useEffect(()=>{const Ne=Y.current;if(Ze&&ot&&Ne){const He=gx(Ne);De!==He&&Ke(He)}},[Ze,ot,R,Ft,Ve,on]),b.useEffect(()=>{const Ne=Y.current;if(typeof IntersectionObserver>"u"||!Ne||!ot||!Ge)return;const He=new IntersectionObserver(()=>{at(!!Ne.offsetParent)});return He.observe(Ne),()=>{He.disconnect()}},[ot,Ge]);const wt=fx(Qe.tooltip,te.text,R),Kt=b.useMemo(()=>{if(!(!Ze||ot))return[te.text,R,H,wt.title].find(Ka)},[Ze,ot,H,wt.title,ut]);if(se)return b.createElement(ax,{value:(u=te.text)!==null&&u!==void 0?u:typeof R=="string"?R:"",onSave:me,onCancel:Ee,onEnd:te.onEnd,prefixCls:X,className:f,style:E,direction:J,component:B,maxLength:te.maxLength,autoSize:te.autoSize,enterIcon:te.enterIcon});const Et=()=>{const{expandable:Ne,symbol:He}=Qe;return Ne?b.createElement("button",{type:"button",key:"expand",className:`${X}-${yt?"collapse":"expand"}`,onClick:qt=>vt(qt,{expanded:!yt}),"aria-label":yt?G.collapse:G==null?void 0:G.expand},typeof He=="function"?He(yt):He):null},kt=()=>{if(!Q)return;const{icon:Ne,tooltip:He,tabIndex:qt}=te,Pn=ri(He)[0]||(G==null?void 0:G.edit),An=typeof Pn=="string"?Pn:"";return ie.includes("icon")?b.createElement(Hi,{key:"edit",title:He===!1?"":Pn},b.createElement("button",{type:"button",ref:Z,className:`${X}-edit`,onClick:de,"aria-label":An,tabIndex:qt},Ne||b.createElement(S0,{role:"button"}))):null},dt=()=>ye?b.createElement(yx,Object.assign({key:"copy"},Ce,{prefixCls:X,copied:oe,locale:G,onCopy:be,loading:ae,iconOnly:R==null})):null,Be=Ne=>[Ne&&Et(),kt(),dt()],Ct=Ne=>[Ne&&!yt&&b.createElement("span",{"aria-hidden":!0,key:"ellipsis"},Tx),Qe.suffix,Be(Ne)];return b.createElement(_r,{onResize:pn,disabled:!Ge},Ne=>b.createElement(vx,{tooltipProps:wt,enableEllipsis:Ge,isEllipsis:ut},b.createElement(yc,Object.assign({className:Oe({[`${X}-${C}`]:C,[`${X}-disabled`]:A,[`${X}-ellipsis`]:Ze,[`${X}-ellipsis-single-line`]:Ut,[`${X}-ellipsis-multiple-line`]:Ft},f),prefixCls:c,style:Object.assign(Object.assign({},E),{WebkitLineClamp:Ft?We:void 0}),component:B,ref:Bi(Ne,Y,r),direction:J,onClick:ie.includes("text")?de:void 0,"aria-label":Kt==null?void 0:Kt.toString(),title:H},ne),b.createElement(bx,{enableMeasure:Ge&&!ot,text:R,rows:We,width:on,onEllipsis:Wt,expanded:yt,miscDeps:[oe,yt,ae,Q,ye,G].concat(Kn(Wu.map(He=>e[He])))},(He,qt)=>Sx(e,b.createElement(b.Fragment,null,He.length>0&&qt&&!yt&&Kt?b.createElement("span",{key:"show-content","aria-hidden":!0},He):He,Ct(qt)))))))});var Ex=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};const Cx=b.forwardRef((e,r)=>{var{ellipsis:u,rel:c}=e,f=Ex(e,["ellipsis","rel"]);const E=Object.assign(Object.assign({},f),{rel:c===void 0&&f.target==="_blank"?"noopener noreferrer":c});return delete E.navigate,b.createElement(Ns,Object.assign({},E,{ref:r,ellipsis:!!u,component:"a"}))}),$x=b.forwardRef((e,r)=>b.createElement(Ns,Object.assign({ref:r},e,{component:"div"})));var _x=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};const Ix=(e,r)=>{var{ellipsis:u}=e,c=_x(e,["ellipsis"]);const f=b.useMemo(()=>u&&typeof u=="object"?Xr(u,["expandable","rows"]):u,[u]);return b.createElement(Ns,Object.assign({ref:r},c,{ellipsis:f,component:"span"}))},Lx=b.forwardRef(Ix);var Ox=function(e,r){var u={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&r.indexOf(c)<0&&(u[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)r.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(u[c[f]]=e[c[f]]);return u};const Ax=[1,2,3,4,5],Rx=b.forwardRef((e,r)=>{const{level:u=1}=e,c=Ox(e,["level"]),f=Ax.includes(u)?`h${u}`:"h1";return b.createElement(Ns,Object.assign({ref:r},c,{component:f}))}),Yr=yc;Yr.Text=Lx;Yr.Link=Cx;Yr.Title=Rx;Yr.Paragraph=$x;const{Title:kx,Text:Dx}=Yr,Mx=()=>xe.jsxs("header",{className:"text-center mb-8",children:[xe.jsxs(kx,{level:2,className:"!text-indigo-800 !mb-2 !text-3xl sm:!text-4xl flex items-center justify-center",children:[xe.jsx(pc,{className:"mr-2 text-2xl sm:text-3xl"}),"Tic Tac Toe AI"]}),xe.jsx(Dx,{type:"secondary",className:"text-base sm:text-lg",children:"بازی با هوش مصنوعی مبتنی بر یادگیری تقویتی"})]}),Px=({board:e,handlePlayerMove:r,isPlayerTurn:u,winner:c,isDraw:f,aiThinking:E,playerWins:C,aiWins:A,draws:R})=>xe.jsxs(xe.Fragment,{children:[xe.jsx("div",{className:"grid grid-cols-3 gap-3 sm:gap-4 max-w-[300px] sm:max-w-[350px] mx-auto mb-6",children:e.map((M,F)=>xe.jsx(Ur,{onClick:()=>r(F),disabled:!u||!!c||f||E||M!==null,className:`
              !aspect-square !w-full !min-h-[80px] sm:!min-h-[100px] !rounded-xl !text-4xl sm:!text-5xl !font-bold !flex !items-center !justify-center
              ${M==="X"?"!bg-green-100 !text-green-600 hover:!bg-green-200 active:!bg-green-300 !border-green-300":M==="O"?"!bg-red-100 !text-red-600 hover:!bg-red-200 active:!bg-red-300 !border-red-300":"!bg-indigo-50 hover:!bg-indigo-100 active:!bg-indigo-200 !border-indigo-200"}
              ${!M&&!c&&!f&&u&&!E?"hover:!shadow-md active:!shadow-inner cursor-pointer":"cursor-default"}
              !transition-all !duration-200 !shadow-md !border-2
            `,size:"large",children:M==="X"?"X":M==="O"?"O":""},F))}),xe.jsxs("div",{className:"flex justify-center space-x-4 sm:space-x-6",children:[xe.jsxs("div",{className:"text-center bg-green-50 p-3 rounded-xl w-20 sm:w-24 shadow-sm border border-green-100",children:[xe.jsx("div",{className:"text-xl sm:text-2xl font-bold text-green-600",children:C}),xe.jsx("div",{className:"text-xs sm:text-sm text-green-800",children:"برد شما"})]}),xe.jsxs("div",{className:"text-center bg-red-50 p-3 rounded-xl w-20 sm:w-24 shadow-sm border border-red-100",children:[xe.jsx("div",{className:"text-xl sm:text-2xl font-bold text-red-600",children:A}),xe.jsx("div",{className:"text-xs sm:text-sm text-red-800",children:"برد AI"})]}),xe.jsxs("div",{className:"text-center bg-yellow-50 p-3 rounded-xl w-20 sm:w-24 shadow-sm border border-yellow-100",children:[xe.jsx("div",{className:"text-xl sm:text-2xl font-bold text-yellow-600",children:R}),xe.jsx("div",{className:"text-xs sm:text-sm text-yellow-800",children:"مساوی"})]})]})]}),zx=({aiLevel:e,changeAiLevel:r})=>xe.jsxs("div",{className:"mb-5",children:[xe.jsx("label",{className:"block text-gray-700 text-sm sm:text-base mb-2",children:"سطح دشواری هوش مصنوعی"}),xe.jsx(hc,{direction:"vertical",className:"w-full",children:xe.jsxs(Ur.Group,{className:"grid grid-cols-3 gap-2 w-full",children:[xe.jsx(Ur,{type:e==="easy"?"primary":"default",onClick:()=>r("easy"),className:`
              ${e==="easy"?"!bg-green-500 !border-green-500 hover:!bg-green-600":"hover:!bg-gray-100"}
              !text-xs sm:!text-sm
            `,children:"آسان"}),xe.jsx(Ur,{type:e==="medium"?"primary":"default",onClick:()=>r("medium"),className:`
              ${e==="medium"?"!bg-yellow-500 !border-yellow-500 hover:!bg-yellow-600":"hover:!bg-gray-100"}
              !text-xs sm:!text-sm
            `,children:"متوسط"}),xe.jsx(Ur,{type:e==="hard"?"primary":"default",onClick:()=>r("hard"),className:`
              ${e==="hard"?"!bg-red-500 !border-red-500 hover:!bg-red-600":"hover:!bg-gray-100"}
              !text-xs sm:!text-sm
            `,children:"سخت"})]})})]}),{Text:ys}=Yr,Nx=({progress:e,status:r})=>xe.jsxs("div",{className:"w-full",children:[xe.jsxs("div",{className:"flex justify-between items-center mb-1",children:[xe.jsx(ys,{className:"!text-gray-700 !font-medium",children:"پیشرفت آموزش"}),xe.jsxs(ys,{className:"!text-indigo-600 !font-medium",children:[e,"%"]})]}),xe.jsx(t0,{percent:e,showInfo:!1,strokeColor:"#4f46e5",trailColor:"#e5e7eb",strokeLinecap:"round",className:"!mb-0",size:"small"}),xe.jsxs("div",{className:"mt-2 text-sm",children:[r==="training"&&xe.jsxs(ys,{className:"!text-indigo-600 flex items-center",children:[xe.jsx(fc,{spin:!0,className:"mr-2"}),"در حال آموزش مدل..."]}),r==="completed"&&xe.jsxs(ys,{className:"!text-green-600 flex items-center",children:[xe.jsx(c0,{className:"mr-2"}),"آموزش تکمیل شد!"]})]})]}),Fx=({trainingProgress:e,trainingStatus:r,retrainAI:u})=>xe.jsxs("div",{className:"mb-5",children:[xe.jsx(Nx,{progress:e,status:r}),xe.jsx(Ur,{type:"dashed",icon:xe.jsx(fc,{}),onClick:u,disabled:r==="training",loading:r==="training",block:!0,className:"mt-3 !text-sm sm:!text-base",children:r==="training"?"در حال آموزش...":"آموزش مجدد هوش مصنوعی"})]}),{Text:Vx}=Yr,jx=({aiLevel:e,changeAiLevel:r,trainingProgress:u,trainingStatus:c,retrainAI:f,showStats:E,setShowStats:C})=>xe.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-4 sm:p-5",children:[xe.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"تنظیمات و اطلاعات"}),xe.jsx(zx,{aiLevel:e,changeAiLevel:r}),xe.jsx(Fx,{trainingProgress:u,trainingStatus:c,retrainAI:f}),xe.jsxs(Ki,{size:"small",className:"bg-indigo-50 border-indigo-100 mb-5",title:xe.jsxs("span",{className:"font-bold text-indigo-800 flex items-center text-sm sm:text-base",children:[xe.jsx(pc,{className:"mr-2"}),"یادگیری تقویتی (RL)"]}),children:[xe.jsx(Vx,{type:"secondary",className:"mb-3 block text-xs sm:text-sm",children:"هوش مصنوعی با آزمون و خطا یاد می‌گیرد و برای هر حرکت پاداش دریافت می‌کند."}),xe.jsxs(xi,{column:1,size:"small",className:"space-y-2",children:[xe.jsx(xi.Item,{label:"برد هوش مصنوعی",children:xe.jsx(zi,{color:"green",children:"+1"})}),xe.jsx(xi.Item,{label:"باخت هوش مصنوعی",children:xe.jsx(zi,{color:"red",children:"-1"})}),xe.jsx(xi.Item,{label:"مساوی",children:xe.jsx(zi,{color:"orange",children:"+0.5"})}),xe.jsx(xi.Item,{label:"حرکت معتبر",children:xe.jsx(zi,{color:"default",children:"+0.01"})})]})]}),xe.jsx(Ur,{type:"primary",icon:E?xe.jsx(my,{}):xe.jsx(dy,{}),onClick:()=>C(!E),block:!0,className:"!bg-purple-600 hover:!bg-purple-700 !text-sm sm:!text-base",children:E?"پنهان کردن جزئیات":"نمایش جزئیات یادگیری"})]}),{Title:Di,Text:Hu}=Yr,Kx=()=>xe.jsx("div",{className:"mt-6 bg-gradient-to-br from-gray-50 to-blue-50 rounded-2xl shadow-lg border border-gray-200 overflow-hidden",children:xe.jsxs("div",{className:"p-5 sm:p-6",children:[xe.jsxs(Di,{level:3,className:"!text-gray-800 !mb-5 !text-xl sm:!text-2xl !font-bold flex items-center",children:[xe.jsx(p0,{className:"mr-3 text-blue-500"}),"جزئیات فنی پروژه"]}),xe.jsxs(Ag,{gutter:[20,20],children:[xe.jsx(Lu,{xs:24,lg:12,children:xe.jsxs(Ki,{className:"h-full shadow-sm hover:shadow-md transition-shadow rounded-xl border border-blue-100 bg-white",bodyStyle:{padding:"20px"},children:[xe.jsxs("div",{className:"flex items-start mb-4",children:[xe.jsx("div",{className:"bg-blue-100 p-2 rounded-lg mr-3",children:xe.jsx(b0,{className:"text-blue-600 text-xl"})}),xe.jsx(Di,{level:5,className:"!mb-0 !text-blue-800",children:"معماری شبکه عصبی"})]}),xe.jsx("ul",{className:"space-y-3",children:[{icon:"🧠",text:"لایه ورودی: 9 نورون (هر خانه صفحه)"},{icon:"🔗",text:"لایه‌های پنهان: 128 و 64 نورون"},{icon:"🎯",text:"لایه خروجی: 9 نورون (احتمال هر حرکت)"},{icon:"⚡",text:"تابع فعال‌ساز: Leaky ReLU"},{icon:"⚙️",text:"نرخ یادگیری: 0.01"}].map((e,r)=>xe.jsxs("li",{className:"flex items-start",children:[xe.jsx("span",{className:"text-lg mr-2",children:e.icon}),xe.jsx(Hu,{className:"text-gray-700",children:e.text})]},r))})]})}),xe.jsx(Lu,{xs:24,lg:12,children:xe.jsxs(Ki,{className:"h-full shadow-sm hover:shadow-md transition-shadow rounded-xl border border-purple-100 bg-white",bodyStyle:{padding:"20px"},children:[xe.jsxs("div",{className:"flex items-start mb-4",children:[xe.jsx("div",{className:"bg-purple-100 p-2 rounded-lg mr-3",children:xe.jsx(o0,{className:"text-purple-600 text-xl"})}),xe.jsx(Di,{level:5,className:"!mb-0 !text-purple-800",children:"فرآیند یادگیری تقویتی"})]}),xe.jsx("ol",{className:"space-y-3 list-decimal pr-5",children:["شروع با مدل تصادفی بدون دانش اولیه","شبیه‌سازی 2000 بازی برای آموزش","به‌روزرسانی وزن‌ها بر اساس پاداش حرکات","ذخیره مدل آموزش‌دیده در localStorage","استفاده از مدل آموزش‌دیده در بازی واقعی"].map((e,r)=>xe.jsx("li",{className:"text-gray-700",children:e},r))})]})})]}),xe.jsx(Ng,{className:"!my-7"}),xe.jsxs("div",{className:"text-center",children:[xe.jsxs(Di,{level:3,className:"!text-gray-800 !mb-6 !text-xl sm:!text-2xl !font-bold flex items-center justify-center",children:[xe.jsx(F0,{className:"mr-3 text-green-500"}),"تکنولوژی‌های استفاده شده"]}),xe.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-5",children:[{name:"React",description:"رابط کاربری",icon:xe.jsx(I0,{className:"text-blue-500 text-2xl"}),color:"from-blue-50 to-blue-100",border:"border-blue-200"},{name:"Brain.js",description:"شبکه عصبی",icon:xe.jsx(i0,{className:"text-cyan-500 text-2xl"}),color:"from-cyan-50 to-cyan-100",border:"border-cyan-200"},{name:"Ant Design",description:"کامپوننت‌ها",icon:xe.jsx(A0,{className:"text-purple-500 text-2xl"}),color:"from-purple-50 to-purple-100",border:"border-purple-200"}].map((e,r)=>xe.jsx("div",{className:`bg-gradient-to-br ${e.color} p-5 rounded-xl border ${e.border} shadow-sm hover:shadow-md transition-all transform hover:-translate-y-1`,children:xe.jsxs("div",{className:"flex flex-col items-center",children:[xe.jsx("div",{className:"mb-3 p-3 bg-white rounded-full shadow-inner",children:e.icon}),xe.jsx(Di,{level:4,className:"!mb-1 !text-gray-800 !text-lg",children:e.name}),xe.jsx(Hu,{type:"secondary",className:"!text-sm",children:e.description})]})},r))})]})]})}),Bx=({trainingProgress:e})=>xe.jsxs("div",{className:"flex flex-col items-center justify-center py-8 sm:py-12",children:[xe.jsx("div",{className:"animate-spin rounded-full h-12 w-12 sm:h-16 sm:w-16 border-t-4 border-b-4 border-indigo-600 mb-4"}),xe.jsx("p",{className:"text-base sm:text-lg text-indigo-700 font-medium text-center px-2",children:"هوش مصنوعی در حال آموزش اولیه است..."}),xe.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-2 text-center px-2",children:"لطفاً صبر کنید. این فرآیند تنها یک‌بار انجام می‌شود."}),xe.jsxs("div",{className:"w-full max-w-[250px] sm:max-w-xs mt-4",children:[xe.jsxs("div",{className:"flex justify-between text-xs sm:text-sm text-gray-600 mb-1",children:[xe.jsx("span",{children:"پیشرفت"}),xe.jsxs("span",{children:[e,"%"]})]}),xe.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:xe.jsx("div",{className:"bg-indigo-600 h-2 rounded-full transition-all duration-300",style:{width:`${e}%`}})})]})]});var Ni={exports:{}},Gx=Ni.exports,Xu;function Ux(){return Xu||(Xu=1,function(e,r){(function(u,c){c(r)})(Gx,function(u){function c(g){return Math.max(0,g)}function f(g,t){return g<=0?0:t}var E=Object.freeze({__proto__:null,activate:c,measure:f});function C(g){return 1/(1+Math.exp(-g))}function A(g,t){return g*(1-g)*t}var R=Object.freeze({__proto__:null,activate:C,measure:A});function M(g){return Math.tanh(g)}function F(g,t){return(1-g*g)*t}var j=Object.freeze({__proto__:null,activate:M,measure:F});function B(g){return g>0?g:.01*g}function H(g,t){return g>0?t:.01*t}var q=Object.freeze({__proto__:null,activate:B,measure:H}),W=Object.freeze({__proto__:null,relu:E,sigmoid:R,tanh:j,leakyRelu:q}),J=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Yo<"u"?Yo:typeof self<"u"?self:{};function G(g,t,n){return n={path:t,exports:{},require:function(i,p){return Y(i,p??n.path)}},g(n,n.exports),n.exports}function Y(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var Z=G(function(g,t){/**
 * gpu.js
 * http://gpu.rocks/
 *
 * GPU Accelerated JavaScript
 *
 * @version 2.16.0
 * @date Wed Nov 16 2022 15:48:37 GMT-0500 (Eastern Standard Time)
 *
 * @license MIT
 * The MIT License
 *
 * Copyright (c) 2022 gpu.js Team
 */(function(n){g.exports=n()})(function(){return function(){function n(i,p,d){function y(l,h){if(!p[l]){if(!i[l]){var a=typeof Y=="function"&&Y;if(!h&&a)return a(l,!0);if(v)return v(l,!0);var o=new Error("Cannot find module '"+l+"'");throw o.code="MODULE_NOT_FOUND",o}var S=p[l]={exports:{}};i[l][0].call(S.exports,function(_){var P=i[l][1][_];return y(P||_)},S,S.exports,n,i,p,d)}return p[l].exports}for(var v=typeof Y=="function"&&Y,m=0;m<d.length;m++)y(d[m]);return y}return n}()({1:[function(n,i,p){(function(d,y){typeof p=="object"&&typeof i<"u"?y(p):(d=d||self,y(d.acorn={}))})(this,function(d){var y={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},v="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",m={5:v,"5module":v+" export import",6:v+" const class extends export import super"},l=/^in(stanceof)?$/,h="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙՠ-ֈא-תׯ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࡠ-ࡪࢠ-ࢴࢶ-ࢽऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱৼਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄຆ-ຊຌ-ຣລວ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡸᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᲐ-ᲺᲽ-Ჿᳩ-ᳬᳮ-ᳳᳵᳶᳺᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕ℘-ℝℤΩℨK-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〇〡-〩〱-〵〸-〼ぁ-ゖ゛-ゟァ-ヺー-ヿㄅ-ㄯㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿯ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞿꟂ-Ᶎꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꣾꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭧꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",a="‌‍·̀-ͯ·҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-٩ٰۖ-ۜ۟-۪ۤۧۨ-ۭ۰-۹ܑܰ-݊ަ-ް߀-߉߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛࣓-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣ०-९ঁ-ঃ়া-ৄেৈো-্ৗৢৣ০-৯৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣ૦-૯ૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୢୣ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఀ-ఄా-ౄె-ైొ-్ౕౖౢౣ౦-౯ಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣ೦-೯ഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣ൦-൯ංඃ්ා-ුූෘ-ෟ෦-෯ෲෳัิ-ฺ็-๎๐-๙ັິ-ຼ່-ໍ໐-໙༘༙༠-༩༹༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှ၀-၉ၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟፩-፱ᜒ-᜔ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝០-៩᠋-᠍᠐-᠙ᢩᤠ-ᤫᤰ-᤻᥆-᥏᧐-᧚ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪰-᪽ᬀ-ᬄ᬴-᭄᭐-᭙᭫-᭳ᮀ-ᮂᮡ-ᮭ᮰-᮹᯦-᯳ᰤ-᰷᱀-᱉᱐-᱙᳐-᳔᳒-᳨᳭᳴᳷-᳹᷀-᷹᷻-᷿‿⁀⁔⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯꘠-꘩꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧꢀꢁꢴ-ꣅ꣐-꣙꣠-꣱ꣿ-꤉ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀꧐-꧙ꧥ꧰-꧹ꨩ-ꨶꩃꩌꩍ꩐-꩙ꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭꯰-꯹ﬞ︀-️︠-︯︳︴﹍-﹏０-９＿",o=new RegExp("["+h+"]"),S=new RegExp("["+h+a+"]");h=a=null;var _=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,477,28,11,0,9,21,155,22,13,52,76,44,33,24,27,35,30,0,12,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,0,33,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,0,161,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,270,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,754,9486,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42710,42,4148,12,221,3,5761,15,7472,3104,541],P=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,525,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,4,9,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,232,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,19723,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,792487,239];function I(s,x){for(var O=65536,N=0;N<x.length;N+=2){if(O+=x[N],O>s)return!1;if(O+=x[N+1],O>=s)return!0}}function k(s,x){return s<65?s===36:s<91?!0:s<97?s===95:s<123?!0:s<=65535?s>=170&&o.test(String.fromCharCode(s)):x===!1?!1:I(s,_)}function T(s,x){return s<48?s===36:s<58?!0:s<65?!1:s<91?!0:s<97?s===95:s<123?!0:s<=65535?s>=170&&S.test(String.fromCharCode(s)):x===!1?!1:I(s,_)||I(s,P)}var L=function(x,O){O===void 0&&(O={}),this.label=x,this.keyword=O.keyword,this.beforeExpr=!!O.beforeExpr,this.startsExpr=!!O.startsExpr,this.isLoop=!!O.isLoop,this.isAssign=!!O.isAssign,this.prefix=!!O.prefix,this.postfix=!!O.postfix,this.binop=O.binop||null,this.updateContext=null};function D(s,x){return new L(s,{beforeExpr:!0,binop:x})}var z={beforeExpr:!0},re={startsExpr:!0},he={};function $(s,x){return x===void 0&&(x={}),x.keyword=s,he[s]=new L(s,x)}var w={num:new L("num",re),regexp:new L("regexp",re),string:new L("string",re),name:new L("name",re),eof:new L("eof"),bracketL:new L("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new L("]"),braceL:new L("{",{beforeExpr:!0,startsExpr:!0}),braceR:new L("}"),parenL:new L("(",{beforeExpr:!0,startsExpr:!0}),parenR:new L(")"),comma:new L(",",z),semi:new L(";",z),colon:new L(":",z),dot:new L("."),question:new L("?",z),arrow:new L("=>",z),template:new L("template"),invalidTemplate:new L("invalidTemplate"),ellipsis:new L("...",z),backQuote:new L("`",re),dollarBraceL:new L("${",{beforeExpr:!0,startsExpr:!0}),eq:new L("=",{beforeExpr:!0,isAssign:!0}),assign:new L("_=",{beforeExpr:!0,isAssign:!0}),incDec:new L("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new L("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:D("||",1),logicalAND:D("&&",2),bitwiseOR:D("|",3),bitwiseXOR:D("^",4),bitwiseAND:D("&",5),equality:D("==/!=/===/!==",6),relational:D("</>/<=/>=",7),bitShift:D("<</>>/>>>",8),plusMin:new L("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:D("%",10),star:D("*",10),slash:D("/",10),starstar:new L("**",{beforeExpr:!0}),_break:$("break"),_case:$("case",z),_catch:$("catch"),_continue:$("continue"),_debugger:$("debugger"),_default:$("default",z),_do:$("do",{isLoop:!0,beforeExpr:!0}),_else:$("else",z),_finally:$("finally"),_for:$("for",{isLoop:!0}),_function:$("function",re),_if:$("if"),_return:$("return",z),_switch:$("switch"),_throw:$("throw",z),_try:$("try"),_var:$("var"),_const:$("const"),_while:$("while",{isLoop:!0}),_with:$("with"),_new:$("new",{beforeExpr:!0,startsExpr:!0}),_this:$("this",re),_super:$("super",re),_class:$("class",re),_extends:$("extends",z),_export:$("export"),_import:$("import",re),_null:$("null",re),_true:$("true",re),_false:$("false",re),_in:$("in",{beforeExpr:!0,binop:7}),_instanceof:$("instanceof",{beforeExpr:!0,binop:7}),_typeof:$("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:$("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:$("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},V=/\r\n?|\n|\u2028|\u2029/,K=new RegExp(V.source,"g");function fe(s,x){return s===10||s===13||!x&&(s===8232||s===8233)}var ee=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,ue=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,_e=Object.prototype,Re=_e.hasOwnProperty,ft=_e.toString;function it(s,x){return Re.call(s,x)}var Pe=Array.isArray||function(s){return ft.call(s)==="[object Array]"};function mt(s){return new RegExp("^(?:"+s.replace(/ /g,"|")+")$")}var bt=function(x,O){this.line=x,this.column=O};bt.prototype.offset=function(x){return new bt(this.line,this.column+x)};var Rt=function(x,O,N){this.start=O,this.end=N,x.sourceFile!==null&&(this.source=x.sourceFile)};function lt(s,x){for(var O=1,N=0;;){K.lastIndex=N;var U=K.exec(s);if(U&&U.index<x)++O,N=U.index+U[0].length;else return new bt(O,x-N)}}var ct={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Ye(s){var x={};for(var O in ct)x[O]=s&&it(s,O)?s[O]:ct[O];if(x.ecmaVersion>=2015&&(x.ecmaVersion-=2009),x.allowReserved==null&&(x.allowReserved=x.ecmaVersion<5),Pe(x.onToken)){var N=x.onToken;x.onToken=function(U){return N.push(U)}}return Pe(x.onComment)&&(x.onComment=Dt(x,x.onComment)),x}function Dt(s,x){return function(O,N,U,ce,Te,je){var gt={type:O?"Block":"Line",value:N,start:U,end:ce};s.locations&&(gt.loc=new Rt(this,Te,je)),s.ranges&&(gt.range=[U,ce]),x.push(gt)}}var Tn=1,_t=2,Zt=Tn|_t,ln=4,Gn=8,Vn=16,St=32,nn=64,En=128;function tr(s,x){return _t|(s?ln:0)|(x?Gn:0)}var Dr=0,Us=1,Mr=2,_o=3,Io=4,Lo=5,dn=function(x,O,N){this.options=x=Ye(x),this.sourceFile=x.sourceFile,this.keywords=mt(m[x.ecmaVersion>=6?6:x.sourceType==="module"?"5module":5]);var U="";if(x.allowReserved!==!0){for(var ce=x.ecmaVersion;!(U=y[ce]);ce--);x.sourceType==="module"&&(U+=" await")}this.reservedWords=mt(U);var Te=(U?U+" ":"")+y.strict;this.reservedWordsStrict=mt(Te),this.reservedWordsStrictBind=mt(Te+" "+y.strictBind),this.input=String(O),this.containsEsc=!1,N?(this.pos=N,this.lineStart=this.input.lastIndexOf(`
`,N-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(V).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=w.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=x.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&x.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Tn),this.regexpState=null},ei={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};dn.prototype.parse=function(){var x=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(x)},ei.inFunction.get=function(){return(this.currentVarScope().flags&_t)>0},ei.inGenerator.get=function(){return(this.currentVarScope().flags&Gn)>0},ei.inAsync.get=function(){return(this.currentVarScope().flags&ln)>0},ei.allowSuper.get=function(){return(this.currentThisScope().flags&nn)>0},ei.allowDirectSuper.get=function(){return(this.currentThisScope().flags&En)>0},ei.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},dn.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&_t)>0},dn.extend=function(){for(var x=[],O=arguments.length;O--;)x[O]=arguments[O];for(var N=this,U=0;U<x.length;U++)N=x[U](N);return N},dn.parse=function(x,O){return new this(O,x).parse()},dn.parseExpressionAt=function(x,O,N){var U=new this(N,x,O);return U.nextToken(),U.parseExpression()},dn.tokenizer=function(x,O){return new this(O,x)},Object.defineProperties(dn.prototype,ei);var Un=dn.prototype,Bh=/^(?:'((?:\\.|[^'])*?)'|"((?:\\.|[^"])*?)")/;Un.strictDirective=function(s){for(;;){ue.lastIndex=s,s+=ue.exec(this.input)[0].length;var x=Bh.exec(this.input.slice(s));if(!x)return!1;if((x[1]||x[2])==="use strict")return!0;s+=x[0].length,ue.lastIndex=s,s+=ue.exec(this.input)[0].length,this.input[s]===";"&&s++}},Un.eat=function(s){return this.type===s?(this.next(),!0):!1},Un.isContextual=function(s){return this.type===w.name&&this.value===s&&!this.containsEsc},Un.eatContextual=function(s){return this.isContextual(s)?(this.next(),!0):!1},Un.expectContextual=function(s){this.eatContextual(s)||this.unexpected()},Un.canInsertSemicolon=function(){return this.type===w.eof||this.type===w.braceR||V.test(this.input.slice(this.lastTokEnd,this.start))},Un.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Un.semicolon=function(){!this.eat(w.semi)&&!this.insertSemicolon()&&this.unexpected()},Un.afterTrailingComma=function(s,x){if(this.type===s)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),x||this.next(),!0},Un.expect=function(s){this.eat(s)||this.unexpected()},Un.unexpected=function(s){this.raise(s??this.start,"Unexpected token")};function is(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Un.checkPatternErrors=function(s,x){if(s){s.trailingComma>-1&&this.raiseRecoverable(s.trailingComma,"Comma is not permitted after the rest element");var O=x?s.parenthesizedAssign:s.parenthesizedBind;O>-1&&this.raiseRecoverable(O,"Parenthesized pattern")}},Un.checkExpressionErrors=function(s,x){if(!s)return!1;var O=s.shorthandAssign,N=s.doubleProto;if(!x)return O>=0||N>=0;O>=0&&this.raise(O,"Shorthand property assignments are valid only in destructuring patterns"),N>=0&&this.raiseRecoverable(N,"Redefinition of __proto__ property")},Un.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Un.isSimpleAssignTarget=function(s){return s.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(s.expression):s.type==="Identifier"||s.type==="MemberExpression"};var It=dn.prototype;It.parseTopLevel=function(s){var x={};for(s.body||(s.body=[]);this.type!==w.eof;){var O=this.parseStatement(null,!0,x);s.body.push(O)}if(this.inModule)for(var N=0,U=Object.keys(this.undefinedExports);N<U.length;N+=1){var ce=U[N];this.raiseRecoverable(this.undefinedExports[ce].start,"Export '"+ce+"' is not defined")}return this.adaptDirectivePrologue(s.body),this.next(),s.sourceType=this.options.sourceType,this.finishNode(s,"Program")};var Ws={kind:"loop"},Gh={kind:"switch"};It.isLet=function(s){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;ue.lastIndex=this.pos;var x=ue.exec(this.input),O=this.pos+x[0].length,N=this.input.charCodeAt(O);if(N===91)return!0;if(s)return!1;if(N===123)return!0;if(k(N,!0)){for(var U=O+1;T(this.input.charCodeAt(U),!0);)++U;var ce=this.input.slice(O,U);if(!l.test(ce))return!0}return!1},It.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;ue.lastIndex=this.pos;var s=ue.exec(this.input),x=this.pos+s[0].length;return!V.test(this.input.slice(this.pos,x))&&this.input.slice(x,x+8)==="function"&&(x+8===this.input.length||!T(this.input.charAt(x+8)))},It.parseStatement=function(s,x,O){var N=this.type,U=this.startNode(),ce;switch(this.isLet(s)&&(N=w._var,ce="let"),N){case w._break:case w._continue:return this.parseBreakContinueStatement(U,N.keyword);case w._debugger:return this.parseDebuggerStatement(U);case w._do:return this.parseDoStatement(U);case w._for:return this.parseForStatement(U);case w._function:return s&&(this.strict||s!=="if"&&s!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(U,!1,!s);case w._class:return s&&this.unexpected(),this.parseClass(U,!0);case w._if:return this.parseIfStatement(U);case w._return:return this.parseReturnStatement(U);case w._switch:return this.parseSwitchStatement(U);case w._throw:return this.parseThrowStatement(U);case w._try:return this.parseTryStatement(U);case w._const:case w._var:return ce=ce||this.value,s&&ce!=="var"&&this.unexpected(),this.parseVarStatement(U,ce);case w._while:return this.parseWhileStatement(U);case w._with:return this.parseWithStatement(U);case w.braceL:return this.parseBlock(!0,U);case w.semi:return this.parseEmptyStatement(U);case w._export:case w._import:if(this.options.ecmaVersion>10&&N===w._import){ue.lastIndex=this.pos;var Te=ue.exec(this.input),je=this.pos+Te[0].length,gt=this.input.charCodeAt(je);if(gt===40)return this.parseExpressionStatement(U,this.parseExpression())}return this.options.allowImportExportEverywhere||(x||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),N===w._import?this.parseImport(U):this.parseExport(U,O);default:if(this.isAsyncFunction())return s&&this.unexpected(),this.next(),this.parseFunctionStatement(U,!0,!s);var Qt=this.value,Zn=this.parseExpression();return N===w.name&&Zn.type==="Identifier"&&this.eat(w.colon)?this.parseLabeledStatement(U,Qt,Zn,s):this.parseExpressionStatement(U,Zn)}},It.parseBreakContinueStatement=function(s,x){var O=x==="break";this.next(),this.eat(w.semi)||this.insertSemicolon()?s.label=null:this.type!==w.name?this.unexpected():(s.label=this.parseIdent(),this.semicolon());for(var N=0;N<this.labels.length;++N){var U=this.labels[N];if((s.label==null||U.name===s.label.name)&&(U.kind!=null&&(O||U.kind==="loop")||s.label&&O))break}return N===this.labels.length&&this.raise(s.start,"Unsyntactic "+x),this.finishNode(s,O?"BreakStatement":"ContinueStatement")},It.parseDebuggerStatement=function(s){return this.next(),this.semicolon(),this.finishNode(s,"DebuggerStatement")},It.parseDoStatement=function(s){return this.next(),this.labels.push(Ws),s.body=this.parseStatement("do"),this.labels.pop(),this.expect(w._while),s.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(w.semi):this.semicolon(),this.finishNode(s,"DoWhileStatement")},It.parseForStatement=function(s){this.next();var x=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Ws),this.enterScope(0),this.expect(w.parenL),this.type===w.semi)return x>-1&&this.unexpected(x),this.parseFor(s,null);var O=this.isLet();if(this.type===w._var||this.type===w._const||O){var N=this.startNode(),U=O?"let":this.value;return this.next(),this.parseVar(N,!0,U),this.finishNode(N,"VariableDeclaration"),(this.type===w._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&N.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===w._in?x>-1&&this.unexpected(x):s.await=x>-1),this.parseForIn(s,N)):(x>-1&&this.unexpected(x),this.parseFor(s,N))}var ce=new is,Te=this.parseExpression(!0,ce);return this.type===w._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===w._in?x>-1&&this.unexpected(x):s.await=x>-1),this.toAssignable(Te,!1,ce),this.checkLVal(Te),this.parseForIn(s,Te)):(this.checkExpressionErrors(ce,!0),x>-1&&this.unexpected(x),this.parseFor(s,Te))},It.parseFunctionStatement=function(s,x,O){return this.next(),this.parseFunction(s,Li|(O?0:Hs),!1,x)},It.parseIfStatement=function(s){return this.next(),s.test=this.parseParenExpression(),s.consequent=this.parseStatement("if"),s.alternate=this.eat(w._else)?this.parseStatement("if"):null,this.finishNode(s,"IfStatement")},It.parseReturnStatement=function(s){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(w.semi)||this.insertSemicolon()?s.argument=null:(s.argument=this.parseExpression(),this.semicolon()),this.finishNode(s,"ReturnStatement")},It.parseSwitchStatement=function(s){this.next(),s.discriminant=this.parseParenExpression(),s.cases=[],this.expect(w.braceL),this.labels.push(Gh),this.enterScope(0);for(var x,O=!1;this.type!==w.braceR;)if(this.type===w._case||this.type===w._default){var N=this.type===w._case;x&&this.finishNode(x,"SwitchCase"),s.cases.push(x=this.startNode()),x.consequent=[],this.next(),N?x.test=this.parseExpression():(O&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),O=!0,x.test=null),this.expect(w.colon)}else x||this.unexpected(),x.consequent.push(this.parseStatement(null));return this.exitScope(),x&&this.finishNode(x,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(s,"SwitchStatement")},It.parseThrowStatement=function(s){return this.next(),V.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),s.argument=this.parseExpression(),this.semicolon(),this.finishNode(s,"ThrowStatement")};var Uh=[];It.parseTryStatement=function(s){if(this.next(),s.block=this.parseBlock(),s.handler=null,this.type===w._catch){var x=this.startNode();if(this.next(),this.eat(w.parenL)){x.param=this.parseBindingAtom();var O=x.param.type==="Identifier";this.enterScope(O?St:0),this.checkLVal(x.param,O?Io:Mr),this.expect(w.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),x.param=null,this.enterScope(0);x.body=this.parseBlock(!1),this.exitScope(),s.handler=this.finishNode(x,"CatchClause")}return s.finalizer=this.eat(w._finally)?this.parseBlock():null,!s.handler&&!s.finalizer&&this.raise(s.start,"Missing catch or finally clause"),this.finishNode(s,"TryStatement")},It.parseVarStatement=function(s,x){return this.next(),this.parseVar(s,!1,x),this.semicolon(),this.finishNode(s,"VariableDeclaration")},It.parseWhileStatement=function(s){return this.next(),s.test=this.parseParenExpression(),this.labels.push(Ws),s.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(s,"WhileStatement")},It.parseWithStatement=function(s){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),s.object=this.parseParenExpression(),s.body=this.parseStatement("with"),this.finishNode(s,"WithStatement")},It.parseEmptyStatement=function(s){return this.next(),this.finishNode(s,"EmptyStatement")},It.parseLabeledStatement=function(s,x,O,N){for(var U=0,ce=this.labels;U<ce.length;U+=1){var Te=ce[U];Te.name===x&&this.raise(O.start,"Label '"+x+"' is already declared")}for(var je=this.type.isLoop?"loop":this.type===w._switch?"switch":null,gt=this.labels.length-1;gt>=0;gt--){var Qt=this.labels[gt];if(Qt.statementStart===s.start)Qt.statementStart=this.start,Qt.kind=je;else break}return this.labels.push({name:x,kind:je,statementStart:this.start}),s.body=this.parseStatement(N?N.indexOf("label")===-1?N+"label":N:"label"),this.labels.pop(),s.label=O,this.finishNode(s,"LabeledStatement")},It.parseExpressionStatement=function(s,x){return s.expression=x,this.semicolon(),this.finishNode(s,"ExpressionStatement")},It.parseBlock=function(s,x){for(s===void 0&&(s=!0),x===void 0&&(x=this.startNode()),x.body=[],this.expect(w.braceL),s&&this.enterScope(0);!this.eat(w.braceR);){var O=this.parseStatement(null);x.body.push(O)}return s&&this.exitScope(),this.finishNode(x,"BlockStatement")},It.parseFor=function(s,x){return s.init=x,this.expect(w.semi),s.test=this.type===w.semi?null:this.parseExpression(),this.expect(w.semi),s.update=this.type===w.parenR?null:this.parseExpression(),this.expect(w.parenR),s.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(s,"ForStatement")},It.parseForIn=function(s,x){var O=this.type===w._in;return this.next(),x.type==="VariableDeclaration"&&x.declarations[0].init!=null&&(!O||this.options.ecmaVersion<8||this.strict||x.kind!=="var"||x.declarations[0].id.type!=="Identifier")?this.raise(x.start,(O?"for-in":"for-of")+" loop variable declaration may not have an initializer"):x.type==="AssignmentPattern"&&this.raise(x.start,"Invalid left-hand side in for-loop"),s.left=x,s.right=O?this.parseExpression():this.parseMaybeAssign(),this.expect(w.parenR),s.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(s,O?"ForInStatement":"ForOfStatement")},It.parseVar=function(s,x,O){for(s.declarations=[],s.kind=O;;){var N=this.startNode();if(this.parseVarId(N,O),this.eat(w.eq)?N.init=this.parseMaybeAssign(x):O==="const"&&!(this.type===w._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():N.id.type!=="Identifier"&&!(x&&(this.type===w._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):N.init=null,s.declarations.push(this.finishNode(N,"VariableDeclarator")),!this.eat(w.comma))break}return s},It.parseVarId=function(s,x){s.id=this.parseBindingAtom(),this.checkLVal(s.id,x==="var"?Us:Mr,!1)};var Li=1,Hs=2,Oo=4;It.parseFunction=function(s,x,O,N){this.initFunction(s),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!N)&&(this.type===w.star&&x&Hs&&this.unexpected(),s.generator=this.eat(w.star)),this.options.ecmaVersion>=8&&(s.async=!!N),x&Li&&(s.id=x&Oo&&this.type!==w.name?null:this.parseIdent(),s.id&&!(x&Hs)&&this.checkLVal(s.id,this.strict||s.generator||s.async?this.treatFunctionsAsVar?Us:Mr:_o));var U=this.yieldPos,ce=this.awaitPos,Te=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(tr(s.async,s.generator)),x&Li||(s.id=this.type===w.name?this.parseIdent():null),this.parseFunctionParams(s),this.parseFunctionBody(s,O,!1),this.yieldPos=U,this.awaitPos=ce,this.awaitIdentPos=Te,this.finishNode(s,x&Li?"FunctionDeclaration":"FunctionExpression")},It.parseFunctionParams=function(s){this.expect(w.parenL),s.params=this.parseBindingList(w.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},It.parseClass=function(s,x){this.next();var O=this.strict;this.strict=!0,this.parseClassId(s,x),this.parseClassSuper(s);var N=this.startNode(),U=!1;for(N.body=[],this.expect(w.braceL);!this.eat(w.braceR);){var ce=this.parseClassElement(s.superClass!==null);ce&&(N.body.push(ce),ce.type==="MethodDefinition"&&ce.kind==="constructor"&&(U&&this.raise(ce.start,"Duplicate constructor in the same class"),U=!0))}return s.body=this.finishNode(N,"ClassBody"),this.strict=O,this.finishNode(s,x?"ClassDeclaration":"ClassExpression")},It.parseClassElement=function(s){var x=this;if(this.eat(w.semi))return null;var O=this.startNode(),N=function(gt,Qt){Qt===void 0&&(Qt=!1);var Zn=x.start,Nr=x.startLoc;return x.eatContextual(gt)?x.type!==w.parenL&&(!Qt||!x.canInsertSemicolon())?!0:(O.key&&x.unexpected(),O.computed=!1,O.key=x.startNodeAt(Zn,Nr),O.key.name=gt,x.finishNode(O.key,"Identifier"),!1):!1};O.kind="method",O.static=N("static");var U=this.eat(w.star),ce=!1;U||(this.options.ecmaVersion>=8&&N("async",!0)?(ce=!0,U=this.options.ecmaVersion>=9&&this.eat(w.star)):N("get")?O.kind="get":N("set")&&(O.kind="set")),O.key||this.parsePropertyName(O);var Te=O.key,je=!1;return!O.computed&&!O.static&&(Te.type==="Identifier"&&Te.name==="constructor"||Te.type==="Literal"&&Te.value==="constructor")?(O.kind!=="method"&&this.raise(Te.start,"Constructor can't have get/set modifier"),U&&this.raise(Te.start,"Constructor can't be a generator"),ce&&this.raise(Te.start,"Constructor can't be an async method"),O.kind="constructor",je=s):O.static&&Te.type==="Identifier"&&Te.name==="prototype"&&this.raise(Te.start,"Classes may not have a static property named prototype"),this.parseClassMethod(O,U,ce,je),O.kind==="get"&&O.value.params.length!==0&&this.raiseRecoverable(O.value.start,"getter should have no params"),O.kind==="set"&&O.value.params.length!==1&&this.raiseRecoverable(O.value.start,"setter should have exactly one param"),O.kind==="set"&&O.value.params[0].type==="RestElement"&&this.raiseRecoverable(O.value.params[0].start,"Setter cannot use rest params"),O},It.parseClassMethod=function(s,x,O,N){return s.value=this.parseMethod(x,O,N),this.finishNode(s,"MethodDefinition")},It.parseClassId=function(s,x){this.type===w.name?(s.id=this.parseIdent(),x&&this.checkLVal(s.id,Mr,!1)):(x===!0&&this.unexpected(),s.id=null)},It.parseClassSuper=function(s){s.superClass=this.eat(w._extends)?this.parseExprSubscripts():null},It.parseExport=function(s,x){if(this.next(),this.eat(w.star))return this.expectContextual("from"),this.type!==w.string&&this.unexpected(),s.source=this.parseExprAtom(),this.semicolon(),this.finishNode(s,"ExportAllDeclaration");if(this.eat(w._default)){this.checkExport(x,"default",this.lastTokStart);var O;if(this.type===w._function||(O=this.isAsyncFunction())){var N=this.startNode();this.next(),O&&this.next(),s.declaration=this.parseFunction(N,Li|Oo,!1,O)}else if(this.type===w._class){var U=this.startNode();s.declaration=this.parseClass(U,"nullableID")}else s.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(s,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())s.declaration=this.parseStatement(null),s.declaration.type==="VariableDeclaration"?this.checkVariableExport(x,s.declaration.declarations):this.checkExport(x,s.declaration.id.name,s.declaration.id.start),s.specifiers=[],s.source=null;else{if(s.declaration=null,s.specifiers=this.parseExportSpecifiers(x),this.eatContextual("from"))this.type!==w.string&&this.unexpected(),s.source=this.parseExprAtom();else{for(var ce=0,Te=s.specifiers;ce<Te.length;ce+=1){var je=Te[ce];this.checkUnreserved(je.local),this.checkLocalExport(je.local)}s.source=null}this.semicolon()}return this.finishNode(s,"ExportNamedDeclaration")},It.checkExport=function(s,x,O){s&&(it(s,x)&&this.raiseRecoverable(O,"Duplicate export '"+x+"'"),s[x]=!0)},It.checkPatternExport=function(s,x){var O=x.type;if(O==="Identifier")this.checkExport(s,x.name,x.start);else if(O==="ObjectPattern")for(var N=0,U=x.properties;N<U.length;N+=1){var ce=U[N];this.checkPatternExport(s,ce)}else if(O==="ArrayPattern")for(var Te=0,je=x.elements;Te<je.length;Te+=1){var gt=je[Te];gt&&this.checkPatternExport(s,gt)}else O==="Property"?this.checkPatternExport(s,x.value):O==="AssignmentPattern"?this.checkPatternExport(s,x.left):O==="RestElement"?this.checkPatternExport(s,x.argument):O==="ParenthesizedExpression"&&this.checkPatternExport(s,x.expression)},It.checkVariableExport=function(s,x){if(s)for(var O=0,N=x;O<N.length;O+=1){var U=N[O];this.checkPatternExport(s,U.id)}},It.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},It.parseExportSpecifiers=function(s){var x=[],O=!0;for(this.expect(w.braceL);!this.eat(w.braceR);){if(O)O=!1;else if(this.expect(w.comma),this.afterTrailingComma(w.braceR))break;var N=this.startNode();N.local=this.parseIdent(!0),N.exported=this.eatContextual("as")?this.parseIdent(!0):N.local,this.checkExport(s,N.exported.name,N.exported.start),x.push(this.finishNode(N,"ExportSpecifier"))}return x},It.parseImport=function(s){return this.next(),this.type===w.string?(s.specifiers=Uh,s.source=this.parseExprAtom()):(s.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),s.source=this.type===w.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(s,"ImportDeclaration")},It.parseImportSpecifiers=function(){var s=[],x=!0;if(this.type===w.name){var O=this.startNode();if(O.local=this.parseIdent(),this.checkLVal(O.local,Mr),s.push(this.finishNode(O,"ImportDefaultSpecifier")),!this.eat(w.comma))return s}if(this.type===w.star){var N=this.startNode();return this.next(),this.expectContextual("as"),N.local=this.parseIdent(),this.checkLVal(N.local,Mr),s.push(this.finishNode(N,"ImportNamespaceSpecifier")),s}for(this.expect(w.braceL);!this.eat(w.braceR);){if(x)x=!1;else if(this.expect(w.comma),this.afterTrailingComma(w.braceR))break;var U=this.startNode();U.imported=this.parseIdent(!0),this.eatContextual("as")?U.local=this.parseIdent():(this.checkUnreserved(U.imported),U.local=U.imported),this.checkLVal(U.local,Mr),s.push(this.finishNode(U,"ImportSpecifier"))}return s},It.adaptDirectivePrologue=function(s){for(var x=0;x<s.length&&this.isDirectiveCandidate(s[x]);++x)s[x].directive=s[x].expression.raw.slice(1,-1)},It.isDirectiveCandidate=function(s){return s.type==="ExpressionStatement"&&s.expression.type==="Literal"&&typeof s.expression.value=="string"&&(this.input[s.start]==='"'||this.input[s.start]==="'")};var Pr=dn.prototype;Pr.toAssignable=function(s,x,O){if(this.options.ecmaVersion>=6&&s)switch(s.type){case"Identifier":this.inAsync&&s.name==="await"&&this.raise(s.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":s.type="ObjectPattern",O&&this.checkPatternErrors(O,!0);for(var N=0,U=s.properties;N<U.length;N+=1){var ce=U[N];this.toAssignable(ce,x),ce.type==="RestElement"&&(ce.argument.type==="ArrayPattern"||ce.argument.type==="ObjectPattern")&&this.raise(ce.argument.start,"Unexpected token")}break;case"Property":s.kind!=="init"&&this.raise(s.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(s.value,x);break;case"ArrayExpression":s.type="ArrayPattern",O&&this.checkPatternErrors(O,!0),this.toAssignableList(s.elements,x);break;case"SpreadElement":s.type="RestElement",this.toAssignable(s.argument,x),s.argument.type==="AssignmentPattern"&&this.raise(s.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":s.operator!=="="&&this.raise(s.left.end,"Only '=' operator can be used for specifying default value."),s.type="AssignmentPattern",delete s.operator,this.toAssignable(s.left,x);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(s.expression,x,O);break;case"MemberExpression":if(!x)break;default:this.raise(s.start,"Assigning to rvalue")}else O&&this.checkPatternErrors(O,!0);return s},Pr.toAssignableList=function(s,x){for(var O=s.length,N=0;N<O;N++){var U=s[N];U&&this.toAssignable(U,x)}if(O){var ce=s[O-1];this.options.ecmaVersion===6&&x&&ce&&ce.type==="RestElement"&&ce.argument.type!=="Identifier"&&this.unexpected(ce.argument.start)}return s},Pr.parseSpread=function(s){var x=this.startNode();return this.next(),x.argument=this.parseMaybeAssign(!1,s),this.finishNode(x,"SpreadElement")},Pr.parseRestBinding=function(){var s=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==w.name&&this.unexpected(),s.argument=this.parseBindingAtom(),this.finishNode(s,"RestElement")},Pr.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case w.bracketL:var s=this.startNode();return this.next(),s.elements=this.parseBindingList(w.bracketR,!0,!0),this.finishNode(s,"ArrayPattern");case w.braceL:return this.parseObj(!0)}return this.parseIdent()},Pr.parseBindingList=function(s,x,O){for(var N=[],U=!0;!this.eat(s);)if(U?U=!1:this.expect(w.comma),x&&this.type===w.comma)N.push(null);else{if(O&&this.afterTrailingComma(s))break;if(this.type===w.ellipsis){var ce=this.parseRestBinding();this.parseBindingListItem(ce),N.push(ce),this.type===w.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(s);break}else{var Te=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(Te),N.push(Te)}}return N},Pr.parseBindingListItem=function(s){return s},Pr.parseMaybeDefault=function(s,x,O){if(O=O||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(w.eq))return O;var N=this.startNodeAt(s,x);return N.left=O,N.right=this.parseMaybeAssign(),this.finishNode(N,"AssignmentPattern")},Pr.checkLVal=function(s,x,O){switch(x===void 0&&(x=Dr),s.type){case"Identifier":x===Mr&&s.name==="let"&&this.raiseRecoverable(s.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(s.name)&&this.raiseRecoverable(s.start,(x?"Binding ":"Assigning to ")+s.name+" in strict mode"),O&&(it(O,s.name)&&this.raiseRecoverable(s.start,"Argument name clash"),O[s.name]=!0),x!==Dr&&x!==Lo&&this.declareName(s.name,x,s.start);break;case"MemberExpression":x&&this.raiseRecoverable(s.start,"Binding member expression");break;case"ObjectPattern":for(var N=0,U=s.properties;N<U.length;N+=1){var ce=U[N];this.checkLVal(ce,x,O)}break;case"Property":this.checkLVal(s.value,x,O);break;case"ArrayPattern":for(var Te=0,je=s.elements;Te<je.length;Te+=1){var gt=je[Te];gt&&this.checkLVal(gt,x,O)}break;case"AssignmentPattern":this.checkLVal(s.left,x,O);break;case"RestElement":this.checkLVal(s.argument,x,O);break;case"ParenthesizedExpression":this.checkLVal(s.expression,x,O);break;default:this.raise(s.start,(x?"Binding":"Assigning to")+" rvalue")}};var Mt=dn.prototype;Mt.checkPropClash=function(s,x,O){if(!(this.options.ecmaVersion>=9&&s.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(s.computed||s.method||s.shorthand))){var N=s.key,U;switch(N.type){case"Identifier":U=N.name;break;case"Literal":U=String(N.value);break;default:return}var ce=s.kind;if(this.options.ecmaVersion>=6){U==="__proto__"&&ce==="init"&&(x.proto&&(O?O.doubleProto<0&&(O.doubleProto=N.start):this.raiseRecoverable(N.start,"Redefinition of __proto__ property")),x.proto=!0);return}U="$"+U;var Te=x[U];if(Te){var je;ce==="init"?je=this.strict&&Te.init||Te.get||Te.set:je=Te.init||Te[ce],je&&this.raiseRecoverable(N.start,"Redefinition of property")}else Te=x[U]={init:!1,get:!1,set:!1};Te[ce]=!0}},Mt.parseExpression=function(s,x){var O=this.start,N=this.startLoc,U=this.parseMaybeAssign(s,x);if(this.type===w.comma){var ce=this.startNodeAt(O,N);for(ce.expressions=[U];this.eat(w.comma);)ce.expressions.push(this.parseMaybeAssign(s,x));return this.finishNode(ce,"SequenceExpression")}return U},Mt.parseMaybeAssign=function(s,x,O){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(s);this.exprAllowed=!1}var N=!1,U=-1,ce=-1;x?(U=x.parenthesizedAssign,ce=x.trailingComma,x.parenthesizedAssign=x.trailingComma=-1):(x=new is,N=!0);var Te=this.start,je=this.startLoc;(this.type===w.parenL||this.type===w.name)&&(this.potentialArrowAt=this.start);var gt=this.parseMaybeConditional(s,x);if(O&&(gt=O.call(this,gt,Te,je)),this.type.isAssign){var Qt=this.startNodeAt(Te,je);return Qt.operator=this.value,Qt.left=this.type===w.eq?this.toAssignable(gt,!1,x):gt,N||(x.parenthesizedAssign=x.trailingComma=x.doubleProto=-1),x.shorthandAssign>=Qt.left.start&&(x.shorthandAssign=-1),this.checkLVal(gt),this.next(),Qt.right=this.parseMaybeAssign(s),this.finishNode(Qt,"AssignmentExpression")}else N&&this.checkExpressionErrors(x,!0);return U>-1&&(x.parenthesizedAssign=U),ce>-1&&(x.trailingComma=ce),gt},Mt.parseMaybeConditional=function(s,x){var O=this.start,N=this.startLoc,U=this.parseExprOps(s,x);if(this.checkExpressionErrors(x))return U;if(this.eat(w.question)){var ce=this.startNodeAt(O,N);return ce.test=U,ce.consequent=this.parseMaybeAssign(),this.expect(w.colon),ce.alternate=this.parseMaybeAssign(s),this.finishNode(ce,"ConditionalExpression")}return U},Mt.parseExprOps=function(s,x){var O=this.start,N=this.startLoc,U=this.parseMaybeUnary(x,!1);return this.checkExpressionErrors(x)||U.start===O&&U.type==="ArrowFunctionExpression"?U:this.parseExprOp(U,O,N,-1,s)},Mt.parseExprOp=function(s,x,O,N,U){var ce=this.type.binop;if(ce!=null&&(!U||this.type!==w._in)&&ce>N){var Te=this.type===w.logicalOR||this.type===w.logicalAND,je=this.value;this.next();var gt=this.start,Qt=this.startLoc,Zn=this.parseExprOp(this.parseMaybeUnary(null,!1),gt,Qt,ce,U),Nr=this.buildBinary(x,O,s,Zn,je,Te);return this.parseExprOp(Nr,x,O,N,U)}return s},Mt.buildBinary=function(s,x,O,N,U,ce){var Te=this.startNodeAt(s,x);return Te.left=O,Te.operator=U,Te.right=N,this.finishNode(Te,ce?"LogicalExpression":"BinaryExpression")},Mt.parseMaybeUnary=function(s,x){var O=this.start,N=this.startLoc,U;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))U=this.parseAwait(),x=!0;else if(this.type.prefix){var ce=this.startNode(),Te=this.type===w.incDec;ce.operator=this.value,ce.prefix=!0,this.next(),ce.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(s,!0),Te?this.checkLVal(ce.argument):this.strict&&ce.operator==="delete"&&ce.argument.type==="Identifier"?this.raiseRecoverable(ce.start,"Deleting local variable in strict mode"):x=!0,U=this.finishNode(ce,Te?"UpdateExpression":"UnaryExpression")}else{if(U=this.parseExprSubscripts(s),this.checkExpressionErrors(s))return U;for(;this.type.postfix&&!this.canInsertSemicolon();){var je=this.startNodeAt(O,N);je.operator=this.value,je.prefix=!1,je.argument=U,this.checkLVal(U),this.next(),U=this.finishNode(je,"UpdateExpression")}}return!x&&this.eat(w.starstar)?this.buildBinary(O,N,U,this.parseMaybeUnary(null,!1),"**",!1):U},Mt.parseExprSubscripts=function(s){var x=this.start,O=this.startLoc,N=this.parseExprAtom(s);if(N.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return N;var U=this.parseSubscripts(N,x,O);return s&&U.type==="MemberExpression"&&(s.parenthesizedAssign>=U.start&&(s.parenthesizedAssign=-1),s.parenthesizedBind>=U.start&&(s.parenthesizedBind=-1)),U},Mt.parseSubscripts=function(s,x,O,N){for(var U=this.options.ecmaVersion>=8&&s.type==="Identifier"&&s.name==="async"&&this.lastTokEnd===s.end&&!this.canInsertSemicolon()&&this.input.slice(s.start,s.end)==="async";;){var ce=this.parseSubscript(s,x,O,N,U);if(ce===s||ce.type==="ArrowFunctionExpression")return ce;s=ce}},Mt.parseSubscript=function(s,x,O,N,U){var ce=this.eat(w.bracketL);if(ce||this.eat(w.dot)){var Te=this.startNodeAt(x,O);Te.object=s,Te.property=ce?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),Te.computed=!!ce,ce&&this.expect(w.bracketR),s=this.finishNode(Te,"MemberExpression")}else if(!N&&this.eat(w.parenL)){var je=new is,gt=this.yieldPos,Qt=this.awaitPos,Zn=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Nr=this.parseExprList(w.parenR,this.options.ecmaVersion>=8,!1,je);if(U&&!this.canInsertSemicolon()&&this.eat(w.arrow))return this.checkPatternErrors(je,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=gt,this.awaitPos=Qt,this.awaitIdentPos=Zn,this.parseArrowExpression(this.startNodeAt(x,O),Nr,!0);this.checkExpressionErrors(je,!0),this.yieldPos=gt||this.yieldPos,this.awaitPos=Qt||this.awaitPos,this.awaitIdentPos=Zn||this.awaitIdentPos;var ci=this.startNodeAt(x,O);ci.callee=s,ci.arguments=Nr,s=this.finishNode(ci,"CallExpression")}else if(this.type===w.backQuote){var ti=this.startNodeAt(x,O);ti.tag=s,ti.quasi=this.parseTemplate({isTagged:!0}),s=this.finishNode(ti,"TaggedTemplateExpression")}return s},Mt.parseExprAtom=function(s){this.type===w.slash&&this.readRegexp();var x,O=this.potentialArrowAt===this.start;switch(this.type){case w._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),x=this.startNode(),this.next(),this.type===w.parenL&&!this.allowDirectSuper&&this.raise(x.start,"super() call outside constructor of a subclass"),this.type!==w.dot&&this.type!==w.bracketL&&this.type!==w.parenL&&this.unexpected(),this.finishNode(x,"Super");case w._this:return x=this.startNode(),this.next(),this.finishNode(x,"ThisExpression");case w.name:var N=this.start,U=this.startLoc,ce=this.containsEsc,Te=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!ce&&Te.name==="async"&&!this.canInsertSemicolon()&&this.eat(w._function))return this.parseFunction(this.startNodeAt(N,U),0,!1,!0);if(O&&!this.canInsertSemicolon()){if(this.eat(w.arrow))return this.parseArrowExpression(this.startNodeAt(N,U),[Te],!1);if(this.options.ecmaVersion>=8&&Te.name==="async"&&this.type===w.name&&!ce)return Te=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(w.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(N,U),[Te],!0)}return Te;case w.regexp:var je=this.value;return x=this.parseLiteral(je.value),x.regex={pattern:je.pattern,flags:je.flags},x;case w.num:case w.string:return this.parseLiteral(this.value);case w._null:case w._true:case w._false:return x=this.startNode(),x.value=this.type===w._null?null:this.type===w._true,x.raw=this.type.keyword,this.next(),this.finishNode(x,"Literal");case w.parenL:var gt=this.start,Qt=this.parseParenAndDistinguishExpression(O);return s&&(s.parenthesizedAssign<0&&!this.isSimpleAssignTarget(Qt)&&(s.parenthesizedAssign=gt),s.parenthesizedBind<0&&(s.parenthesizedBind=gt)),Qt;case w.bracketL:return x=this.startNode(),this.next(),x.elements=this.parseExprList(w.bracketR,!0,!0,s),this.finishNode(x,"ArrayExpression");case w.braceL:return this.parseObj(!1,s);case w._function:return x=this.startNode(),this.next(),this.parseFunction(x,0);case w._class:return this.parseClass(this.startNode(),!1);case w._new:return this.parseNew();case w.backQuote:return this.parseTemplate();case w._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Mt.parseExprImport=function(){var s=this.startNode();switch(this.next(),this.type){case w.parenL:return this.parseDynamicImport(s);default:this.unexpected()}},Mt.parseDynamicImport=function(s){if(this.next(),s.source=this.parseMaybeAssign(),!this.eat(w.parenR)){var x=this.start;this.eat(w.comma)&&this.eat(w.parenR)?this.raiseRecoverable(x,"Trailing comma is not allowed in import()"):this.unexpected(x)}return this.finishNode(s,"ImportExpression")},Mt.parseLiteral=function(s){var x=this.startNode();return x.value=s,x.raw=this.input.slice(this.start,this.end),x.raw.charCodeAt(x.raw.length-1)===110&&(x.bigint=x.raw.slice(0,-1)),this.next(),this.finishNode(x,"Literal")},Mt.parseParenExpression=function(){this.expect(w.parenL);var s=this.parseExpression();return this.expect(w.parenR),s},Mt.parseParenAndDistinguishExpression=function(s){var x=this.start,O=this.startLoc,N,U=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var ce=this.start,Te=this.startLoc,je=[],gt=!0,Qt=!1,Zn=new is,Nr=this.yieldPos,ci=this.awaitPos,ti;for(this.yieldPos=0,this.awaitPos=0;this.type!==w.parenR;)if(gt?gt=!1:this.expect(w.comma),U&&this.afterTrailingComma(w.parenR,!0)){Qt=!0;break}else if(this.type===w.ellipsis){ti=this.start,je.push(this.parseParenItem(this.parseRestBinding())),this.type===w.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else je.push(this.parseMaybeAssign(!1,Zn,this.parseParenItem));var ad=this.start,od=this.startLoc;if(this.expect(w.parenR),s&&!this.canInsertSemicolon()&&this.eat(w.arrow))return this.checkPatternErrors(Zn,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Nr,this.awaitPos=ci,this.parseParenArrowList(x,O,je);(!je.length||Qt)&&this.unexpected(this.lastTokStart),ti&&this.unexpected(ti),this.checkExpressionErrors(Zn,!0),this.yieldPos=Nr||this.yieldPos,this.awaitPos=ci||this.awaitPos,je.length>1?(N=this.startNodeAt(ce,Te),N.expressions=je,this.finishNodeAt(N,"SequenceExpression",ad,od)):N=je[0]}else N=this.parseParenExpression();if(this.options.preserveParens){var Wo=this.startNodeAt(x,O);return Wo.expression=N,this.finishNode(Wo,"ParenthesizedExpression")}else return N},Mt.parseParenItem=function(s){return s},Mt.parseParenArrowList=function(s,x,O){return this.parseArrowExpression(this.startNodeAt(s,x),O)};var Wh=[];Mt.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var s=this.startNode(),x=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(w.dot)){s.meta=x;var O=this.containsEsc;return s.property=this.parseIdent(!0),(s.property.name!=="target"||O)&&this.raiseRecoverable(s.property.start,"The only valid meta property for new is new.target"),this.inNonArrowFunction()||this.raiseRecoverable(s.start,"new.target can only be used in functions"),this.finishNode(s,"MetaProperty")}var N=this.start,U=this.startLoc,ce=this.type===w._import;return s.callee=this.parseSubscripts(this.parseExprAtom(),N,U,!0),ce&&s.callee.type==="ImportExpression"&&this.raise(N,"Cannot use new with import()"),this.eat(w.parenL)?s.arguments=this.parseExprList(w.parenR,this.options.ecmaVersion>=8,!1):s.arguments=Wh,this.finishNode(s,"NewExpression")},Mt.parseTemplateElement=function(s){var x=s.isTagged,O=this.startNode();return this.type===w.invalidTemplate?(x||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),O.value={raw:this.value,cooked:null}):O.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),O.tail=this.type===w.backQuote,this.finishNode(O,"TemplateElement")},Mt.parseTemplate=function(s){s===void 0&&(s={});var x=s.isTagged;x===void 0&&(x=!1);var O=this.startNode();this.next(),O.expressions=[];var N=this.parseTemplateElement({isTagged:x});for(O.quasis=[N];!N.tail;)this.type===w.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(w.dollarBraceL),O.expressions.push(this.parseExpression()),this.expect(w.braceR),O.quasis.push(N=this.parseTemplateElement({isTagged:x}));return this.next(),this.finishNode(O,"TemplateLiteral")},Mt.isAsyncProp=function(s){return!s.computed&&s.key.type==="Identifier"&&s.key.name==="async"&&(this.type===w.name||this.type===w.num||this.type===w.string||this.type===w.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===w.star)&&!V.test(this.input.slice(this.lastTokEnd,this.start))},Mt.parseObj=function(s,x){var O=this.startNode(),N=!0,U={};for(O.properties=[],this.next();!this.eat(w.braceR);){if(N)N=!1;else if(this.expect(w.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(w.braceR))break;var ce=this.parseProperty(s,x);s||this.checkPropClash(ce,U,x),O.properties.push(ce)}return this.finishNode(O,s?"ObjectPattern":"ObjectExpression")},Mt.parseProperty=function(s,x){var O=this.startNode(),N,U,ce,Te;if(this.options.ecmaVersion>=9&&this.eat(w.ellipsis))return s?(O.argument=this.parseIdent(!1),this.type===w.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(O,"RestElement")):(this.type===w.parenL&&x&&(x.parenthesizedAssign<0&&(x.parenthesizedAssign=this.start),x.parenthesizedBind<0&&(x.parenthesizedBind=this.start)),O.argument=this.parseMaybeAssign(!1,x),this.type===w.comma&&x&&x.trailingComma<0&&(x.trailingComma=this.start),this.finishNode(O,"SpreadElement"));this.options.ecmaVersion>=6&&(O.method=!1,O.shorthand=!1,(s||x)&&(ce=this.start,Te=this.startLoc),s||(N=this.eat(w.star)));var je=this.containsEsc;return this.parsePropertyName(O),!s&&!je&&this.options.ecmaVersion>=8&&!N&&this.isAsyncProp(O)?(U=!0,N=this.options.ecmaVersion>=9&&this.eat(w.star),this.parsePropertyName(O,x)):U=!1,this.parsePropertyValue(O,s,N,U,ce,Te,x,je),this.finishNode(O,"Property")},Mt.parsePropertyValue=function(s,x,O,N,U,ce,Te,je){if((O||N)&&this.type===w.colon&&this.unexpected(),this.eat(w.colon))s.value=x?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,Te),s.kind="init";else if(this.options.ecmaVersion>=6&&this.type===w.parenL)x&&this.unexpected(),s.kind="init",s.method=!0,s.value=this.parseMethod(O,N);else if(!x&&!je&&this.options.ecmaVersion>=5&&!s.computed&&s.key.type==="Identifier"&&(s.key.name==="get"||s.key.name==="set")&&this.type!==w.comma&&this.type!==w.braceR){(O||N)&&this.unexpected(),s.kind=s.key.name,this.parsePropertyName(s),s.value=this.parseMethod(!1);var gt=s.kind==="get"?0:1;if(s.value.params.length!==gt){var Qt=s.value.start;s.kind==="get"?this.raiseRecoverable(Qt,"getter should have no params"):this.raiseRecoverable(Qt,"setter should have exactly one param")}else s.kind==="set"&&s.value.params[0].type==="RestElement"&&this.raiseRecoverable(s.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!s.computed&&s.key.type==="Identifier"?((O||N)&&this.unexpected(),this.checkUnreserved(s.key),s.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=U),s.kind="init",x?s.value=this.parseMaybeDefault(U,ce,s.key):this.type===w.eq&&Te?(Te.shorthandAssign<0&&(Te.shorthandAssign=this.start),s.value=this.parseMaybeDefault(U,ce,s.key)):s.value=s.key,s.shorthand=!0):this.unexpected()},Mt.parsePropertyName=function(s){if(this.options.ecmaVersion>=6){if(this.eat(w.bracketL))return s.computed=!0,s.key=this.parseMaybeAssign(),this.expect(w.bracketR),s.key;s.computed=!1}return s.key=this.type===w.num||this.type===w.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Mt.initFunction=function(s){s.id=null,this.options.ecmaVersion>=6&&(s.generator=s.expression=!1),this.options.ecmaVersion>=8&&(s.async=!1)},Mt.parseMethod=function(s,x,O){var N=this.startNode(),U=this.yieldPos,ce=this.awaitPos,Te=this.awaitIdentPos;return this.initFunction(N),this.options.ecmaVersion>=6&&(N.generator=s),this.options.ecmaVersion>=8&&(N.async=!!x),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(tr(x,N.generator)|nn|(O?En:0)),this.expect(w.parenL),N.params=this.parseBindingList(w.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(N,!1,!0),this.yieldPos=U,this.awaitPos=ce,this.awaitIdentPos=Te,this.finishNode(N,"FunctionExpression")},Mt.parseArrowExpression=function(s,x,O){var N=this.yieldPos,U=this.awaitPos,ce=this.awaitIdentPos;return this.enterScope(tr(O,!1)|Vn),this.initFunction(s),this.options.ecmaVersion>=8&&(s.async=!!O),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,s.params=this.toAssignableList(x,!0),this.parseFunctionBody(s,!0,!1),this.yieldPos=N,this.awaitPos=U,this.awaitIdentPos=ce,this.finishNode(s,"ArrowFunctionExpression")},Mt.parseFunctionBody=function(s,x,O){var N=x&&this.type!==w.braceL,U=this.strict,ce=!1;if(N)s.body=this.parseMaybeAssign(),s.expression=!0,this.checkParams(s,!1);else{var Te=this.options.ecmaVersion>=7&&!this.isSimpleParamList(s.params);(!U||Te)&&(ce=this.strictDirective(this.end),ce&&Te&&this.raiseRecoverable(s.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var je=this.labels;this.labels=[],ce&&(this.strict=!0),this.checkParams(s,!U&&!ce&&!x&&!O&&this.isSimpleParamList(s.params)),s.body=this.parseBlock(!1),s.expression=!1,this.adaptDirectivePrologue(s.body.body),this.labels=je}this.exitScope(),this.strict&&s.id&&this.checkLVal(s.id,Lo),this.strict=U},Mt.isSimpleParamList=function(s){for(var x=0,O=s;x<O.length;x+=1){var N=O[x];if(N.type!=="Identifier")return!1}return!0},Mt.checkParams=function(s,x){for(var O={},N=0,U=s.params;N<U.length;N+=1){var ce=U[N];this.checkLVal(ce,Us,x?null:O)}},Mt.parseExprList=function(s,x,O,N){for(var U=[],ce=!0;!this.eat(s);){if(ce)ce=!1;else if(this.expect(w.comma),x&&this.afterTrailingComma(s))break;var Te=void 0;O&&this.type===w.comma?Te=null:this.type===w.ellipsis?(Te=this.parseSpread(N),N&&this.type===w.comma&&N.trailingComma<0&&(N.trailingComma=this.start)):Te=this.parseMaybeAssign(!1,N),U.push(Te)}return U},Mt.checkUnreserved=function(s){var x=s.start,O=s.end,N=s.name;if(this.inGenerator&&N==="yield"&&this.raiseRecoverable(x,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&N==="await"&&this.raiseRecoverable(x,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(N)&&this.raise(x,"Unexpected keyword '"+N+"'"),!(this.options.ecmaVersion<6&&this.input.slice(x,O).indexOf("\\")!==-1)){var U=this.strict?this.reservedWordsStrict:this.reservedWords;U.test(N)&&(!this.inAsync&&N==="await"&&this.raiseRecoverable(x,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(x,"The keyword '"+N+"' is reserved"))}},Mt.parseIdent=function(s,x){var O=this.startNode();return this.type===w.name?O.name=this.value:this.type.keyword?(O.name=this.type.keyword,(O.name==="class"||O.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!s),this.finishNode(O,"Identifier"),s||(this.checkUnreserved(O),O.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=O.start)),O},Mt.parseYield=function(s){this.yieldPos||(this.yieldPos=this.start);var x=this.startNode();return this.next(),this.type===w.semi||this.canInsertSemicolon()||this.type!==w.star&&!this.type.startsExpr?(x.delegate=!1,x.argument=null):(x.delegate=this.eat(w.star),x.argument=this.parseMaybeAssign(s)),this.finishNode(x,"YieldExpression")},Mt.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var s=this.startNode();return this.next(),s.argument=this.parseMaybeUnary(null,!1),this.finishNode(s,"AwaitExpression")};var ss=dn.prototype;ss.raise=function(s,x){var O=lt(this.input,s);x+=" ("+O.line+":"+O.column+")";var N=new SyntaxError(x);throw N.pos=s,N.loc=O,N.raisedAt=this.pos,N},ss.raiseRecoverable=ss.raise,ss.curPosition=function(){if(this.options.locations)return new bt(this.curLine,this.pos-this.lineStart)};var Br=dn.prototype,Hh=function(x){this.flags=x,this.var=[],this.lexical=[],this.functions=[]};Br.enterScope=function(s){this.scopeStack.push(new Hh(s))},Br.exitScope=function(){this.scopeStack.pop()},Br.treatFunctionsAsVarInScope=function(s){return s.flags&_t||!this.inModule&&s.flags&Tn},Br.declareName=function(s,x,O){var N=!1;if(x===Mr){var U=this.currentScope();N=U.lexical.indexOf(s)>-1||U.functions.indexOf(s)>-1||U.var.indexOf(s)>-1,U.lexical.push(s),this.inModule&&U.flags&Tn&&delete this.undefinedExports[s]}else if(x===Io){var ce=this.currentScope();ce.lexical.push(s)}else if(x===_o){var Te=this.currentScope();this.treatFunctionsAsVar?N=Te.lexical.indexOf(s)>-1:N=Te.lexical.indexOf(s)>-1||Te.var.indexOf(s)>-1,Te.functions.push(s)}else for(var je=this.scopeStack.length-1;je>=0;--je){var gt=this.scopeStack[je];if(gt.lexical.indexOf(s)>-1&&!(gt.flags&St&&gt.lexical[0]===s)||!this.treatFunctionsAsVarInScope(gt)&&gt.functions.indexOf(s)>-1){N=!0;break}if(gt.var.push(s),this.inModule&&gt.flags&Tn&&delete this.undefinedExports[s],gt.flags&Zt)break}N&&this.raiseRecoverable(O,"Identifier '"+s+"' has already been declared")},Br.checkLocalExport=function(s){this.scopeStack[0].lexical.indexOf(s.name)===-1&&this.scopeStack[0].var.indexOf(s.name)===-1&&(this.undefinedExports[s.name]=s)},Br.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Br.currentVarScope=function(){for(var s=this.scopeStack.length-1;;s--){var x=this.scopeStack[s];if(x.flags&Zt)return x}},Br.currentThisScope=function(){for(var s=this.scopeStack.length-1;;s--){var x=this.scopeStack[s];if(x.flags&Zt&&!(x.flags&Vn))return x}};var as=function(x,O,N){this.type="",this.start=O,this.end=0,x.options.locations&&(this.loc=new Rt(x,N)),x.options.directSourceFile&&(this.sourceFile=x.options.directSourceFile),x.options.ranges&&(this.range=[O,0])},os=dn.prototype;os.startNode=function(){return new as(this,this.start,this.startLoc)},os.startNodeAt=function(s,x){return new as(this,s,x)};function Ao(s,x,O,N){return s.type=x,s.end=O,this.options.locations&&(s.loc.end=N),this.options.ranges&&(s.range[1]=O),s}os.finishNode=function(s,x){return Ao.call(this,s,x,this.lastTokEnd,this.lastTokEndLoc)},os.finishNodeAt=function(s,x,O,N){return Ao.call(this,s,x,O,N)};var hr=function(x,O,N,U,ce){this.token=x,this.isExpr=!!O,this.preserveSpace=!!N,this.override=U,this.generator=!!ce},gn={b_stat:new hr("{",!1),b_expr:new hr("{",!0),b_tmpl:new hr("${",!1),p_stat:new hr("(",!1),p_expr:new hr("(",!0),q_tmpl:new hr("`",!0,!0,function(s){return s.tryReadTemplateToken()}),f_stat:new hr("function",!1),f_expr:new hr("function",!0),f_expr_gen:new hr("function",!0,!1,null,!0),f_gen:new hr("function",!1,!1,null,!0)},us=dn.prototype;us.initialContext=function(){return[gn.b_stat]},us.braceIsBlock=function(s){var x=this.curContext();return x===gn.f_expr||x===gn.f_stat?!0:s===w.colon&&(x===gn.b_stat||x===gn.b_expr)?!x.isExpr:s===w._return||s===w.name&&this.exprAllowed?V.test(this.input.slice(this.lastTokEnd,this.start)):s===w._else||s===w.semi||s===w.eof||s===w.parenR||s===w.arrow?!0:s===w.braceL?x===gn.b_stat:s===w._var||s===w._const||s===w.name?!1:!this.exprAllowed},us.inGeneratorContext=function(){for(var s=this.context.length-1;s>=1;s--){var x=this.context[s];if(x.token==="function")return x.generator}return!1},us.updateContext=function(s){var x,O=this.type;O.keyword&&s===w.dot?this.exprAllowed=!1:(x=O.updateContext)?x.call(this,s):this.exprAllowed=O.beforeExpr},w.parenR.updateContext=w.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var s=this.context.pop();s===gn.b_stat&&this.curContext().token==="function"&&(s=this.context.pop()),this.exprAllowed=!s.isExpr},w.braceL.updateContext=function(s){this.context.push(this.braceIsBlock(s)?gn.b_stat:gn.b_expr),this.exprAllowed=!0},w.dollarBraceL.updateContext=function(){this.context.push(gn.b_tmpl),this.exprAllowed=!0},w.parenL.updateContext=function(s){var x=s===w._if||s===w._for||s===w._with||s===w._while;this.context.push(x?gn.p_stat:gn.p_expr),this.exprAllowed=!0},w.incDec.updateContext=function(){},w._function.updateContext=w._class.updateContext=function(s){s.beforeExpr&&s!==w.semi&&s!==w._else&&!(s===w._return&&V.test(this.input.slice(this.lastTokEnd,this.start)))&&!((s===w.colon||s===w.braceL)&&this.curContext()===gn.b_stat)?this.context.push(gn.f_expr):this.context.push(gn.f_stat),this.exprAllowed=!1},w.backQuote.updateContext=function(){this.curContext()===gn.q_tmpl?this.context.pop():this.context.push(gn.q_tmpl),this.exprAllowed=!1},w.star.updateContext=function(s){if(s===w._function){var x=this.context.length-1;this.context[x]===gn.f_expr?this.context[x]=gn.f_expr_gen:this.context[x]=gn.f_gen}this.exprAllowed=!0},w.name.updateContext=function(s){var x=!1;this.options.ecmaVersion>=6&&s!==w.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(x=!0),this.exprAllowed=x};var Ro="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ko=Ro+" Extended_Pictographic",Xh=ko,Yh={9:Ro,10:ko,11:Xh},Do="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Mo="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Po=Mo+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",Jh=Po+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",qh={9:Mo,10:Po,11:Jh},zo={};function Xs(s){var x=zo[s]={binary:mt(Yh[s]+" "+Do),nonBinary:{General_Category:mt(Do),Script:mt(qh[s])}};x.nonBinary.Script_Extensions=x.nonBinary.Script,x.nonBinary.gc=x.nonBinary.General_Category,x.nonBinary.sc=x.nonBinary.Script,x.nonBinary.scx=x.nonBinary.Script_Extensions}Xs(9),Xs(10),Xs(11);var st=dn.prototype,zr=function(x){this.parser=x,this.validFlags="gim"+(x.options.ecmaVersion>=6?"uy":"")+(x.options.ecmaVersion>=9?"s":""),this.unicodeProperties=zo[x.options.ecmaVersion>=11?11:x.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};zr.prototype.reset=function(x,O,N){var U=N.indexOf("u")!==-1;this.start=x|0,this.source=O+"",this.flags=N,this.switchU=U&&this.parser.options.ecmaVersion>=6,this.switchN=U&&this.parser.options.ecmaVersion>=9},zr.prototype.raise=function(x){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+x)},zr.prototype.at=function(x){var O=this.source,N=O.length;if(x>=N)return-1;var U=O.charCodeAt(x);if(!this.switchU||U<=55295||U>=57344||x+1>=N)return U;var ce=O.charCodeAt(x+1);return ce>=56320&&ce<=57343?(U<<10)+ce-56613888:U},zr.prototype.nextIndex=function(x){var O=this.source,N=O.length;if(x>=N)return N;var U=O.charCodeAt(x),ce;return!this.switchU||U<=55295||U>=57344||x+1>=N||(ce=O.charCodeAt(x+1))<56320||ce>57343?x+1:x+2},zr.prototype.current=function(){return this.at(this.pos)},zr.prototype.lookahead=function(){return this.at(this.nextIndex(this.pos))},zr.prototype.advance=function(){this.pos=this.nextIndex(this.pos)},zr.prototype.eat=function(x){return this.current()===x?(this.advance(),!0):!1};function ls(s){return s<=65535?String.fromCharCode(s):(s-=65536,String.fromCharCode((s>>10)+55296,(s&1023)+56320))}st.validateRegExpFlags=function(s){for(var x=s.validFlags,O=s.flags,N=0;N<O.length;N++){var U=O.charAt(N);x.indexOf(U)===-1&&this.raise(s.start,"Invalid regular expression flag"),O.indexOf(U,N+1)>-1&&this.raise(s.start,"Duplicate regular expression flag")}},st.validateRegExpPattern=function(s){this.regexp_pattern(s),!s.switchN&&this.options.ecmaVersion>=9&&s.groupNames.length>0&&(s.switchN=!0,this.regexp_pattern(s))},st.regexp_pattern=function(s){s.pos=0,s.lastIntValue=0,s.lastStringValue="",s.lastAssertionIsQuantifiable=!1,s.numCapturingParens=0,s.maxBackReference=0,s.groupNames.length=0,s.backReferenceNames.length=0,this.regexp_disjunction(s),s.pos!==s.source.length&&(s.eat(41)&&s.raise("Unmatched ')'"),(s.eat(93)||s.eat(125))&&s.raise("Lone quantifier brackets")),s.maxBackReference>s.numCapturingParens&&s.raise("Invalid escape");for(var x=0,O=s.backReferenceNames;x<O.length;x+=1){var N=O[x];s.groupNames.indexOf(N)===-1&&s.raise("Invalid named capture referenced")}},st.regexp_disjunction=function(s){for(this.regexp_alternative(s);s.eat(124);)this.regexp_alternative(s);this.regexp_eatQuantifier(s,!0)&&s.raise("Nothing to repeat"),s.eat(123)&&s.raise("Lone quantifier brackets")},st.regexp_alternative=function(s){for(;s.pos<s.source.length&&this.regexp_eatTerm(s););},st.regexp_eatTerm=function(s){return this.regexp_eatAssertion(s)?(s.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(s)&&s.switchU&&s.raise("Invalid quantifier"),!0):(s.switchU?this.regexp_eatAtom(s):this.regexp_eatExtendedAtom(s))?(this.regexp_eatQuantifier(s),!0):!1},st.regexp_eatAssertion=function(s){var x=s.pos;if(s.lastAssertionIsQuantifiable=!1,s.eat(94)||s.eat(36))return!0;if(s.eat(92)){if(s.eat(66)||s.eat(98))return!0;s.pos=x}if(s.eat(40)&&s.eat(63)){var O=!1;if(this.options.ecmaVersion>=9&&(O=s.eat(60)),s.eat(61)||s.eat(33))return this.regexp_disjunction(s),s.eat(41)||s.raise("Unterminated group"),s.lastAssertionIsQuantifiable=!O,!0}return s.pos=x,!1},st.regexp_eatQuantifier=function(s,x){return x===void 0&&(x=!1),this.regexp_eatQuantifierPrefix(s,x)?(s.eat(63),!0):!1},st.regexp_eatQuantifierPrefix=function(s,x){return s.eat(42)||s.eat(43)||s.eat(63)||this.regexp_eatBracedQuantifier(s,x)},st.regexp_eatBracedQuantifier=function(s,x){var O=s.pos;if(s.eat(123)){var N=0,U=-1;if(this.regexp_eatDecimalDigits(s)&&(N=s.lastIntValue,s.eat(44)&&this.regexp_eatDecimalDigits(s)&&(U=s.lastIntValue),s.eat(125)))return U!==-1&&U<N&&!x&&s.raise("numbers out of order in {} quantifier"),!0;s.switchU&&!x&&s.raise("Incomplete quantifier"),s.pos=O}return!1},st.regexp_eatAtom=function(s){return this.regexp_eatPatternCharacters(s)||s.eat(46)||this.regexp_eatReverseSolidusAtomEscape(s)||this.regexp_eatCharacterClass(s)||this.regexp_eatUncapturingGroup(s)||this.regexp_eatCapturingGroup(s)},st.regexp_eatReverseSolidusAtomEscape=function(s){var x=s.pos;if(s.eat(92)){if(this.regexp_eatAtomEscape(s))return!0;s.pos=x}return!1},st.regexp_eatUncapturingGroup=function(s){var x=s.pos;if(s.eat(40)){if(s.eat(63)&&s.eat(58)){if(this.regexp_disjunction(s),s.eat(41))return!0;s.raise("Unterminated group")}s.pos=x}return!1},st.regexp_eatCapturingGroup=function(s){if(s.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(s):s.current()===63&&s.raise("Invalid group"),this.regexp_disjunction(s),s.eat(41))return s.numCapturingParens+=1,!0;s.raise("Unterminated group")}return!1},st.regexp_eatExtendedAtom=function(s){return s.eat(46)||this.regexp_eatReverseSolidusAtomEscape(s)||this.regexp_eatCharacterClass(s)||this.regexp_eatUncapturingGroup(s)||this.regexp_eatCapturingGroup(s)||this.regexp_eatInvalidBracedQuantifier(s)||this.regexp_eatExtendedPatternCharacter(s)},st.regexp_eatInvalidBracedQuantifier=function(s){return this.regexp_eatBracedQuantifier(s,!0)&&s.raise("Nothing to repeat"),!1},st.regexp_eatSyntaxCharacter=function(s){var x=s.current();return No(x)?(s.lastIntValue=x,s.advance(),!0):!1};function No(s){return s===36||s>=40&&s<=43||s===46||s===63||s>=91&&s<=94||s>=123&&s<=125}st.regexp_eatPatternCharacters=function(s){for(var x=s.pos,O=0;(O=s.current())!==-1&&!No(O);)s.advance();return s.pos!==x},st.regexp_eatExtendedPatternCharacter=function(s){var x=s.current();return x!==-1&&x!==36&&!(x>=40&&x<=43)&&x!==46&&x!==63&&x!==91&&x!==94&&x!==124?(s.advance(),!0):!1},st.regexp_groupSpecifier=function(s){if(s.eat(63)){if(this.regexp_eatGroupName(s)){s.groupNames.indexOf(s.lastStringValue)!==-1&&s.raise("Duplicate capture group name"),s.groupNames.push(s.lastStringValue);return}s.raise("Invalid group")}},st.regexp_eatGroupName=function(s){if(s.lastStringValue="",s.eat(60)){if(this.regexp_eatRegExpIdentifierName(s)&&s.eat(62))return!0;s.raise("Invalid capture group name")}return!1},st.regexp_eatRegExpIdentifierName=function(s){if(s.lastStringValue="",this.regexp_eatRegExpIdentifierStart(s)){for(s.lastStringValue+=ls(s.lastIntValue);this.regexp_eatRegExpIdentifierPart(s);)s.lastStringValue+=ls(s.lastIntValue);return!0}return!1},st.regexp_eatRegExpIdentifierStart=function(s){var x=s.pos,O=s.current();return s.advance(),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(s)&&(O=s.lastIntValue),Zh(O)?(s.lastIntValue=O,!0):(s.pos=x,!1)};function Zh(s){return k(s,!0)||s===36||s===95}st.regexp_eatRegExpIdentifierPart=function(s){var x=s.pos,O=s.current();return s.advance(),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(s)&&(O=s.lastIntValue),Qh(O)?(s.lastIntValue=O,!0):(s.pos=x,!1)};function Qh(s){return T(s,!0)||s===36||s===95||s===8204||s===8205}st.regexp_eatAtomEscape=function(s){return this.regexp_eatBackReference(s)||this.regexp_eatCharacterClassEscape(s)||this.regexp_eatCharacterEscape(s)||s.switchN&&this.regexp_eatKGroupName(s)?!0:(s.switchU&&(s.current()===99&&s.raise("Invalid unicode escape"),s.raise("Invalid escape")),!1)},st.regexp_eatBackReference=function(s){var x=s.pos;if(this.regexp_eatDecimalEscape(s)){var O=s.lastIntValue;if(s.switchU)return O>s.maxBackReference&&(s.maxBackReference=O),!0;if(O<=s.numCapturingParens)return!0;s.pos=x}return!1},st.regexp_eatKGroupName=function(s){if(s.eat(107)){if(this.regexp_eatGroupName(s))return s.backReferenceNames.push(s.lastStringValue),!0;s.raise("Invalid named reference")}return!1},st.regexp_eatCharacterEscape=function(s){return this.regexp_eatControlEscape(s)||this.regexp_eatCControlLetter(s)||this.regexp_eatZero(s)||this.regexp_eatHexEscapeSequence(s)||this.regexp_eatRegExpUnicodeEscapeSequence(s)||!s.switchU&&this.regexp_eatLegacyOctalEscapeSequence(s)||this.regexp_eatIdentityEscape(s)},st.regexp_eatCControlLetter=function(s){var x=s.pos;if(s.eat(99)){if(this.regexp_eatControlLetter(s))return!0;s.pos=x}return!1},st.regexp_eatZero=function(s){return s.current()===48&&!cs(s.lookahead())?(s.lastIntValue=0,s.advance(),!0):!1},st.regexp_eatControlEscape=function(s){var x=s.current();return x===116?(s.lastIntValue=9,s.advance(),!0):x===110?(s.lastIntValue=10,s.advance(),!0):x===118?(s.lastIntValue=11,s.advance(),!0):x===102?(s.lastIntValue=12,s.advance(),!0):x===114?(s.lastIntValue=13,s.advance(),!0):!1},st.regexp_eatControlLetter=function(s){var x=s.current();return Fo(x)?(s.lastIntValue=x%32,s.advance(),!0):!1};function Fo(s){return s>=65&&s<=90||s>=97&&s<=122}st.regexp_eatRegExpUnicodeEscapeSequence=function(s){var x=s.pos;if(s.eat(117)){if(this.regexp_eatFixedHexDigits(s,4)){var O=s.lastIntValue;if(s.switchU&&O>=55296&&O<=56319){var N=s.pos;if(s.eat(92)&&s.eat(117)&&this.regexp_eatFixedHexDigits(s,4)){var U=s.lastIntValue;if(U>=56320&&U<=57343)return s.lastIntValue=(O-55296)*1024+(U-56320)+65536,!0}s.pos=N,s.lastIntValue=O}return!0}if(s.switchU&&s.eat(123)&&this.regexp_eatHexDigits(s)&&s.eat(125)&&ed(s.lastIntValue))return!0;s.switchU&&s.raise("Invalid unicode escape"),s.pos=x}return!1};function ed(s){return s>=0&&s<=1114111}st.regexp_eatIdentityEscape=function(s){if(s.switchU)return this.regexp_eatSyntaxCharacter(s)?!0:s.eat(47)?(s.lastIntValue=47,!0):!1;var x=s.current();return x!==99&&(!s.switchN||x!==107)?(s.lastIntValue=x,s.advance(),!0):!1},st.regexp_eatDecimalEscape=function(s){s.lastIntValue=0;var x=s.current();if(x>=49&&x<=57){do s.lastIntValue=10*s.lastIntValue+(x-48),s.advance();while((x=s.current())>=48&&x<=57);return!0}return!1},st.regexp_eatCharacterClassEscape=function(s){var x=s.current();if(td(x))return s.lastIntValue=-1,s.advance(),!0;if(s.switchU&&this.options.ecmaVersion>=9&&(x===80||x===112)){if(s.lastIntValue=-1,s.advance(),s.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(s)&&s.eat(125))return!0;s.raise("Invalid property name")}return!1};function td(s){return s===100||s===68||s===115||s===83||s===119||s===87}st.regexp_eatUnicodePropertyValueExpression=function(s){var x=s.pos;if(this.regexp_eatUnicodePropertyName(s)&&s.eat(61)){var O=s.lastStringValue;if(this.regexp_eatUnicodePropertyValue(s)){var N=s.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(s,O,N),!0}}if(s.pos=x,this.regexp_eatLoneUnicodePropertyNameOrValue(s)){var U=s.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(s,U),!0}return!1},st.regexp_validateUnicodePropertyNameAndValue=function(s,x,O){it(s.unicodeProperties.nonBinary,x)||s.raise("Invalid property name"),s.unicodeProperties.nonBinary[x].test(O)||s.raise("Invalid property value")},st.regexp_validateUnicodePropertyNameOrValue=function(s,x){s.unicodeProperties.binary.test(x)||s.raise("Invalid property name")},st.regexp_eatUnicodePropertyName=function(s){var x=0;for(s.lastStringValue="";Vo(x=s.current());)s.lastStringValue+=ls(x),s.advance();return s.lastStringValue!==""};function Vo(s){return Fo(s)||s===95}st.regexp_eatUnicodePropertyValue=function(s){var x=0;for(s.lastStringValue="";nd(x=s.current());)s.lastStringValue+=ls(x),s.advance();return s.lastStringValue!==""};function nd(s){return Vo(s)||cs(s)}st.regexp_eatLoneUnicodePropertyNameOrValue=function(s){return this.regexp_eatUnicodePropertyValue(s)},st.regexp_eatCharacterClass=function(s){if(s.eat(91)){if(s.eat(94),this.regexp_classRanges(s),s.eat(93))return!0;s.raise("Unterminated character class")}return!1},st.regexp_classRanges=function(s){for(;this.regexp_eatClassAtom(s);){var x=s.lastIntValue;if(s.eat(45)&&this.regexp_eatClassAtom(s)){var O=s.lastIntValue;s.switchU&&(x===-1||O===-1)&&s.raise("Invalid character class"),x!==-1&&O!==-1&&x>O&&s.raise("Range out of order in character class")}}},st.regexp_eatClassAtom=function(s){var x=s.pos;if(s.eat(92)){if(this.regexp_eatClassEscape(s))return!0;if(s.switchU){var O=s.current();(O===99||Bo(O))&&s.raise("Invalid class escape"),s.raise("Invalid escape")}s.pos=x}var N=s.current();return N!==93?(s.lastIntValue=N,s.advance(),!0):!1},st.regexp_eatClassEscape=function(s){var x=s.pos;if(s.eat(98))return s.lastIntValue=8,!0;if(s.switchU&&s.eat(45))return s.lastIntValue=45,!0;if(!s.switchU&&s.eat(99)){if(this.regexp_eatClassControlLetter(s))return!0;s.pos=x}return this.regexp_eatCharacterClassEscape(s)||this.regexp_eatCharacterEscape(s)},st.regexp_eatClassControlLetter=function(s){var x=s.current();return cs(x)||x===95?(s.lastIntValue=x%32,s.advance(),!0):!1},st.regexp_eatHexEscapeSequence=function(s){var x=s.pos;if(s.eat(120)){if(this.regexp_eatFixedHexDigits(s,2))return!0;s.switchU&&s.raise("Invalid escape"),s.pos=x}return!1},st.regexp_eatDecimalDigits=function(s){var x=s.pos,O=0;for(s.lastIntValue=0;cs(O=s.current());)s.lastIntValue=10*s.lastIntValue+(O-48),s.advance();return s.pos!==x};function cs(s){return s>=48&&s<=57}st.regexp_eatHexDigits=function(s){var x=s.pos,O=0;for(s.lastIntValue=0;jo(O=s.current());)s.lastIntValue=16*s.lastIntValue+Ko(O),s.advance();return s.pos!==x};function jo(s){return s>=48&&s<=57||s>=65&&s<=70||s>=97&&s<=102}function Ko(s){return s>=65&&s<=70?10+(s-65):s>=97&&s<=102?10+(s-97):s-48}st.regexp_eatLegacyOctalEscapeSequence=function(s){if(this.regexp_eatOctalDigit(s)){var x=s.lastIntValue;if(this.regexp_eatOctalDigit(s)){var O=s.lastIntValue;x<=3&&this.regexp_eatOctalDigit(s)?s.lastIntValue=x*64+O*8+s.lastIntValue:s.lastIntValue=x*8+O}else s.lastIntValue=x;return!0}return!1},st.regexp_eatOctalDigit=function(s){var x=s.current();return Bo(x)?(s.lastIntValue=x-48,s.advance(),!0):(s.lastIntValue=0,!1)};function Bo(s){return s>=48&&s<=55}st.regexp_eatFixedHexDigits=function(s,x){var O=s.pos;s.lastIntValue=0;for(var N=0;N<x;++N){var U=s.current();if(!jo(U))return s.pos=O,!1;s.lastIntValue=16*s.lastIntValue+Ko(U),s.advance()}return!0};var hs=function(x){this.type=x.type,this.value=x.value,this.start=x.start,this.end=x.end,x.options.locations&&(this.loc=new Rt(x,x.startLoc,x.endLoc)),x.options.ranges&&(this.range=[x.start,x.end])},Nt=dn.prototype;Nt.next=function(s){!s&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new hs(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Nt.getToken=function(){return this.next(),new hs(this)},typeof Symbol<"u"&&(Nt[Symbol.iterator]=function(){var s=this;return{next:function(){var x=s.getToken();return{done:x.type===w.eof,value:x}}}}),Nt.curContext=function(){return this.context[this.context.length-1]},Nt.nextToken=function(){var s=this.curContext();if((!s||!s.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(w.eof);if(s.override)return s.override(this);this.readToken(this.fullCharCodeAtPos())},Nt.readToken=function(s){return k(s,this.options.ecmaVersion>=6)||s===92?this.readWord():this.getTokenFromCode(s)},Nt.fullCharCodeAtPos=function(){var s=this.input.charCodeAt(this.pos);if(s<=55295||s>=57344)return s;var x=this.input.charCodeAt(this.pos+1);return(s<<10)+x-56613888},Nt.skipBlockComment=function(){var s=this.options.onComment&&this.curPosition(),x=this.pos,O=this.input.indexOf("*/",this.pos+=2);if(O===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=O+2,this.options.locations){K.lastIndex=x;for(var N;(N=K.exec(this.input))&&N.index<this.pos;)++this.curLine,this.lineStart=N.index+N[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(x+2,O),x,this.pos,s,this.curPosition())},Nt.skipLineComment=function(s){for(var x=this.pos,O=this.options.onComment&&this.curPosition(),N=this.input.charCodeAt(this.pos+=s);this.pos<this.input.length&&!fe(N);)N=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(x+s,this.pos),x,this.pos,O,this.curPosition())},Nt.skipSpace=function(){e:for(;this.pos<this.input.length;){var s=this.input.charCodeAt(this.pos);switch(s){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(s>8&&s<14||s>=5760&&ee.test(String.fromCharCode(s)))++this.pos;else break e}}},Nt.finishToken=function(s,x){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var O=this.type;this.type=s,this.value=x,this.updateContext(O)},Nt.readToken_dot=function(){var s=this.input.charCodeAt(this.pos+1);if(s>=48&&s<=57)return this.readNumber(!0);var x=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&s===46&&x===46?(this.pos+=3,this.finishToken(w.ellipsis)):(++this.pos,this.finishToken(w.dot))},Nt.readToken_slash=function(){var s=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):s===61?this.finishOp(w.assign,2):this.finishOp(w.slash,1)},Nt.readToken_mult_modulo_exp=function(s){var x=this.input.charCodeAt(this.pos+1),O=1,N=s===42?w.star:w.modulo;return this.options.ecmaVersion>=7&&s===42&&x===42&&(++O,N=w.starstar,x=this.input.charCodeAt(this.pos+2)),x===61?this.finishOp(w.assign,O+1):this.finishOp(N,O)},Nt.readToken_pipe_amp=function(s){var x=this.input.charCodeAt(this.pos+1);return x===s?this.finishOp(s===124?w.logicalOR:w.logicalAND,2):x===61?this.finishOp(w.assign,2):this.finishOp(s===124?w.bitwiseOR:w.bitwiseAND,1)},Nt.readToken_caret=function(){var s=this.input.charCodeAt(this.pos+1);return s===61?this.finishOp(w.assign,2):this.finishOp(w.bitwiseXOR,1)},Nt.readToken_plus_min=function(s){var x=this.input.charCodeAt(this.pos+1);return x===s?x===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||V.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(w.incDec,2):x===61?this.finishOp(w.assign,2):this.finishOp(w.plusMin,1)},Nt.readToken_lt_gt=function(s){var x=this.input.charCodeAt(this.pos+1),O=1;return x===s?(O=s===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+O)===61?this.finishOp(w.assign,O+1):this.finishOp(w.bitShift,O)):x===33&&s===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(x===61&&(O=2),this.finishOp(w.relational,O))},Nt.readToken_eq_excl=function(s){var x=this.input.charCodeAt(this.pos+1);return x===61?this.finishOp(w.equality,this.input.charCodeAt(this.pos+2)===61?3:2):s===61&&x===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(w.arrow)):this.finishOp(s===61?w.eq:w.prefix,1)},Nt.getTokenFromCode=function(s){switch(s){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(w.parenL);case 41:return++this.pos,this.finishToken(w.parenR);case 59:return++this.pos,this.finishToken(w.semi);case 44:return++this.pos,this.finishToken(w.comma);case 91:return++this.pos,this.finishToken(w.bracketL);case 93:return++this.pos,this.finishToken(w.bracketR);case 123:return++this.pos,this.finishToken(w.braceL);case 125:return++this.pos,this.finishToken(w.braceR);case 58:return++this.pos,this.finishToken(w.colon);case 63:return++this.pos,this.finishToken(w.question);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(w.backQuote);case 48:var x=this.input.charCodeAt(this.pos+1);if(x===120||x===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(x===111||x===79)return this.readRadixNumber(8);if(x===98||x===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(s);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(s);case 124:case 38:return this.readToken_pipe_amp(s);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(s);case 60:case 62:return this.readToken_lt_gt(s);case 61:case 33:return this.readToken_eq_excl(s);case 126:return this.finishOp(w.prefix,1)}this.raise(this.pos,"Unexpected character '"+Ys(s)+"'")},Nt.finishOp=function(s,x){var O=this.input.slice(this.pos,this.pos+x);return this.pos+=x,this.finishToken(s,O)},Nt.readRegexp=function(){for(var s,x,O=this.pos;;){this.pos>=this.input.length&&this.raise(O,"Unterminated regular expression");var N=this.input.charAt(this.pos);if(V.test(N)&&this.raise(O,"Unterminated regular expression"),s)s=!1;else{if(N==="[")x=!0;else if(N==="]"&&x)x=!1;else if(N==="/"&&!x)break;s=N==="\\"}++this.pos}var U=this.input.slice(O,this.pos);++this.pos;var ce=this.pos,Te=this.readWord1();this.containsEsc&&this.unexpected(ce);var je=this.regexpState||(this.regexpState=new zr(this));je.reset(O,U,Te),this.validateRegExpFlags(je),this.validateRegExpPattern(je);var gt=null;try{gt=new RegExp(U,Te)}catch{}return this.finishToken(w.regexp,{pattern:U,flags:Te,value:gt})},Nt.readInt=function(s,x){for(var O=this.pos,N=0,U=0,ce=x??1/0;U<ce;++U){var Te=this.input.charCodeAt(this.pos),je=void 0;if(Te>=97?je=Te-97+10:Te>=65?je=Te-65+10:Te>=48&&Te<=57?je=Te-48:je=1/0,je>=s)break;++this.pos,N=N*s+je}return this.pos===O||x!=null&&this.pos-O!==x?null:N},Nt.readRadixNumber=function(s){var x=this.pos;this.pos+=2;var O=this.readInt(s);return O==null&&this.raise(this.start+2,"Expected number in radix "+s),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(O=typeof BigInt<"u"?BigInt(this.input.slice(x,this.pos)):null,++this.pos):k(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(w.num,O)},Nt.readNumber=function(s){var x=this.pos;!s&&this.readInt(10)===null&&this.raise(x,"Invalid number");var O=this.pos-x>=2&&this.input.charCodeAt(x)===48;O&&this.strict&&this.raise(x,"Invalid number");var N=this.input.charCodeAt(this.pos);if(!O&&!s&&this.options.ecmaVersion>=11&&N===110){var U=this.input.slice(x,this.pos),ce=typeof BigInt<"u"?BigInt(U):null;return++this.pos,k(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(w.num,ce)}O&&/[89]/.test(this.input.slice(x,this.pos))&&(O=!1),N===46&&!O&&(++this.pos,this.readInt(10),N=this.input.charCodeAt(this.pos)),(N===69||N===101)&&!O&&(N=this.input.charCodeAt(++this.pos),(N===43||N===45)&&++this.pos,this.readInt(10)===null&&this.raise(x,"Invalid number")),k(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var Te=this.input.slice(x,this.pos),je=O?parseInt(Te,8):parseFloat(Te);return this.finishToken(w.num,je)},Nt.readCodePoint=function(){var s=this.input.charCodeAt(this.pos),x;if(s===123){this.options.ecmaVersion<6&&this.unexpected();var O=++this.pos;x=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,x>1114111&&this.invalidStringToken(O,"Code point out of bounds")}else x=this.readHexChar(4);return x};function Ys(s){return s<=65535?String.fromCharCode(s):(s-=65536,String.fromCharCode((s>>10)+55296,(s&1023)+56320))}Nt.readString=function(s){for(var x="",O=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var N=this.input.charCodeAt(this.pos);if(N===s)break;N===92?(x+=this.input.slice(O,this.pos),x+=this.readEscapedChar(!1),O=this.pos):(fe(N,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return x+=this.input.slice(O,this.pos++),this.finishToken(w.string,x)};var Go={};Nt.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(s){if(s===Go)this.readInvalidTemplateToken();else throw s}this.inTemplateElement=!1},Nt.invalidStringToken=function(s,x){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Go;this.raise(s,x)},Nt.readTmplToken=function(){for(var s="",x=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var O=this.input.charCodeAt(this.pos);if(O===96||O===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===w.template||this.type===w.invalidTemplate)?O===36?(this.pos+=2,this.finishToken(w.dollarBraceL)):(++this.pos,this.finishToken(w.backQuote)):(s+=this.input.slice(x,this.pos),this.finishToken(w.template,s));if(O===92)s+=this.input.slice(x,this.pos),s+=this.readEscapedChar(!0),x=this.pos;else if(fe(O)){switch(s+=this.input.slice(x,this.pos),++this.pos,O){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:s+=`
`;break;default:s+=String.fromCharCode(O);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),x=this.pos}else++this.pos}},Nt.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(w.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Nt.readEscapedChar=function(s){var x=this.input.charCodeAt(++this.pos);switch(++this.pos,x){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Ys(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(s){var O=this.pos-1;return this.invalidStringToken(O,"Invalid escape sequence in template string"),null}default:if(x>=48&&x<=55){var N=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],U=parseInt(N,8);return U>255&&(N=N.slice(0,-1),U=parseInt(N,8)),this.pos+=N.length-1,x=this.input.charCodeAt(this.pos),(N!=="0"||x===56||x===57)&&(this.strict||s)&&this.invalidStringToken(this.pos-1-N.length,s?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(U)}return fe(x)?"":String.fromCharCode(x)}},Nt.readHexChar=function(s){var x=this.pos,O=this.readInt(16,s);return O===null&&this.invalidStringToken(x,"Bad character escape sequence"),O},Nt.readWord1=function(){this.containsEsc=!1;for(var s="",x=!0,O=this.pos,N=this.options.ecmaVersion>=6;this.pos<this.input.length;){var U=this.fullCharCodeAtPos();if(T(U,N))this.pos+=U<=65535?1:2;else if(U===92){this.containsEsc=!0,s+=this.input.slice(O,this.pos);var ce=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var Te=this.readCodePoint();(x?k:T)(Te,N)||this.invalidStringToken(ce,"Invalid Unicode escape"),s+=Ys(Te),O=this.pos}else break;x=!1}return s+this.input.slice(O,this.pos)},Nt.readWord=function(){var s=this.readWord1(),x=w.name;return this.keywords.test(s)&&(x=he[s]),this.finishToken(x,s)};var Uo="7.1.0";dn.acorn={Parser:dn,version:Uo,defaultOptions:ct,Position:bt,SourceLocation:Rt,getLineInfo:lt,Node:as,TokenType:L,tokTypes:w,keywordTypes:he,TokContext:hr,tokContexts:gn,isIdentifierChar:T,isIdentifierStart:k,Token:hs,isNewLine:fe,lineBreak:V,lineBreakG:K,nonASCIIwhitespace:ee};function rd(s,x){return dn.parse(s,x)}function id(s,x,O){return dn.parseExpressionAt(s,x,O)}function sd(s,x){return dn.tokenizer(s,x)}d.Node=as,d.Parser=dn,d.Position=bt,d.SourceLocation=Rt,d.TokContext=hr,d.Token=hs,d.TokenType=L,d.defaultOptions=ct,d.getLineInfo=lt,d.isIdentifierChar=T,d.isIdentifierStart=k,d.isNewLine=fe,d.keywordTypes=he,d.lineBreak=V,d.lineBreakG=K,d.nonASCIIwhitespace=ee,d.parse=rd,d.parseExpressionAt=id,d.tokContexts=gn,d.tokTypes=w,d.tokenizer=sd,d.version=Uo,Object.defineProperty(d,"__esModule",{value:!0})})},{}],2:[function(n,i,p){},{}],3:[function(n,i,p){function d(h,a={}){const{contextName:o="gl",throwGetError:S,useTrackablePrimitives:_,readPixelsFile:P,recording:I=[],variables:k={},onReadPixels:T,onUnrecognizedArgumentLookup:L}=a,D=new Proxy(h,{get:V}),z=[],re={};let he=0,$="",w;return D;function V(lt,ct){switch(ct){case"addComment":return it;case"checkThrowError":return Pe;case"getReadPixelsVariableName":return w;case"insertVariable":return ee;case"reset":return fe;case"setIndent":return _e;case"toString":return K;case"getContextVariableName":return Rt}return typeof h[ct]=="function"?function(){switch(ct){case"getError":return S?I.push(`${$}if (${o}.getError() !== ${o}.NONE) throw new Error('error');`):I.push(`${$}${o}.getError();`),h.getError();case"getExtension":{const Zt=`${o}Variables${z.length}`;I.push(`${$}const ${Zt} = ${o}.getExtension('${arguments[0]}');`);const ln=h.getExtension(arguments[0]);if(ln&&typeof ln=="object"){const Gn=y(ln,{getEntity:ue,useTrackablePrimitives:_,recording:I,contextName:Zt,contextVariables:z,variables:k,indent:$,onUnrecognizedArgumentLookup:L});return z.push(Gn),Gn}else z.push(null);return ln}case"readPixels":const Dt=z.indexOf(arguments[6]);let Tn;if(Dt===-1){const Zt=bt(arguments[6]);Zt?(Tn=Zt,I.push(`${$}${Zt}`)):(Tn=`${o}Variable${z.length}`,z.push(arguments[6]),I.push(`${$}const ${Tn} = new ${arguments[6].constructor.name}(${arguments[6].length});`))}else Tn=`${o}Variable${Dt}`;w=Tn;const _t=[arguments[0],arguments[1],arguments[2],arguments[3],ue(arguments[4]),ue(arguments[5]),Tn];return I.push(`${$}${o}.readPixels(${_t.join(", ")});`),P&&ft(arguments[2],arguments[3]),T&&T(Tn,_t),h.readPixels.apply(h,arguments);case"drawBuffers":return I.push(`${$}${o}.drawBuffers([${v(arguments[0],{contextName:o,contextVariables:z,getEntity:ue,addVariable:Re,variables:k,onUnrecognizedArgumentLookup:L})}]);`),h.drawBuffers(arguments[0])}let Ye=h[ct].apply(h,arguments);switch(typeof Ye){case"undefined":I.push(`${$}${mt(ct,arguments)};`);return;case"number":case"boolean":if(_&&z.indexOf(l(Ye))===-1){I.push(`${$}const ${o}Variable${z.length} = ${mt(ct,arguments)};`),z.push(Ye=l(Ye));break}default:Ye===null?I.push(`${mt(ct,arguments)};`):I.push(`${$}const ${o}Variable${z.length} = ${mt(ct,arguments)};`),z.push(Ye)}return Ye}:(re[h[ct]]=ct,h[ct])}function K(){return I.join(`
`)}function fe(){for(;I.length>0;)I.pop()}function ee(lt,ct){k[lt]=ct}function ue(lt){const ct=re[lt];return ct?o+"."+ct:lt}function _e(lt){$=" ".repeat(lt)}function Re(lt,ct){const Ye=`${o}Variable${z.length}`;return I.push(`${$}const ${Ye} = ${ct};`),z.push(lt),Ye}function ft(lt,ct){const Ye=`${o}Variable${z.length}`,Dt=`imageDatum${he}`;I.push(`${$}let ${Dt} = ["P3\\n# ${P}.ppm\\n", ${lt}, ' ', ${ct}, "\\n255\\n"].join("");`),I.push(`${$}for (let i = 0; i < ${Dt}.length; i += 4) {`),I.push(`${$}  ${Dt} += ${Ye}[i] + ' ' + ${Ye}[i + 1] + ' ' + ${Ye}[i + 2] + ' ';`),I.push(`${$}}`),I.push(`${$}if (typeof require !== "undefined") {`),I.push(`${$}  require('fs').writeFileSync('./${P}.ppm', ${Dt});`),I.push(`${$}}`),he++}function it(lt){I.push(`${$}// ${lt}`)}function Pe(){I.push(`${$}(() => {
${$}const error = ${o}.getError();
${$}if (error !== ${o}.NONE) {
${$}  const names = Object.getOwnPropertyNames(gl);
${$}  for (let i = 0; i < names.length; i++) {
${$}    const name = names[i];
${$}    if (${o}[name] === error) {
${$}      throw new Error('${o} threw ' + name);
${$}    }
${$}  }
${$}}
${$}})();`)}function mt(lt,ct){return`${o}.${lt}(${v(ct,{contextName:o,contextVariables:z,getEntity:ue,addVariable:Re,variables:k,onUnrecognizedArgumentLookup:L})})`}function bt(lt){if(k){for(const ct in k)if(k[ct]===lt)return ct}return null}function Rt(lt){const ct=z.indexOf(lt);return ct!==-1?`${o}Variable${ct}`:null}}function y(h,a){const o=new Proxy(h,{get:re}),S={},{contextName:_,contextVariables:P,getEntity:I,useTrackablePrimitives:k,recording:T,variables:L,indent:D,onUnrecognizedArgumentLookup:z}=a;return o;function re(V,K){return typeof V[K]=="function"?function(){switch(K){case"drawBuffersWEBGL":return T.push(`${D}${_}.drawBuffersWEBGL([${v(arguments[0],{contextName:_,contextVariables:P,getEntity:he,addVariable:w,variables:L,onUnrecognizedArgumentLookup:z})}]);`),h.drawBuffersWEBGL(arguments[0])}let fe=h[K].apply(h,arguments);switch(typeof fe){case"undefined":T.push(`${D}${$(K,arguments)};`);return;case"number":case"boolean":k&&P.indexOf(l(fe))===-1?(T.push(`${D}const ${_}Variable${P.length} = ${$(K,arguments)};`),P.push(fe=l(fe))):(T.push(`${D}const ${_}Variable${P.length} = ${$(K,arguments)};`),P.push(fe));break;default:fe===null?T.push(`${$(K,arguments)};`):T.push(`${D}const ${_}Variable${P.length} = ${$(K,arguments)};`),P.push(fe)}return fe}:(S[h[K]]=K,h[K])}function he(V){return S.hasOwnProperty(V)?`${_}.${S[V]}`:I(V)}function $(V,K){return`${_}.${V}(${v(K,{contextName:_,contextVariables:P,getEntity:he,addVariable:w,variables:L,onUnrecognizedArgumentLookup:z})})`}function w(V,K){const fe=`${_}Variable${P.length}`;return P.push(V),T.push(`${D}const ${fe} = ${K};`),fe}}function v(h,a){const{variables:o,onUnrecognizedArgumentLookup:S}=a;return Array.from(h).map(P=>{const I=_(P);return I||m(P,a)}).join(", ");function _(P){if(o){for(const I in o)if(o.hasOwnProperty(I)&&o[I]===P)return I}return S?S(P):null}}function m(h,a){const{contextName:o,contextVariables:S,getEntity:_,addVariable:P,onUnrecognizedArgumentLookup:I}=a;if(typeof h>"u")return"undefined";if(h===null)return"null";const k=S.indexOf(h);if(k>-1)return`${o}Variable${k}`;switch(h.constructor.name){case"String":const T=/\n/.test(h),L=/'/.test(h),D=/"/.test(h);return T?"`"+h+"`":L&&!D?'"'+h+'"':"'"+h+"'";case"Number":return _(h);case"Boolean":return _(h);case"Array":return P(h,`new ${h.constructor.name}([${Array.from(h).join(",")}])`);case"Float32Array":case"Uint8Array":case"Uint16Array":case"Int32Array":return P(h,`new ${h.constructor.name}(${JSON.stringify(Array.from(h))})`);default:if(I){const z=I(h);if(z)return z}throw new Error(`unrecognized argument type ${h.constructor.name}`)}}function l(h){return new h.constructor(h)}typeof i<"u"&&(i.exports={glWiretap:d,glExtensionWiretap:y}),typeof window<"u"&&(d.glExtensionWiretap=y,window.glWiretap=d)},{}],4:[function(n,i,p){function d(P){const I=new Array(P.length);for(let k=0;k<P.length;k++){const T=P[k];T.toArray?I[k]=T.toArray():I[k]=T}return I}function y(){const P=d(arguments),I=new Float32Array(this.output.x);for(let k=0;k<this.output.x;k++)this.thread.x=k,this.thread.y=0,this.thread.z=0,I[k]=this._fn.apply(this,P);return I}function v(){const P=d(arguments),I=new Array(this.output.y);for(let k=0;k<this.output.y;k++){const T=new Float32Array(this.output.x);for(let L=0;L<this.output.x;L++)this.thread.x=L,this.thread.y=k,this.thread.z=0,T[L]=this._fn.apply(this,P);I[k]=T}return I}function m(){const P=d(arguments);for(let I=0;I<this.output.y;I++)for(let k=0;k<this.output.x;k++)this.thread.x=k,this.thread.y=I,this.thread.z=0,this._fn.apply(this,P)}function l(){const P=d(arguments),I=new Array(this.output.z);for(let k=0;k<this.output.z;k++){const T=new Array(this.output.y);for(let L=0;L<this.output.y;L++){const D=new Float32Array(this.output.x);for(let z=0;z<this.output.x;z++)this.thread.x=z,this.thread.y=L,this.thread.z=k,D[z]=this._fn.apply(this,P);T[L]=D}I[k]=T}return I}function h(P){P.setOutput=T=>{P.output=o(T),P.graphical&&a(P)},P.toJSON=()=>{throw new Error("Not usable with gpuMock")},P.setConstants=T=>(P.constants=T,P),P.setGraphical=T=>(P.graphical=T,P),P.setCanvas=T=>(P.canvas=T,P),P.setContext=T=>(P.context=T,P),P.destroy=()=>{},P.validateSettings=()=>{},P.graphical&&P.output&&a(P),P.exec=function(){return new Promise((T,L)=>{try{T(P.apply(P,arguments))}catch(D){L(D)}})},P.getPixels=T=>{const{x:L,y:D}=P.output;return T?_(P._imageData.data,L,D):P._imageData.data.slice(0)},P.color=function(T,L,D,z){typeof z>"u"&&(z=1),T=Math.floor(T*255),L=Math.floor(L*255),D=Math.floor(D*255),z=Math.floor(z*255);const re=P.output.x,he=P.output.y,$=P.thread.x,w=he-P.thread.y-1,V=$+w*re;P._colorData[V*4+0]=T,P._colorData[V*4+1]=L,P._colorData[V*4+2]=D,P._colorData[V*4+3]=z};const I=()=>P,k=["setWarnVarUsage","setArgumentTypes","setTactic","setOptimizeFloatMemory","setDebug","setLoopMaxIterations","setConstantTypes","setFunctions","setNativeFunctions","setInjectedNative","setPipeline","setPrecision","setOutputToTexture","setImmutable","setStrictIntegers","setDynamicOutput","setHardcodeConstants","setDynamicArguments","setUseLegacyEncoder","setWarnVarUsage","addSubKernel"];for(let T=0;T<k.length;T++)P[k[T]]=I;return P}function a(P){const{x:I,y:k}=P.output;if(P.context&&P.context.createImageData){const T=new Uint8ClampedArray(I*k*4);P._imageData=P.context.createImageData(I,k),P._colorData=T}else{const T=new Uint8ClampedArray(I*k*4);P._imageData={data:T},P._colorData=T}}function o(P){let I=null;if(P.length)if(P.length===3){const[k,T,L]=P;I={x:k,y:T,z:L}}else if(P.length===2){const[k,T]=P;I={x:k,y:T}}else{const[k]=P;I={x:k}}else I=P;return I}function S(P,I={}){const k=I.output?o(I.output):null;function T(){return T.output.z?l.apply(T,arguments):T.output.y?T.graphical?m.apply(T,arguments):v.apply(T,arguments):y.apply(T,arguments)}return T._fn=P,T.constants=I.constants||null,T.context=I.context||null,T.canvas=I.canvas||null,T.graphical=I.graphical||!1,T._imageData=null,T._colorData=null,T.output=k,T.thread={x:0,y:0,z:0},h(T)}function _(P,I,k){const T=k/2|0,L=I*4,D=new Uint8ClampedArray(I*4),z=P.slice(0);for(let re=0;re<T;++re){const he=re*L,$=(k-re-1)*L;D.set(z.subarray(he,he+L)),z.copyWithin(he,$,$+L),z.set(D,$)}return z}i.exports={gpuMock:S}},{}],5:[function(n,i,p){const{utils:d}=n("./utils");function y(v,m){const l=m.toString();return new Function(`return function ${v} (${d.getArgumentNamesFromString(l).join(", ")}) {
  ${d.getFunctionBodyFromString(l)}
}`)()}i.exports={alias:y}},{"./utils":114}],6:[function(n,i,p){const{FunctionNode:d}=n("../function-node");class y extends d{astFunction(m,l){if(!this.isRootKernel){l.push("function"),l.push(" "),l.push(this.name),l.push("(");for(let h=0;h<this.argumentNames.length;++h){const a=this.argumentNames[h];h>0&&l.push(", "),l.push("user_"),l.push(a)}l.push(`) {
`)}for(let h=0;h<m.body.body.length;++h)this.astGeneric(m.body.body[h],l),l.push(`
`);return this.isRootKernel||l.push(`}
`),l}astReturnStatement(m,l){const h=this.returnType||this.getType(m.argument);return this.returnType||(this.returnType=h),this.isRootKernel?(l.push(this.leadingReturnStatement),this.astGeneric(m.argument,l),l.push(`;
`),l.push(this.followingReturnStatement),l.push(`continue;
`)):this.isSubKernel?(l.push(`subKernelResult_${this.name} = `),this.astGeneric(m.argument,l),l.push(";"),l.push(`return subKernelResult_${this.name};`)):(l.push("return "),this.astGeneric(m.argument,l),l.push(";")),l}astLiteral(m,l){if(isNaN(m.value))throw this.astErrorOutput("Non-numeric literal not supported : "+m.value,m);return l.push(m.value),l}astBinaryExpression(m,l){return l.push("("),this.astGeneric(m.left,l),l.push(m.operator),this.astGeneric(m.right,l),l.push(")"),l}astIdentifierExpression(m,l){if(m.type!=="Identifier")throw this.astErrorOutput("IdentifierExpression - not an Identifier",m);switch(m.name){case"Infinity":l.push("Infinity");break;default:this.constants&&this.constants.hasOwnProperty(m.name)?l.push("constants_"+m.name):l.push("user_"+m.name)}return l}astForStatement(m,l){if(m.type!=="ForStatement")throw this.astErrorOutput("Invalid for statement",m);const h=[],a=[],o=[],S=[];let _=null;if(m.init){this.pushState("in-for-loop-init"),this.astGeneric(m.init,h);for(let P=0;P<h.length;P++)h[P].includes&&h[P].includes(",")&&(_=!1);this.popState("in-for-loop-init")}else _=!1;if(m.test?this.astGeneric(m.test,a):_=!1,m.update?this.astGeneric(m.update,o):_=!1,m.body&&(this.pushState("loop-body"),this.astGeneric(m.body,S),this.popState("loop-body")),_===null&&(_=this.isSafe(m.init)&&this.isSafe(m.test)),_)l.push(`for (${h.join("")};${a.join("")};${o.join("")}){
`),l.push(S.join("")),l.push(`}
`);else{const P=this.getInternalVariableName("safeI");h.length>0&&l.push(h.join(""),`;
`),l.push(`for (let ${P}=0;${P}<LOOP_MAX;${P}++){
`),a.length>0&&l.push(`if (!${a.join("")}) break;
`),l.push(S.join("")),l.push(`
${o.join("")};`),l.push(`}
`)}return l}astWhileStatement(m,l){if(m.type!=="WhileStatement")throw this.astErrorOutput("Invalid while statement",m);return l.push("for (let i = 0; i < LOOP_MAX; i++) {"),l.push("if ("),this.astGeneric(m.test,l),l.push(`) {
`),this.astGeneric(m.body,l),l.push(`} else {
`),l.push(`break;
`),l.push(`}
`),l.push(`}
`),l}astDoWhileStatement(m,l){if(m.type!=="DoWhileStatement")throw this.astErrorOutput("Invalid while statement",m);return l.push("for (let i = 0; i < LOOP_MAX; i++) {"),this.astGeneric(m.body,l),l.push("if (!"),this.astGeneric(m.test,l),l.push(`) {
`),l.push(`break;
`),l.push(`}
`),l.push(`}
`),l}astAssignmentExpression(m,l){const h=this.getDeclaration(m.left);if(h&&!h.assignable)throw this.astErrorOutput(`Variable ${m.left.name} is not assignable here`,m);return this.astGeneric(m.left,l),l.push(m.operator),this.astGeneric(m.right,l),l}astBlockStatement(m,l){if(this.isState("loop-body")){this.pushState("block-body");for(let h=0;h<m.body.length;h++)this.astGeneric(m.body[h],l);this.popState("block-body")}else{l.push(`{
`);for(let h=0;h<m.body.length;h++)this.astGeneric(m.body[h],l);l.push(`}
`)}return l}astVariableDeclaration(m,l){l.push(`${m.kind} `);const{declarations:h}=m;for(let a=0;a<h.length;a++){a>0&&l.push(",");const o=h[a],S=this.getDeclaration(o.id);S.valueType||(S.valueType=this.getType(o.init)),this.astGeneric(o,l)}return this.isState("in-for-loop-init")||l.push(";"),l}astIfStatement(m,l){return l.push("if ("),this.astGeneric(m.test,l),l.push(")"),m.consequent.type==="BlockStatement"?this.astGeneric(m.consequent,l):(l.push(` {
`),this.astGeneric(m.consequent,l),l.push(`
}
`)),m.alternate&&(l.push("else "),m.alternate.type==="BlockStatement"||m.alternate.type==="IfStatement"?this.astGeneric(m.alternate,l):(l.push(` {
`),this.astGeneric(m.alternate,l),l.push(`
}
`))),l}astSwitchStatement(m,l){const{discriminant:h,cases:a}=m;l.push("switch ("),this.astGeneric(h,l),l.push(`) {
`);for(let o=0;o<a.length;o++){if(a[o].test===null){l.push(`default:
`),this.astGeneric(a[o].consequent,l),a[o].consequent&&a[o].consequent.length>0&&l.push(`break;
`);continue}l.push("case "),this.astGeneric(a[o].test,l),l.push(`:
`),a[o].consequent&&a[o].consequent.length>0&&(this.astGeneric(a[o].consequent,l),l.push(`break;
`))}l.push(`
}`)}astThisExpression(m,l){return l.push("_this"),l}astMemberExpression(m,l){const{signature:h,type:a,property:o,xProperty:S,yProperty:_,zProperty:P,name:I,origin:k}=this.getMemberExpressionDetails(m);switch(h){case"this.thread.value":return l.push(`_this.thread.${I}`),l;case"this.output.value":switch(I){case"x":l.push("outputX");break;case"y":l.push("outputY");break;case"z":l.push("outputZ");break;default:throw this.astErrorOutput("Unexpected expression",m)}return l;case"value":throw this.astErrorOutput("Unexpected expression",m);case"value[]":case"value[][]":case"value[][][]":case"value.value":if(k==="Math")return l.push(Math[I]),l;switch(o){case"r":return l.push(`user_${I}[0]`),l;case"g":return l.push(`user_${I}[1]`),l;case"b":return l.push(`user_${I}[2]`),l;case"a":return l.push(`user_${I}[3]`),l}break;case"this.constants.value":case"this.constants.value[]":case"this.constants.value[][]":case"this.constants.value[][][]":break;case"fn()[]":return this.astGeneric(m.object,l),l.push("["),this.astGeneric(m.property,l),l.push("]"),l;case"fn()[][]":return this.astGeneric(m.object.object,l),l.push("["),this.astGeneric(m.object.property,l),l.push("]"),l.push("["),this.astGeneric(m.property,l),l.push("]"),l;default:throw this.astErrorOutput("Unexpected expression",m)}if(!m.computed)switch(a){case"Number":case"Integer":case"Float":case"Boolean":return l.push(`${k}_${I}`),l}const T=`${k}_${I}`;switch(a){case"Array(2)":case"Array(3)":case"Array(4)":case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":case"HTMLImageArray":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":case"HTMLImage":default:let L,D;if(k==="constants"){const z=this.constants[I];D=this.constantTypes[I]==="Input",L=D?z.size:null}else D=this.isInput(I),L=D?this.argumentSizes[this.argumentNames.indexOf(I)]:null;l.push(`${T}`),P&&_?D?(l.push("[("),this.astGeneric(P,l),l.push(`*${this.dynamicArguments?"(outputY * outputX)":L[1]*L[0]})+(`),this.astGeneric(_,l),l.push(`*${this.dynamicArguments?"outputX":L[0]})+`),this.astGeneric(S,l),l.push("]")):(l.push("["),this.astGeneric(P,l),l.push("]"),l.push("["),this.astGeneric(_,l),l.push("]"),l.push("["),this.astGeneric(S,l),l.push("]")):_?D?(l.push("[("),this.astGeneric(_,l),l.push(`*${this.dynamicArguments?"outputX":L[0]})+`),this.astGeneric(S,l),l.push("]")):(l.push("["),this.astGeneric(_,l),l.push("]"),l.push("["),this.astGeneric(S,l),l.push("]")):typeof S<"u"&&(l.push("["),this.astGeneric(S,l),l.push("]"))}return l}astCallExpression(m,l){if(m.type!=="CallExpression")throw this.astErrorOutput("Unknown CallExpression",m);let h=this.astMemberExpressionUnroll(m.callee);this.calledFunctions.indexOf(h)<0&&this.calledFunctions.push(h),this.isAstMathFunction(m),this.onFunctionCall&&this.onFunctionCall(this.name,h,m.arguments),l.push(h),l.push("(");const a=this.lookupFunctionArgumentTypes(h)||[];for(let o=0;o<m.arguments.length;++o){const S=m.arguments[o];let _=this.getType(S);a[o]||this.triggerImplyArgumentType(h,o,_,this),o>0&&l.push(", "),this.astGeneric(S,l)}return l.push(")"),l}astArrayExpression(m,l){const h=this.getType(m),a=m.elements.length,o=[];for(let S=0;S<a;++S){const _=[];this.astGeneric(m.elements[S],_),o.push(_.join(""))}switch(h){case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":l.push(`[${o.join(", ")}]`);break;default:l.push(`new Float32Array([${o.join(", ")}])`)}return l}astDebuggerStatement(m,l){return l.push("debugger;"),l}}i.exports={CPUFunctionNode:y}},{"../function-node":10}],7:[function(n,i,p){const{utils:d}=n("../../utils");function y(m,l){const h=[];for(const a in l){if(!l.hasOwnProperty(a))continue;const o=l[a],S=m[a];switch(o){case"Number":case"Integer":case"Float":case"Boolean":h.push(`${a}:${S}`);break;case"Array(2)":case"Array(3)":case"Array(4)":case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":h.push(`${a}:new ${S.constructor.name}(${JSON.stringify(Array.from(S))})`);break}}return`{ ${h.join()} }`}function v(m,l){const h=[],a=[],o=[],S=!/^function/.test(m.color.toString());if(h.push("  const { context, canvas, constants: incomingConstants } = settings;",`  const output = new Int32Array(${JSON.stringify(Array.from(m.output))});`,`  const _constantTypes = ${JSON.stringify(m.constantTypes)};`,`  const _constants = ${y(m.constants,m.constantTypes)};`),a.push("    constants: _constants,","    context,","    output,","    thread: {x: 0, y: 0, z: 0},"),m.graphical){h.push(`  const _imageData = context.createImageData(${m.output[0]}, ${m.output[1]});`),h.push(`  const _colorData = new Uint8ClampedArray(${m.output[0]} * ${m.output[1]} * 4);`);const I=d.flattenFunctionToString((S?"function ":"")+m.color.toString(),{thisLookup:T=>{switch(T){case"_colorData":return"_colorData";case"_imageData":return"_imageData";case"output":return"output";case"thread":return"this.thread"}return JSON.stringify(m[T])},findDependency:(T,L)=>null}),k=d.flattenFunctionToString((S?"function ":"")+m.getPixels.toString(),{thisLookup:T=>{switch(T){case"_colorData":return"_colorData";case"_imageData":return"_imageData";case"output":return"output";case"thread":return"this.thread"}return JSON.stringify(m[T])},findDependency:()=>null});a.push("    _imageData,","    _colorData,",`    color: ${I},`),o.push(`  kernel.getPixels = ${k};`)}const _=[],P=Object.keys(m.constantTypes);for(let I=0;I<P.length;I++)_.push(m.constantTypes[P]);if(m.argumentTypes.indexOf("HTMLImageArray")!==-1||_.indexOf("HTMLImageArray")!==-1){const I=d.flattenFunctionToString((S?"function ":"")+m._imageTo3DArray.toString(),{doNotDefine:["canvas"],findDependency:(k,T)=>k==="this"?(S?"function ":"")+m[T].toString():null,thisLookup:k=>{switch(k){case"canvas":return;case"context":return"context"}}});o.push(I),a.push("    _mediaTo2DArray,"),a.push("    _imageTo3DArray,")}else if(m.argumentTypes.indexOf("HTMLImage")!==-1||_.indexOf("HTMLImage")!==-1){const I=d.flattenFunctionToString((S?"function ":"")+m._mediaTo2DArray.toString(),{findDependency:(k,T)=>null,thisLookup:k=>{switch(k){case"canvas":return"settings.canvas";case"context":return"settings.context"}throw new Error("unhandled thisLookup")}});o.push(I),a.push("    _mediaTo2DArray,")}return`function(settings) {
${h.join(`
`)}
  for (const p in _constantTypes) {
    if (!_constantTypes.hasOwnProperty(p)) continue;
    const type = _constantTypes[p];
    switch (type) {
      case 'Number':
      case 'Integer':
      case 'Float':
      case 'Boolean':
      case 'Array(2)':
      case 'Array(3)':
      case 'Array(4)':
      case 'Matrix(2)':
      case 'Matrix(3)':
      case 'Matrix(4)':
        if (incomingConstants.hasOwnProperty(p)) {
          console.warn('constant ' + p + ' of type ' + type + ' cannot be resigned');
        }
        continue;
    }
    if (!incomingConstants.hasOwnProperty(p)) {
      throw new Error('constant ' + p + ' not found');
    }
    _constants[p] = incomingConstants[p];
  }
  const kernel = (function() {
${m._kernelString}
  })
    .apply({ ${a.join(`
`)} });
  ${o.join(`
`)}
  return kernel;
}`}i.exports={cpuKernelString:v}},{"../../utils":114}],8:[function(n,i,p){const{Kernel:d}=n("../kernel"),{FunctionBuilder:y}=n("../function-builder"),{CPUFunctionNode:v}=n("./function-node"),{utils:m}=n("../../utils"),{cpuKernelString:l}=n("./kernel-string");class h extends d{static getFeatures(){return this.features}static get features(){return Object.freeze({kernelMap:!0,isIntegerDivisionAccurate:!0})}static get isSupported(){return!0}static isContextMatch(o){return!1}static get mode(){return"cpu"}static nativeFunctionArguments(){return null}static nativeFunctionReturnType(){throw new Error(`Looking up native function return type not supported on ${this.name}`)}static combineKernels(o){return o}static getSignature(o,S){return"cpu"+(S.length>0?":"+S.join(","):"")}constructor(o,S){super(o,S),this.mergeSettings(o.settings||S),this._imageData=null,this._colorData=null,this._kernelString=null,this._prependedString=[],this.thread={x:0,y:0,z:0},this.translatedSources=null}initCanvas(){if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(0,0)}initContext(){return this.canvas?this.canvas.getContext("2d"):null}initPlugins(o){return[]}validateSettings(o){if(!this.output||this.output.length===0){if(o.length!==1)throw new Error("Auto output only supported for kernels with only one input");const S=m.getVariableType(o[0],this.strictIntegers);if(S==="Array")this.output=m.getDimensions(S);else if(S==="NumberTexture"||S==="ArrayTexture(4)")this.output=o[0].output;else throw new Error("Auto output not supported for input type: "+S)}if(this.graphical&&this.output.length!==2)throw new Error("Output must have 2 dimensions on graphical mode");this.checkOutput()}translateSource(){if(this.leadingReturnStatement=this.output.length>1?"resultX[x] = ":"result[x] = ",this.subKernels){const S=[];for(let _=0;_<this.subKernels.length;_++){const{name:P}=this.subKernels[_];S.push(this.output.length>1?`resultX_${P}[x] = subKernelResult_${P};
`:`result_${P}[x] = subKernelResult_${P};
`)}this.followingReturnStatement=S.join("")}const o=y.fromKernel(this,v);this.translatedSources=o.getPrototypes("kernel"),!this.graphical&&!this.returnType&&(this.returnType=o.getKernelResultType())}build(){if(this.built)return;if(this.setupConstants(),this.setupArguments(arguments),this.validateSettings(arguments),this.translateSource(),this.graphical){const{canvas:S,output:_}=this;if(!S)throw new Error("no canvas available for using graphical output");const P=_[0],I=_[1]||1;S.width=P,S.height=I,this._imageData=this.context.createImageData(P,I),this._colorData=new Uint8ClampedArray(P*I*4)}const o=this.getKernelString();this.kernelString=o,this.debug&&(console.log("Function output:"),console.log(o));try{this.run=new Function([],o).bind(this)()}catch(S){console.error("An error occurred compiling the javascript: ",S)}this.buildSignature(arguments),this.built=!0}color(o,S,_,P){typeof P>"u"&&(P=1),o=Math.floor(o*255),S=Math.floor(S*255),_=Math.floor(_*255),P=Math.floor(P*255);const I=this.output[0],k=this.output[1],T=this.thread.x,L=k-this.thread.y-1,D=T+L*I;this._colorData[D*4+0]=o,this._colorData[D*4+1]=S,this._colorData[D*4+2]=_,this._colorData[D*4+3]=P}getKernelString(){if(this._kernelString!==null)return this._kernelString;let o=null,{translatedSources:S}=this;return S.length>1?S=S.filter(_=>/^function/.test(_)?_:(o=_,!1)):o=S.shift(),this._kernelString=`  const LOOP_MAX = ${this._getLoopMaxString()};
  ${this.injectedNative||""}
  const _this = this;
  ${this._resultKernelHeader()}
  ${this._processConstants()}
  return (${this.argumentNames.map(_=>"user_"+_).join(", ")}) => {
    ${this._prependedString.join("")}
    ${this._earlyThrows()}
    ${this._processArguments()}
    ${this.graphical?this._graphicalKernelBody(o):this._resultKernelBody(o)}
    ${S.length>0?S.join(`
`):""}
  };`}toString(){return l(this)}_getLoopMaxString(){return this.loopMaxIterations?` ${parseInt(this.loopMaxIterations)};`:" 1000;"}_processConstants(){if(!this.constants)return"";const o=[];for(let S in this.constants)switch(this.constantTypes[S]){case"HTMLCanvas":case"OffscreenCanvas":case"HTMLImage":case"ImageBitmap":case"ImageData":case"HTMLVideo":o.push(`    const constants_${S} = this._mediaTo2DArray(this.constants.${S});
`);break;case"HTMLImageArray":o.push(`    const constants_${S} = this._imageTo3DArray(this.constants.${S});
`);break;case"Input":o.push(`    const constants_${S} = this.constants.${S}.value;
`);break;default:o.push(`    const constants_${S} = this.constants.${S};
`)}return o.join("")}_earlyThrows(){if(this.graphical||this.immutable||!this.pipeline)return"";const o=[];for(let _=0;_<this.argumentTypes.length;_++)this.argumentTypes[_]==="Array"&&o.push(this.argumentNames[_]);if(o.length===0)return"";const S=[];for(let _=0;_<o.length;_++){const P=o[_],I=this._mapSubKernels(k=>`user_${P} === result_${k.name}`).join(" || ");S.push(`user_${P} === result${I?` || ${I}`:""}`)}return`if (${S.join(" || ")}) throw new Error('Source and destination arrays are the same.  Use immutable = true');`}_processArguments(){const o=[];for(let S=0;S<this.argumentTypes.length;S++){const _=`user_${this.argumentNames[S]}`;switch(this.argumentTypes[S]){case"HTMLCanvas":case"OffscreenCanvas":case"HTMLImage":case"ImageBitmap":case"ImageData":case"HTMLVideo":o.push(`    ${_} = this._mediaTo2DArray(${_});
`);break;case"HTMLImageArray":o.push(`    ${_} = this._imageTo3DArray(${_});
`);break;case"Input":o.push(`    ${_} = ${_}.value;
`);break;case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":case"NumberTexture":case"MemoryOptimizedNumberTexture":o.push(`
    if (${_}.toArray) {
      if (!_this.textureCache) {
        _this.textureCache = [];
        _this.arrayCache = [];
      }
      const textureIndex = _this.textureCache.indexOf(${_});
      if (textureIndex !== -1) {
        ${_} = _this.arrayCache[textureIndex];
      } else {
        _this.textureCache.push(${_});
        ${_} = ${_}.toArray();
        _this.arrayCache.push(${_});
      }
    }`);break}}return o.join("")}_mediaTo2DArray(o){const S=this.canvas,_=o.width>0?o.width:o.videoWidth,P=o.height>0?o.height:o.videoHeight;S.width<_&&(S.width=_),S.height<P&&(S.height=P);const I=this.context;let k;o.constructor===ImageData?k=o.data:(I.drawImage(o,0,0,_,P),k=I.getImageData(0,0,_,P).data);const T=new Array(P);let L=0;for(let D=P-1;D>=0;D--){const z=T[D]=new Array(_);for(let re=0;re<_;re++){const he=new Float32Array(4);he[0]=k[L++]/255,he[1]=k[L++]/255,he[2]=k[L++]/255,he[3]=k[L++]/255,z[re]=he}}return T}getPixels(o){const[S,_]=this.output;return o?m.flipPixels(this._imageData.data,S,_):this._imageData.data.slice(0)}_imageTo3DArray(o){const S=new Array(o.length);for(let _=0;_<o.length;_++)S[_]=this._mediaTo2DArray(o[_]);return S}_resultKernelHeader(){if(this.graphical||this.immutable||!this.pipeline)return"";switch(this.output.length){case 1:return this._mutableKernel1DResults();case 2:return this._mutableKernel2DResults();case 3:return this._mutableKernel3DResults()}}_resultKernelBody(o){switch(this.output.length){case 1:return(!this.immutable&&this.pipeline?this._resultMutableKernel1DLoop(o):this._resultImmutableKernel1DLoop(o))+this._kernelOutput();case 2:return(!this.immutable&&this.pipeline?this._resultMutableKernel2DLoop(o):this._resultImmutableKernel2DLoop(o))+this._kernelOutput();case 3:return(!this.immutable&&this.pipeline?this._resultMutableKernel3DLoop(o):this._resultImmutableKernel3DLoop(o))+this._kernelOutput();default:throw new Error("unsupported size kernel")}}_graphicalKernelBody(o){switch(this.output.length){case 2:return this._graphicalKernel2DLoop(o)+this._graphicalOutput();default:throw new Error("unsupported size kernel")}}_graphicalOutput(){return`
    this._imageData.data.set(this._colorData);
    this.context.putImageData(this._imageData, 0, 0);
    return;`}_getKernelResultTypeConstructorString(){switch(this.returnType){case"LiteralInteger":case"Number":case"Integer":case"Float":return"Float32Array";case"Array(2)":case"Array(3)":case"Array(4)":return"Array";default:if(this.graphical)return"Float32Array";throw new Error(`unhandled returnType ${this.returnType}`)}}_resultImmutableKernel1DLoop(o){const S=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];
    const result = new ${S}(outputX);
    ${this._mapSubKernels(_=>`const result_${_.name} = new ${S}(outputX);
`).join("    ")}
    ${this._mapSubKernels(_=>`let subKernelResult_${_.name};
`).join("    ")}
    for (let x = 0; x < outputX; x++) {
      this.thread.x = x;
      this.thread.y = 0;
      this.thread.z = 0;
      ${o}
    }`}_mutableKernel1DResults(){const o=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];
    const result = new ${o}(outputX);
    ${this._mapSubKernels(S=>`const result_${S.name} = new ${o}(outputX);
`).join("    ")}
    ${this._mapSubKernels(S=>`let subKernelResult_${S.name};
`).join("    ")}`}_resultMutableKernel1DLoop(o){return`  const outputX = _this.output[0];
    for (let x = 0; x < outputX; x++) {
      this.thread.x = x;
      this.thread.y = 0;
      this.thread.z = 0;
      ${o}
    }`}_resultImmutableKernel2DLoop(o){const S=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];
    const outputY = _this.output[1];
    const result = new Array(outputY);
    ${this._mapSubKernels(_=>`const result_${_.name} = new Array(outputY);
`).join("    ")}
    ${this._mapSubKernels(_=>`let subKernelResult_${_.name};
`).join("    ")}
    for (let y = 0; y < outputY; y++) {
      this.thread.z = 0;
      this.thread.y = y;
      const resultX = result[y] = new ${S}(outputX);
      ${this._mapSubKernels(_=>`const resultX_${_.name} = result_${_.name}[y] = new ${S}(outputX);
`).join("")}
      for (let x = 0; x < outputX; x++) {
        this.thread.x = x;
        ${o}
      }
    }`}_mutableKernel2DResults(){const o=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];
    const outputY = _this.output[1];
    const result = new Array(outputY);
    ${this._mapSubKernels(S=>`const result_${S.name} = new Array(outputY);
`).join("    ")}
    ${this._mapSubKernels(S=>`let subKernelResult_${S.name};
`).join("    ")}
    for (let y = 0; y < outputY; y++) {
      const resultX = result[y] = new ${o}(outputX);
      ${this._mapSubKernels(S=>`const resultX_${S.name} = result_${S.name}[y] = new ${o}(outputX);
`).join("")}
    }`}_resultMutableKernel2DLoop(o){const S=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];
    const outputY = _this.output[1];
    for (let y = 0; y < outputY; y++) {
      this.thread.z = 0;
      this.thread.y = y;
      const resultX = result[y];
      ${this._mapSubKernels(_=>`const resultX_${_.name} = result_${_.name}[y] = new ${S}(outputX);
`).join("")}
      for (let x = 0; x < outputX; x++) {
        this.thread.x = x;
        ${o}
      }
    }`}_graphicalKernel2DLoop(o){return`  const outputX = _this.output[0];
    const outputY = _this.output[1];
    for (let y = 0; y < outputY; y++) {
      this.thread.z = 0;
      this.thread.y = y;
      for (let x = 0; x < outputX; x++) {
        this.thread.x = x;
        ${o}
      }
    }`}_resultImmutableKernel3DLoop(o){const S=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];
    const outputY = _this.output[1];
    const outputZ = _this.output[2];
    const result = new Array(outputZ);
    ${this._mapSubKernels(_=>`const result_${_.name} = new Array(outputZ);
`).join("    ")}
    ${this._mapSubKernels(_=>`let subKernelResult_${_.name};
`).join("    ")}
    for (let z = 0; z < outputZ; z++) {
      this.thread.z = z;
      const resultY = result[z] = new Array(outputY);
      ${this._mapSubKernels(_=>`const resultY_${_.name} = result_${_.name}[z] = new Array(outputY);
`).join("      ")}
      for (let y = 0; y < outputY; y++) {
        this.thread.y = y;
        const resultX = resultY[y] = new ${S}(outputX);
        ${this._mapSubKernels(_=>`const resultX_${_.name} = resultY_${_.name}[y] = new ${S}(outputX);
`).join("        ")}
        for (let x = 0; x < outputX; x++) {
          this.thread.x = x;
          ${o}
        }
      }
    }`}_mutableKernel3DResults(){const o=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];
    const outputY = _this.output[1];
    const outputZ = _this.output[2];
    const result = new Array(outputZ);
    ${this._mapSubKernels(S=>`const result_${S.name} = new Array(outputZ);
`).join("    ")}
    ${this._mapSubKernels(S=>`let subKernelResult_${S.name};
`).join("    ")}
    for (let z = 0; z < outputZ; z++) {
      const resultY = result[z] = new Array(outputY);
      ${this._mapSubKernels(S=>`const resultY_${S.name} = result_${S.name}[z] = new Array(outputY);
`).join("      ")}
      for (let y = 0; y < outputY; y++) {
        const resultX = resultY[y] = new ${o}(outputX);
        ${this._mapSubKernels(S=>`const resultX_${S.name} = resultY_${S.name}[y] = new ${o}(outputX);
`).join("        ")}
      }
    }`}_resultMutableKernel3DLoop(o){return`  const outputX = _this.output[0];
    const outputY = _this.output[1];
    const outputZ = _this.output[2];
    for (let z = 0; z < outputZ; z++) {
      this.thread.z = z;
      const resultY = result[z];
      for (let y = 0; y < outputY; y++) {
        this.thread.y = y;
        const resultX = resultY[y];
        for (let x = 0; x < outputX; x++) {
          this.thread.x = x;
          ${o}
        }
      }
    }`}_kernelOutput(){return this.subKernels?`
    return {
      result: result,
      ${this.subKernels.map(o=>`${o.property}: result_${o.name}`).join(`,
      `)}
    };`:`
    return result;`}_mapSubKernels(o){return this.subKernels===null?[""]:this.subKernels.map(o)}destroy(o){o&&delete this.canvas}static destroyContext(o){}toJSON(){const o=super.toJSON();return o.functionNodes=y.fromKernel(this,v).toJSON(),o}setOutput(o){super.setOutput(o);const[S,_]=this.output;this.graphical&&(this._imageData=this.context.createImageData(S,_),this._colorData=new Uint8ClampedArray(S*_*4))}prependString(o){if(this._kernelString)throw new Error("Kernel already built");this._prependedString.push(o)}hasPrependString(o){return this._prependedString.indexOf(o)>-1}}i.exports={CPUKernel:h}},{"../../utils":114,"../function-builder":9,"../kernel":36,"./function-node":6,"./kernel-string":7}],9:[function(n,i,p){class d{static fromKernel(v,m,l){const{kernelArguments:h,kernelConstants:a,argumentNames:o,argumentSizes:S,argumentBitRatios:_,constants:P,constantBitRatios:I,debug:k,loopMaxIterations:T,nativeFunctions:L,output:D,optimizeFloatMemory:z,precision:re,plugins:he,source:$,subKernels:w,functions:V,leadingReturnStatement:K,followingReturnStatement:fe,dynamicArguments:ee,dynamicOutput:ue}=v,_e=new Array(h.length),Re={};for(let St=0;St<h.length;St++)_e[St]=h[St].type;for(let St=0;St<a.length;St++){const nn=a[St];Re[nn.name]=nn.type}const ft=(St,nn)=>Vn.needsArgumentType(St,nn),it=(St,nn,En)=>{Vn.assignArgumentType(St,nn,En)},Pe=(St,nn,En)=>Vn.lookupReturnType(St,nn,En),mt=St=>Vn.lookupFunctionArgumentTypes(St),bt=(St,nn)=>Vn.lookupFunctionArgumentName(St,nn),Rt=(St,nn)=>Vn.lookupFunctionArgumentBitRatio(St,nn),lt=(St,nn,En,tr)=>{Vn.assignArgumentType(St,nn,En,tr)},ct=(St,nn,En,tr)=>{Vn.assignArgumentBitRatio(St,nn,En,tr)},Ye=(St,nn,En)=>{Vn.trackFunctionCall(St,nn,En)},Dt=(St,nn)=>{const En=[];for(let Dr=0;Dr<St.params.length;Dr++)En.push(St.params[Dr].name);const tr=new m(nn,Object.assign({},Tn,{returnType:null,ast:St,name:St.id.name,argumentNames:En,lookupReturnType:Pe,lookupFunctionArgumentTypes:mt,lookupFunctionArgumentName:bt,lookupFunctionArgumentBitRatio:Rt,needsArgumentType:ft,assignArgumentType:it,triggerImplyArgumentType:lt,triggerImplyArgumentBitRatio:ct,onFunctionCall:Ye}));tr.traceFunctionAST(St),Vn.addFunctionNode(tr)},Tn=Object.assign({isRootKernel:!1,onNestedFunction:Dt,lookupReturnType:Pe,lookupFunctionArgumentTypes:mt,lookupFunctionArgumentName:bt,lookupFunctionArgumentBitRatio:Rt,needsArgumentType:ft,assignArgumentType:it,triggerImplyArgumentType:lt,triggerImplyArgumentBitRatio:ct,onFunctionCall:Ye,optimizeFloatMemory:z,precision:re,constants:P,constantTypes:Re,constantBitRatios:I,debug:k,loopMaxIterations:T,output:D,plugins:he,dynamicArguments:ee,dynamicOutput:ue},l||{}),_t=Object.assign({},Tn,{isRootKernel:!0,name:"kernel",argumentNames:o,argumentTypes:_e,argumentSizes:S,argumentBitRatios:_,leadingReturnStatement:K,followingReturnStatement:fe});if(typeof $=="object"&&$.functionNodes)return new d().fromJSON($.functionNodes,m);const Zt=new m($,_t);let ln=null;V&&(ln=V.map(St=>new m(St.source,{returnType:St.returnType,argumentTypes:St.argumentTypes,output:D,plugins:he,constants:P,constantTypes:Re,constantBitRatios:I,optimizeFloatMemory:z,precision:re,lookupReturnType:Pe,lookupFunctionArgumentTypes:mt,lookupFunctionArgumentName:bt,lookupFunctionArgumentBitRatio:Rt,needsArgumentType:ft,assignArgumentType:it,triggerImplyArgumentType:lt,triggerImplyArgumentBitRatio:ct,onFunctionCall:Ye,onNestedFunction:Dt})));let Gn=null;w&&(Gn=w.map(St=>{const{name:nn,source:En}=St;return new m(En,Object.assign({},Tn,{name:nn,isSubKernel:!0,isRootKernel:!1}))}));const Vn=new d({kernel:v,rootNode:Zt,functionNodes:ln,nativeFunctions:L,subKernelNodes:Gn});return Vn}constructor(v){if(v=v||{},this.kernel=v.kernel,this.rootNode=v.rootNode,this.functionNodes=v.functionNodes||[],this.subKernelNodes=v.subKernelNodes||[],this.nativeFunctions=v.nativeFunctions||[],this.functionMap={},this.nativeFunctionNames=[],this.lookupChain=[],this.functionNodeDependencies={},this.functionCalls={},this.rootNode&&(this.functionMap.kernel=this.rootNode),this.functionNodes)for(let m=0;m<this.functionNodes.length;m++)this.functionMap[this.functionNodes[m].name]=this.functionNodes[m];if(this.subKernelNodes)for(let m=0;m<this.subKernelNodes.length;m++)this.functionMap[this.subKernelNodes[m].name]=this.subKernelNodes[m];if(this.nativeFunctions)for(let m=0;m<this.nativeFunctions.length;m++){const l=this.nativeFunctions[m];this.nativeFunctionNames.push(l.name)}}addFunctionNode(v){if(!v.name)throw new Error("functionNode.name needs set");this.functionMap[v.name]=v,v.isRootKernel&&(this.rootNode=v)}traceFunctionCalls(v,m){if(v=v||"kernel",m=m||[],this.nativeFunctionNames.indexOf(v)>-1){const h=m.indexOf(v);if(h===-1)m.push(v);else{const a=m.splice(h,1)[0];m.push(a)}return m}const l=this.functionMap[v];if(l){const h=m.indexOf(v);if(h===-1){m.push(v),l.toString();for(let a=0;a<l.calledFunctions.length;++a)this.traceFunctionCalls(l.calledFunctions[a],m)}else{const a=m.splice(h,1)[0];m.push(a)}}return m}getPrototypeString(v){return this.getPrototypes(v).join(`
`)}getPrototypes(v){return this.rootNode&&this.rootNode.toString(),v?this.getPrototypesFromFunctionNames(this.traceFunctionCalls(v,[]).reverse()):this.getPrototypesFromFunctionNames(Object.keys(this.functionMap))}getStringFromFunctionNames(v){const m=[];for(let l=0;l<v.length;++l)this.functionMap[v[l]]&&m.push(this.functionMap[v[l]].toString());return m.join(`
`)}getPrototypesFromFunctionNames(v){const m=[];for(let l=0;l<v.length;++l){const h=v[l],a=this.nativeFunctionNames.indexOf(h);if(a>-1){m.push(this.nativeFunctions[a].source);continue}const o=this.functionMap[h];o&&m.push(o.toString())}return m}toJSON(){return this.traceFunctionCalls(this.rootNode.name).reverse().map(v=>{const m=this.nativeFunctions.indexOf(v);if(m>-1)return{name:v,source:this.nativeFunctions[m].source};if(this.functionMap[v])return this.functionMap[v].toJSON();throw new Error(`function ${v} not found`)})}fromJSON(v,m){this.functionMap={};for(let l=0;l<v.length;l++){const h=v[l];this.functionMap[h.settings.name]=new m(h.ast,h.settings)}return this}getString(v){return v?this.getStringFromFunctionNames(this.traceFunctionCalls(v).reverse()):this.getStringFromFunctionNames(Object.keys(this.functionMap))}lookupReturnType(v,m,l){if(m.type!=="CallExpression")throw new Error(`expected ast type of "CallExpression", but is ${m.type}`);if(this._isNativeFunction(v))return this._lookupNativeFunctionReturnType(v);if(this._isFunction(v)){const h=this._getFunction(v);if(h.returnType)return h.returnType;{for(let o=0;o<this.lookupChain.length;o++)if(this.lookupChain[o].ast===m){if(h.argumentTypes.length===0&&m.arguments.length>0){const S=m.arguments;for(let _=0;_<S.length;_++)this.lookupChain.push({name:l.name,ast:S[o],requestingNode:l}),h.argumentTypes[_]=l.getType(S[_]),this.lookupChain.pop();return h.returnType=h.getType(h.getJsAST())}throw new Error("circlical logic detected!")}this.lookupChain.push({name:l.name,ast:m,requestingNode:l});const a=h.getType(h.getJsAST());return this.lookupChain.pop(),h.returnType=a}}return null}_getFunction(v){return this._isFunction(v),this.functionMap[v]}_isFunction(v){return!!this.functionMap[v]}_getNativeFunction(v){for(let m=0;m<this.nativeFunctions.length;m++)if(this.nativeFunctions[m].name===v)return this.nativeFunctions[m];return null}_isNativeFunction(v){return!!this._getNativeFunction(v)}_lookupNativeFunctionReturnType(v){let m=this._getNativeFunction(v);if(m)return m.returnType;throw new Error(`Native function ${v} not found`)}lookupFunctionArgumentTypes(v){return this._isNativeFunction(v)?this._getNativeFunction(v).argumentTypes:this._isFunction(v)?this._getFunction(v).argumentTypes:null}lookupFunctionArgumentName(v,m){return this._getFunction(v).argumentNames[m]}lookupFunctionArgumentBitRatio(v,m){if(!this._isFunction(v))throw new Error("function not found");if(this.rootNode.name===v){const o=this.rootNode.argumentNames.indexOf(m);if(o!==-1)return this.rootNode.argumentBitRatios[o]}const l=this._getFunction(v),h=l.argumentNames.indexOf(m);if(h===-1)throw new Error("argument not found");const a=l.argumentBitRatios[h];if(typeof a!="number")throw new Error("argument bit ratio not found");return a}needsArgumentType(v,m){return this._isFunction(v)?!this._getFunction(v).argumentTypes[m]:!1}assignArgumentType(v,m,l,h){if(!this._isFunction(v))return;const a=this._getFunction(v);a.argumentTypes[m]||(a.argumentTypes[m]=l)}assignArgumentBitRatio(v,m,l,h){const a=this._getFunction(v);if(this._isNativeFunction(l))return null;const o=this._getFunction(l),S=a.argumentNames.indexOf(m);if(S===-1)throw new Error(`Argument ${m} not found in arguments from function ${v}`);const _=a.argumentBitRatios[S];if(typeof _!="number")throw new Error(`Bit ratio for argument ${m} not found in function ${v}`);o.argumentBitRatios||(o.argumentBitRatios=new Array(o.argumentNames.length));const P=o.argumentBitRatios[S];if(typeof P=="number"){if(P!==_)throw new Error(`Incompatible bit ratio found at function ${v} at argument ${m}`);return P}return o.argumentBitRatios[S]=_,_}trackFunctionCall(v,m,l){this.functionNodeDependencies[v]||(this.functionNodeDependencies[v]=new Set,this.functionCalls[v]=[]),this.functionNodeDependencies[v].add(m),this.functionCalls[v].push(l)}getKernelResultType(){return this.rootNode.returnType||this.rootNode.getType(this.rootNode.ast)}getSubKernelResultType(v){const m=this.subKernelNodes[v];let l=!1;for(let h=0;h<this.rootNode.functionCalls.length;h++)this.rootNode.functionCalls[h].ast.callee.name===m.name&&(l=!0);if(!l)throw new Error(`SubKernel ${m.name} never called by kernel`);return m.returnType||m.getType(m.getJsAST())}getReturnTypes(){const v={[this.rootNode.name]:this.rootNode.getType(this.rootNode.ast)},m=this.traceFunctionCalls(this.rootNode.name);for(let l=0;l<m.length;l++){const h=m[l],a=this.functionMap[h];v[h]=a.getType(a.ast)}return v}}i.exports={FunctionBuilder:d}},{}],10:[function(n,i,p){const d=n("acorn"),{utils:y}=n("../utils"),{FunctionTracer:v}=n("./function-tracer");class m{constructor(a,o){if(!a&&!o.ast)throw new Error("source parameter is missing");if(o=o||{},this.source=a,this.ast=null,this.name=typeof a=="string"?o.isRootKernel?"kernel":o.name||y.getFunctionNameFromString(a):null,this.calledFunctions=[],this.constants={},this.constantTypes={},this.constantBitRatios={},this.isRootKernel=!1,this.isSubKernel=!1,this.debug=null,this.functions=null,this.identifiers=null,this.contexts=null,this.functionCalls=null,this.states=[],this.needsArgumentType=null,this.assignArgumentType=null,this.lookupReturnType=null,this.lookupFunctionArgumentTypes=null,this.lookupFunctionArgumentBitRatio=null,this.triggerImplyArgumentType=null,this.triggerImplyArgumentBitRatio=null,this.onNestedFunction=null,this.onFunctionCall=null,this.optimizeFloatMemory=null,this.precision=null,this.loopMaxIterations=null,this.argumentNames=typeof this.source=="string"?y.getArgumentNamesFromString(this.source):null,this.argumentTypes=[],this.argumentSizes=[],this.argumentBitRatios=null,this.returnType=null,this.output=[],this.plugins=null,this.leadingReturnStatement=null,this.followingReturnStatement=null,this.dynamicOutput=null,this.dynamicArguments=null,this.strictTypingChecking=!1,this.fixIntegerDivisionAccuracy=null,o)for(const S in o)o.hasOwnProperty(S)&&this.hasOwnProperty(S)&&(this[S]=o[S]);this.literalTypes={},this.validate(),this._string=null,this._internalVariableNames={}}validate(){if(typeof this.source!="string"&&!this.ast)throw new Error("this.source not a string");if(!this.ast&&!y.isFunctionString(this.source))throw new Error("this.source not a function string");if(!this.name)throw new Error("this.name could not be set");if(this.argumentTypes.length>0&&this.argumentTypes.length!==this.argumentNames.length)throw new Error(`argumentTypes count of ${this.argumentTypes.length} exceeds ${this.argumentNames.length}`);if(this.output.length<1)throw new Error("this.output is not big enough")}isIdentifierConstant(a){return this.constants?this.constants.hasOwnProperty(a):!1}isInput(a){return this.argumentTypes[this.argumentNames.indexOf(a)]==="Input"}pushState(a){this.states.push(a)}popState(a){if(this.state!==a)throw new Error(`Cannot popState ${a} when in ${this.state}`);this.states.pop()}isState(a){return this.state===a}get state(){return this.states[this.states.length-1]}astMemberExpressionUnroll(a){if(a.type==="Identifier")return a.name;if(a.type==="ThisExpression")return"this";if(a.type==="MemberExpression"&&a.object&&a.property)return a.object.hasOwnProperty("name")&&a.object.name!=="Math"?this.astMemberExpressionUnroll(a.property):this.astMemberExpressionUnroll(a.object)+"."+this.astMemberExpressionUnroll(a.property);if(a.hasOwnProperty("expressions")){const o=a.expressions[0];if(o.type==="Literal"&&o.value===0&&a.expressions.length===2)return this.astMemberExpressionUnroll(a.expressions[1])}throw this.astErrorOutput("Unknown astMemberExpressionUnroll",a)}getJsAST(a){if(this.ast)return this.ast;if(typeof this.source=="object")return this.traceFunctionAST(this.source),this.ast=this.source;if(a=a||d,a===null)throw new Error("Missing JS to AST parser");const o=Object.freeze(a.parse(`const parser_${this.name} = ${this.source};`,{locations:!0})),S=o.body[0].declarations[0].init;if(this.traceFunctionAST(S),!o)throw new Error("Failed to parse JS code");return this.ast=S}traceFunctionAST(a){const{contexts:o,declarations:S,functions:_,identifiers:P,functionCalls:I}=new v(a);this.contexts=o,this.identifiers=P,this.functionCalls=I,this.functions=_;for(let k=0;k<S.length;k++){const T=S[k],{ast:L,inForLoopInit:D,inForLoopTest:z}=T,{init:re}=L,he=this.getDependencies(re);let $=null;if(D&&z)$="Integer";else if(re){const w=this.getType(re);switch(w){case"Integer":case"Float":case"Number":re.type==="MemberExpression"?$=w:$="Number";break;case"LiteralInteger":$="Number";break;default:$=w}}T.valueType=$,T.dependencies=he,T.isSafe=this.isSafeDependencies(he)}for(let k=0;k<_.length;k++)this.onNestedFunction(_[k],this.source)}getDeclaration(a){for(let o=0;o<this.identifiers.length;o++){const S=this.identifiers[o];if(a===S.ast)return S.declaration}return null}getVariableType(a){if(a.type!=="Identifier")throw new Error(`ast of ${a.type} not "Identifier"`);let o=null;const S=this.argumentNames.indexOf(a.name);if(S===-1){const _=this.getDeclaration(a);if(_)return _.valueType}else{const _=this.argumentTypes[S];_&&(o=_)}if(!o&&this.strictTypingChecking)throw new Error(`Declaration of ${name} not found`);return o}getLookupType(a){if(!l.hasOwnProperty(a))throw new Error(`unknown typeLookupMap ${a}`);return l[a]}getConstantType(a){if(this.constantTypes[a]){const o=this.constantTypes[a];return o==="Float"?"Number":o}throw new Error(`Type for constant "${a}" not declared`)}toString(){return this._string?this._string:this._string=this.astGeneric(this.getJsAST(),[]).join("").trim()}toJSON(){const a={source:this.source,name:this.name,constants:this.constants,constantTypes:this.constantTypes,isRootKernel:this.isRootKernel,isSubKernel:this.isSubKernel,debug:this.debug,output:this.output,loopMaxIterations:this.loopMaxIterations,argumentNames:this.argumentNames,argumentTypes:this.argumentTypes,argumentSizes:this.argumentSizes,returnType:this.returnType,leadingReturnStatement:this.leadingReturnStatement,followingReturnStatement:this.followingReturnStatement};return{ast:this.ast,settings:a}}getType(a){if(Array.isArray(a))return this.getType(a[a.length-1]);switch(a.type){case"BlockStatement":return this.getType(a.body);case"ArrayExpression":switch(this.getType(a.elements[0])){case"Array(2)":case"Array(3)":case"Array(4)":return`Matrix(${a.elements.length})`}return`Array(${a.elements.length})`;case"Literal":const S=this.astKey(a);return this.literalTypes[S]?this.literalTypes[S]:Number.isInteger(a.value)?"LiteralInteger":a.value===!0||a.value===!1?"Boolean":"Number";case"AssignmentExpression":return this.getType(a.left);case"CallExpression":if(this.isAstMathFunction(a))return"Number";if(!a.callee||!a.callee.name){if(a.callee.type==="SequenceExpression"&&a.callee.expressions[a.callee.expressions.length-1].property.name){const T=a.callee.expressions[a.callee.expressions.length-1].property.name;return this.inferArgumentTypesIfNeeded(T,a.arguments),this.lookupReturnType(T,a,this)}if(this.getVariableSignature(a.callee,!0)==="this.color")return null;if(a.callee.type==="MemberExpression"&&a.callee.object&&a.callee.property&&a.callee.property.name&&a.arguments){const T=a.callee.property.name;return this.inferArgumentTypesIfNeeded(T,a.arguments),this.lookupReturnType(T,a,this)}throw this.astErrorOutput("Unknown call expression",a)}if(a.callee&&a.callee.name){const T=a.callee.name;return this.inferArgumentTypesIfNeeded(T,a.arguments),this.lookupReturnType(T,a,this)}throw this.astErrorOutput(`Unhandled getType Type "${a.type}"`,a);case"LogicalExpression":return"Boolean";case"BinaryExpression":switch(a.operator){case"%":case"/":if(this.fixIntegerDivisionAccuracy)return"Number";break;case">":case"<":return"Boolean";case"&":case"|":case"^":case"<<":case">>":case">>>":return"Integer"}const _=this.getType(a.left);if(this.isState("skip-literal-correction"))return _;if(_==="LiteralInteger"){const T=this.getType(a.right);return T==="LiteralInteger"?a.left.value%1===0?"Integer":"Float":T}return l[_]||_;case"UpdateExpression":return this.getType(a.argument);case"UnaryExpression":return a.operator==="~"?"Integer":this.getType(a.argument);case"VariableDeclaration":{const T=a.declarations;let L;for(let D=0;D<T.length;D++){const z=T[D];L=this.getType(z)}if(!L)throw this.astErrorOutput("Unable to find type for declaration",a);return L}case"VariableDeclarator":const P=this.getDeclaration(a.id);if(!P)throw this.astErrorOutput("Unable to find declarator",a);if(!P.valueType)throw this.astErrorOutput("Unable to find declarator valueType",a);return P.valueType;case"Identifier":if(a.name==="Infinity")return"Number";if(this.isAstVariable(a)&&this.getVariableSignature(a)==="value")return this.getCheckVariableType(a);const I=this.findIdentifierOrigin(a);return I&&I.init?this.getType(I.init):null;case"ReturnStatement":return this.getType(a.argument);case"MemberExpression":if(this.isAstMathFunction(a)){switch(a.property.name){case"ceil":return"Integer";case"floor":return"Integer";case"round":return"Integer"}return"Number"}if(this.isAstVariable(a)){switch(this.getVariableSignature(a)){case"value[]":return this.getLookupType(this.getCheckVariableType(a.object));case"value[][]":return this.getLookupType(this.getCheckVariableType(a.object.object));case"value[][][]":return this.getLookupType(this.getCheckVariableType(a.object.object.object));case"value[][][][]":return this.getLookupType(this.getCheckVariableType(a.object.object.object.object));case"value.thread.value":case"this.thread.value":return"Integer";case"this.output.value":return this.dynamicOutput?"Integer":"LiteralInteger";case"this.constants.value":return this.getConstantType(a.property.name);case"this.constants.value[]":return this.getLookupType(this.getConstantType(a.object.property.name));case"this.constants.value[][]":return this.getLookupType(this.getConstantType(a.object.object.property.name));case"this.constants.value[][][]":return this.getLookupType(this.getConstantType(a.object.object.object.property.name));case"this.constants.value[][][][]":return this.getLookupType(this.getConstantType(a.object.object.object.object.property.name));case"fn()[]":case"fn()[][]":case"fn()[][][]":return this.getLookupType(this.getType(a.object));case"value.value":if(this.isAstMathVariable(a))return"Number";switch(a.property.name){case"r":case"g":case"b":case"a":return this.getLookupType(this.getCheckVariableType(a.object))}case"[][]":return"Number"}throw this.astErrorOutput("Unhandled getType MemberExpression",a)}throw this.astErrorOutput("Unhandled getType MemberExpression",a);case"ConditionalExpression":return this.getType(a.consequent);case"FunctionDeclaration":case"FunctionExpression":const k=this.findLastReturn(a.body);return k?this.getType(k):null;case"IfStatement":return this.getType(a.consequent);case"SequenceExpression":return this.getType(a.expressions[a.expressions.length-1]);default:throw this.astErrorOutput(`Unhandled getType Type "${a.type}"`,a)}}getCheckVariableType(a){const o=this.getVariableType(a);if(!o)throw this.astErrorOutput(`${a.type} is not defined`,a);return o}inferArgumentTypesIfNeeded(a,o){for(let S=0;S<o.length;S++){if(!this.needsArgumentType(a,S))continue;const _=this.getType(o[S]);if(!_)throw this.astErrorOutput(`Unable to infer argument ${S}`,o[S]);this.assignArgumentType(a,S,_)}}isAstMathVariable(a){const o=["E","PI","SQRT2","SQRT1_2","LN2","LN10","LOG2E","LOG10E"];return a.type==="MemberExpression"&&a.object&&a.object.type==="Identifier"&&a.object.name==="Math"&&a.property&&a.property.type==="Identifier"&&o.indexOf(a.property.name)>-1}isAstMathFunction(a){const o=["abs","acos","acosh","asin","asinh","atan","atan2","atanh","cbrt","ceil","clz32","cos","cosh","expm1","exp","floor","fround","imul","log","log2","log10","log1p","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc"];return a.type==="CallExpression"&&a.callee&&a.callee.type==="MemberExpression"&&a.callee.object&&a.callee.object.type==="Identifier"&&a.callee.object.name==="Math"&&a.callee.property&&a.callee.property.type==="Identifier"&&o.indexOf(a.callee.property.name)>-1}isAstVariable(a){return a.type==="Identifier"||a.type==="MemberExpression"}isSafe(a){return this.isSafeDependencies(this.getDependencies(a))}isSafeDependencies(a){return a&&a.every?a.every(o=>o.isSafe):!0}getDependencies(a,o,S){if(o||(o=[]),!a)return null;if(Array.isArray(a)){for(let _=0;_<a.length;_++)this.getDependencies(a[_],o,S);return o}switch(a.type){case"AssignmentExpression":return this.getDependencies(a.left,o,S),this.getDependencies(a.right,o,S),o;case"ConditionalExpression":return this.getDependencies(a.test,o,S),this.getDependencies(a.alternate,o,S),this.getDependencies(a.consequent,o,S),o;case"Literal":o.push({origin:"literal",value:a.value,isSafe:S===!0?!1:a.value>-1/0&&a.value<1/0&&!isNaN(a.value)});break;case"VariableDeclarator":return this.getDependencies(a.init,o,S);case"Identifier":const _=this.getDeclaration(a);if(_)o.push({name:a.name,origin:"declaration",isSafe:S?!1:this.isSafeDependencies(_.dependencies)});else if(this.argumentNames.indexOf(a.name)>-1)o.push({name:a.name,origin:"argument",isSafe:!1});else if(this.strictTypingChecking)throw new Error(`Cannot find identifier origin "${a.name}"`);break;case"FunctionDeclaration":return this.getDependencies(a.body.body[a.body.body.length-1],o,S);case"ReturnStatement":return this.getDependencies(a.argument,o);case"BinaryExpression":case"LogicalExpression":return S=a.operator==="/"||a.operator==="*",this.getDependencies(a.left,o,S),this.getDependencies(a.right,o,S),o;case"UnaryExpression":case"UpdateExpression":return this.getDependencies(a.argument,o,S);case"VariableDeclaration":return this.getDependencies(a.declarations,o,S);case"ArrayExpression":return o.push({origin:"declaration",isSafe:!0}),o;case"CallExpression":return o.push({origin:"function",isSafe:!0}),o;case"MemberExpression":const P=this.getMemberExpressionDetails(a);switch(P.signature){case"value[]":this.getDependencies(a.object,o,S);break;case"value[][]":this.getDependencies(a.object.object,o,S);break;case"value[][][]":this.getDependencies(a.object.object.object,o,S);break;case"this.output.value":this.dynamicOutput&&o.push({name:P.name,origin:"output",isSafe:!1});break}if(P)return P.property&&this.getDependencies(P.property,o,S),P.xProperty&&this.getDependencies(P.xProperty,o,S),P.yProperty&&this.getDependencies(P.yProperty,o,S),P.zProperty&&this.getDependencies(P.zProperty,o,S),o;case"SequenceExpression":return this.getDependencies(a.expressions,o,S);default:throw this.astErrorOutput(`Unhandled type ${a.type} in getDependencies`,a)}return o}getVariableSignature(a,o){if(!this.isAstVariable(a))throw new Error(`ast of type "${a.type}" is not a variable signature`);if(a.type==="Identifier")return"value";const S=[];for(;a;)a.computed?S.push("[]"):a.type==="ThisExpression"?S.unshift("this"):a.property&&a.property.name?a.property.name==="x"||a.property.name==="y"||a.property.name==="z"?S.unshift(o?"."+a.property.name:".value"):a.property.name==="constants"||a.property.name==="thread"||a.property.name==="output"?S.unshift("."+a.property.name):S.unshift(o?"."+a.property.name:".value"):a.name?S.unshift(o?a.name:"value"):a.callee&&a.callee.name?S.unshift(o?a.callee.name+"()":"fn()"):a.elements?S.unshift("[]"):S.unshift("unknown"),a=a.object;const _=S.join("");return o||["value","value[]","value[][]","value[][][]","value[][][][]","value.value","value.thread.value","this.thread.value","this.output.value","this.constants.value","this.constants.value[]","this.constants.value[][]","this.constants.value[][][]","this.constants.value[][][][]","fn()[]","fn()[][]","fn()[][][]","[][]"].indexOf(_)>-1?_:null}build(){return this.toString().length>0}astGeneric(a,o){if(a===null)throw this.astErrorOutput("NULL ast",a);if(Array.isArray(a)){for(let S=0;S<a.length;S++)this.astGeneric(a[S],o);return o}switch(a.type){case"FunctionDeclaration":return this.astFunctionDeclaration(a,o);case"FunctionExpression":return this.astFunctionExpression(a,o);case"ReturnStatement":return this.astReturnStatement(a,o);case"Literal":return this.astLiteral(a,o);case"BinaryExpression":return this.astBinaryExpression(a,o);case"Identifier":return this.astIdentifierExpression(a,o);case"AssignmentExpression":return this.astAssignmentExpression(a,o);case"ExpressionStatement":return this.astExpressionStatement(a,o);case"EmptyStatement":return this.astEmptyStatement(a,o);case"BlockStatement":return this.astBlockStatement(a,o);case"IfStatement":return this.astIfStatement(a,o);case"SwitchStatement":return this.astSwitchStatement(a,o);case"BreakStatement":return this.astBreakStatement(a,o);case"ContinueStatement":return this.astContinueStatement(a,o);case"ForStatement":return this.astForStatement(a,o);case"WhileStatement":return this.astWhileStatement(a,o);case"DoWhileStatement":return this.astDoWhileStatement(a,o);case"VariableDeclaration":return this.astVariableDeclaration(a,o);case"VariableDeclarator":return this.astVariableDeclarator(a,o);case"ThisExpression":return this.astThisExpression(a,o);case"SequenceExpression":return this.astSequenceExpression(a,o);case"UnaryExpression":return this.astUnaryExpression(a,o);case"UpdateExpression":return this.astUpdateExpression(a,o);case"LogicalExpression":return this.astLogicalExpression(a,o);case"MemberExpression":return this.astMemberExpression(a,o);case"CallExpression":return this.astCallExpression(a,o);case"ArrayExpression":return this.astArrayExpression(a,o);case"DebuggerStatement":return this.astDebuggerStatement(a,o);case"ConditionalExpression":return this.astConditionalExpression(a,o)}throw this.astErrorOutput("Unknown ast type : "+a.type,a)}astErrorOutput(a,o){if(typeof this.source!="string")return new Error(a);const S=y.getAstString(this.source,o),P=this.source.substr(o.start).split(/\n/),I=P.length>0?P[P.length-1]:0;return new Error(`${a} on line ${P.length}, position ${I.length}:
 ${S}`)}astDebuggerStatement(a,o){return o}astConditionalExpression(a,o){if(a.type!=="ConditionalExpression")throw this.astErrorOutput("Not a conditional expression",a);return o.push("("),this.astGeneric(a.test,o),o.push("?"),this.astGeneric(a.consequent,o),o.push(":"),this.astGeneric(a.alternate,o),o.push(")"),o}astFunction(a,o){throw new Error(`"astFunction" not defined on ${this.constructor.name}`)}astFunctionDeclaration(a,o){return this.isChildFunction(a)?o:this.astFunction(a,o)}astFunctionExpression(a,o){return this.isChildFunction(a)?o:this.astFunction(a,o)}isChildFunction(a){for(let o=0;o<this.functions.length;o++)if(this.functions[o]===a)return!0;return!1}astReturnStatement(a,o){return o}astLiteral(a,o){return this.literalTypes[this.astKey(a)]="Number",o}astBinaryExpression(a,o){return o}astIdentifierExpression(a,o){return o}astAssignmentExpression(a,o){return o}astExpressionStatement(a,o){return this.astGeneric(a.expression,o),o.push(";"),o}astEmptyStatement(a,o){return o}astBlockStatement(a,o){return o}astIfStatement(a,o){return o}astSwitchStatement(a,o){return o}astBreakStatement(a,o){return o.push("break;"),o}astContinueStatement(a,o){return o.push(`continue;
`),o}astForStatement(a,o){return o}astWhileStatement(a,o){return o}astDoWhileStatement(a,o){return o}astVariableDeclarator(a,o){return this.astGeneric(a.id,o),a.init!==null&&(o.push("="),this.astGeneric(a.init,o)),o}astThisExpression(a,o){return o}astSequenceExpression(a,o){const{expressions:S}=a,_=[];for(let P=0;P<S.length;P++){const I=S[P],k=[];this.astGeneric(I,k),_.push(k.join(""))}return _.length>1?o.push("(",_.join(","),")"):o.push(_[0]),o}astUnaryExpression(a,o){return this.checkAndUpconvertBitwiseUnary(a,o)||(a.prefix?(o.push(a.operator),this.astGeneric(a.argument,o)):(this.astGeneric(a.argument,o),o.push(a.operator))),o}checkAndUpconvertBitwiseUnary(a,o){}astUpdateExpression(a,o){return a.prefix?(o.push(a.operator),this.astGeneric(a.argument,o)):(this.astGeneric(a.argument,o),o.push(a.operator)),o}astLogicalExpression(a,o){return o.push("("),this.astGeneric(a.left,o),o.push(a.operator),this.astGeneric(a.right,o),o.push(")"),o}astMemberExpression(a,o){return o}astCallExpression(a,o){return o}astArrayExpression(a,o){return o}getMemberExpressionDetails(a){if(a.type!=="MemberExpression")throw this.astErrorOutput(`Expression ${a.type} not a MemberExpression`,a);let o=null,S=null;const _=this.getVariableSignature(a);switch(_){case"value":return null;case"value.thread.value":case"this.thread.value":case"this.output.value":return{signature:_,type:"Integer",name:a.property.name};case"value[]":if(typeof a.object.name!="string")throw this.astErrorOutput("Unexpected expression",a);return o=a.object.name,{name:o,origin:"user",signature:_,type:this.getVariableType(a.object),xProperty:a.property};case"value[][]":if(typeof a.object.object.name!="string")throw this.astErrorOutput("Unexpected expression",a);return o=a.object.object.name,{name:o,origin:"user",signature:_,type:this.getVariableType(a.object.object),yProperty:a.object.property,xProperty:a.property};case"value[][][]":if(typeof a.object.object.object.name!="string")throw this.astErrorOutput("Unexpected expression",a);return o=a.object.object.object.name,{name:o,origin:"user",signature:_,type:this.getVariableType(a.object.object.object),zProperty:a.object.object.property,yProperty:a.object.property,xProperty:a.property};case"value[][][][]":if(typeof a.object.object.object.object.name!="string")throw this.astErrorOutput("Unexpected expression",a);return o=a.object.object.object.object.name,{name:o,origin:"user",signature:_,type:this.getVariableType(a.object.object.object.object),zProperty:a.object.object.property,yProperty:a.object.property,xProperty:a.property};case"value.value":if(typeof a.property.name!="string")throw this.astErrorOutput("Unexpected expression",a);if(this.isAstMathVariable(a))return o=a.property.name,{name:o,origin:"Math",type:"Number",signature:_};switch(a.property.name){case"r":case"g":case"b":case"a":return o=a.object.name,{name:o,property:a.property.name,origin:"user",signature:_,type:"Number"};default:throw this.astErrorOutput("Unexpected expression",a)}case"this.constants.value":if(typeof a.property.name!="string")throw this.astErrorOutput("Unexpected expression",a);if(o=a.property.name,S=this.getConstantType(o),!S)throw this.astErrorOutput("Constant has no type",a);return{name:o,type:S,origin:"constants",signature:_};case"this.constants.value[]":if(typeof a.object.property.name!="string")throw this.astErrorOutput("Unexpected expression",a);if(o=a.object.property.name,S=this.getConstantType(o),!S)throw this.astErrorOutput("Constant has no type",a);return{name:o,type:S,origin:"constants",signature:_,xProperty:a.property};case"this.constants.value[][]":{if(typeof a.object.object.property.name!="string")throw this.astErrorOutput("Unexpected expression",a);if(o=a.object.object.property.name,S=this.getConstantType(o),!S)throw this.astErrorOutput("Constant has no type",a);return{name:o,type:S,origin:"constants",signature:_,yProperty:a.object.property,xProperty:a.property}}case"this.constants.value[][][]":{if(typeof a.object.object.object.property.name!="string")throw this.astErrorOutput("Unexpected expression",a);if(o=a.object.object.object.property.name,S=this.getConstantType(o),!S)throw this.astErrorOutput("Constant has no type",a);return{name:o,type:S,origin:"constants",signature:_,zProperty:a.object.object.property,yProperty:a.object.property,xProperty:a.property}}case"fn()[]":case"fn()[][]":case"[][]":return{signature:_,property:a.property};default:throw this.astErrorOutput("Unexpected expression",a)}}findIdentifierOrigin(a){const o=[this.ast];for(;o.length>0;){const S=o[0];if(S.type==="VariableDeclarator"&&S.id&&S.id.name&&S.id.name===a.name)return S;if(o.shift(),S.argument)o.push(S.argument);else if(S.body)o.push(S.body);else if(S.declarations)o.push(S.declarations);else if(Array.isArray(S))for(let _=0;_<S.length;_++)o.push(S[_])}return null}findLastReturn(a){const o=[a||this.ast];for(;o.length>0;){const S=o.pop();if(S.type==="ReturnStatement")return S;if(S.type!=="FunctionDeclaration")if(S.argument)o.push(S.argument);else if(S.body)o.push(S.body);else if(S.declarations)o.push(S.declarations);else if(Array.isArray(S))for(let _=0;_<S.length;_++)o.push(S[_]);else S.consequent?o.push(S.consequent):S.cases&&o.push(S.cases)}return null}getInternalVariableName(a){return this._internalVariableNames.hasOwnProperty(a)||(this._internalVariableNames[a]=0),this._internalVariableNames[a]++,this._internalVariableNames[a]===1?a:a+this._internalVariableNames[a]}astKey(a,o=","){if(!a.start||!a.end)throw new Error("AST start and end needed");return`${a.start}${o}${a.end}`}}const l={Number:"Number",Float:"Float",Integer:"Integer",Array:"Number","Array(2)":"Number","Array(3)":"Number","Array(4)":"Number","Matrix(2)":"Number","Matrix(3)":"Number","Matrix(4)":"Number",Array2D:"Number",Array3D:"Number",Input:"Number",HTMLCanvas:"Array(4)",OffscreenCanvas:"Array(4)",HTMLImage:"Array(4)",ImageBitmap:"Array(4)",ImageData:"Array(4)",HTMLVideo:"Array(4)",HTMLImageArray:"Array(4)",NumberTexture:"Number",MemoryOptimizedNumberTexture:"Number","Array1D(2)":"Array(2)","Array1D(3)":"Array(3)","Array1D(4)":"Array(4)","Array2D(2)":"Array(2)","Array2D(3)":"Array(3)","Array2D(4)":"Array(4)","Array3D(2)":"Array(2)","Array3D(3)":"Array(3)","Array3D(4)":"Array(4)","ArrayTexture(1)":"Number","ArrayTexture(2)":"Array(2)","ArrayTexture(3)":"Array(3)","ArrayTexture(4)":"Array(4)"};i.exports={FunctionNode:m}},{"../utils":114,"./function-tracer":11,acorn:1}],11:[function(n,i,p){const{utils:d}=n("../utils");function y(l){return l.length>0?l[l.length-1]:null}const v={trackIdentifiers:"trackIdentifiers",memberExpression:"memberExpression",inForLoopInit:"inForLoopInit"};class m{constructor(h){this.runningContexts=[],this.functionContexts=[],this.contexts=[],this.functionCalls=[],this.declarations=[],this.identifiers=[],this.functions=[],this.returnStatements=[],this.trackedIdentifiers=null,this.states=[],this.newFunctionContext(),this.scan(h)}isState(h){return this.states[this.states.length-1]===h}hasState(h){return this.states.indexOf(h)>-1}pushState(h){this.states.push(h)}popState(h){if(this.isState(h))this.states.pop();else throw new Error(`Cannot pop the non-active state "${h}"`)}get currentFunctionContext(){return y(this.functionContexts)}get currentContext(){return y(this.runningContexts)}newFunctionContext(){const h={"@contextType":"function"};this.contexts.push(h),this.functionContexts.push(h)}newContext(h){const a=Object.assign({"@contextType":"const/let"},this.currentContext);this.contexts.push(a),this.runningContexts.push(a),h();const{currentFunctionContext:o}=this;for(const S in o)!o.hasOwnProperty(S)||a.hasOwnProperty(S)||(a[S]=o[S]);return this.runningContexts.pop(),a}useFunctionContext(h){const a=y(this.functionContexts);this.runningContexts.push(a),h(),this.runningContexts.pop()}getIdentifiers(h){const a=this.trackedIdentifiers=[];return this.pushState(v.trackIdentifiers),h(),this.trackedIdentifiers=null,this.popState(v.trackIdentifiers),a}getDeclaration(h){const{currentContext:a,currentFunctionContext:o,runningContexts:S}=this,_=a[h]||o[h]||null;if(!_&&a===o&&S.length>0){const P=S[S.length-2];if(P[h])return P[h]}return _}scan(h){if(h){if(Array.isArray(h)){for(let a=0;a<h.length;a++)this.scan(h[a]);return}switch(h.type){case"Program":this.useFunctionContext(()=>{this.scan(h.body)});break;case"BlockStatement":this.newContext(()=>{this.scan(h.body)});break;case"AssignmentExpression":case"LogicalExpression":this.scan(h.left),this.scan(h.right);break;case"BinaryExpression":this.scan(h.left),this.scan(h.right);break;case"UpdateExpression":if(h.operator==="++"){const a=this.getDeclaration(h.argument.name);a&&(a.suggestedType="Integer")}this.scan(h.argument);break;case"UnaryExpression":this.scan(h.argument);break;case"VariableDeclaration":h.kind==="var"?this.useFunctionContext(()=>{h.declarations=d.normalizeDeclarations(h),this.scan(h.declarations)}):(h.declarations=d.normalizeDeclarations(h),this.scan(h.declarations));break;case"VariableDeclarator":{const{currentContext:a}=this,o=this.hasState(v.inForLoopInit),S={ast:h,context:a,name:h.id.name,origin:"declaration",inForLoopInit:o,inForLoopTest:null,assignable:a===this.currentFunctionContext||!o&&!a.hasOwnProperty(h.id.name),suggestedType:null,valueType:null,dependencies:null,isSafe:null};a[h.id.name]||(a[h.id.name]=S),this.declarations.push(S),this.scan(h.id),this.scan(h.init);break}case"FunctionExpression":case"FunctionDeclaration":this.runningContexts.length===0?this.scan(h.body):this.functions.push(h);break;case"IfStatement":this.scan(h.test),this.scan(h.consequent),h.alternate&&this.scan(h.alternate);break;case"ForStatement":{let a;const o=this.newContext(()=>{this.pushState(v.inForLoopInit),this.scan(h.init),this.popState(v.inForLoopInit),a=this.getIdentifiers(()=>{this.scan(h.test)}),this.scan(h.update),this.newContext(()=>{this.scan(h.body)})});if(a)for(const S in o)S!=="@contextType"&&a.indexOf(S)>-1&&(o[S].inForLoopTest=!0);break}case"DoWhileStatement":case"WhileStatement":this.newContext(()=>{this.scan(h.body),this.scan(h.test)});break;case"Identifier":{this.isState(v.trackIdentifiers)&&this.trackedIdentifiers.push(h.name),this.identifiers.push({context:this.currentContext,declaration:this.getDeclaration(h.name),ast:h});break}case"ReturnStatement":this.returnStatements.push(h),this.scan(h.argument);break;case"MemberExpression":this.pushState(v.memberExpression),this.scan(h.object),this.scan(h.property),this.popState(v.memberExpression);break;case"ExpressionStatement":this.scan(h.expression);break;case"SequenceExpression":this.scan(h.expressions);break;case"CallExpression":this.functionCalls.push({context:this.currentContext,ast:h}),this.scan(h.arguments);break;case"ArrayExpression":this.scan(h.elements);break;case"ConditionalExpression":this.scan(h.test),this.scan(h.alternate),this.scan(h.consequent);break;case"SwitchStatement":this.scan(h.discriminant),this.scan(h.cases);break;case"SwitchCase":this.scan(h.test),this.scan(h.consequent);break;case"ThisExpression":case"Literal":case"DebuggerStatement":case"EmptyStatement":case"BreakStatement":case"ContinueStatement":break;default:throw new Error(`unhandled type "${h.type}"`)}}}}i.exports={FunctionTracer:m}},{"../utils":114}],12:[function(n,i,p){const{glWiretap:d}=n("gl-wiretap"),{utils:y}=n("../../utils");function v(S){return S.toString().replace("=>","").replace(/^function /,"").replace(/utils[.]/g,"/*utils.*/")}function m(S,_,P,I,k){P.built||P.build.apply(P,_),_=_?Array.from(_).map(_t=>{switch(typeof _t){case"boolean":return new Boolean(_t);case"number":return new Number(_t);default:return _t}}):null;const T=[],L=d(P.context,{useTrackablePrimitives:!0,onReadPixels:_t=>{if(Ye.subKernels){if(!D)T.push(`    const result = { result: ${l(_t,Ye)} };`),D=!0;else{const Zt=Ye.subKernels[z++].property;T.push(`    result${isNaN(Zt)?"."+Zt:`[${Zt}]`} = ${l(_t,Ye)};`)}z===Ye.subKernels.length&&T.push("    return result;");return}_t?T.push(`    return ${l(_t,Ye)};`):T.push("    return null;")},onUnrecognizedArgumentLookup:_t=>{const Zt=o(_t,Ye.kernelArguments,[],L);if(Zt)return Zt;const ln=o(_t,Ye.kernelConstants,fe?Object.keys(fe).map(Gn=>fe[Gn]):[],L);return ln||null}});let D=!1,z=0;const{source:re,canvas:he,output:$,pipeline:w,graphical:V,loopMaxIterations:K,constants:fe,optimizeFloatMemory:ee,precision:ue,fixIntegerDivisionAccuracy:_e,functions:Re,nativeFunctions:ft,subKernels:it,immutable:Pe,argumentTypes:mt,constantTypes:bt,kernelArguments:Rt,kernelConstants:lt,tactic:ct}=P,Ye=new S(re,{canvas:he,context:L,checkContext:!1,output:$,pipeline:w,graphical:V,loopMaxIterations:K,constants:fe,optimizeFloatMemory:ee,precision:ue,fixIntegerDivisionAccuracy:_e,functions:Re,nativeFunctions:ft,subKernels:it,immutable:Pe,argumentTypes:mt,constantTypes:bt,tactic:ct});let Dt=[];if(L.setIndent(2),Ye.build.apply(Ye,_),Dt.push(L.toString()),L.reset(),Ye.kernelArguments.forEach((_t,Zt)=>{switch(_t.type){case"Integer":case"Boolean":case"Number":case"Float":case"Array":case"Array(2)":case"Array(3)":case"Array(4)":case"HTMLCanvas":case"HTMLImage":case"HTMLVideo":L.insertVariable(`uploadValue_${_t.name}`,_t.uploadValue);break;case"HTMLImageArray":for(let ln=0;ln<_[Zt].length;ln++){const Gn=_[Zt];L.insertVariable(`uploadValue_${_t.name}[${ln}]`,Gn[ln])}break;case"Input":L.insertVariable(`uploadValue_${_t.name}`,_t.uploadValue);break;case"MemoryOptimizedNumberTexture":case"NumberTexture":case"Array1D(2)":case"Array1D(3)":case"Array1D(4)":case"Array2D(2)":case"Array2D(3)":case"Array2D(4)":case"Array3D(2)":case"Array3D(3)":case"Array3D(4)":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":L.insertVariable(`uploadValue_${_t.name}`,_[Zt].texture);break;default:throw new Error(`unhandled kernelArgumentType insertion for glWiretap of type ${_t.type}`)}}),Dt.push("/** start of injected functions **/"),Dt.push(`function ${v(y.flattenTo)}`),Dt.push(`function ${v(y.flatten2dArrayTo)}`),Dt.push(`function ${v(y.flatten3dArrayTo)}`),Dt.push(`function ${v(y.flatten4dArrayTo)}`),Dt.push(`function ${v(y.isArray)}`),Ye.renderOutput!==Ye.renderTexture&&Ye.formatValues&&Dt.push(`  const renderOutput = function ${v(Ye.formatValues)};`),Dt.push("/** end of injected functions **/"),Dt.push(`  const innerKernel = function (${Ye.kernelArguments.map(_t=>_t.varName).join(", ")}) {`),L.setIndent(4),Ye.run.apply(Ye,_),Ye.renderKernels?Ye.renderKernels():Ye.renderOutput&&Ye.renderOutput(),Dt.push("    /** start setup uploads for kernel values **/"),Ye.kernelArguments.forEach(_t=>{Dt.push("    "+_t.getStringValueHandler().split(`
`).join(`
    `))}),Dt.push("    /** end setup uploads for kernel values **/"),Dt.push(L.toString()),Ye.renderOutput===Ye.renderTexture){L.reset();const _t=L.getContextVariableName(Ye.framebuffer);if(Ye.renderKernels){const Zt=Ye.renderKernels(),ln=L.getContextVariableName(Ye.texture.texture);Dt.push(`    return {
      result: {
        texture: ${ln},
        type: '${Zt.result.type}',
        toArray: ${a(Zt.result,ln,_t)}
      },`);const{subKernels:Gn,mappedTextures:Vn}=Ye;for(let St=0;St<Gn.length;St++){const nn=Vn[St],En=Gn[St],tr=Zt[En.property],Dr=L.getContextVariableName(nn.texture);Dt.push(`
      ${En.property}: {
        texture: ${Dr},
        type: '${tr.type}',
        toArray: ${a(tr,Dr,_t)}
      },`)}Dt.push("    };")}else{const Zt=Ye.renderOutput(),ln=L.getContextVariableName(Ye.texture.texture);Dt.push(`    return {
        texture: ${ln},
        type: '${Zt.type}',
        toArray: ${a(Zt,ln,_t)}
      };`)}}Dt.push(`    ${k?`
`+k+"    ":""}`),Dt.push(T.join(`
`)),Dt.push("  };"),Ye.graphical&&(Dt.push(h(Ye)),Dt.push("  innerKernel.getPixels = getPixels;")),Dt.push("  return innerKernel;");let Tn=[];return lt.forEach(_t=>{Tn.push(`${_t.getStringValueHandler()}`)}),`function kernel(settings) {
  const { context, constants } = settings;
  ${Tn.join("")}
  ${I||""}
${Dt.join(`
`)}
}`}function l(S,_){const P=_.precision==="single"?S:`new Float32Array(${S}.buffer)`;return _.output[2]?`renderOutput(${P}, ${_.output[0]}, ${_.output[1]}, ${_.output[2]})`:_.output[1]?`renderOutput(${P}, ${_.output[0]}, ${_.output[1]})`:`renderOutput(${P}, ${_.output[0]})`}function h(S){const _=S.getPixels.toString(),P=!/^function/.test(_);return y.flattenFunctionToString(`${P?"function ":""}${_}`,{findDependency:(I,k)=>I==="utils"?`const ${k} = ${y[k].toString()};`:null,thisLookup:I=>{if(I==="context")return null;if(S.hasOwnProperty(I))return JSON.stringify(S[I]);throw new Error(`unhandled thisLookup ${I}`)}})}function a(S,_,P){const I=S.toArray.toString(),k=!/^function/.test(I),T=y.flattenFunctionToString(`${k?"function ":""}${I}`,{findDependency:(L,D)=>{if(L==="utils")return`const ${D} = ${y[D].toString()};`;if(L==="this")return D==="framebuffer"?"":`${k?"function ":""}${S[D].toString()}`;throw new Error("unhandled fromObject")},thisLookup:(L,D)=>{if(L==="texture")return _;if(L==="context")return D?null:"gl";if(S.hasOwnProperty(L))return JSON.stringify(S[L]);throw new Error(`unhandled thisLookup ${L}`)}});return`() => {
  function framebuffer() { return ${P}; };
  ${T}
  return toArray();
  }`}function o(S,_,P,I,k){if(S===null||_===null)return null;switch(typeof S){case"boolean":case"number":return null}if(typeof HTMLImageElement<"u"&&S instanceof HTMLImageElement)for(let T=0;T<_.length;T++){const L=_[T];if(L.type!=="HTMLImageArray"&&L||L.uploadValue!==S)continue;const D=P[T].indexOf(S);if(D===-1)continue;const z=`uploadValue_${L.name}[${D}]`;return I.insertVariable(z,S),z}for(let T=0;T<_.length;T++){const L=_[T];if(S!==L.uploadValue)continue;const D=`uploadValue_${L.name}`;return I.insertVariable(D,L),D}return null}i.exports={glKernelString:m}},{"../../utils":114,"gl-wiretap":3}],13:[function(n,i,p){const{Kernel:d}=n("../kernel"),{utils:y}=n("../../utils"),{GLTextureArray2Float:v}=n("./texture/array-2-float"),{GLTextureArray2Float2D:m}=n("./texture/array-2-float-2d"),{GLTextureArray2Float3D:l}=n("./texture/array-2-float-3d"),{GLTextureArray3Float:h}=n("./texture/array-3-float"),{GLTextureArray3Float2D:a}=n("./texture/array-3-float-2d"),{GLTextureArray3Float3D:o}=n("./texture/array-3-float-3d"),{GLTextureArray4Float:S}=n("./texture/array-4-float"),{GLTextureArray4Float2D:_}=n("./texture/array-4-float-2d"),{GLTextureArray4Float3D:P}=n("./texture/array-4-float-3d"),{GLTextureFloat:I}=n("./texture/float"),{GLTextureFloat2D:k}=n("./texture/float-2d"),{GLTextureFloat3D:T}=n("./texture/float-3d"),{GLTextureMemoryOptimized:L}=n("./texture/memory-optimized"),{GLTextureMemoryOptimized2D:D}=n("./texture/memory-optimized-2d"),{GLTextureMemoryOptimized3D:z}=n("./texture/memory-optimized-3d"),{GLTextureUnsigned:re}=n("./texture/unsigned"),{GLTextureUnsigned2D:he}=n("./texture/unsigned-2d"),{GLTextureUnsigned3D:$}=n("./texture/unsigned-3d"),{GLTextureGraphical:w}=n("./texture/graphical");class V extends d{static get mode(){return"gpu"}static getIsFloatRead(){const ee=`function kernelFunction() {
      return 1;
    }`,ue=new this(ee,{context:this.testContext,canvas:this.testCanvas,validate:!1,output:[1],precision:"single",returnType:"Number",tactic:"speed"});ue.build(),ue.run();const _e=ue.renderOutput();return ue.destroy(!0),_e[0]===1}static getIsIntegerDivisionAccurate(){function ee(ft,it){return ft[this.thread.x]/it[this.thread.x]}const ue=new this(ee.toString(),{context:this.testContext,canvas:this.testCanvas,validate:!1,output:[2],returnType:"Number",precision:"unsigned",tactic:"speed"}),_e=[[6,6030401],[3,3991]];ue.build.apply(ue,_e),ue.run.apply(ue,_e);const Re=ue.renderOutput();return ue.destroy(!0),Re[0]===2&&Re[1]===1511}static getIsSpeedTacticSupported(){function ee(ft){return ft[this.thread.x]}const ue=new this(ee.toString(),{context:this.testContext,canvas:this.testCanvas,validate:!1,output:[4],returnType:"Number",precision:"unsigned",tactic:"speed"}),_e=[[0,1,2,3]];ue.build.apply(ue,_e),ue.run.apply(ue,_e);const Re=ue.renderOutput();return ue.destroy(!0),Math.round(Re[0])===0&&Math.round(Re[1])===1&&Math.round(Re[2])===2&&Math.round(Re[3])===3}static get testCanvas(){throw new Error(`"testCanvas" not defined on ${this.name}`)}static get testContext(){throw new Error(`"testContext" not defined on ${this.name}`)}static getFeatures(){const ee=this.testContext,ue=this.getIsDrawBuffers();return Object.freeze({isFloatRead:this.getIsFloatRead(),isIntegerDivisionAccurate:this.getIsIntegerDivisionAccurate(),isSpeedTacticSupported:this.getIsSpeedTacticSupported(),isTextureFloat:this.getIsTextureFloat(),isDrawBuffers:ue,kernelMap:ue,channelCount:this.getChannelCount(),maxTextureSize:this.getMaxTextureSize(),lowIntPrecision:ee.getShaderPrecisionFormat(ee.FRAGMENT_SHADER,ee.LOW_INT),lowFloatPrecision:ee.getShaderPrecisionFormat(ee.FRAGMENT_SHADER,ee.LOW_FLOAT),mediumIntPrecision:ee.getShaderPrecisionFormat(ee.FRAGMENT_SHADER,ee.MEDIUM_INT),mediumFloatPrecision:ee.getShaderPrecisionFormat(ee.FRAGMENT_SHADER,ee.MEDIUM_FLOAT),highIntPrecision:ee.getShaderPrecisionFormat(ee.FRAGMENT_SHADER,ee.HIGH_INT),highFloatPrecision:ee.getShaderPrecisionFormat(ee.FRAGMENT_SHADER,ee.HIGH_FLOAT)})}static setupFeatureChecks(){throw new Error(`"setupFeatureChecks" not defined on ${this.name}`)}static getSignature(ee,ue){return ee.getVariablePrecisionString()+(ue.length>0?":"+ue.join(","):"")}setFixIntegerDivisionAccuracy(ee){return this.fixIntegerDivisionAccuracy=ee,this}setPrecision(ee){return this.precision=ee,this}setFloatTextures(ee){return y.warnDeprecated("method","setFloatTextures","setOptimizeFloatMemory"),this.floatTextures=ee,this}static nativeFunctionArguments(ee){const ue=[],_e=[],Re=[],ft=/^[a-zA-Z_]/,it=/[a-zA-Z_0-9]/;let Pe=0,mt=null,bt=null;for(;Pe<ee.length;){const Rt=ee[Pe],lt=ee[Pe+1],ct=Re.length>0?Re[Re.length-1]:null;if(ct==="FUNCTION_ARGUMENTS"&&Rt==="/"&&lt==="*"){Re.push("MULTI_LINE_COMMENT"),Pe+=2;continue}else if(ct==="MULTI_LINE_COMMENT"&&Rt==="*"&&lt==="/"){Re.pop(),Pe+=2;continue}else if(ct==="FUNCTION_ARGUMENTS"&&Rt==="/"&&lt==="/"){Re.push("COMMENT"),Pe+=2;continue}else if(ct==="COMMENT"&&Rt===`
`){Re.pop(),Pe++;continue}else if(ct===null&&Rt==="("){Re.push("FUNCTION_ARGUMENTS"),Pe++;continue}else if(ct==="FUNCTION_ARGUMENTS"){if(Rt===")"){Re.pop();break}if(Rt==="f"&&lt==="l"&&ee[Pe+2]==="o"&&ee[Pe+3]==="a"&&ee[Pe+4]==="t"&&ee[Pe+5]===" "){Re.push("DECLARE_VARIABLE"),bt="float",mt="",Pe+=6;continue}else if(Rt==="i"&&lt==="n"&&ee[Pe+2]==="t"&&ee[Pe+3]===" "){Re.push("DECLARE_VARIABLE"),bt="int",mt="",Pe+=4;continue}else if(Rt==="v"&&lt==="e"&&ee[Pe+2]==="c"&&ee[Pe+3]==="2"&&ee[Pe+4]===" "){Re.push("DECLARE_VARIABLE"),bt="vec2",mt="",Pe+=5;continue}else if(Rt==="v"&&lt==="e"&&ee[Pe+2]==="c"&&ee[Pe+3]==="3"&&ee[Pe+4]===" "){Re.push("DECLARE_VARIABLE"),bt="vec3",mt="",Pe+=5;continue}else if(Rt==="v"&&lt==="e"&&ee[Pe+2]==="c"&&ee[Pe+3]==="4"&&ee[Pe+4]===" "){Re.push("DECLARE_VARIABLE"),bt="vec4",mt="",Pe+=5;continue}}else if(ct==="DECLARE_VARIABLE"){if(mt===""){if(Rt===" "){Pe++;continue}if(!ft.test(Rt))throw new Error("variable name is not expected string")}mt+=Rt,it.test(lt)||(Re.pop(),_e.push(mt),ue.push(K[bt]))}Pe++}if(Re.length>0)throw new Error("GLSL function was not parsable");return{argumentNames:_e,argumentTypes:ue}}static nativeFunctionReturnType(ee){return K[ee.match(/int|float|vec[2-4]/)[0]]}static combineKernels(ee,ue){ee.apply(null,arguments);const{texSize:_e,context:Re,threadDim:ft}=ue.texSize;let it;if(ue.precision==="single"){const Pe=_e[0],mt=Math.ceil(_e[1]/4);it=new Float32Array(Pe*mt*4*4),Re.readPixels(0,0,Pe,mt*4,Re.RGBA,Re.FLOAT,it)}else{const Pe=new Uint8Array(_e[0]*_e[1]*4);Re.readPixels(0,0,_e[0],_e[1],Re.RGBA,Re.UNSIGNED_BYTE,Pe),it=new Float32Array(Pe.buffer)}if(it=it.subarray(0,ft[0]*ft[1]*ft[2]),ue.output.length===1)return it;if(ue.output.length===2)return y.splitArray(it,ue.output[0]);if(ue.output.length===3)return y.splitArray(it,ue.output[0]*ue.output[1]).map(function(mt){return y.splitArray(mt,ue.output[0])})}constructor(ee,ue){super(ee,ue),this.transferValues=null,this.formatValues=null,this.TextureConstructor=null,this.renderOutput=null,this.renderRawOutput=null,this.texSize=null,this.translatedSource=null,this.compiledFragmentShader=null,this.compiledVertexShader=null,this.switchingKernels=null,this._textureSwitched=null,this._mappedTextureSwitched=null}checkTextureSize(){const{features:ee}=this.constructor;if(this.texSize[0]>ee.maxTextureSize||this.texSize[1]>ee.maxTextureSize)throw new Error(`Texture size [${this.texSize[0]},${this.texSize[1]}] generated by kernel is larger than supported size [${ee.maxTextureSize},${ee.maxTextureSize}]`)}translateSource(){throw new Error(`"translateSource" not defined on ${this.constructor.name}`)}pickRenderStrategy(ee){if(this.graphical)return this.renderRawOutput=this.readPackedPixelsToUint8Array,this.transferValues=ue=>ue,this.TextureConstructor=w,null;if(this.precision==="unsigned")if(this.renderRawOutput=this.readPackedPixelsToUint8Array,this.transferValues=this.readPackedPixelsToFloat32Array,this.pipeline)switch(this.renderOutput=this.renderTexture,this.subKernels!==null&&(this.renderKernels=this.renderKernelsToTextures),this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.output[2]>0?(this.TextureConstructor=$,null):this.output[1]>0?(this.TextureConstructor=he,null):(this.TextureConstructor=re,null);case"Array(2)":case"Array(3)":case"Array(4)":return this.requestFallback(ee)}else switch(this.subKernels!==null&&(this.renderKernels=this.renderKernelsToArrays),this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.renderOutput=this.renderValues,this.output[2]>0?(this.TextureConstructor=$,this.formatValues=y.erect3DPackedFloat,null):this.output[1]>0?(this.TextureConstructor=he,this.formatValues=y.erect2DPackedFloat,null):(this.TextureConstructor=re,this.formatValues=y.erectPackedFloat,null);case"Array(2)":case"Array(3)":case"Array(4)":return this.requestFallback(ee)}else if(this.precision==="single"){if(this.renderRawOutput=this.readFloatPixelsToFloat32Array,this.transferValues=this.readFloatPixelsToFloat32Array,this.pipeline)switch(this.renderOutput=this.renderTexture,this.subKernels!==null&&(this.renderKernels=this.renderKernelsToTextures),this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.optimizeFloatMemory?this.output[2]>0?(this.TextureConstructor=z,null):this.output[1]>0?(this.TextureConstructor=D,null):(this.TextureConstructor=L,null):this.output[2]>0?(this.TextureConstructor=T,null):this.output[1]>0?(this.TextureConstructor=k,null):(this.TextureConstructor=I,null);case"Array(2)":return this.output[2]>0?(this.TextureConstructor=l,null):this.output[1]>0?(this.TextureConstructor=m,null):(this.TextureConstructor=v,null);case"Array(3)":return this.output[2]>0?(this.TextureConstructor=o,null):this.output[1]>0?(this.TextureConstructor=a,null):(this.TextureConstructor=h,null);case"Array(4)":return this.output[2]>0?(this.TextureConstructor=P,null):this.output[1]>0?(this.TextureConstructor=_,null):(this.TextureConstructor=S,null)}if(this.renderOutput=this.renderValues,this.subKernels!==null&&(this.renderKernels=this.renderKernelsToArrays),this.optimizeFloatMemory)switch(this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.output[2]>0?(this.TextureConstructor=z,this.formatValues=y.erectMemoryOptimized3DFloat,null):this.output[1]>0?(this.TextureConstructor=D,this.formatValues=y.erectMemoryOptimized2DFloat,null):(this.TextureConstructor=L,this.formatValues=y.erectMemoryOptimizedFloat,null);case"Array(2)":return this.output[2]>0?(this.TextureConstructor=l,this.formatValues=y.erect3DArray2,null):this.output[1]>0?(this.TextureConstructor=m,this.formatValues=y.erect2DArray2,null):(this.TextureConstructor=v,this.formatValues=y.erectArray2,null);case"Array(3)":return this.output[2]>0?(this.TextureConstructor=o,this.formatValues=y.erect3DArray3,null):this.output[1]>0?(this.TextureConstructor=a,this.formatValues=y.erect2DArray3,null):(this.TextureConstructor=h,this.formatValues=y.erectArray3,null);case"Array(4)":return this.output[2]>0?(this.TextureConstructor=P,this.formatValues=y.erect3DArray4,null):this.output[1]>0?(this.TextureConstructor=_,this.formatValues=y.erect2DArray4,null):(this.TextureConstructor=S,this.formatValues=y.erectArray4,null)}else switch(this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.output[2]>0?(this.TextureConstructor=T,this.formatValues=y.erect3DFloat,null):this.output[1]>0?(this.TextureConstructor=k,this.formatValues=y.erect2DFloat,null):(this.TextureConstructor=I,this.formatValues=y.erectFloat,null);case"Array(2)":return this.output[2]>0?(this.TextureConstructor=l,this.formatValues=y.erect3DArray2,null):this.output[1]>0?(this.TextureConstructor=m,this.formatValues=y.erect2DArray2,null):(this.TextureConstructor=v,this.formatValues=y.erectArray2,null);case"Array(3)":return this.output[2]>0?(this.TextureConstructor=o,this.formatValues=y.erect3DArray3,null):this.output[1]>0?(this.TextureConstructor=a,this.formatValues=y.erect2DArray3,null):(this.TextureConstructor=h,this.formatValues=y.erectArray3,null);case"Array(4)":return this.output[2]>0?(this.TextureConstructor=P,this.formatValues=y.erect3DArray4,null):this.output[1]>0?(this.TextureConstructor=_,this.formatValues=y.erect2DArray4,null):(this.TextureConstructor=S,this.formatValues=y.erectArray4,null)}}else throw new Error(`unhandled precision of "${this.precision}"`);throw new Error(`unhandled return type "${this.returnType}"`)}getKernelString(){throw new Error("abstract method call")}getMainResultTexture(){switch(this.returnType){case"LiteralInteger":case"Float":case"Integer":case"Number":return this.getMainResultNumberTexture();case"Array(2)":return this.getMainResultArray2Texture();case"Array(3)":return this.getMainResultArray3Texture();case"Array(4)":return this.getMainResultArray4Texture();default:throw new Error(`unhandled returnType type ${this.returnType}`)}}getMainResultKernelNumberTexture(){throw new Error("abstract method call")}getMainResultSubKernelNumberTexture(){throw new Error("abstract method call")}getMainResultKernelArray2Texture(){throw new Error("abstract method call")}getMainResultSubKernelArray2Texture(){throw new Error("abstract method call")}getMainResultKernelArray3Texture(){throw new Error("abstract method call")}getMainResultSubKernelArray3Texture(){throw new Error("abstract method call")}getMainResultKernelArray4Texture(){throw new Error("abstract method call")}getMainResultSubKernelArray4Texture(){throw new Error("abstract method call")}getMainResultGraphical(){throw new Error("abstract method call")}getMainResultMemoryOptimizedFloats(){throw new Error("abstract method call")}getMainResultPackedPixels(){throw new Error("abstract method call")}getMainResultString(){return this.graphical?this.getMainResultGraphical():this.precision==="single"?this.optimizeFloatMemory?this.getMainResultMemoryOptimizedFloats():this.getMainResultTexture():this.getMainResultPackedPixels()}getMainResultNumberTexture(){return y.linesToString(this.getMainResultKernelNumberTexture())+y.linesToString(this.getMainResultSubKernelNumberTexture())}getMainResultArray2Texture(){return y.linesToString(this.getMainResultKernelArray2Texture())+y.linesToString(this.getMainResultSubKernelArray2Texture())}getMainResultArray3Texture(){return y.linesToString(this.getMainResultKernelArray3Texture())+y.linesToString(this.getMainResultSubKernelArray3Texture())}getMainResultArray4Texture(){return y.linesToString(this.getMainResultKernelArray4Texture())+y.linesToString(this.getMainResultSubKernelArray4Texture())}getFloatTacticDeclaration(){return`precision ${this.getVariablePrecisionString(this.texSize,this.tactic)} float;
`}getIntTacticDeclaration(){return`precision ${this.getVariablePrecisionString(this.texSize,this.tactic,!0)} int;
`}getSampler2DTacticDeclaration(){return`precision ${this.getVariablePrecisionString(this.texSize,this.tactic)} sampler2D;
`}getSampler2DArrayTacticDeclaration(){return`precision ${this.getVariablePrecisionString(this.texSize,this.tactic)} sampler2DArray;
`}renderTexture(){return this.immutable?this.texture.clone():this.texture}readPackedPixelsToUint8Array(){if(this.precision!=="unsigned")throw new Error('Requires this.precision to be "unsigned"');const{texSize:ee,context:ue}=this,_e=new Uint8Array(ee[0]*ee[1]*4);return ue.readPixels(0,0,ee[0],ee[1],ue.RGBA,ue.UNSIGNED_BYTE,_e),_e}readPackedPixelsToFloat32Array(){return new Float32Array(this.readPackedPixelsToUint8Array().buffer)}readFloatPixelsToFloat32Array(){if(this.precision!=="single")throw new Error('Requires this.precision to be "single"');const{texSize:ee,context:ue}=this,_e=ee[0],Re=ee[1],ft=new Float32Array(_e*Re*4);return ue.readPixels(0,0,_e,Re,ue.RGBA,ue.FLOAT,ft),ft}getPixels(ee){const{context:ue,output:_e}=this,[Re,ft]=_e,it=new Uint8Array(Re*ft*4);return ue.readPixels(0,0,Re,ft,ue.RGBA,ue.UNSIGNED_BYTE,it),new Uint8ClampedArray((ee?it:y.flipPixels(it,Re,ft)).buffer)}renderKernelsToArrays(){const ee={result:this.renderOutput()};for(let ue=0;ue<this.subKernels.length;ue++)ee[this.subKernels[ue].property]=this.mappedTextures[ue].toArray();return ee}renderKernelsToTextures(){const ee={result:this.renderOutput()};if(this.immutable)for(let ue=0;ue<this.subKernels.length;ue++)ee[this.subKernels[ue].property]=this.mappedTextures[ue].clone();else for(let ue=0;ue<this.subKernels.length;ue++)ee[this.subKernels[ue].property]=this.mappedTextures[ue];return ee}resetSwitchingKernels(){const ee=this.switchingKernels;return this.switchingKernels=null,ee}setOutput(ee){const ue=this.toKernelOutput(ee);if(this.program){if(!this.dynamicOutput)throw new Error("Resizing a kernel with dynamicOutput: false is not possible");const _e=[ue[0],ue[1]||1,ue[2]||1],Re=y.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},_e),ft=this.texSize;if(ft){const Pe=this.getVariablePrecisionString(ft,this.tactic),mt=this.getVariablePrecisionString(Re,this.tactic);if(Pe!==mt){this.debug&&console.warn("Precision requirement changed, asking GPU instance to recompile"),this.switchKernels({type:"outputPrecisionMismatch",precision:mt,needed:ee});return}}this.output=ue,this.threadDim=_e,this.texSize=Re;const{context:it}=this;if(it.bindFramebuffer(it.FRAMEBUFFER,this.framebuffer),this.updateMaxTexSize(),this.framebuffer.width=this.texSize[0],this.framebuffer.height=this.texSize[1],it.viewport(0,0,this.maxTexSize[0],this.maxTexSize[1]),this.canvas.width=this.maxTexSize[0],this.canvas.height=this.maxTexSize[1],this.texture&&this.texture.delete(),this.texture=null,this._setupOutputTexture(),this.mappedTextures&&this.mappedTextures.length>0){for(let Pe=0;Pe<this.mappedTextures.length;Pe++)this.mappedTextures[Pe].delete();this.mappedTextures=null,this._setupSubOutputTextures()}}else this.output=ue;return this}renderValues(){return this.formatValues(this.transferValues(),this.output[0],this.output[1],this.output[2])}switchKernels(ee){this.switchingKernels?this.switchingKernels.push(ee):this.switchingKernels=[ee]}getVariablePrecisionString(ee=this.texSize,ue=this.tactic,_e=!1){if(!ue){if(!this.constructor.features.isSpeedTacticSupported)return"highp";const Re=this.constructor.features[_e?"lowIntPrecision":"lowFloatPrecision"],ft=this.constructor.features[_e?"mediumIntPrecision":"mediumFloatPrecision"],it=this.constructor.features[_e?"highIntPrecision":"highFloatPrecision"],Pe=Math.log2(ee[0]*ee[1]);if(Pe<=Re.rangeMax)return"lowp";if(Pe<=ft.rangeMax)return"mediump";if(Pe<=it.rangeMax)return"highp";throw new Error("The required size exceeds that of the ability of your system")}switch(ue){case"speed":return"lowp";case"balanced":return"mediump";case"precision":return"highp";default:throw new Error(`Unknown tactic "${ue}" use "speed", "balanced", "precision", or empty for auto`)}}updateTextureArgumentRefs(ee,ue){if(this.immutable){if(this.texture.texture===ue.texture){const{prevArg:_e}=ee;_e&&(_e.texture._refs===1&&(this.texture.delete(),this.texture=_e.clone(),this._textureSwitched=!0),_e.delete()),ee.prevArg=ue.clone()}else if(this.mappedTextures&&this.mappedTextures.length>0){const{mappedTextures:_e}=this;for(let Re=0;Re<_e.length;Re++){const ft=_e[Re];if(ft.texture===ue.texture){const{prevArg:it}=ee;it&&(it.texture._refs===1&&(ft.delete(),_e[Re]=it.clone(),this._mappedTextureSwitched[Re]=!0),it.delete()),ee.prevArg=ue.clone();return}}}}}onActivate(ee){if(this._textureSwitched=!0,this.texture=ee.texture,this.mappedTextures){for(let ue=0;ue<this.mappedTextures.length;ue++)this._mappedTextureSwitched[ue]=!0;this.mappedTextures=ee.mappedTextures}}initCanvas(){}}const K={int:"Integer",float:"Number",vec2:"Array(2)",vec3:"Array(3)",vec4:"Array(4)"};i.exports={GLKernel:V}},{"../../utils":114,"../kernel":36,"./texture/array-2-float":16,"./texture/array-2-float-2d":14,"./texture/array-2-float-3d":15,"./texture/array-3-float":19,"./texture/array-3-float-2d":17,"./texture/array-3-float-3d":18,"./texture/array-4-float":22,"./texture/array-4-float-2d":20,"./texture/array-4-float-3d":21,"./texture/float":25,"./texture/float-2d":23,"./texture/float-3d":24,"./texture/graphical":26,"./texture/memory-optimized":30,"./texture/memory-optimized-2d":28,"./texture/memory-optimized-3d":29,"./texture/unsigned":33,"./texture/unsigned-2d":31,"./texture/unsigned-3d":32}],14:[function(n,i,p){const{utils:d}=n("../../../utils"),{GLTextureFloat:y}=n("./float");class v extends y{constructor(l){super(l),this.type="ArrayTexture(2)"}toArray(){return d.erect2DArray2(this.renderValues(),this.output[0],this.output[1])}}i.exports={GLTextureArray2Float2D:v}},{"../../../utils":114,"./float":25}],15:[function(n,i,p){const{utils:d}=n("../../../utils"),{GLTextureFloat:y}=n("./float");class v extends y{constructor(l){super(l),this.type="ArrayTexture(2)"}toArray(){return d.erect3DArray2(this.renderValues(),this.output[0],this.output[1],this.output[2])}}i.exports={GLTextureArray2Float3D:v}},{"../../../utils":114,"./float":25}],16:[function(n,i,p){const{utils:d}=n("../../../utils"),{GLTextureFloat:y}=n("./float");class v extends y{constructor(l){super(l),this.type="ArrayTexture(2)"}toArray(){return d.erectArray2(this.renderValues(),this.output[0],this.output[1])}}i.exports={GLTextureArray2Float:v}},{"../../../utils":114,"./float":25}],17:[function(n,i,p){const{utils:d}=n("../../../utils"),{GLTextureFloat:y}=n("./float");class v extends y{constructor(l){super(l),this.type="ArrayTexture(3)"}toArray(){return d.erect2DArray3(this.renderValues(),this.output[0],this.output[1])}}i.exports={GLTextureArray3Float2D:v}},{"../../../utils":114,"./float":25}],18:[function(n,i,p){const{utils:d}=n("../../../utils"),{GLTextureFloat:y}=n("./float");class v extends y{constructor(l){super(l),this.type="ArrayTexture(3)"}toArray(){return d.erect3DArray3(this.renderValues(),this.output[0],this.output[1],this.output[2])}}i.exports={GLTextureArray3Float3D:v}},{"../../../utils":114,"./float":25}],19:[function(n,i,p){const{utils:d}=n("../../../utils"),{GLTextureFloat:y}=n("./float");class v extends y{constructor(l){super(l),this.type="ArrayTexture(3)"}toArray(){return d.erectArray3(this.renderValues(),this.output[0])}}i.exports={GLTextureArray3Float:v}},{"../../../utils":114,"./float":25}],20:[function(n,i,p){const{utils:d}=n("../../../utils"),{GLTextureFloat:y}=n("./float");class v extends y{constructor(l){super(l),this.type="ArrayTexture(4)"}toArray(){return d.erect2DArray4(this.renderValues(),this.output[0],this.output[1])}}i.exports={GLTextureArray4Float2D:v}},{"../../../utils":114,"./float":25}],21:[function(n,i,p){const{utils:d}=n("../../../utils"),{GLTextureFloat:y}=n("./float");class v extends y{constructor(l){super(l),this.type="ArrayTexture(4)"}toArray(){return d.erect3DArray4(this.renderValues(),this.output[0],this.output[1],this.output[2])}}i.exports={GLTextureArray4Float3D:v}},{"../../../utils":114,"./float":25}],22:[function(n,i,p){const{utils:d}=n("../../../utils"),{GLTextureFloat:y}=n("./float");class v extends y{constructor(l){super(l),this.type="ArrayTexture(4)"}toArray(){return d.erectArray4(this.renderValues(),this.output[0])}}i.exports={GLTextureArray4Float:v}},{"../../../utils":114,"./float":25}],23:[function(n,i,p){const{utils:d}=n("../../../utils"),{GLTextureFloat:y}=n("./float");class v extends y{constructor(l){super(l),this.type="ArrayTexture(1)"}toArray(){return d.erect2DFloat(this.renderValues(),this.output[0],this.output[1])}}i.exports={GLTextureFloat2D:v}},{"../../../utils":114,"./float":25}],24:[function(n,i,p){const{utils:d}=n("../../../utils"),{GLTextureFloat:y}=n("./float");class v extends y{constructor(l){super(l),this.type="ArrayTexture(1)"}toArray(){return d.erect3DFloat(this.renderValues(),this.output[0],this.output[1],this.output[2])}}i.exports={GLTextureFloat3D:v}},{"../../../utils":114,"./float":25}],25:[function(n,i,p){const{utils:d}=n("../../../utils"),{GLTexture:y}=n("./index");class v extends y{get textureType(){return this.context.FLOAT}constructor(l){super(l),this.type="ArrayTexture(1)"}renderRawOutput(){const l=this.context,h=this.size;l.bindFramebuffer(l.FRAMEBUFFER,this.framebuffer()),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,this.texture,0);const a=new Float32Array(h[0]*h[1]*4);return l.readPixels(0,0,h[0],h[1],l.RGBA,l.FLOAT,a),a}renderValues(){return this._deleted?null:this.renderRawOutput()}toArray(){return d.erectFloat(this.renderValues(),this.output[0])}}i.exports={GLTextureFloat:v}},{"../../../utils":114,"./index":27}],26:[function(n,i,p){const{GLTextureUnsigned:d}=n("./unsigned");class y extends d{constructor(m){super(m),this.type="ArrayTexture(4)"}toArray(){return this.renderValues()}}i.exports={GLTextureGraphical:y}},{"./unsigned":33}],27:[function(n,i,p){const{Texture:d}=n("../../../texture");class y extends d{get textureType(){throw new Error(`"textureType" not implemented on ${this.name}`)}clone(){return new this.constructor(this)}beforeMutate(){return this.texture._refs>1?(this.newTexture(),!0):!1}cloneTexture(){this.texture._refs--;const{context:l,size:h,texture:a,kernel:o}=this;o.debug&&console.warn("cloning internal texture"),l.bindFramebuffer(l.FRAMEBUFFER,this.framebuffer()),v(l,a),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,a,0);const S=l.createTexture();v(l,S),l.texImage2D(l.TEXTURE_2D,0,this.internalFormat,h[0],h[1],0,this.textureFormat,this.textureType,null),l.copyTexSubImage2D(l.TEXTURE_2D,0,0,0,0,0,h[0],h[1]),S._refs=1,this.texture=S}newTexture(){this.texture._refs--;const l=this.context,h=this.size;this.kernel.debug&&console.warn("new internal texture");const o=l.createTexture();v(l,o),l.texImage2D(l.TEXTURE_2D,0,this.internalFormat,h[0],h[1],0,this.textureFormat,this.textureType,null),o._refs=1,this.texture=o}clear(){if(this.texture._refs){this.texture._refs--;const a=this.context,o=this.texture=a.createTexture();v(a,o);const S=this.size;o._refs=1,a.texImage2D(a.TEXTURE_2D,0,this.internalFormat,S[0],S[1],0,this.textureFormat,this.textureType,null)}const{context:l,texture:h}=this;l.bindFramebuffer(l.FRAMEBUFFER,this.framebuffer()),l.bindTexture(l.TEXTURE_2D,h),v(l,h),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,h,0),l.clearColor(0,0,0,0),l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT)}delete(){this._deleted||(this._deleted=!0,!(this.texture._refs&&(this.texture._refs--,this.texture._refs))&&this.context.deleteTexture(this.texture))}framebuffer(){return this._framebuffer||(this._framebuffer=this.kernel.getRawValueFramebuffer(this.size[0],this.size[1])),this._framebuffer}}function v(m,l){m.activeTexture(m.TEXTURE15),m.bindTexture(m.TEXTURE_2D,l),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST)}i.exports={GLTexture:y}},{"../../../texture":113}],28:[function(n,i,p){const{utils:d}=n("../../../utils"),{GLTextureFloat:y}=n("./float");class v extends y{constructor(l){super(l),this.type="MemoryOptimizedNumberTexture"}toArray(){return d.erectMemoryOptimized2DFloat(this.renderValues(),this.output[0],this.output[1])}}i.exports={GLTextureMemoryOptimized2D:v}},{"../../../utils":114,"./float":25}],29:[function(n,i,p){const{utils:d}=n("../../../utils"),{GLTextureFloat:y}=n("./float");class v extends y{constructor(l){super(l),this.type="MemoryOptimizedNumberTexture"}toArray(){return d.erectMemoryOptimized3DFloat(this.renderValues(),this.output[0],this.output[1],this.output[2])}}i.exports={GLTextureMemoryOptimized3D:v}},{"../../../utils":114,"./float":25}],30:[function(n,i,p){const{utils:d}=n("../../../utils"),{GLTextureFloat:y}=n("./float");class v extends y{constructor(l){super(l),this.type="MemoryOptimizedNumberTexture"}toArray(){return d.erectMemoryOptimizedFloat(this.renderValues(),this.output[0])}}i.exports={GLTextureMemoryOptimized:v}},{"../../../utils":114,"./float":25}],31:[function(n,i,p){const{utils:d}=n("../../../utils"),{GLTextureUnsigned:y}=n("./unsigned");class v extends y{constructor(l){super(l),this.type="NumberTexture"}toArray(){return d.erect2DPackedFloat(this.renderValues(),this.output[0],this.output[1])}}i.exports={GLTextureUnsigned2D:v}},{"../../../utils":114,"./unsigned":33}],32:[function(n,i,p){const{utils:d}=n("../../../utils"),{GLTextureUnsigned:y}=n("./unsigned");class v extends y{constructor(l){super(l),this.type="NumberTexture"}toArray(){return d.erect3DPackedFloat(this.renderValues(),this.output[0],this.output[1],this.output[2])}}i.exports={GLTextureUnsigned3D:v}},{"../../../utils":114,"./unsigned":33}],33:[function(n,i,p){const{utils:d}=n("../../../utils"),{GLTexture:y}=n("./index");class v extends y{get textureType(){return this.context.UNSIGNED_BYTE}constructor(l){super(l),this.type="NumberTexture"}renderRawOutput(){const{context:l}=this;l.bindFramebuffer(l.FRAMEBUFFER,this.framebuffer()),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,this.texture,0);const h=new Uint8Array(this.size[0]*this.size[1]*4);return l.readPixels(0,0,this.size[0],this.size[1],l.RGBA,l.UNSIGNED_BYTE,h),h}renderValues(){return this._deleted?null:new Float32Array(this.renderRawOutput().buffer)}toArray(){return d.erectPackedFloat(this.renderValues(),this.output[0])}}i.exports={GLTextureUnsigned:v}},{"../../../utils":114,"./index":27}],34:[function(n,i,p){const d=n("gl"),{WebGLKernel:y}=n("../web-gl/kernel"),{glKernelString:v}=n("../gl/kernel-string");let m=null,l=null,h=null,a=null,o=null;class S extends y{static get isSupported(){return m!==null||(this.setupFeatureChecks(),m=h!==null),m}static setupFeatureChecks(){if(l=null,a=null,typeof d=="function")try{if(h=d(2,2,{preserveDrawingBuffer:!0}),!h||!h.getExtension)return;a={STACKGL_resize_drawingbuffer:h.getExtension("STACKGL_resize_drawingbuffer"),STACKGL_destroy_context:h.getExtension("STACKGL_destroy_context"),OES_texture_float:h.getExtension("OES_texture_float"),OES_texture_float_linear:h.getExtension("OES_texture_float_linear"),OES_element_index_uint:h.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:h.getExtension("WEBGL_draw_buffers"),WEBGL_color_buffer_float:h.getExtension("WEBGL_color_buffer_float")},o=this.getFeatures()}catch(P){console.warn(P)}}static isContextMatch(P){try{return P.getParameter(P.RENDERER)==="ANGLE"}catch{return!1}}static getIsTextureFloat(){return!!a.OES_texture_float}static getIsDrawBuffers(){return!!a.WEBGL_draw_buffers}static getChannelCount(){return a.WEBGL_draw_buffers?h.getParameter(a.WEBGL_draw_buffers.MAX_DRAW_BUFFERS_WEBGL):1}static getMaxTextureSize(){return h.getParameter(h.MAX_TEXTURE_SIZE)}static get testCanvas(){return l}static get testContext(){return h}static get features(){return o}initCanvas(){return{}}initContext(){return d(2,2,{preserveDrawingBuffer:!0})}initExtensions(){this.extensions={STACKGL_resize_drawingbuffer:this.context.getExtension("STACKGL_resize_drawingbuffer"),STACKGL_destroy_context:this.context.getExtension("STACKGL_destroy_context"),OES_texture_float:this.context.getExtension("OES_texture_float"),OES_texture_float_linear:this.context.getExtension("OES_texture_float_linear"),OES_element_index_uint:this.context.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:this.context.getExtension("WEBGL_draw_buffers")}}build(){super.build.apply(this,arguments),this.fallbackRequested||this.extensions.STACKGL_resize_drawingbuffer.resize(this.maxTexSize[0],this.maxTexSize[1])}destroyExtensions(){this.extensions.STACKGL_resize_drawingbuffer=null,this.extensions.STACKGL_destroy_context=null,this.extensions.OES_texture_float=null,this.extensions.OES_texture_float_linear=null,this.extensions.OES_element_index_uint=null,this.extensions.WEBGL_draw_buffers=null}static destroyContext(P){const I=P.getExtension("STACKGL_destroy_context");I&&I.destroy&&I.destroy()}toString(){return v(this.constructor,arguments,this,`const gl = context || require('gl')(1, 1);
`,`    if (!context) { gl.getExtension('STACKGL_destroy_context').destroy(); }
`)}setOutput(P){return super.setOutput(P),this.graphical&&this.extensions.STACKGL_resize_drawingbuffer&&this.extensions.STACKGL_resize_drawingbuffer.resize(this.maxTexSize[0],this.maxTexSize[1]),this}}i.exports={HeadlessGLKernel:S}},{"../gl/kernel-string":12,"../web-gl/kernel":70,gl:2}],35:[function(n,i,p){class d{constructor(v,m){const{name:l,kernel:h,context:a,checkContext:o,onRequestContextHandle:S,onUpdateValueMismatch:_,origin:P,strictIntegers:I,type:k,tactic:T}=m;if(!l)throw new Error("name not set");if(!k)throw new Error("type not set");if(!P)throw new Error("origin not set");if(P!=="user"&&P!=="constants")throw new Error(`origin must be "user" or "constants" value is "${P}"`);if(!S)throw new Error("onRequestContextHandle is not set");this.name=l,this.origin=P,this.tactic=T,this.varName=P==="constants"?`constants.${l}`:l,this.kernel=h,this.strictIntegers=I,this.type=v.type||k,this.size=v.size||null,this.index=null,this.context=a,this.checkContext=o??!0,this.contextHandle=null,this.onRequestContextHandle=S,this.onUpdateValueMismatch=_,this.forceUploadEachRun=null}get id(){return`${this.origin}_${name}`}getSource(){throw new Error(`"getSource" not defined on ${this.constructor.name}`)}updateValue(v){throw new Error(`"updateValue" not defined on ${this.constructor.name}`)}}i.exports={KernelValue:d}},{}],36:[function(n,i,p){const{utils:d}=n("../utils"),{Input:y}=n("../input");class v{static get isSupported(){throw new Error(`"isSupported" not implemented on ${this.name}`)}static isContextMatch(h){throw new Error(`"isContextMatch" not implemented on ${this.name}`)}static getFeatures(){throw new Error(`"getFeatures" not implemented on ${this.name}`)}static destroyContext(h){throw new Error(`"destroyContext" called on ${this.name}`)}static nativeFunctionArguments(){throw new Error(`"nativeFunctionArguments" called on ${this.name}`)}static nativeFunctionReturnType(){throw new Error(`"nativeFunctionReturnType" called on ${this.name}`)}static combineKernels(){throw new Error(`"combineKernels" called on ${this.name}`)}constructor(h,a){if(typeof h!="object"){if(typeof h!="string")throw new Error("source not a string");if(!d.isFunctionString(h))throw new Error("source not a function string")}this.useLegacyEncoder=!1,this.fallbackRequested=!1,this.onRequestFallback=null,this.argumentNames=typeof h=="string"?d.getArgumentNamesFromString(h):null,this.argumentTypes=null,this.argumentSizes=null,this.argumentBitRatios=null,this.kernelArguments=null,this.kernelConstants=null,this.forceUploadKernelConstants=null,this.source=h,this.output=null,this.debug=!1,this.graphical=!1,this.loopMaxIterations=0,this.constants=null,this.constantTypes=null,this.constantBitRatios=null,this.dynamicArguments=!1,this.dynamicOutput=!1,this.canvas=null,this.context=null,this.checkContext=null,this.gpu=null,this.functions=null,this.nativeFunctions=null,this.injectedNative=null,this.subKernels=null,this.validate=!0,this.immutable=!1,this.pipeline=!1,this.precision=null,this.tactic=null,this.plugins=null,this.returnType=null,this.leadingReturnStatement=null,this.followingReturnStatement=null,this.optimizeFloatMemory=null,this.strictIntegers=!1,this.fixIntegerDivisionAccuracy=null,this.built=!1,this.signature=null}mergeSettings(h){for(let a in h)if(!(!h.hasOwnProperty(a)||!this.hasOwnProperty(a))){switch(a){case"output":if(!Array.isArray(h.output)){this.setOutput(h.output);continue}break;case"functions":this.functions=[];for(let o=0;o<h.functions.length;o++)this.addFunction(h.functions[o]);continue;case"graphical":h[a]&&!h.hasOwnProperty("precision")&&(this.precision="unsigned"),this[a]=h[a];continue;case"nativeFunctions":if(!h.nativeFunctions)continue;this.nativeFunctions=[];for(let o=0;o<h.nativeFunctions.length;o++){const S=h.nativeFunctions[o],{name:_,source:P}=S;this.addNativeFunction(_,P,S)}continue}this[a]=h[a]}this.canvas||(this.canvas=this.initCanvas()),this.context||(this.context=this.initContext()),this.plugins||(this.plugins=this.initPlugins(h))}build(){throw new Error(`"build" not defined on ${this.constructor.name}`)}run(){throw new Error(`"run" not defined on ${this.constructor.name}`)}initCanvas(){throw new Error(`"initCanvas" not defined on ${this.constructor.name}`)}initContext(){throw new Error(`"initContext" not defined on ${this.constructor.name}`)}initPlugins(h){throw new Error(`"initPlugins" not defined on ${this.constructor.name}`)}addFunction(h,a={}){if(h.name&&h.source&&h.argumentTypes&&"returnType"in h)this.functions.push(h);else if("settings"in h&&"source"in h)this.functions.push(this.functionToIGPUFunction(h.source,h.settings));else if(typeof h=="string"||typeof h=="function")this.functions.push(this.functionToIGPUFunction(h,a));else throw new Error("function not properly defined");return this}addNativeFunction(h,a,o={}){const{argumentTypes:S,argumentNames:_}=o.argumentTypes?m(o.argumentTypes):this.constructor.nativeFunctionArguments(a)||{};return this.nativeFunctions.push({name:h,source:a,settings:o,argumentTypes:S,argumentNames:_,returnType:o.returnType||this.constructor.nativeFunctionReturnType(a)}),this}setupArguments(h){if(this.kernelArguments=[],this.argumentTypes)for(let a=0;a<this.argumentTypes.length;a++)this.kernelArguments.push({type:this.argumentTypes[a]});else if(!this.argumentTypes){this.argumentTypes=[];for(let a=0;a<h.length;a++){const o=d.getVariableType(h[a],this.strictIntegers),S=o==="Integer"?"Number":o;this.argumentTypes.push(S),this.kernelArguments.push({type:S})}}this.argumentSizes=new Array(h.length),this.argumentBitRatios=new Int32Array(h.length);for(let a=0;a<h.length;a++){const o=h[a];this.argumentSizes[a]=o.constructor===y?o.size:null,this.argumentBitRatios[a]=this.getBitRatio(o)}if(this.argumentNames.length!==h.length)throw new Error("arguments are miss-aligned")}setupConstants(){this.kernelConstants=[];let h=this.constantTypes===null;if(h&&(this.constantTypes={}),this.constantBitRatios={},this.constants)for(let a in this.constants){if(h){const o=d.getVariableType(this.constants[a],this.strictIntegers);this.constantTypes[a]=o,this.kernelConstants.push({name:a,type:o})}else this.kernelConstants.push({name:a,type:this.constantTypes[a]});this.constantBitRatios[a]=this.getBitRatio(this.constants[a])}}setOptimizeFloatMemory(h){return this.optimizeFloatMemory=h,this}toKernelOutput(h){return h.hasOwnProperty("x")?h.hasOwnProperty("y")?h.hasOwnProperty("z")?[h.x,h.y,h.z]:[h.x,h.y]:[h.x]:h}setOutput(h){return this.output=this.toKernelOutput(h),this}setDebug(h){return this.debug=h,this}setGraphical(h){return this.graphical=h,this.precision="unsigned",this}setLoopMaxIterations(h){return this.loopMaxIterations=h,this}setConstants(h){return this.constants=h,this}setConstantTypes(h){return this.constantTypes=h,this}setFunctions(h){for(let a=0;a<h.length;a++)this.addFunction(h[a]);return this}setNativeFunctions(h){for(let a=0;a<h.length;a++){const o=h[a],{name:S,source:_}=o;this.addNativeFunction(S,_,o)}return this}setInjectedNative(h){return this.injectedNative=h,this}setPipeline(h){return this.pipeline=h,this}setPrecision(h){return this.precision=h,this}setDimensions(h){return d.warnDeprecated("method","setDimensions","setOutput"),this.output=h,this}setOutputToTexture(h){return d.warnDeprecated("method","setOutputToTexture","setPipeline"),this.pipeline=h,this}setImmutable(h){return this.immutable=h,this}setCanvas(h){return this.canvas=h,this}setStrictIntegers(h){return this.strictIntegers=h,this}setDynamicOutput(h){return this.dynamicOutput=h,this}setHardcodeConstants(h){return d.warnDeprecated("method","setHardcodeConstants"),this.setDynamicOutput(h),this.setDynamicArguments(h),this}setDynamicArguments(h){return this.dynamicArguments=h,this}setUseLegacyEncoder(h){return this.useLegacyEncoder=h,this}setWarnVarUsage(h){return d.warnDeprecated("method","setWarnVarUsage"),this}getCanvas(){return d.warnDeprecated("method","getCanvas"),this.canvas}getWebGl(){return d.warnDeprecated("method","getWebGl"),this.context}setContext(h){return this.context=h,this}setArgumentTypes(h){if(Array.isArray(h))this.argumentTypes=h;else{this.argumentTypes=[];for(const a in h){if(!h.hasOwnProperty(a))continue;const o=this.argumentNames.indexOf(a);if(o===-1)throw new Error(`unable to find argument ${a}`);this.argumentTypes[o]=h[a]}}return this}setTactic(h){return this.tactic=h,this}requestFallback(h){if(!this.onRequestFallback)throw new Error(`"onRequestFallback" not defined on ${this.constructor.name}`);return this.fallbackRequested=!0,this.onRequestFallback(h)}validateSettings(){throw new Error(`"validateSettings" not defined on ${this.constructor.name}`)}addSubKernel(h){if(this.subKernels===null&&(this.subKernels=[]),!h.source)throw new Error('subKernel missing "source" property');if(!h.property&&isNaN(h.property))throw new Error('subKernel missing "property" property');if(!h.name)throw new Error('subKernel missing "name" property');return this.subKernels.push(h),this}destroy(h){throw new Error(`"destroy" called on ${this.constructor.name}`)}getBitRatio(h){if(this.precision==="single")return 4;if(Array.isArray(h[0]))return this.getBitRatio(h[0]);if(h.constructor===y)return this.getBitRatio(h.value);switch(h.constructor){case Uint8ClampedArray:case Uint8Array:case Int8Array:return 1;case Uint16Array:case Int16Array:return 2;case Float32Array:case Int32Array:default:return 4}}getPixels(h){throw new Error(`"getPixels" called on ${this.constructor.name}`)}checkOutput(){if(!this.output||!d.isArray(this.output))throw new Error("kernel.output not an array");if(this.output.length<1)throw new Error("kernel.output is empty, needs at least 1 value");for(let h=0;h<this.output.length;h++)if(isNaN(this.output[h])||this.output[h]<1)throw new Error(`${this.constructor.name}.output[${h}] incorrectly defined as \`${this.output[h]}\`, needs to be numeric, and greater than 0`)}prependString(h){throw new Error(`"prependString" called on ${this.constructor.name}`)}hasPrependString(h){throw new Error(`"hasPrependString" called on ${this.constructor.name}`)}toJSON(){return{settings:{output:this.output,pipeline:this.pipeline,argumentNames:this.argumentNames,argumentsTypes:this.argumentTypes,constants:this.constants,pluginNames:this.plugins?this.plugins.map(h=>h.name):null,returnType:this.returnType}}}buildSignature(h){const a=this.constructor;this.signature=a.getSignature(this,a.getArgumentTypes(this,h))}static getArgumentTypes(h,a){const o=new Array(a.length);for(let S=0;S<a.length;S++){const _=a[S],P=h.argumentTypes[S];if(_.type)o[S]=_.type;else switch(P){case"Number":case"Integer":case"Float":case"ArrayTexture(1)":o[S]=d.getVariableType(_);break;default:o[S]=P}}return o}static getSignature(h,a){throw new Error(`"getSignature" not implemented on ${this.name}`)}functionToIGPUFunction(h,a={}){if(typeof h!="string"&&typeof h!="function")throw new Error("source not a string or function");const o=typeof h=="string"?h:h.toString();let S=[];return Array.isArray(a.argumentTypes)?S=a.argumentTypes:typeof a.argumentTypes=="object"?S=d.getArgumentNamesFromString(o).map(_=>a.argumentTypes[_])||[]:S=a.argumentTypes||[],{name:d.getFunctionNameFromString(o)||null,source:o,argumentTypes:S,returnType:a.returnType||null}}onActivate(h){}}function m(l){const h=Object.keys(l),a=[];for(let o=0;o<h.length;o++){const S=h[o];a.push(l[S])}return{argumentTypes:a,argumentNames:h}}i.exports={Kernel:v}},{"../input":110,"../utils":114}],37:[function(n,i,p){const d=`__HEADER__;
__FLOAT_TACTIC_DECLARATION__;
__INT_TACTIC_DECLARATION__;
__SAMPLER_2D_TACTIC_DECLARATION__;

const int LOOP_MAX = __LOOP_MAX__;

__PLUGINS__;
__CONSTANTS__;

varying vec2 vTexCoord;

float acosh(float x) {
  return log(x + sqrt(x * x - 1.0));
}

float sinh(float x) {
  return (pow(${Math.E}, x) - pow(${Math.E}, -x)) / 2.0;
}

float asinh(float x) {
  return log(x + sqrt(x * x + 1.0));
}

float atan2(float v1, float v2) {
  if (v1 == 0.0 || v2 == 0.0) return 0.0;
  return atan(v1 / v2);
}

float atanh(float x) {
  x = (x + 1.0) / (x - 1.0);
  if (x < 0.0) {
    return 0.5 * log(-x);
  }
  return 0.5 * log(x);
}

float cbrt(float x) {
  if (x >= 0.0) {
    return pow(x, 1.0 / 3.0);
  } else {
    return -pow(x, 1.0 / 3.0);
  }
}

float cosh(float x) {
  return (pow(${Math.E}, x) + pow(${Math.E}, -x)) / 2.0; 
}

float expm1(float x) {
  return pow(${Math.E}, x) - 1.0; 
}

float fround(highp float x) {
  return x;
}

float imul(float v1, float v2) {
  return float(int(v1) * int(v2));
}

float log10(float x) {
  return log2(x) * (1.0 / log2(10.0));
}

float log1p(float x) {
  return log(1.0 + x);
}

float _pow(float v1, float v2) {
  if (v2 == 0.0) return 1.0;
  return pow(v1, v2);
}

float tanh(float x) {
  float e = exp(2.0 * x);
  return (e - 1.0) / (e + 1.0);
}

float trunc(float x) {
  if (x >= 0.0) {
    return floor(x); 
  } else {
    return ceil(x);
  }
}

vec4 _round(vec4 x) {
  return floor(x + 0.5);
}

float _round(float x) {
  return floor(x + 0.5);
}

const int BIT_COUNT = 32;
int modi(int x, int y) {
  return x - y * (x / y);
}

int bitwiseOr(int a, int b) {
  int result = 0;
  int n = 1;
  
  for (int i = 0; i < BIT_COUNT; i++) {
    if ((modi(a, 2) == 1) || (modi(b, 2) == 1)) {
      result += n;
    }
    a = a / 2;
    b = b / 2;
    n = n * 2;
    if(!(a > 0 || b > 0)) {
      break;
    }
  }
  return result;
}
int bitwiseXOR(int a, int b) {
  int result = 0;
  int n = 1;
  
  for (int i = 0; i < BIT_COUNT; i++) {
    if ((modi(a, 2) == 1) != (modi(b, 2) == 1)) {
      result += n;
    }
    a = a / 2;
    b = b / 2;
    n = n * 2;
    if(!(a > 0 || b > 0)) {
      break;
    }
  }
  return result;
}
int bitwiseAnd(int a, int b) {
  int result = 0;
  int n = 1;
  for (int i = 0; i < BIT_COUNT; i++) {
    if ((modi(a, 2) == 1) && (modi(b, 2) == 1)) {
      result += n;
    }
    a = a / 2;
    b = b / 2;
    n = n * 2;
    if(!(a > 0 && b > 0)) {
      break;
    }
  }
  return result;
}
int bitwiseNot(int a) {
  int result = 0;
  int n = 1;
  
  for (int i = 0; i < BIT_COUNT; i++) {
    if (modi(a, 2) == 0) {
      result += n;    
    }
    a = a / 2;
    n = n * 2;
  }
  return result;
}
int bitwiseZeroFillLeftShift(int n, int shift) {
  int maxBytes = BIT_COUNT;
  for (int i = 0; i < BIT_COUNT; i++) {
    if (maxBytes >= n) {
      break;
    }
    maxBytes *= 2;
  }
  for (int i = 0; i < BIT_COUNT; i++) {
    if (i >= shift) {
      break;
    }
    n *= 2;
  }

  int result = 0;
  int byteVal = 1;
  for (int i = 0; i < BIT_COUNT; i++) {
    if (i >= maxBytes) break;
    if (modi(n, 2) > 0) { result += byteVal; }
    n = int(n / 2);
    byteVal *= 2;
  }
  return result;
}

int bitwiseSignedRightShift(int num, int shifts) {
  return int(floor(float(num) / pow(2.0, float(shifts))));
}

int bitwiseZeroFillRightShift(int n, int shift) {
  int maxBytes = BIT_COUNT;
  for (int i = 0; i < BIT_COUNT; i++) {
    if (maxBytes >= n) {
      break;
    }
    maxBytes *= 2;
  }
  for (int i = 0; i < BIT_COUNT; i++) {
    if (i >= shift) {
      break;
    }
    n /= 2;
  }
  int result = 0;
  int byteVal = 1;
  for (int i = 0; i < BIT_COUNT; i++) {
    if (i >= maxBytes) break;
    if (modi(n, 2) > 0) { result += byteVal; }
    n = int(n / 2);
    byteVal *= 2;
  }
  return result;
}

vec2 integerMod(vec2 x, float y) {
  vec2 res = floor(mod(x, y));
  return res * step(1.0 - floor(y), -res);
}

vec3 integerMod(vec3 x, float y) {
  vec3 res = floor(mod(x, y));
  return res * step(1.0 - floor(y), -res);
}

vec4 integerMod(vec4 x, vec4 y) {
  vec4 res = floor(mod(x, y));
  return res * step(1.0 - floor(y), -res);
}

float integerMod(float x, float y) {
  float res = floor(mod(x, y));
  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);
}

int integerMod(int x, int y) {
  return x - (y * int(x / y));
}

__DIVIDE_WITH_INTEGER_CHECK__;

// Here be dragons!
// DO NOT OPTIMIZE THIS CODE
// YOU WILL BREAK SOMETHING ON SOMEBODY'S MACHINE
// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME
const vec2 MAGIC_VEC = vec2(1.0, -256.0);
const vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);
const vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536
float decode32(vec4 texel) {
  __DECODE32_ENDIANNESS__;
  texel *= 255.0;
  vec2 gte128;
  gte128.x = texel.b >= 128.0 ? 1.0 : 0.0;
  gte128.y = texel.a >= 128.0 ? 1.0 : 0.0;
  float exponent = 2.0 * texel.a - 127.0 + dot(gte128, MAGIC_VEC);
  float res = exp2(_round(exponent));
  texel.b = texel.b - 128.0 * gte128.x;
  res = dot(texel, SCALE_FACTOR) * exp2(_round(exponent-23.0)) + res;
  res *= gte128.y * -2.0 + 1.0;
  return res;
}

float decode16(vec4 texel, int index) {
  int channel = integerMod(index, 2);
  if (channel == 0) return texel.r * 255.0 + texel.g * 65280.0;
  if (channel == 1) return texel.b * 255.0 + texel.a * 65280.0;
  return 0.0;
}

float decode8(vec4 texel, int index) {
  int channel = integerMod(index, 4);
  if (channel == 0) return texel.r * 255.0;
  if (channel == 1) return texel.g * 255.0;
  if (channel == 2) return texel.b * 255.0;
  if (channel == 3) return texel.a * 255.0;
  return 0.0;
}

vec4 legacyEncode32(float f) {
  float F = abs(f);
  float sign = f < 0.0 ? 1.0 : 0.0;
  float exponent = floor(log2(F));
  float mantissa = (exp2(-exponent) * F);
  // exponent += floor(log2(mantissa));
  vec4 texel = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;
  texel.rg = integerMod(texel.rg, 256.0);
  texel.b = integerMod(texel.b, 128.0);
  texel.a = exponent*0.5 + 63.5;
  texel.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;
  texel = floor(texel);
  texel *= 0.003921569; // 1/255
  __ENCODE32_ENDIANNESS__;
  return texel;
}

// https://github.com/gpujs/gpu.js/wiki/Encoder-details
vec4 encode32(float value) {
  if (value == 0.0) return vec4(0, 0, 0, 0);

  float exponent;
  float mantissa;
  vec4  result;
  float sgn;

  sgn = step(0.0, -value);
  value = abs(value);

  exponent = floor(log2(value));

  mantissa = value*pow(2.0, -exponent)-1.0;
  exponent = exponent+127.0;
  result   = vec4(0,0,0,0);

  result.a = floor(exponent/2.0);
  exponent = exponent - result.a*2.0;
  result.a = result.a + 128.0*sgn;

  result.b = floor(mantissa * 128.0);
  mantissa = mantissa - result.b / 128.0;
  result.b = result.b + exponent*128.0;

  result.g = floor(mantissa*32768.0);
  mantissa = mantissa - result.g/32768.0;

  result.r = floor(mantissa*8388608.0);
  return result/255.0;
}
// Dragons end here

int index;
ivec3 threadId;

ivec3 indexTo3D(int idx, ivec3 texDim) {
  int z = int(idx / (texDim.x * texDim.y));
  idx -= z * int(texDim.x * texDim.y);
  int y = int(idx / texDim.x);
  int x = int(integerMod(idx, texDim.x));
  return ivec3(x, y, z);
}

float get32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture2D(tex, st / vec2(texSize));
  return decode32(texel);
}

float get16(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int w = texSize.x * 2;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture2D(tex, st / vec2(texSize.x * 2, texSize.y));
  return decode16(texel, index);
}

float get8(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int w = texSize.x * 4;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture2D(tex, st / vec2(texSize.x * 4, texSize.y));
  return decode8(texel, index);
}

float getMemoryOptimized32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int channel = integerMod(index, 4);
  index = index / 4;
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture2D(tex, st / vec2(texSize));
  if (channel == 0) return texel.r;
  if (channel == 1) return texel.g;
  if (channel == 2) return texel.b;
  if (channel == 3) return texel.a;
  return 0.0;
}

vec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  return texture2D(tex, st / vec2(texSize));
}

float getFloatFromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);
  return result[0];
}

vec2 getVec2FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);
  return vec2(result[0], result[1]);
}

vec2 getMemoryOptimizedVec2(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + (texDim.x * (y + (texDim.y * z)));
  int channel = integerMod(index, 2);
  index = index / 2;
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture2D(tex, st / vec2(texSize));
  if (channel == 0) return vec2(texel.r, texel.g);
  if (channel == 1) return vec2(texel.b, texel.a);
  return vec2(0.0, 0.0);
}

vec3 getVec3FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);
  return vec3(result[0], result[1], result[2]);
}

vec3 getMemoryOptimizedVec3(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int fieldIndex = 3 * (x + texDim.x * (y + texDim.y * z));
  int vectorIndex = fieldIndex / 4;
  int vectorOffset = fieldIndex - vectorIndex * 4;
  int readY = vectorIndex / texSize.x;
  int readX = vectorIndex - readY * texSize.x;
  vec4 tex1 = texture2D(tex, (vec2(readX, readY) + 0.5) / vec2(texSize));
  
  if (vectorOffset == 0) {
    return tex1.xyz;
  } else if (vectorOffset == 1) {
    return tex1.yzw;
  } else {
    readX++;
    if (readX >= texSize.x) {
      readX = 0;
      readY++;
    }
    vec4 tex2 = texture2D(tex, vec2(readX, readY) / vec2(texSize));
    if (vectorOffset == 2) {
      return vec3(tex1.z, tex1.w, tex2.x);
    } else {
      return vec3(tex1.w, tex2.x, tex2.y);
    }
  }
}

vec4 getVec4FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  return getImage2D(tex, texSize, texDim, z, y, x);
}

vec4 getMemoryOptimizedVec4(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int channel = integerMod(index, 2);
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture2D(tex, st / vec2(texSize));
  return vec4(texel.r, texel.g, texel.b, texel.a);
}

vec4 actualColor;
void color(float r, float g, float b, float a) {
  actualColor = vec4(r,g,b,a);
}

void color(float r, float g, float b) {
  color(r,g,b,1.0);
}

void color(sampler2D image) {
  actualColor = texture2D(image, vTexCoord);
}

float modulo(float number, float divisor) {
  if (number < 0.0) {
    number = abs(number);
    if (divisor < 0.0) {
      divisor = abs(divisor);
    }
    return -mod(number, divisor);
  }
  if (divisor < 0.0) {
    divisor = abs(divisor);
  }
  return mod(number, divisor);
}

__INJECTED_NATIVE__;
__MAIN_CONSTANTS__;
__MAIN_ARGUMENTS__;
__KERNEL__;

void main(void) {
  index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;
  __MAIN_RESULT__;
}`;i.exports={fragmentShader:d}},{}],38:[function(n,i,p){const{utils:d}=n("../../utils"),{FunctionNode:y}=n("../function-node");class v extends y{constructor(a,o){super(a,o),o&&o.hasOwnProperty("fixIntegerDivisionAccuracy")&&(this.fixIntegerDivisionAccuracy=o.fixIntegerDivisionAccuracy)}astConditionalExpression(a,o){if(a.type!=="ConditionalExpression")throw this.astErrorOutput("Not a conditional expression",a);const S=this.getType(a.consequent),_=this.getType(a.alternate);return S===null&&_===null?(o.push("if ("),this.astGeneric(a.test,o),o.push(") {"),this.astGeneric(a.consequent,o),o.push(";"),o.push("} else {"),this.astGeneric(a.alternate,o),o.push(";"),o.push("}"),o):(o.push("("),this.astGeneric(a.test,o),o.push("?"),this.astGeneric(a.consequent,o),o.push(":"),this.astGeneric(a.alternate,o),o.push(")"),o)}astFunction(a,o){if(this.isRootKernel)o.push("void");else{this.returnType||this.findLastReturn()&&(this.returnType=this.getType(a.body),this.returnType==="LiteralInteger"&&(this.returnType="Number"));const{returnType:S}=this;if(!S)o.push("void");else{const _=m[S];if(!_)throw new Error(`unknown type ${S}`);o.push(_)}}if(o.push(" "),o.push(this.name),o.push("("),!this.isRootKernel)for(let S=0;S<this.argumentNames.length;++S){const _=this.argumentNames[S];S>0&&o.push(", ");let P=this.argumentTypes[this.argumentNames.indexOf(_)];if(!P)throw this.astErrorOutput(`Unknown argument ${_} type`,a);P==="LiteralInteger"&&(this.argumentTypes[S]=P="Number");const I=m[P];if(!I)throw this.astErrorOutput("Unexpected expression",a);const k=d.sanitizeName(_);I==="sampler2D"||I==="sampler2DArray"?o.push(`${I} user_${k},ivec2 user_${k}Size,ivec3 user_${k}Dim`):o.push(`${I} user_${k}`)}o.push(`) {
`);for(let S=0;S<a.body.body.length;++S)this.astGeneric(a.body.body[S],o),o.push(`
`);return o.push(`}
`),o}astReturnStatement(a,o){if(!a.argument)throw this.astErrorOutput("Unexpected return statement",a);this.pushState("skip-literal-correction");const S=this.getType(a.argument);this.popState("skip-literal-correction");const _=[];switch(this.returnType||(S==="LiteralInteger"||S==="Integer"?this.returnType="Number":this.returnType=S),this.returnType){case"LiteralInteger":case"Number":case"Float":switch(S){case"Integer":_.push("float("),this.astGeneric(a.argument,_),_.push(")");break;case"LiteralInteger":this.castLiteralToFloat(a.argument,_),this.getType(a)==="Integer"&&(_.unshift("float("),_.push(")"));break;default:this.astGeneric(a.argument,_)}break;case"Integer":switch(S){case"Float":case"Number":this.castValueToInteger(a.argument,_);break;case"LiteralInteger":this.castLiteralToInteger(a.argument,_);break;default:this.astGeneric(a.argument,_)}break;case"Array(4)":case"Array(3)":case"Array(2)":case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":case"Input":this.astGeneric(a.argument,_);break;default:throw this.astErrorOutput(`unhandled return type ${this.returnType}`,a)}return this.isRootKernel?(o.push(`kernelResult = ${_.join("")};`),o.push("return;")):this.isSubKernel?(o.push(`subKernelResult_${this.name} = ${_.join("")};`),o.push(`return subKernelResult_${this.name};`)):o.push(`return ${_.join("")};`),o}astLiteral(a,o){if(isNaN(a.value))throw this.astErrorOutput("Non-numeric literal not supported : "+a.value,a);const S=this.astKey(a);return Number.isInteger(a.value)?this.isState("casting-to-integer")||this.isState("building-integer")?(this.literalTypes[S]="Integer",o.push(`${a.value}`)):this.isState("casting-to-float")||this.isState("building-float")?(this.literalTypes[S]="Number",o.push(`${a.value}.0`)):(this.literalTypes[S]="Number",o.push(`${a.value}.0`)):this.isState("casting-to-integer")||this.isState("building-integer")?(this.literalTypes[S]="Integer",o.push(Math.round(a.value))):(this.literalTypes[S]="Number",o.push(`${a.value}`)),o}astBinaryExpression(a,o){if(this.checkAndUpconvertOperator(a,o))return o;if(this.fixIntegerDivisionAccuracy&&a.operator==="/"){switch(o.push("divWithIntCheck("),this.pushState("building-float"),this.getType(a.left)){case"Integer":this.castValueToFloat(a.left,o);break;case"LiteralInteger":this.castLiteralToFloat(a.left,o);break;default:this.astGeneric(a.left,o)}switch(o.push(", "),this.getType(a.right)){case"Integer":this.castValueToFloat(a.right,o);break;case"LiteralInteger":this.castLiteralToFloat(a.right,o);break;default:this.astGeneric(a.right,o)}return this.popState("building-float"),o.push(")"),o}o.push("(");const S=this.getType(a.left)||"Number",_=this.getType(a.right)||"Number",P=S+" & "+_;switch(P){case"Integer & Integer":this.pushState("building-integer"),this.astGeneric(a.left,o),o.push(l[a.operator]||a.operator),this.astGeneric(a.right,o),this.popState("building-integer");break;case"Number & Float":case"Float & Number":case"Float & Float":case"Number & Number":this.pushState("building-float"),this.astGeneric(a.left,o),o.push(l[a.operator]||a.operator),this.astGeneric(a.right,o),this.popState("building-float");break;case"LiteralInteger & LiteralInteger":this.isState("casting-to-integer")||this.isState("building-integer")?(this.pushState("building-integer"),this.astGeneric(a.left,o),o.push(l[a.operator]||a.operator),this.astGeneric(a.right,o),this.popState("building-integer")):(this.pushState("building-float"),this.castLiteralToFloat(a.left,o),o.push(l[a.operator]||a.operator),this.castLiteralToFloat(a.right,o),this.popState("building-float"));break;case"Integer & Float":case"Integer & Number":if((a.operator===">"||a.operator==="<"&&a.right.type==="Literal")&&!Number.isInteger(a.right.value)){this.pushState("building-float"),this.castValueToFloat(a.left,o),o.push(l[a.operator]||a.operator),this.astGeneric(a.right,o),this.popState("building-float");break}if(this.pushState("building-integer"),this.astGeneric(a.left,o),o.push(l[a.operator]||a.operator),this.pushState("casting-to-integer"),a.right.type==="Literal"){const I=[];if(this.astGeneric(a.right,I),this.getType(a.right)==="Integer")o.push(I.join(""));else throw this.astErrorOutput("Unhandled binary expression with literal",a)}else o.push("int("),this.astGeneric(a.right,o),o.push(")");this.popState("casting-to-integer"),this.popState("building-integer");break;case"Integer & LiteralInteger":this.pushState("building-integer"),this.astGeneric(a.left,o),o.push(l[a.operator]||a.operator),this.castLiteralToInteger(a.right,o),this.popState("building-integer");break;case"Number & Integer":this.pushState("building-float"),this.astGeneric(a.left,o),o.push(l[a.operator]||a.operator),this.castValueToFloat(a.right,o),this.popState("building-float");break;case"Float & LiteralInteger":case"Number & LiteralInteger":this.pushState("building-float"),this.astGeneric(a.left,o),o.push(l[a.operator]||a.operator),this.castLiteralToFloat(a.right,o),this.popState("building-float");break;case"LiteralInteger & Float":case"LiteralInteger & Number":this.isState("casting-to-integer")?(this.pushState("building-integer"),this.castLiteralToInteger(a.left,o),o.push(l[a.operator]||a.operator),this.castValueToInteger(a.right,o),this.popState("building-integer")):(this.pushState("building-float"),this.astGeneric(a.left,o),o.push(l[a.operator]||a.operator),this.pushState("casting-to-float"),this.astGeneric(a.right,o),this.popState("casting-to-float"),this.popState("building-float"));break;case"LiteralInteger & Integer":this.pushState("building-integer"),this.castLiteralToInteger(a.left,o),o.push(l[a.operator]||a.operator),this.astGeneric(a.right,o),this.popState("building-integer");break;case"Boolean & Boolean":this.pushState("building-boolean"),this.astGeneric(a.left,o),o.push(l[a.operator]||a.operator),this.astGeneric(a.right,o),this.popState("building-boolean");break;case"Float & Integer":this.pushState("building-float"),this.astGeneric(a.left,o),o.push(l[a.operator]||a.operator),this.castValueToFloat(a.right,o),this.popState("building-float");break;default:throw this.astErrorOutput(`Unhandled binary expression between ${P}`,a)}return o.push(")"),o}checkAndUpconvertOperator(a,o){const S=this.checkAndUpconvertBitwiseOperators(a,o);if(S)return S;const P={"%":this.fixIntegerDivisionAccuracy?"integerCorrectionModulo":"modulo","**":"pow"}[a.operator];if(!P)return null;switch(o.push(P),o.push("("),this.getType(a.left)){case"Integer":this.castValueToFloat(a.left,o);break;case"LiteralInteger":this.castLiteralToFloat(a.left,o);break;default:this.astGeneric(a.left,o)}switch(o.push(","),this.getType(a.right)){case"Integer":this.castValueToFloat(a.right,o);break;case"LiteralInteger":this.castLiteralToFloat(a.right,o);break;default:this.astGeneric(a.right,o)}return o.push(")"),o}checkAndUpconvertBitwiseOperators(a,o){const _={"&":"bitwiseAnd","|":"bitwiseOr","^":"bitwiseXOR","<<":"bitwiseZeroFillLeftShift",">>":"bitwiseSignedRightShift",">>>":"bitwiseZeroFillRightShift"}[a.operator];if(!_)return null;switch(o.push(_),o.push("("),this.getType(a.left)){case"Number":case"Float":this.castValueToInteger(a.left,o);break;case"LiteralInteger":this.castLiteralToInteger(a.left,o);break;default:this.astGeneric(a.left,o)}switch(o.push(","),this.getType(a.right)){case"Number":case"Float":this.castValueToInteger(a.right,o);break;case"LiteralInteger":this.castLiteralToInteger(a.right,o);break;default:this.astGeneric(a.right,o)}return o.push(")"),o}checkAndUpconvertBitwiseUnary(a,o){const _={"~":"bitwiseNot"}[a.operator];if(!_)return null;switch(o.push(_),o.push("("),this.getType(a.argument)){case"Number":case"Float":this.castValueToInteger(a.argument,o);break;case"LiteralInteger":this.castLiteralToInteger(a.argument,o);break;default:this.astGeneric(a.argument,o)}return o.push(")"),o}castLiteralToInteger(a,o){return this.pushState("casting-to-integer"),this.astGeneric(a,o),this.popState("casting-to-integer"),o}castLiteralToFloat(a,o){return this.pushState("casting-to-float"),this.astGeneric(a,o),this.popState("casting-to-float"),o}castValueToInteger(a,o){return this.pushState("casting-to-integer"),o.push("int("),this.astGeneric(a,o),o.push(")"),this.popState("casting-to-integer"),o}castValueToFloat(a,o){return this.pushState("casting-to-float"),o.push("float("),this.astGeneric(a,o),o.push(")"),this.popState("casting-to-float"),o}astIdentifierExpression(a,o){if(a.type!=="Identifier")throw this.astErrorOutput("IdentifierExpression - not an Identifier",a);const S=this.getType(a),_=d.sanitizeName(a.name);return a.name==="Infinity"?o.push("3.402823466e+38"):S==="Boolean"?this.argumentNames.indexOf(_)>-1?o.push(`bool(user_${_})`):o.push(`user_${_}`):o.push(`user_${_}`),o}astForStatement(a,o){if(a.type!=="ForStatement")throw this.astErrorOutput("Invalid for statement",a);const S=[],_=[],P=[],I=[];let k=null;if(a.init){const{declarations:T}=a.init;T.length>1&&(k=!1),this.astGeneric(a.init,S);for(let L=0;L<T.length;L++)T[L].init&&T[L].init.type!=="Literal"&&(k=!1)}else k=!1;if(a.test?this.astGeneric(a.test,_):k=!1,a.update?this.astGeneric(a.update,P):k=!1,a.body&&(this.pushState("loop-body"),this.astGeneric(a.body,I),this.popState("loop-body")),k===null&&(k=this.isSafe(a.init)&&this.isSafe(a.test)),k){const T=S.join(""),L=T[T.length-1]!==";";o.push(`for (${T}${L?";":""}${_.join("")};${P.join("")}){
`),o.push(I.join("")),o.push(`}
`)}else{const T=this.getInternalVariableName("safeI");S.length>0&&o.push(S.join(""),`
`),o.push(`for (int ${T}=0;${T}<LOOP_MAX;${T}++){
`),_.length>0&&o.push(`if (!${_.join("")}) break;
`),o.push(I.join("")),o.push(`
${P.join("")};`),o.push(`}
`)}return o}astWhileStatement(a,o){if(a.type!=="WhileStatement")throw this.astErrorOutput("Invalid while statement",a);const S=this.getInternalVariableName("safeI");return o.push(`for (int ${S}=0;${S}<LOOP_MAX;${S}++){
`),o.push("if (!"),this.astGeneric(a.test,o),o.push(`) break;
`),this.astGeneric(a.body,o),o.push(`}
`),o}astDoWhileStatement(a,o){if(a.type!=="DoWhileStatement")throw this.astErrorOutput("Invalid while statement",a);const S=this.getInternalVariableName("safeI");return o.push(`for (int ${S}=0;${S}<LOOP_MAX;${S}++){
`),this.astGeneric(a.body,o),o.push("if (!"),this.astGeneric(a.test,o),o.push(`) break;
`),o.push(`}
`),o}astAssignmentExpression(a,o){if(a.operator==="%=")this.astGeneric(a.left,o),o.push("="),o.push("mod("),this.astGeneric(a.left,o),o.push(","),this.astGeneric(a.right,o),o.push(")");else if(a.operator==="**=")this.astGeneric(a.left,o),o.push("="),o.push("pow("),this.astGeneric(a.left,o),o.push(","),this.astGeneric(a.right,o),o.push(")");else{const S=this.getType(a.left),_=this.getType(a.right);return this.astGeneric(a.left,o),o.push(a.operator),S!=="Integer"&&_==="Integer"?(o.push("float("),this.astGeneric(a.right,o),o.push(")")):this.astGeneric(a.right,o),o}}astBlockStatement(a,o){if(this.isState("loop-body")){this.pushState("block-body");for(let S=0;S<a.body.length;S++)this.astGeneric(a.body[S],o);this.popState("block-body")}else{o.push(`{
`);for(let S=0;S<a.body.length;S++)this.astGeneric(a.body[S],o);o.push(`}
`)}return o}astVariableDeclaration(a,o){const S=a.declarations;if(!S||!S[0]||!S[0].init)throw this.astErrorOutput("Unexpected expression",a);const _=[];let P=null;const I=[];let k=[];for(let T=0;T<S.length;T++){const L=S[T],D=L.init,z=this.getDeclaration(L.id),re=this.getType(L.init);let he=re;he==="LiteralInteger"&&(z.suggestedType==="Integer"?he="Integer":he="Number");const $=m[he];if(!$)throw this.astErrorOutput(`Markup type ${he} not handled`,a);const w=[];if(re==="Integer"&&he==="Integer"){if(z.valueType="Number",T===0||P===null)w.push("float ");else if(he!==P)throw new Error("Unhandled declaration");P=he,w.push(`user_${d.sanitizeName(L.id.name)}=`),w.push("float("),this.astGeneric(D,w),w.push(")")}else z.valueType=he,T===0||P===null?w.push(`${$} `):he!==P&&(I.push(k.join(",")),k=[],w.push(`${$} `)),P=he,w.push(`user_${d.sanitizeName(L.id.name)}=`),re==="Number"&&he==="Integer"?D.left&&D.left.type==="Literal"?this.astGeneric(D,w):(w.push("int("),this.astGeneric(D,w),w.push(")")):re==="LiteralInteger"&&he==="Integer"?this.castLiteralToInteger(D,w):this.astGeneric(D,w);k.push(w.join(""))}return k.length>0&&I.push(k.join(",")),_.push(I.join(";")),o.push(_.join("")),o.push(";"),o}astIfStatement(a,o){return o.push("if ("),this.astGeneric(a.test,o),o.push(")"),a.consequent.type==="BlockStatement"?this.astGeneric(a.consequent,o):(o.push(` {
`),this.astGeneric(a.consequent,o),o.push(`
}
`)),a.alternate&&(o.push("else "),a.alternate.type==="BlockStatement"||a.alternate.type==="IfStatement"?this.astGeneric(a.alternate,o):(o.push(` {
`),this.astGeneric(a.alternate,o),o.push(`
}
`))),o}astSwitchStatement(a,o){if(a.type!=="SwitchStatement")throw this.astErrorOutput("Invalid switch statement",a);const{discriminant:S,cases:_}=a,P=this.getType(S),I=`switchDiscriminant${this.astKey(a,"_")}`;switch(P){case"Float":case"Number":o.push(`float ${I} = `),this.astGeneric(S,o),o.push(`;
`);break;case"Integer":o.push(`int ${I} = `),this.astGeneric(S,o),o.push(`;
`);break}if(_.length===1&&!_[0].test)return this.astGeneric(_[0].consequent,o),o;let k=!1,T=[],L=!1,D=!1;for(let z=0;z<_.length;z++){if(_[z].test){if(z===0||!D?(D=!0,o.push(`if (${I} == `)):k?(o.push(`${I} == `),k=!1):o.push(` else if (${I} == `),P==="Integer")switch(this.getType(_[z].test)){case"Number":case"Float":this.castValueToInteger(_[z].test,o);break;case"LiteralInteger":this.castLiteralToInteger(_[z].test,o);break}else if(P==="Float")switch(this.getType(_[z].test)){case"LiteralInteger":this.castLiteralToFloat(_[z].test,o);break;case"Integer":this.castValueToFloat(_[z].test,o);break}else throw new Error("unhanlded");if(!_[z].consequent||_[z].consequent.length===0){k=!0,o.push(" || ");continue}o.push(`) {
`)}else if(_.length>z+1){L=!0,this.astGeneric(_[z].consequent,T);continue}else o.push(` else {
`);this.astGeneric(_[z].consequent,o),o.push(`
}`)}return L&&(o.push(" else {"),o.push(T.join("")),o.push("}")),o}astThisExpression(a,o){return o.push("this"),o}astMemberExpression(a,o){const{property:S,name:_,signature:P,origin:I,type:k,xProperty:T,yProperty:L,zProperty:D}=this.getMemberExpressionDetails(a);switch(P){case"value.thread.value":case"this.thread.value":if(_!=="x"&&_!=="y"&&_!=="z")throw this.astErrorOutput("Unexpected expression, expected `this.thread.x`, `this.thread.y`, or `this.thread.z`",a);return o.push(`threadId.${_}`),o;case"this.output.value":if(this.dynamicOutput)switch(_){case"x":this.isState("casting-to-float")?o.push("float(uOutputDim.x)"):o.push("uOutputDim.x");break;case"y":this.isState("casting-to-float")?o.push("float(uOutputDim.y)"):o.push("uOutputDim.y");break;case"z":this.isState("casting-to-float")?o.push("float(uOutputDim.z)"):o.push("uOutputDim.z");break;default:throw this.astErrorOutput("Unexpected expression",a)}else switch(_){case"x":this.isState("casting-to-integer")?o.push(this.output[0]):o.push(this.output[0],".0");break;case"y":this.isState("casting-to-integer")?o.push(this.output[1]):o.push(this.output[1],".0");break;case"z":this.isState("casting-to-integer")?o.push(this.output[2]):o.push(this.output[2],".0");break;default:throw this.astErrorOutput("Unexpected expression",a)}return o;case"value":throw this.astErrorOutput("Unexpected expression",a);case"value[]":case"value[][]":case"value[][][]":case"value[][][][]":case"value.value":if(I==="Math")return o.push(Math[_]),o;const re=d.sanitizeName(_);switch(S){case"r":return o.push(`user_${re}.r`),o;case"g":return o.push(`user_${re}.g`),o;case"b":return o.push(`user_${re}.b`),o;case"a":return o.push(`user_${re}.a`),o}break;case"this.constants.value":if(typeof T>"u")switch(k){case"Array(2)":case"Array(3)":case"Array(4)":return o.push(`constants_${d.sanitizeName(_)}`),o}case"this.constants.value[]":case"this.constants.value[][]":case"this.constants.value[][][]":case"this.constants.value[][][][]":break;case"fn()[]":return this.astCallExpression(a.object,o),o.push("["),o.push(this.memberExpressionPropertyMarkup(S)),o.push("]"),o;case"fn()[][]":return this.astCallExpression(a.object.object,o),o.push("["),o.push(this.memberExpressionPropertyMarkup(a.object.property)),o.push("]"),o.push("["),o.push(this.memberExpressionPropertyMarkup(a.property)),o.push("]"),o;case"[][]":return this.astArrayExpression(a.object,o),o.push("["),o.push(this.memberExpressionPropertyMarkup(S)),o.push("]"),o;default:throw this.astErrorOutput("Unexpected expression",a)}if(a.computed===!1)switch(k){case"Number":case"Integer":case"Float":case"Boolean":return o.push(`${I}_${d.sanitizeName(_)}`),o}const z=`${I}_${d.sanitizeName(_)}`;switch(k){case"Array(2)":case"Array(3)":case"Array(4)":this.astGeneric(a.object,o),o.push("["),o.push(this.memberExpressionPropertyMarkup(T)),o.push("]");break;case"HTMLImageArray":o.push(`getImage3D(${z}, ${z}Size, ${z}Dim, `),this.memberExpressionXYZ(T,L,D,o),o.push(")");break;case"ArrayTexture(1)":o.push(`getFloatFromSampler2D(${z}, ${z}Size, ${z}Dim, `),this.memberExpressionXYZ(T,L,D,o),o.push(")");break;case"Array1D(2)":case"Array2D(2)":case"Array3D(2)":o.push(`getMemoryOptimizedVec2(${z}, ${z}Size, ${z}Dim, `),this.memberExpressionXYZ(T,L,D,o),o.push(")");break;case"ArrayTexture(2)":o.push(`getVec2FromSampler2D(${z}, ${z}Size, ${z}Dim, `),this.memberExpressionXYZ(T,L,D,o),o.push(")");break;case"Array1D(3)":case"Array2D(3)":case"Array3D(3)":o.push(`getMemoryOptimizedVec3(${z}, ${z}Size, ${z}Dim, `),this.memberExpressionXYZ(T,L,D,o),o.push(")");break;case"ArrayTexture(3)":o.push(`getVec3FromSampler2D(${z}, ${z}Size, ${z}Dim, `),this.memberExpressionXYZ(T,L,D,o),o.push(")");break;case"Array1D(4)":case"Array2D(4)":case"Array3D(4)":o.push(`getMemoryOptimizedVec4(${z}, ${z}Size, ${z}Dim, `),this.memberExpressionXYZ(T,L,D,o),o.push(")");break;case"ArrayTexture(4)":case"HTMLCanvas":case"OffscreenCanvas":case"HTMLImage":case"ImageBitmap":case"ImageData":case"HTMLVideo":o.push(`getVec4FromSampler2D(${z}, ${z}Size, ${z}Dim, `),this.memberExpressionXYZ(T,L,D,o),o.push(")");break;case"NumberTexture":case"Array":case"Array2D":case"Array3D":case"Array4D":case"Input":case"Number":case"Float":case"Integer":if(this.precision==="single")o.push(`getMemoryOptimized32(${z}, ${z}Size, ${z}Dim, `),this.memberExpressionXYZ(T,L,D,o),o.push(")");else{const re=I==="user"?this.lookupFunctionArgumentBitRatio(this.name,_):this.constantBitRatios[_];switch(re){case 1:o.push(`get8(${z}, ${z}Size, ${z}Dim, `);break;case 2:o.push(`get16(${z}, ${z}Size, ${z}Dim, `);break;case 4:case 0:o.push(`get32(${z}, ${z}Size, ${z}Dim, `);break;default:throw new Error(`unhandled bit ratio of ${re}`)}this.memberExpressionXYZ(T,L,D,o),o.push(")")}break;case"MemoryOptimizedNumberTexture":o.push(`getMemoryOptimized32(${z}, ${z}Size, ${z}Dim, `),this.memberExpressionXYZ(T,L,D,o),o.push(")");break;case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":o.push(`${z}[${this.memberExpressionPropertyMarkup(L)}]`),L&&o.push(`[${this.memberExpressionPropertyMarkup(T)}]`);break;default:throw new Error(`unhandled member expression "${k}"`)}return o}astCallExpression(a,o){if(!a.callee)throw this.astErrorOutput("Unknown CallExpression",a);let S=null;const _=this.isAstMathFunction(a);if(_||a.callee.object&&a.callee.object.type==="ThisExpression"?S=a.callee.property.name:a.callee.type==="SequenceExpression"&&a.callee.expressions[0].type==="Literal"&&!isNaN(a.callee.expressions[0].raw)?S=a.callee.expressions[1].property.name:S=a.callee.name,!S)throw this.astErrorOutput("Unhandled function, couldn't find name",a);switch(S){case"pow":S="_pow";break;case"round":S="_round";break}if(this.calledFunctions.indexOf(S)<0&&this.calledFunctions.push(S),S==="random"&&this.plugins&&this.plugins.length>0)for(let P=0;P<this.plugins.length;P++){const I=this.plugins[P];if(I.functionMatch==="Math.random()"&&I.functionReplace)return o.push(I.functionReplace),o}if(this.onFunctionCall&&this.onFunctionCall(this.name,S,a.arguments),o.push(S),o.push("("),_)for(let P=0;P<a.arguments.length;++P){const I=a.arguments[P],k=this.getType(I);switch(P>0&&o.push(", "),k){case"Integer":this.castValueToFloat(I,o);break;default:this.astGeneric(I,o);break}}else{const P=this.lookupFunctionArgumentTypes(S)||[];for(let I=0;I<a.arguments.length;++I){const k=a.arguments[I];let T=P[I];I>0&&o.push(", ");const L=this.getType(k);switch(T||(this.triggerImplyArgumentType(S,I,L,this),T=L),L){case"Boolean":this.astGeneric(k,o);continue;case"Number":case"Float":if(T==="Integer"){o.push("int("),this.astGeneric(k,o),o.push(")");continue}else if(T==="Number"||T==="Float"){this.astGeneric(k,o);continue}else if(T==="LiteralInteger"){this.castLiteralToFloat(k,o);continue}break;case"Integer":if(T==="Number"||T==="Float"){o.push("float("),this.astGeneric(k,o),o.push(")");continue}else if(T==="Integer"){this.astGeneric(k,o);continue}break;case"LiteralInteger":if(T==="Integer"){this.castLiteralToInteger(k,o);continue}else if(T==="Number"||T==="Float"){this.castLiteralToFloat(k,o);continue}else if(T==="LiteralInteger"){this.astGeneric(k,o);continue}break;case"Array(2)":case"Array(3)":case"Array(4)":if(T===L){if(k.type==="Identifier")o.push(`user_${d.sanitizeName(k.name)}`);else if(k.type==="ArrayExpression"||k.type==="MemberExpression"||k.type==="CallExpression")this.astGeneric(k,o);else throw this.astErrorOutput(`Unhandled argument type ${k.type}`,a);continue}break;case"HTMLCanvas":case"OffscreenCanvas":case"HTMLImage":case"ImageBitmap":case"ImageData":case"HTMLImageArray":case"HTMLVideo":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":case"Array":case"Input":if(T===L){if(k.type!=="Identifier")throw this.astErrorOutput(`Unhandled argument type ${k.type}`,a);this.triggerImplyArgumentBitRatio(this.name,k.name,S,I);const D=d.sanitizeName(k.name);o.push(`user_${D},user_${D}Size,user_${D}Dim`);continue}break}throw this.astErrorOutput(`Unhandled argument combination of ${L} and ${T} for argument named "${k.name}"`,a)}}return o.push(")"),o}astArrayExpression(a,o){const S=this.getType(a),_=a.elements.length;switch(S){case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":o.push(`mat${_}(`);break;default:o.push(`vec${_}(`)}for(let P=0;P<_;++P){P>0&&o.push(", ");const I=a.elements[P];this.astGeneric(I,o)}return o.push(")"),o}memberExpressionXYZ(a,o,S,_){return S?_.push(this.memberExpressionPropertyMarkup(S),", "):_.push("0, "),o?_.push(this.memberExpressionPropertyMarkup(o),", "):_.push("0, "),_.push(this.memberExpressionPropertyMarkup(a)),_}memberExpressionPropertyMarkup(a){if(!a)throw new Error("Property not set");const o=this.getType(a),S=[];switch(o){case"Number":case"Float":this.castValueToInteger(a,S);break;case"LiteralInteger":this.castLiteralToInteger(a,S);break;default:this.astGeneric(a,S)}return S.join("")}}const m={Array:"sampler2D","Array(2)":"vec2","Array(3)":"vec3","Array(4)":"vec4","Matrix(2)":"mat2","Matrix(3)":"mat3","Matrix(4)":"mat4",Array2D:"sampler2D",Array3D:"sampler2D",Boolean:"bool",Float:"float",Input:"sampler2D",Integer:"int",Number:"float",LiteralInteger:"float",NumberTexture:"sampler2D",MemoryOptimizedNumberTexture:"sampler2D","ArrayTexture(1)":"sampler2D","ArrayTexture(2)":"sampler2D","ArrayTexture(3)":"sampler2D","ArrayTexture(4)":"sampler2D",HTMLVideo:"sampler2D",HTMLCanvas:"sampler2D",OffscreenCanvas:"sampler2D",HTMLImage:"sampler2D",ImageBitmap:"sampler2D",ImageData:"sampler2D",HTMLImageArray:"sampler2DArray"},l={"===":"==","!==":"!="};i.exports={WebGLFunctionNode:v}},{"../../utils":114,"../function-node":10}],39:[function(n,i,p){const{WebGLKernelValueBoolean:d}=n("./kernel-value/boolean"),{WebGLKernelValueFloat:y}=n("./kernel-value/float"),{WebGLKernelValueInteger:v}=n("./kernel-value/integer"),{WebGLKernelValueHTMLImage:m}=n("./kernel-value/html-image"),{WebGLKernelValueDynamicHTMLImage:l}=n("./kernel-value/dynamic-html-image"),{WebGLKernelValueHTMLVideo:h}=n("./kernel-value/html-video"),{WebGLKernelValueDynamicHTMLVideo:a}=n("./kernel-value/dynamic-html-video"),{WebGLKernelValueSingleInput:o}=n("./kernel-value/single-input"),{WebGLKernelValueDynamicSingleInput:S}=n("./kernel-value/dynamic-single-input"),{WebGLKernelValueUnsignedInput:_}=n("./kernel-value/unsigned-input"),{WebGLKernelValueDynamicUnsignedInput:P}=n("./kernel-value/dynamic-unsigned-input"),{WebGLKernelValueMemoryOptimizedNumberTexture:I}=n("./kernel-value/memory-optimized-number-texture"),{WebGLKernelValueDynamicMemoryOptimizedNumberTexture:k}=n("./kernel-value/dynamic-memory-optimized-number-texture"),{WebGLKernelValueNumberTexture:T}=n("./kernel-value/number-texture"),{WebGLKernelValueDynamicNumberTexture:L}=n("./kernel-value/dynamic-number-texture"),{WebGLKernelValueSingleArray:D}=n("./kernel-value/single-array"),{WebGLKernelValueDynamicSingleArray:z}=n("./kernel-value/dynamic-single-array"),{WebGLKernelValueSingleArray1DI:re}=n("./kernel-value/single-array1d-i"),{WebGLKernelValueDynamicSingleArray1DI:he}=n("./kernel-value/dynamic-single-array1d-i"),{WebGLKernelValueSingleArray2DI:$}=n("./kernel-value/single-array2d-i"),{WebGLKernelValueDynamicSingleArray2DI:w}=n("./kernel-value/dynamic-single-array2d-i"),{WebGLKernelValueSingleArray3DI:V}=n("./kernel-value/single-array3d-i"),{WebGLKernelValueDynamicSingleArray3DI:K}=n("./kernel-value/dynamic-single-array3d-i"),{WebGLKernelValueArray2:fe}=n("./kernel-value/array2"),{WebGLKernelValueArray3:ee}=n("./kernel-value/array3"),{WebGLKernelValueArray4:ue}=n("./kernel-value/array4"),{WebGLKernelValueUnsignedArray:_e}=n("./kernel-value/unsigned-array"),{WebGLKernelValueDynamicUnsignedArray:Re}=n("./kernel-value/dynamic-unsigned-array"),ft={unsigned:{dynamic:{Boolean:d,Integer:v,Float:y,Array:Re,"Array(2)":fe,"Array(3)":ee,"Array(4)":ue,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:P,NumberTexture:L,"ArrayTexture(1)":L,"ArrayTexture(2)":L,"ArrayTexture(3)":L,"ArrayTexture(4)":L,MemoryOptimizedNumberTexture:k,HTMLCanvas:l,OffscreenCanvas:l,HTMLImage:l,ImageBitmap:l,ImageData:l,HTMLImageArray:!1,HTMLVideo:a},static:{Boolean:d,Float:y,Integer:v,Array:_e,"Array(2)":fe,"Array(3)":ee,"Array(4)":ue,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:_,NumberTexture:T,"ArrayTexture(1)":T,"ArrayTexture(2)":T,"ArrayTexture(3)":T,"ArrayTexture(4)":T,MemoryOptimizedNumberTexture:I,HTMLCanvas:m,OffscreenCanvas:m,HTMLImage:m,ImageBitmap:m,ImageData:m,HTMLImageArray:!1,HTMLVideo:h}},single:{dynamic:{Boolean:d,Integer:v,Float:y,Array:z,"Array(2)":fe,"Array(3)":ee,"Array(4)":ue,"Array1D(2)":he,"Array1D(3)":he,"Array1D(4)":he,"Array2D(2)":w,"Array2D(3)":w,"Array2D(4)":w,"Array3D(2)":K,"Array3D(3)":K,"Array3D(4)":K,Input:S,NumberTexture:L,"ArrayTexture(1)":L,"ArrayTexture(2)":L,"ArrayTexture(3)":L,"ArrayTexture(4)":L,MemoryOptimizedNumberTexture:k,HTMLCanvas:l,OffscreenCanvas:l,HTMLImage:l,ImageBitmap:l,ImageData:l,HTMLImageArray:!1,HTMLVideo:a},static:{Boolean:d,Float:y,Integer:v,Array:D,"Array(2)":fe,"Array(3)":ee,"Array(4)":ue,"Array1D(2)":re,"Array1D(3)":re,"Array1D(4)":re,"Array2D(2)":$,"Array2D(3)":$,"Array2D(4)":$,"Array3D(2)":V,"Array3D(3)":V,"Array3D(4)":V,Input:o,NumberTexture:T,"ArrayTexture(1)":T,"ArrayTexture(2)":T,"ArrayTexture(3)":T,"ArrayTexture(4)":T,MemoryOptimizedNumberTexture:I,HTMLCanvas:m,OffscreenCanvas:m,HTMLImage:m,ImageBitmap:m,ImageData:m,HTMLImageArray:!1,HTMLVideo:h}}};function it(Pe,mt,bt,Rt){if(!Pe)throw new Error("type missing");if(!mt)throw new Error("dynamic missing");if(!bt)throw new Error("precision missing");Rt.type&&(Pe=Rt.type);const lt=ft[bt][mt];if(lt[Pe]===!1)return null;if(lt[Pe]===void 0)throw new Error(`Could not find a KernelValue for ${Pe}`);return lt[Pe]}i.exports={lookupKernelValueType:it,kernelValueMaps:ft}},{"./kernel-value/array2":41,"./kernel-value/array3":42,"./kernel-value/array4":43,"./kernel-value/boolean":44,"./kernel-value/dynamic-html-image":45,"./kernel-value/dynamic-html-video":46,"./kernel-value/dynamic-memory-optimized-number-texture":47,"./kernel-value/dynamic-number-texture":48,"./kernel-value/dynamic-single-array":49,"./kernel-value/dynamic-single-array1d-i":50,"./kernel-value/dynamic-single-array2d-i":51,"./kernel-value/dynamic-single-array3d-i":52,"./kernel-value/dynamic-single-input":53,"./kernel-value/dynamic-unsigned-array":54,"./kernel-value/dynamic-unsigned-input":55,"./kernel-value/float":56,"./kernel-value/html-image":57,"./kernel-value/html-video":58,"./kernel-value/integer":60,"./kernel-value/memory-optimized-number-texture":61,"./kernel-value/number-texture":62,"./kernel-value/single-array":63,"./kernel-value/single-array1d-i":64,"./kernel-value/single-array2d-i":65,"./kernel-value/single-array3d-i":66,"./kernel-value/single-input":67,"./kernel-value/unsigned-array":68,"./kernel-value/unsigned-input":69}],40:[function(n,i,p){const{WebGLKernelValue:d}=n("./index"),{Input:y}=n("../../../input");class v extends d{checkSize(l,h){if(!this.kernel.validate)return;const{maxTextureSize:a}=this.kernel.constructor.features;if(l>a||h>a)throw l>h?new Error(`Argument texture width of ${l} larger than maximum size of ${a} for your GPU`):l<h?new Error(`Argument texture height of ${h} larger than maximum size of ${a} for your GPU`):new Error(`Argument texture height and width of ${h} larger than maximum size of ${a} for your GPU`)}setup(){this.requestTexture(),this.setupTexture(),this.defineTexture()}requestTexture(){this.texture=this.onRequestTexture()}defineTexture(){const{context:l}=this;l.activeTexture(this.contextHandle),l.bindTexture(l.TEXTURE_2D,this.texture),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST)}setupTexture(){this.contextHandle=this.onRequestContextHandle(),this.index=this.onRequestIndex(),this.dimensionsId=this.id+"Dim",this.sizeId=this.id+"Size"}getBitRatio(l){if(Array.isArray(l[0]))return this.getBitRatio(l[0]);if(l.constructor===y)return this.getBitRatio(l.value);switch(l.constructor){case Uint8ClampedArray:case Uint8Array:case Int8Array:return 1;case Uint16Array:case Int16Array:return 2;case Float32Array:case Int32Array:default:return 4}}destroy(){this.prevArg&&this.prevArg.delete(),this.context.deleteTexture(this.texture)}}i.exports={WebGLKernelArray:v}},{"../../../input":110,"./index":59}],41:[function(n,i,p){const{WebGLKernelValue:d}=n("./index");class y extends d{constructor(m,l){super(m,l),this.uploadValue=m}getSource(m){return this.origin==="constants"?`const vec2 ${this.id} = vec2(${m[0]},${m[1]});
`:`uniform vec2 ${this.id};
`}getStringValueHandler(){return this.origin==="constants"?"":`const uploadValue_${this.name} = ${this.varName};
`}updateValue(m){this.origin!=="constants"&&this.kernel.setUniform2fv(this.id,this.uploadValue=m)}}i.exports={WebGLKernelValueArray2:y}},{"./index":59}],42:[function(n,i,p){const{WebGLKernelValue:d}=n("./index");class y extends d{constructor(m,l){super(m,l),this.uploadValue=m}getSource(m){return this.origin==="constants"?`const vec3 ${this.id} = vec3(${m[0]},${m[1]},${m[2]});
`:`uniform vec3 ${this.id};
`}getStringValueHandler(){return this.origin==="constants"?"":`const uploadValue_${this.name} = ${this.varName};
`}updateValue(m){this.origin!=="constants"&&this.kernel.setUniform3fv(this.id,this.uploadValue=m)}}i.exports={WebGLKernelValueArray3:y}},{"./index":59}],43:[function(n,i,p){const{WebGLKernelValue:d}=n("./index");class y extends d{constructor(m,l){super(m,l),this.uploadValue=m}getSource(m){return this.origin==="constants"?`const vec4 ${this.id} = vec4(${m[0]},${m[1]},${m[2]},${m[3]});
`:`uniform vec4 ${this.id};
`}getStringValueHandler(){return this.origin==="constants"?"":`const uploadValue_${this.name} = ${this.varName};
`}updateValue(m){this.origin!=="constants"&&this.kernel.setUniform4fv(this.id,this.uploadValue=m)}}i.exports={WebGLKernelValueArray4:y}},{"./index":59}],44:[function(n,i,p){n("../../../utils");const{WebGLKernelValue:d}=n("./index");class y extends d{constructor(m,l){super(m,l),this.uploadValue=m}getSource(m){return this.origin==="constants"?`const bool ${this.id} = ${m};
`:`uniform bool ${this.id};
`}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};
`}updateValue(m){this.origin!=="constants"&&this.kernel.setUniform1i(this.id,this.uploadValue=m)}}i.exports={WebGLKernelValueBoolean:y}},{"../../../utils":114,"./index":59}],45:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueHTMLImage:y}=n("./html-image");class v extends y{getSource(){return d.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(l){const{width:h,height:a}=l;this.checkSize(h,a),this.dimensions=[h,a,1],this.textureSize=[h,a],this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(l)}}i.exports={WebGLKernelValueDynamicHTMLImage:v}},{"../../../utils":114,"./html-image":57}],46:[function(n,i,p){const{WebGLKernelValueDynamicHTMLImage:d}=n("./dynamic-html-image");class y extends d{}i.exports={WebGLKernelValueDynamicHTMLVideo:y}},{"./dynamic-html-image":45}],47:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueMemoryOptimizedNumberTexture:y}=n("./memory-optimized-number-texture");class v extends y{getSource(){return d.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(l){this.dimensions=l.dimensions,this.checkSize(l.size[0],l.size[1]),this.textureSize=l.size,this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(l)}}i.exports={WebGLKernelValueDynamicMemoryOptimizedNumberTexture:v}},{"../../../utils":114,"./memory-optimized-number-texture":61}],48:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueNumberTexture:y}=n("./number-texture");class v extends y{getSource(){return d.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(l){this.dimensions=l.dimensions,this.checkSize(l.size[0],l.size[1]),this.textureSize=l.size,this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(l)}}i.exports={WebGLKernelValueDynamicNumberTexture:v}},{"../../../utils":114,"./number-texture":62}],49:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueSingleArray:y}=n("./single-array");class v extends y{getSource(){return d.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(l){this.dimensions=d.getDimensions(l,!0),this.textureSize=d.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(l)}}i.exports={WebGLKernelValueDynamicSingleArray:v}},{"../../../utils":114,"./single-array":63}],50:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueSingleArray1DI:y}=n("./single-array1d-i");class v extends y{getSource(){return d.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(l){this.setShape(l),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(l)}}i.exports={WebGLKernelValueDynamicSingleArray1DI:v}},{"../../../utils":114,"./single-array1d-i":64}],51:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueSingleArray2DI:y}=n("./single-array2d-i");class v extends y{getSource(){return d.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(l){this.setShape(l),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(l)}}i.exports={WebGLKernelValueDynamicSingleArray2DI:v}},{"../../../utils":114,"./single-array2d-i":65}],52:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueSingleArray3DI:y}=n("./single-array3d-i");class v extends y{getSource(){return d.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(l){this.setShape(l),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(l)}}i.exports={WebGLKernelValueDynamicSingleArray3DI:v}},{"../../../utils":114,"./single-array3d-i":66}],53:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueSingleInput:y}=n("./single-input");class v extends y{getSource(){return d.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(l){let[h,a,o]=l.size;this.dimensions=new Int32Array([h||1,a||1,o||1]),this.textureSize=d.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(l)}}i.exports={WebGLKernelValueDynamicSingleInput:v}},{"../../../utils":114,"./single-input":67}],54:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueUnsignedArray:y}=n("./unsigned-array");class v extends y{getSource(){return d.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(l){this.dimensions=d.getDimensions(l,!0),this.textureSize=d.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio),this.checkSize(this.textureSize[0],this.textureSize[1]);const h=this.getTransferArrayType(l);this.preUploadValue=new h(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(l)}}i.exports={WebGLKernelValueDynamicUnsignedArray:v}},{"../../../utils":114,"./unsigned-array":68}],55:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueUnsignedInput:y}=n("./unsigned-input");class v extends y{getSource(){return d.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(l){let[h,a,o]=l.size;this.dimensions=new Int32Array([h||1,a||1,o||1]),this.textureSize=d.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio),this.checkSize(this.textureSize[0],this.textureSize[1]);const S=this.getTransferArrayType(l.value);this.preUploadValue=new S(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(l)}}i.exports={WebGLKernelValueDynamicUnsignedInput:v}},{"../../../utils":114,"./unsigned-input":69}],56:[function(n,i,p){n("../../../utils");const{WebGLKernelValue:d}=n("./index");class y extends d{constructor(m,l){super(m,l),this.uploadValue=m}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};
`}getSource(m){return this.origin==="constants"?Number.isInteger(m)?`const float ${this.id} = ${m}.0;
`:`const float ${this.id} = ${m};
`:`uniform float ${this.id};
`}updateValue(m){this.origin!=="constants"&&this.kernel.setUniform1f(this.id,this.uploadValue=m)}}i.exports={WebGLKernelValueFloat:y}},{"../../../utils":114,"./index":59}],57:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelArray:y}=n("./array");class v extends y{constructor(l,h){super(l,h);const{width:a,height:o}=l;this.checkSize(a,o),this.dimensions=[a,o,1],this.textureSize=[a,o],this.uploadValue=l}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};
`}getSource(){return d.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(l){if(l.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(l.constructor);return}const{context:h}=this;h.activeTexture(this.contextHandle),h.bindTexture(h.TEXTURE_2D,this.texture),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!0),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,this.uploadValue=l),this.kernel.setUniform1i(this.id,this.index)}}i.exports={WebGLKernelValueHTMLImage:v}},{"../../../utils":114,"./array":40}],58:[function(n,i,p){const{WebGLKernelValueHTMLImage:d}=n("./html-image");class y extends d{}i.exports={WebGLKernelValueHTMLVideo:y}},{"./html-image":57}],59:[function(n,i,p){const{utils:d}=n("../../../utils"),{KernelValue:y}=n("../../kernel-value");class v extends y{constructor(l,h){super(l,h),this.dimensionsId=null,this.sizeId=null,this.initialValueConstructor=l.constructor,this.onRequestTexture=h.onRequestTexture,this.onRequestIndex=h.onRequestIndex,this.uploadValue=null,this.textureSize=null,this.bitRatio=null,this.prevArg=null}get id(){return`${this.origin}_${d.sanitizeName(this.name)}`}setup(){}getTransferArrayType(l){if(Array.isArray(l[0]))return this.getTransferArrayType(l[0]);switch(l.constructor){case Array:case Int32Array:case Int16Array:case Int8Array:return Float32Array;case Uint8ClampedArray:case Uint8Array:case Uint16Array:case Uint32Array:case Float32Array:case Float64Array:return l.constructor}return console.warn("Unfamiliar constructor type.  Will go ahead and use, but likley this may result in a transfer of zeros"),l.constructor}getStringValueHandler(){throw new Error(`"getStringValueHandler" not implemented on ${this.constructor.name}`)}getVariablePrecisionString(){return this.kernel.getVariablePrecisionString(this.textureSize||void 0,this.tactic||void 0)}destroy(){}}i.exports={WebGLKernelValue:v}},{"../../../utils":114,"../../kernel-value":35}],60:[function(n,i,p){n("../../../utils");const{WebGLKernelValue:d}=n("./index");class y extends d{constructor(m,l){super(m,l),this.uploadValue=m}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};
`}getSource(m){return this.origin==="constants"?`const int ${this.id} = ${parseInt(m)};
`:`uniform int ${this.id};
`}updateValue(m){this.origin!=="constants"&&this.kernel.setUniform1i(this.id,this.uploadValue=m)}}i.exports={WebGLKernelValueInteger:y}},{"../../../utils":114,"./index":59}],61:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelArray:y}=n("./array"),v="Source and destination textures are the same.  Use immutable = true and manually cleanup kernel output texture memory with texture.delete()";class m extends y{constructor(h,a){super(h,a);const[o,S]=h.size;this.checkSize(o,S),this.dimensions=h.dimensions,this.textureSize=h.size,this.uploadValue=h.texture,this.forceUploadEachRun=!0}setup(){this.setupTexture()}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName}.texture;
`}getSource(){return d.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(h){if(h.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(h.constructor);return}if(this.checkContext&&h.context!==this.context)throw new Error(`Value ${this.name} (${this.type}) must be from same context`);const{kernel:a,context:o}=this;if(a.pipeline)if(a.immutable)a.updateTextureArgumentRefs(this,h);else{if(a.texture&&a.texture.texture===h.texture)throw new Error(v);if(a.mappedTextures){const{mappedTextures:S}=a;for(let _=0;_<S.length;_++)if(S[_].texture===h.texture)throw new Error(v)}}o.activeTexture(this.contextHandle),o.bindTexture(o.TEXTURE_2D,this.uploadValue=h.texture),this.kernel.setUniform1i(this.id,this.index)}}i.exports={WebGLKernelValueMemoryOptimizedNumberTexture:m,sameError:v}},{"../../../utils":114,"./array":40}],62:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelArray:y}=n("./array"),{sameError:v}=n("./memory-optimized-number-texture");class m extends y{constructor(h,a){super(h,a);const[o,S]=h.size;this.checkSize(o,S);const{size:_,dimensions:P}=h;this.bitRatio=this.getBitRatio(h),this.dimensions=P,this.textureSize=_,this.uploadValue=h.texture,this.forceUploadEachRun=!0}setup(){this.setupTexture()}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName}.texture;
`}getSource(){return d.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(h){if(h.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(h.constructor);return}if(this.checkContext&&h.context!==this.context)throw new Error(`Value ${this.name} (${this.type}) must be from same context`);const{kernel:a,context:o}=this;if(a.pipeline)if(a.immutable)a.updateTextureArgumentRefs(this,h);else{if(a.texture&&a.texture.texture===h.texture)throw new Error(v);if(a.mappedTextures){const{mappedTextures:S}=a;for(let _=0;_<S.length;_++)if(S[_].texture===h.texture)throw new Error(v)}}o.activeTexture(this.contextHandle),o.bindTexture(o.TEXTURE_2D,this.uploadValue=h.texture),this.kernel.setUniform1i(this.id,this.index)}}i.exports={WebGLKernelValueNumberTexture:m}},{"../../../utils":114,"./array":40,"./memory-optimized-number-texture":61}],63:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelArray:y}=n("./array");class v extends y{constructor(l,h){super(l,h),this.bitRatio=4,this.dimensions=d.getDimensions(l,!0),this.textureSize=d.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return d.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}, uploadValue_${this.name})`])}getSource(){return d.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(l){if(l.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(l.constructor);return}const{context:h}=this;d.flattenTo(l,this.uploadValue),h.activeTexture(this.contextHandle),h.bindTexture(h.TEXTURE_2D,this.texture),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!1),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,this.textureSize[0],this.textureSize[1],0,h.RGBA,h.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}i.exports={WebGLKernelValueSingleArray:v}},{"../../../utils":114,"./array":40}],64:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelArray:y}=n("./array");class v extends y{constructor(l,h){super(l,h),this.bitRatio=4,this.setShape(l)}setShape(l){const h=d.getDimensions(l,!0);this.textureSize=d.getMemoryOptimizedFloatTextureSize(h,this.bitRatio),this.dimensions=new Int32Array([h[1],1,1]),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return d.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}, uploadValue_${this.name})`])}getSource(){return d.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(l){if(l.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(l.constructor);return}const{context:h}=this;d.flatten2dArrayTo(l,this.uploadValue),h.activeTexture(this.contextHandle),h.bindTexture(h.TEXTURE_2D,this.texture),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!1),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,this.textureSize[0],this.textureSize[1],0,h.RGBA,h.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}i.exports={WebGLKernelValueSingleArray1DI:v}},{"../../../utils":114,"./array":40}],65:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelArray:y}=n("./array");class v extends y{constructor(l,h){super(l,h),this.bitRatio=4,this.setShape(l)}setShape(l){const h=d.getDimensions(l,!0);this.textureSize=d.getMemoryOptimizedFloatTextureSize(h,this.bitRatio),this.dimensions=new Int32Array([h[1],h[2],1]),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return d.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}, uploadValue_${this.name})`])}getSource(){return d.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(l){if(l.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(l.constructor);return}const{context:h}=this;d.flatten3dArrayTo(l,this.uploadValue),h.activeTexture(this.contextHandle),h.bindTexture(h.TEXTURE_2D,this.texture),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!1),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,this.textureSize[0],this.textureSize[1],0,h.RGBA,h.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}i.exports={WebGLKernelValueSingleArray2DI:v}},{"../../../utils":114,"./array":40}],66:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelArray:y}=n("./array");class v extends y{constructor(l,h){super(l,h),this.bitRatio=4,this.setShape(l)}setShape(l){const h=d.getDimensions(l,!0);this.textureSize=d.getMemoryOptimizedFloatTextureSize(h,this.bitRatio),this.dimensions=new Int32Array([h[1],h[2],h[3]]),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return d.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}, uploadValue_${this.name})`])}getSource(){return d.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(l){if(l.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(l.constructor);return}const{context:h}=this;d.flatten4dArrayTo(l,this.uploadValue),h.activeTexture(this.contextHandle),h.bindTexture(h.TEXTURE_2D,this.texture),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!1),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,this.textureSize[0],this.textureSize[1],0,h.RGBA,h.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}i.exports={WebGLKernelValueSingleArray3DI:v}},{"../../../utils":114,"./array":40}],67:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelArray:y}=n("./array");class v extends y{constructor(l,h){super(l,h),this.bitRatio=4;let[a,o,S]=l.size;this.dimensions=new Int32Array([a||1,o||1,S||1]),this.textureSize=d.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return d.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}.value, uploadValue_${this.name})`])}getSource(){return d.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(l){if(l.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(l.constructor);return}const{context:h}=this;d.flattenTo(l.value,this.uploadValue),h.activeTexture(this.contextHandle),h.bindTexture(h.TEXTURE_2D,this.texture),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!1),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,this.textureSize[0],this.textureSize[1],0,h.RGBA,h.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}i.exports={WebGLKernelValueSingleInput:v}},{"../../../utils":114,"./array":40}],68:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelArray:y}=n("./array");class v extends y{constructor(l,h){super(l,h),this.bitRatio=this.getBitRatio(l),this.dimensions=d.getDimensions(l,!0),this.textureSize=d.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio),this.checkSize(this.textureSize[0],this.textureSize[1]),this.TranserArrayType=this.getTransferArrayType(l),this.preUploadValue=new this.TranserArrayType(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer)}getStringValueHandler(){return d.linesToString([`const preUploadValue_${this.name} = new ${this.TranserArrayType.name}(${this.uploadArrayLength})`,`const uploadValue_${this.name} = new Uint8Array(preUploadValue_${this.name}.buffer)`,`flattenTo(${this.varName}, preUploadValue_${this.name})`])}getSource(){return d.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(l){if(l.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(l.constructor);return}const{context:h}=this;d.flattenTo(l,this.preUploadValue),h.activeTexture(this.contextHandle),h.bindTexture(h.TEXTURE_2D,this.texture),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!1),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,this.textureSize[0],this.textureSize[1],0,h.RGBA,h.UNSIGNED_BYTE,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}i.exports={WebGLKernelValueUnsignedArray:v}},{"../../../utils":114,"./array":40}],69:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelArray:y}=n("./array");class v extends y{constructor(l,h){super(l,h),this.bitRatio=this.getBitRatio(l);const[a,o,S]=l.size;this.dimensions=new Int32Array([a||1,o||1,S||1]),this.textureSize=d.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio),this.checkSize(this.textureSize[0],this.textureSize[1]),this.TranserArrayType=this.getTransferArrayType(l.value),this.preUploadValue=new this.TranserArrayType(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer)}getStringValueHandler(){return d.linesToString([`const preUploadValue_${this.name} = new ${this.TranserArrayType.name}(${this.uploadArrayLength})`,`const uploadValue_${this.name} = new Uint8Array(preUploadValue_${this.name}.buffer)`,`flattenTo(${this.varName}.value, preUploadValue_${this.name})`])}getSource(){return d.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(l){if(l.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(value.constructor);return}const{context:h}=this;d.flattenTo(l.value,this.preUploadValue),h.activeTexture(this.contextHandle),h.bindTexture(h.TEXTURE_2D,this.texture),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!1),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,this.textureSize[0],this.textureSize[1],0,h.RGBA,h.UNSIGNED_BYTE,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}i.exports={WebGLKernelValueUnsignedInput:v}},{"../../../utils":114,"./array":40}],70:[function(n,i,p){const{GLKernel:d}=n("../gl/kernel"),{FunctionBuilder:y}=n("../function-builder"),{WebGLFunctionNode:v}=n("./function-node"),{utils:m}=n("../../utils"),l=n("../../plugins/math-random-uniformly-distributed"),{fragmentShader:h}=n("./fragment-shader"),{vertexShader:a}=n("./vertex-shader"),{glKernelString:o}=n("../gl/kernel-string"),{lookupKernelValueType:S}=n("./kernel-value-maps");let _=null,P=null,I=null,k=null,T=null;const L=[l],D=[],z={};class re extends d{static get isSupported(){return _!==null||(this.setupFeatureChecks(),_=this.isContextMatch(I)),_}static setupFeatureChecks(){typeof document<"u"?P=document.createElement("canvas"):typeof OffscreenCanvas<"u"&&(P=new OffscreenCanvas(0,0)),P&&(I=P.getContext("webgl")||P.getContext("experimental-webgl"),!(!I||!I.getExtension)&&(k={OES_texture_float:I.getExtension("OES_texture_float"),OES_texture_float_linear:I.getExtension("OES_texture_float_linear"),OES_element_index_uint:I.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:I.getExtension("WEBGL_draw_buffers")},T=this.getFeatures()))}static isContextMatch($){return typeof WebGLRenderingContext<"u"?$ instanceof WebGLRenderingContext:!1}static getIsTextureFloat(){return!!k.OES_texture_float}static getIsDrawBuffers(){return!!k.WEBGL_draw_buffers}static getChannelCount(){return k.WEBGL_draw_buffers?I.getParameter(k.WEBGL_draw_buffers.MAX_DRAW_BUFFERS_WEBGL):1}static getMaxTextureSize(){return I.getParameter(I.MAX_TEXTURE_SIZE)}static lookupKernelValueType($,w,V,K){return S($,w,V,K)}static get testCanvas(){return P}static get testContext(){return I}static get features(){return T}static get fragmentShader(){return h}static get vertexShader(){return a}constructor($,w){super($,w),this.program=null,this.pipeline=w.pipeline,this.endianness=m.systemEndianness(),this.extensions={},this.argumentTextureCount=0,this.constantTextureCount=0,this.fragShader=null,this.vertShader=null,this.drawBuffersMap=null,this.maxTexSize=null,this.onRequestSwitchKernel=null,this.texture=null,this.mappedTextures=null,this.mergeSettings($.settings||w),this.threadDim=null,this.framebuffer=null,this.buffer=null,this.textureCache=[],this.programUniformLocationCache={},this.uniform1fCache={},this.uniform1iCache={},this.uniform2fCache={},this.uniform2fvCache={},this.uniform2ivCache={},this.uniform3fvCache={},this.uniform3ivCache={},this.uniform4fvCache={},this.uniform4ivCache={}}initCanvas(){if(typeof document<"u"){const $=document.createElement("canvas");return $.width=2,$.height=2,$}else if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(0,0)}initContext(){const $={alpha:!1,depth:!1,antialias:!1};return this.canvas.getContext("webgl",$)||this.canvas.getContext("experimental-webgl",$)}initPlugins($){const w=[],{source:V}=this;if(typeof V=="string")for(let K=0;K<L.length;K++){const fe=L[K];V.match(fe.functionMatch)&&w.push(fe)}else if(typeof V=="object"&&$.pluginNames)for(let K=0;K<L.length;K++){const fe=L[K];$.pluginNames.some(ue=>ue===fe.name)&&w.push(fe)}return w}initExtensions(){this.extensions={OES_texture_float:this.context.getExtension("OES_texture_float"),OES_texture_float_linear:this.context.getExtension("OES_texture_float_linear"),OES_element_index_uint:this.context.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:this.context.getExtension("WEBGL_draw_buffers"),WEBGL_color_buffer_float:this.context.getExtension("WEBGL_color_buffer_float")}}validateSettings($){if(!this.validate){this.texSize=m.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output);return}const{features:w}=this.constructor;if(this.optimizeFloatMemory===!0&&!w.isTextureFloat)throw new Error("Float textures are not supported");if(this.precision==="single"&&!w.isFloatRead)throw new Error("Single precision not supported");if(!this.graphical&&this.precision===null&&w.isTextureFloat&&(this.precision=w.isFloatRead?"single":"unsigned"),this.subKernels&&this.subKernels.length>0&&!this.extensions.WEBGL_draw_buffers)throw new Error("could not instantiate draw buffers extension");if(this.fixIntegerDivisionAccuracy===null?this.fixIntegerDivisionAccuracy=!w.isIntegerDivisionAccurate:this.fixIntegerDivisionAccuracy&&w.isIntegerDivisionAccurate&&(this.fixIntegerDivisionAccuracy=!1),this.checkOutput(),!this.output||this.output.length===0){if($.length!==1)throw new Error("Auto output only supported for kernels with only one input");const V=m.getVariableType($[0],this.strictIntegers);switch(V){case"Array":this.output=m.getDimensions(V);break;case"NumberTexture":case"MemoryOptimizedNumberTexture":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":this.output=$[0].output;break;default:throw new Error("Auto output not supported for input type: "+V)}}if(this.graphical){if(this.output.length!==2)throw new Error("Output must have 2 dimensions on graphical mode");this.precision==="precision"&&(this.precision="unsigned",console.warn("Cannot use graphical mode and single precision at the same time")),this.texSize=m.clone(this.output);return}else this.precision===null&&w.isTextureFloat&&(this.precision="single");this.texSize=m.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output),this.checkTextureSize()}updateMaxTexSize(){const{texSize:$,canvas:w}=this;if(this.maxTexSize===null){let V=D.indexOf(w);V===-1&&(V=D.length,D.push(w),z[V]=[$[0],$[1]]),this.maxTexSize=z[V]}this.maxTexSize[0]<$[0]&&(this.maxTexSize[0]=$[0]),this.maxTexSize[1]<$[1]&&(this.maxTexSize[1]=$[1])}setupArguments($){this.kernelArguments=[],this.argumentTextureCount=0;const w=this.argumentTypes===null;if(w&&(this.argumentTypes=[]),this.argumentSizes=[],this.argumentBitRatios=[],$.length<this.argumentNames.length)throw new Error("not enough arguments for kernel");if($.length>this.argumentNames.length)throw new Error("too many arguments for kernel");const{context:V}=this;let K=0;const fe=()=>this.createTexture(),ee=()=>this.constantTextureCount+K++,ue=Re=>{this.switchKernels({type:"argumentMismatch",needed:Re})},_e=()=>V.TEXTURE0+this.constantTextureCount+this.argumentTextureCount++;for(let Re=0;Re<$.length;Re++){const ft=$[Re],it=this.argumentNames[Re];let Pe;w?(Pe=m.getVariableType(ft,this.strictIntegers),this.argumentTypes.push(Pe)):Pe=this.argumentTypes[Re];const mt=this.constructor.lookupKernelValueType(Pe,this.dynamicArguments?"dynamic":"static",this.precision,$[Re]);if(mt===null)return this.requestFallback($);const bt=new mt(ft,{name:it,type:Pe,tactic:this.tactic,origin:"user",context:V,checkContext:this.checkContext,kernel:this,strictIntegers:this.strictIntegers,onRequestTexture:fe,onRequestIndex:ee,onUpdateValueMismatch:ue,onRequestContextHandle:_e});this.kernelArguments.push(bt),bt.setup(),this.argumentSizes.push(bt.textureSize),this.argumentBitRatios[Re]=bt.bitRatio}}createTexture(){const $=this.context.createTexture();return this.textureCache.push($),$}setupConstants($){const{context:w}=this;this.kernelConstants=[],this.forceUploadKernelConstants=[];let V=this.constantTypes===null;V&&(this.constantTypes={}),this.constantBitRatios={};let K=0;for(const fe in this.constants){const ee=this.constants[fe];let ue;V?(ue=m.getVariableType(ee,this.strictIntegers),this.constantTypes[fe]=ue):ue=this.constantTypes[fe];const _e=this.constructor.lookupKernelValueType(ue,"static",this.precision,ee);if(_e===null)return this.requestFallback($);const Re=new _e(ee,{name:fe,type:ue,tactic:this.tactic,origin:"constants",context:this.context,checkContext:this.checkContext,kernel:this,strictIntegers:this.strictIntegers,onRequestTexture:()=>this.createTexture(),onRequestIndex:()=>K++,onRequestContextHandle:()=>w.TEXTURE0+this.constantTextureCount++});this.constantBitRatios[fe]=Re.bitRatio,this.kernelConstants.push(Re),Re.setup(),Re.forceUploadEachRun&&this.forceUploadKernelConstants.push(Re)}}build(){if(this.built||(this.initExtensions(),this.validateSettings(arguments),this.setupConstants(arguments),this.fallbackRequested)||(this.setupArguments(arguments),this.fallbackRequested))return;this.updateMaxTexSize(),this.translateSource();const $=this.pickRenderStrategy(arguments);if($)return $;const{texSize:w,context:V,canvas:K}=this;V.enable(V.SCISSOR_TEST),this.pipeline&&this.precision==="single"?(V.viewport(0,0,this.maxTexSize[0],this.maxTexSize[1]),K.width=this.maxTexSize[0],K.height=this.maxTexSize[1]):(V.viewport(0,0,this.maxTexSize[0],this.maxTexSize[1]),K.width=this.maxTexSize[0],K.height=this.maxTexSize[1]);const fe=this.threadDim=Array.from(this.output);for(;fe.length<3;)fe.push(1);const ee=this.getVertexShader(arguments),ue=V.createShader(V.VERTEX_SHADER);V.shaderSource(ue,ee),V.compileShader(ue),this.vertShader=ue;const _e=this.getFragmentShader(arguments),Re=V.createShader(V.FRAGMENT_SHADER);if(V.shaderSource(Re,_e),V.compileShader(Re),this.fragShader=Re,this.debug&&(console.log("GLSL Shader Output:"),console.log(_e)),!V.getShaderParameter(ue,V.COMPILE_STATUS))throw new Error("Error compiling vertex shader: "+V.getShaderInfoLog(ue));if(!V.getShaderParameter(Re,V.COMPILE_STATUS))throw new Error("Error compiling fragment shader: "+V.getShaderInfoLog(Re));const ft=this.program=V.createProgram();V.attachShader(ft,ue),V.attachShader(ft,Re),V.linkProgram(ft),this.framebuffer=V.createFramebuffer(),this.framebuffer.width=w[0],this.framebuffer.height=w[1],this.rawValueFramebuffers={};const it=new Float32Array([-1,-1,1,-1,-1,1,1,1]),Pe=new Float32Array([0,0,1,0,0,1,1,1]),mt=it.byteLength;let bt=this.buffer;bt?V.bindBuffer(V.ARRAY_BUFFER,bt):(bt=this.buffer=V.createBuffer(),V.bindBuffer(V.ARRAY_BUFFER,bt),V.bufferData(V.ARRAY_BUFFER,it.byteLength+Pe.byteLength,V.STATIC_DRAW)),V.bufferSubData(V.ARRAY_BUFFER,0,it),V.bufferSubData(V.ARRAY_BUFFER,mt,Pe);const Rt=V.getAttribLocation(this.program,"aPos");V.enableVertexAttribArray(Rt),V.vertexAttribPointer(Rt,2,V.FLOAT,!1,0,0);const lt=V.getAttribLocation(this.program,"aTexCoord");V.enableVertexAttribArray(lt),V.vertexAttribPointer(lt,2,V.FLOAT,!1,0,mt),V.bindFramebuffer(V.FRAMEBUFFER,this.framebuffer);let ct=0;V.useProgram(this.program);for(let Ye in this.constants)this.kernelConstants[ct++].updateValue(this.constants[Ye]);this._setupOutputTexture(),this.subKernels!==null&&this.subKernels.length>0&&(this._mappedTextureSwitched={},this._setupSubOutputTextures()),this.buildSignature(arguments),this.built=!0}translateSource(){const $=y.fromKernel(this,v,{fixIntegerDivisionAccuracy:this.fixIntegerDivisionAccuracy});this.translatedSource=$.getPrototypeString("kernel"),this.setupReturnTypes($)}setupReturnTypes($){if(!this.graphical&&!this.returnType&&(this.returnType=$.getKernelResultType()),this.subKernels&&this.subKernels.length>0)for(let w=0;w<this.subKernels.length;w++){const V=this.subKernels[w];V.returnType||(V.returnType=$.getSubKernelResultType(w))}}run(){const{kernelArguments:$,texSize:w,forceUploadKernelConstants:V,context:K}=this;K.useProgram(this.program),K.scissor(0,0,w[0],w[1]),this.dynamicOutput&&(this.setUniform3iv("uOutputDim",new Int32Array(this.threadDim)),this.setUniform2iv("uTexSize",w)),this.setUniform2f("ratio",w[0]/this.maxTexSize[0],w[1]/this.maxTexSize[1]);for(let fe=0;fe<V.length;fe++){const ee=V[fe];if(ee.updateValue(this.constants[ee.name]),this.switchingKernels)return}for(let fe=0;fe<$.length;fe++)if($[fe].updateValue(arguments[fe]),this.switchingKernels)return;if(this.plugins)for(let fe=0;fe<this.plugins.length;fe++){const ee=this.plugins[fe];ee.onBeforeRun&&ee.onBeforeRun(this)}if(this.graphical){if(this.pipeline)return K.bindRenderbuffer(K.RENDERBUFFER,null),K.bindFramebuffer(K.FRAMEBUFFER,this.framebuffer),this.immutable&&this._replaceOutputTexture(),K.drawArrays(K.TRIANGLE_STRIP,0,4),this.immutable?this.texture.clone():this.texture;K.bindRenderbuffer(K.RENDERBUFFER,null),K.bindFramebuffer(K.FRAMEBUFFER,null),K.drawArrays(K.TRIANGLE_STRIP,0,4);return}K.bindFramebuffer(K.FRAMEBUFFER,this.framebuffer),this.immutable&&this._replaceOutputTexture(),this.subKernels!==null&&(this.immutable&&this._replaceSubOutputTextures(),this.drawBuffers()),K.drawArrays(K.TRIANGLE_STRIP,0,4)}drawBuffers(){this.extensions.WEBGL_draw_buffers.drawBuffersWEBGL(this.drawBuffersMap)}getInternalFormat(){return this.context.RGBA}getTextureFormat(){const{context:$}=this;switch(this.getInternalFormat()){case $.RGBA:return $.RGBA;default:throw new Error("Unknown internal format")}}_replaceOutputTexture(){if(this.texture.beforeMutate()||this._textureSwitched){const $=this.context;$.framebufferTexture2D($.FRAMEBUFFER,$.COLOR_ATTACHMENT0,$.TEXTURE_2D,this.texture.texture,0),this._textureSwitched=!1}}_setupOutputTexture(){const $=this.context,w=this.texSize;if(this.texture){$.framebufferTexture2D($.FRAMEBUFFER,$.COLOR_ATTACHMENT0,$.TEXTURE_2D,this.texture.texture,0);return}const V=this.createTexture();$.activeTexture($.TEXTURE0+this.constantTextureCount+this.argumentTextureCount),$.bindTexture($.TEXTURE_2D,V),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.NEAREST),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.NEAREST);const K=this.getInternalFormat();this.precision==="single"?$.texImage2D($.TEXTURE_2D,0,K,w[0],w[1],0,$.RGBA,$.FLOAT,null):$.texImage2D($.TEXTURE_2D,0,K,w[0],w[1],0,K,$.UNSIGNED_BYTE,null),$.framebufferTexture2D($.FRAMEBUFFER,$.COLOR_ATTACHMENT0,$.TEXTURE_2D,V,0),this.texture=new this.TextureConstructor({texture:V,size:w,dimensions:this.threadDim,output:this.output,context:this.context,internalFormat:this.getInternalFormat(),textureFormat:this.getTextureFormat(),kernel:this})}_replaceSubOutputTextures(){const $=this.context;for(let w=0;w<this.mappedTextures.length;w++){const V=this.mappedTextures[w];(V.beforeMutate()||this._mappedTextureSwitched[w])&&($.framebufferTexture2D($.FRAMEBUFFER,$.COLOR_ATTACHMENT0+w+1,$.TEXTURE_2D,V.texture,0),this._mappedTextureSwitched[w]=!1)}}_setupSubOutputTextures(){const $=this.context;if(this.mappedTextures){for(let V=0;V<this.subKernels.length;V++)$.framebufferTexture2D($.FRAMEBUFFER,$.COLOR_ATTACHMENT0+V+1,$.TEXTURE_2D,this.mappedTextures[V].texture,0);return}const w=this.texSize;this.drawBuffersMap=[$.COLOR_ATTACHMENT0],this.mappedTextures=[];for(let V=0;V<this.subKernels.length;V++){const K=this.createTexture();this.drawBuffersMap.push($.COLOR_ATTACHMENT0+V+1),$.activeTexture($.TEXTURE0+this.constantTextureCount+this.argumentTextureCount+V),$.bindTexture($.TEXTURE_2D,K),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.NEAREST),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.NEAREST),this.precision==="single"?$.texImage2D($.TEXTURE_2D,0,$.RGBA,w[0],w[1],0,$.RGBA,$.FLOAT,null):$.texImage2D($.TEXTURE_2D,0,$.RGBA,w[0],w[1],0,$.RGBA,$.UNSIGNED_BYTE,null),$.framebufferTexture2D($.FRAMEBUFFER,$.COLOR_ATTACHMENT0+V+1,$.TEXTURE_2D,K,0),this.mappedTextures.push(new this.TextureConstructor({texture:K,size:w,dimensions:this.threadDim,output:this.output,context:this.context,internalFormat:this.getInternalFormat(),textureFormat:this.getTextureFormat(),kernel:this}))}}setUniform1f($,w){if(this.uniform1fCache.hasOwnProperty($)){const K=this.uniform1fCache[$];if(w===K)return}this.uniform1fCache[$]=w;const V=this.getUniformLocation($);this.context.uniform1f(V,w)}setUniform1i($,w){if(this.uniform1iCache.hasOwnProperty($)){const K=this.uniform1iCache[$];if(w===K)return}this.uniform1iCache[$]=w;const V=this.getUniformLocation($);this.context.uniform1i(V,w)}setUniform2f($,w,V){if(this.uniform2fCache.hasOwnProperty($)){const fe=this.uniform2fCache[$];if(w===fe[0]&&V===fe[1])return}this.uniform2fCache[$]=[w,V];const K=this.getUniformLocation($);this.context.uniform2f(K,w,V)}setUniform2fv($,w){if(this.uniform2fvCache.hasOwnProperty($)){const K=this.uniform2fvCache[$];if(w[0]===K[0]&&w[1]===K[1])return}this.uniform2fvCache[$]=w;const V=this.getUniformLocation($);this.context.uniform2fv(V,w)}setUniform2iv($,w){if(this.uniform2ivCache.hasOwnProperty($)){const K=this.uniform2ivCache[$];if(w[0]===K[0]&&w[1]===K[1])return}this.uniform2ivCache[$]=w;const V=this.getUniformLocation($);this.context.uniform2iv(V,w)}setUniform3fv($,w){if(this.uniform3fvCache.hasOwnProperty($)){const K=this.uniform3fvCache[$];if(w[0]===K[0]&&w[1]===K[1]&&w[2]===K[2])return}this.uniform3fvCache[$]=w;const V=this.getUniformLocation($);this.context.uniform3fv(V,w)}setUniform3iv($,w){if(this.uniform3ivCache.hasOwnProperty($)){const K=this.uniform3ivCache[$];if(w[0]===K[0]&&w[1]===K[1]&&w[2]===K[2])return}this.uniform3ivCache[$]=w;const V=this.getUniformLocation($);this.context.uniform3iv(V,w)}setUniform4fv($,w){if(this.uniform4fvCache.hasOwnProperty($)){const K=this.uniform4fvCache[$];if(w[0]===K[0]&&w[1]===K[1]&&w[2]===K[2]&&w[3]===K[3])return}this.uniform4fvCache[$]=w;const V=this.getUniformLocation($);this.context.uniform4fv(V,w)}setUniform4iv($,w){if(this.uniform4ivCache.hasOwnProperty($)){const K=this.uniform4ivCache[$];if(w[0]===K[0]&&w[1]===K[1]&&w[2]===K[2]&&w[3]===K[3])return}this.uniform4ivCache[$]=w;const V=this.getUniformLocation($);this.context.uniform4iv(V,w)}getUniformLocation($){return this.programUniformLocationCache.hasOwnProperty($)?this.programUniformLocationCache[$]:this.programUniformLocationCache[$]=this.context.getUniformLocation(this.program,$)}_getFragShaderArtifactMap($){return{HEADER:this._getHeaderString(),LOOP_MAX:this._getLoopMaxString(),PLUGINS:this._getPluginsString(),CONSTANTS:this._getConstantsString(),DECODE32_ENDIANNESS:this._getDecode32EndiannessString(),ENCODE32_ENDIANNESS:this._getEncode32EndiannessString(),DIVIDE_WITH_INTEGER_CHECK:this._getDivideWithIntegerCheckString(),INJECTED_NATIVE:this._getInjectedNative(),MAIN_CONSTANTS:this._getMainConstantsString(),MAIN_ARGUMENTS:this._getMainArgumentsString($),KERNEL:this.getKernelString(),MAIN_RESULT:this.getMainResultString(),FLOAT_TACTIC_DECLARATION:this.getFloatTacticDeclaration(),INT_TACTIC_DECLARATION:this.getIntTacticDeclaration(),SAMPLER_2D_TACTIC_DECLARATION:this.getSampler2DTacticDeclaration(),SAMPLER_2D_ARRAY_TACTIC_DECLARATION:this.getSampler2DArrayTacticDeclaration()}}_getVertShaderArtifactMap($){return{FLOAT_TACTIC_DECLARATION:this.getFloatTacticDeclaration(),INT_TACTIC_DECLARATION:this.getIntTacticDeclaration(),SAMPLER_2D_TACTIC_DECLARATION:this.getSampler2DTacticDeclaration(),SAMPLER_2D_ARRAY_TACTIC_DECLARATION:this.getSampler2DArrayTacticDeclaration()}}_getHeaderString(){return this.subKernels!==null?`#extension GL_EXT_draw_buffers : require
`:""}_getLoopMaxString(){return this.loopMaxIterations?` ${parseInt(this.loopMaxIterations)};
`:` 1000;
`}_getPluginsString(){return this.plugins?this.plugins.map($=>$.source&&this.source.match($.functionMatch)?$.source:"").join(`
`):`
`}_getConstantsString(){const $=[],{threadDim:w,texSize:V}=this;return this.dynamicOutput?$.push("uniform ivec3 uOutputDim","uniform ivec2 uTexSize"):$.push(`ivec3 uOutputDim = ivec3(${w[0]}, ${w[1]}, ${w[2]})`,`ivec2 uTexSize = ivec2(${V[0]}, ${V[1]})`),m.linesToString($)}_getTextureCoordinate(){const $=this.subKernels;return $===null||$.length<1?`varying vec2 vTexCoord;
`:`out vec2 vTexCoord;
`}_getDecode32EndiannessString(){return this.endianness==="LE"?"":`  texel.rgba = texel.abgr;
`}_getEncode32EndiannessString(){return this.endianness==="LE"?"":`  texel.rgba = texel.abgr;
`}_getDivideWithIntegerCheckString(){return this.fixIntegerDivisionAccuracy?`float divWithIntCheck(float x, float y) {
  if (floor(x) == x && floor(y) == y && integerMod(x, y) == 0.0) {
    return float(int(x) / int(y));
  }
  return x / y;
}

float integerCorrectionModulo(float number, float divisor) {
  if (number < 0.0) {
    number = abs(number);
    if (divisor < 0.0) {
      divisor = abs(divisor);
    }
    return -(number - (divisor * floor(divWithIntCheck(number, divisor))));
  }
  if (divisor < 0.0) {
    divisor = abs(divisor);
  }
  return number - (divisor * floor(divWithIntCheck(number, divisor)));
}`:""}_getMainArgumentsString($){const w=[],{argumentNames:V}=this;for(let K=0;K<V.length;K++)w.push(this.kernelArguments[K].getSource($[K]));return w.join("")}_getInjectedNative(){return this.injectedNative||""}_getMainConstantsString(){const $=[],{constants:w}=this;if(w){let V=0;for(const K in w)this.constants.hasOwnProperty(K)&&$.push(this.kernelConstants[V++].getSource(this.constants[K]))}return $.join("")}getRawValueFramebuffer($,w){if(this.rawValueFramebuffers[$]||(this.rawValueFramebuffers[$]={}),!this.rawValueFramebuffers[$][w]){const V=this.context.createFramebuffer();V.width=$,V.height=w,this.rawValueFramebuffers[$][w]=V}return this.rawValueFramebuffers[$][w]}getKernelResultDeclaration(){switch(this.returnType){case"Array(2)":return"vec2 kernelResult";case"Array(3)":return"vec3 kernelResult";case"Array(4)":return"vec4 kernelResult";case"LiteralInteger":case"Float":case"Number":case"Integer":return"float kernelResult";default:if(this.graphical)return"float kernelResult";throw new Error(`unrecognized output type "${this.returnType}"`)}}getKernelString(){const $=[this.getKernelResultDeclaration()],{subKernels:w}=this;if(w!==null)switch(this.returnType){case"Number":case"Float":case"Integer":for(let V=0;V<w.length;V++){const K=w[V];$.push(K.returnType==="Integer"?`int subKernelResult_${K.name} = 0`:`float subKernelResult_${K.name} = 0.0`)}break;case"Array(2)":for(let V=0;V<w.length;V++)$.push(`vec2 subKernelResult_${w[V].name}`);break;case"Array(3)":for(let V=0;V<w.length;V++)$.push(`vec3 subKernelResult_${w[V].name}`);break;case"Array(4)":for(let V=0;V<w.length;V++)$.push(`vec4 subKernelResult_${w[V].name}`);break}return m.linesToString($)+this.translatedSource}getMainResultGraphical(){return m.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragColor = actualColor"])}getMainResultPackedPixels(){switch(this.returnType){case"LiteralInteger":case"Number":case"Integer":case"Float":return this.getMainResultKernelPackedPixels()+this.getMainResultSubKernelPackedPixels();default:throw new Error(`packed output only usable with Numbers, "${this.returnType}" specified`)}}getMainResultKernelPackedPixels(){return m.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()",`  gl_FragData[0] = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(kernelResult)`])}getMainResultSubKernelPackedPixels(){const $=[];if(!this.subKernels)return"";for(let w=0;w<this.subKernels.length;w++)this.subKernels[w].returnType==="Integer"?$.push(`  gl_FragData[${w+1}] = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(float(subKernelResult_${this.subKernels[w].name}))`):$.push(`  gl_FragData[${w+1}] = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(subKernelResult_${this.subKernels[w].name})`);return m.linesToString($)}getMainResultMemoryOptimizedFloats(){const $=["  index *= 4"];switch(this.returnType){case"Number":case"Integer":case"Float":const w=["r","g","b","a"];for(let V=0;V<w.length;V++){const K=w[V];this.getMainResultKernelMemoryOptimizedFloats($,K),this.getMainResultSubKernelMemoryOptimizedFloats($,K),V+1<w.length&&$.push("  index += 1")}break;default:throw new Error(`optimized output only usable with Numbers, ${this.returnType} specified`)}return m.linesToString($)}getMainResultKernelMemoryOptimizedFloats($,w){$.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()",`  gl_FragData[0].${w} = kernelResult`)}getMainResultSubKernelMemoryOptimizedFloats($,w){if(!this.subKernels)return $;for(let V=0;V<this.subKernels.length;V++)this.subKernels[V].returnType==="Integer"?$.push(`  gl_FragData[${V+1}].${w} = float(subKernelResult_${this.subKernels[V].name})`):$.push(`  gl_FragData[${V+1}].${w} = subKernelResult_${this.subKernels[V].name}`)}getMainResultKernelNumberTexture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0][0] = kernelResult"]}getMainResultSubKernelNumberTexture(){const $=[];if(!this.subKernels)return $;for(let w=0;w<this.subKernels.length;++w){const V=this.subKernels[w];V.returnType==="Integer"?$.push(`  gl_FragData[${w+1}][0] = float(subKernelResult_${V.name})`):$.push(`  gl_FragData[${w+1}][0] = subKernelResult_${V.name}`)}return $}getMainResultKernelArray2Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0][0] = kernelResult[0]","  gl_FragData[0][1] = kernelResult[1]"]}getMainResultSubKernelArray2Texture(){const $=[];if(!this.subKernels)return $;for(let w=0;w<this.subKernels.length;++w)$.push(`  gl_FragData[${w+1}][0] = subKernelResult_${this.subKernels[w].name}[0]`,`  gl_FragData[${w+1}][1] = subKernelResult_${this.subKernels[w].name}[1]`);return $}getMainResultKernelArray3Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0][0] = kernelResult[0]","  gl_FragData[0][1] = kernelResult[1]","  gl_FragData[0][2] = kernelResult[2]"]}getMainResultSubKernelArray3Texture(){const $=[];if(!this.subKernels)return $;for(let w=0;w<this.subKernels.length;++w)$.push(`  gl_FragData[${w+1}][0] = subKernelResult_${this.subKernels[w].name}[0]`,`  gl_FragData[${w+1}][1] = subKernelResult_${this.subKernels[w].name}[1]`,`  gl_FragData[${w+1}][2] = subKernelResult_${this.subKernels[w].name}[2]`);return $}getMainResultKernelArray4Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0] = kernelResult"]}getMainResultSubKernelArray4Texture(){const $=[];if(!this.subKernels)return $;switch(this.returnType){case"Number":case"Float":case"Integer":for(let w=0;w<this.subKernels.length;++w)this.subKernels[w].returnType==="Integer"?$.push(`  gl_FragData[${w+1}] = float(subKernelResult_${this.subKernels[w].name})`):$.push(`  gl_FragData[${w+1}] = subKernelResult_${this.subKernels[w].name}`);break;case"Array(2)":for(let w=0;w<this.subKernels.length;++w)$.push(`  gl_FragData[${w+1}][0] = subKernelResult_${this.subKernels[w].name}[0]`,`  gl_FragData[${w+1}][1] = subKernelResult_${this.subKernels[w].name}[1]`);break;case"Array(3)":for(let w=0;w<this.subKernels.length;++w)$.push(`  gl_FragData[${w+1}][0] = subKernelResult_${this.subKernels[w].name}[0]`,`  gl_FragData[${w+1}][1] = subKernelResult_${this.subKernels[w].name}[1]`,`  gl_FragData[${w+1}][2] = subKernelResult_${this.subKernels[w].name}[2]`);break;case"Array(4)":for(let w=0;w<this.subKernels.length;++w)$.push(`  gl_FragData[${w+1}][0] = subKernelResult_${this.subKernels[w].name}[0]`,`  gl_FragData[${w+1}][1] = subKernelResult_${this.subKernels[w].name}[1]`,`  gl_FragData[${w+1}][2] = subKernelResult_${this.subKernels[w].name}[2]`,`  gl_FragData[${w+1}][3] = subKernelResult_${this.subKernels[w].name}[3]`);break}return $}replaceArtifacts($,w){return $.replace(/[ ]*__([A-Z]+[0-9]*([_]?[A-Z]*[0-9]?)*)__;\n/g,(V,K)=>{if(w.hasOwnProperty(K))return w[K];throw`unhandled artifact ${K}`})}getFragmentShader($){return this.compiledFragmentShader!==null?this.compiledFragmentShader:this.compiledFragmentShader=this.replaceArtifacts(this.constructor.fragmentShader,this._getFragShaderArtifactMap($))}getVertexShader($){return this.compiledVertexShader!==null?this.compiledVertexShader:this.compiledVertexShader=this.replaceArtifacts(this.constructor.vertexShader,this._getVertShaderArtifactMap($))}toString(){const $=m.linesToString(["const gl = context"]);return o(this.constructor,arguments,this,$)}destroy($){if(!this.context)return;this.buffer&&this.context.deleteBuffer(this.buffer),this.framebuffer&&this.context.deleteFramebuffer(this.framebuffer);for(const V in this.rawValueFramebuffers){for(const K in this.rawValueFramebuffers[V])this.context.deleteFramebuffer(this.rawValueFramebuffers[V][K]),delete this.rawValueFramebuffers[V][K];delete this.rawValueFramebuffers[V]}if(this.vertShader&&this.context.deleteShader(this.vertShader),this.fragShader&&this.context.deleteShader(this.fragShader),this.program&&this.context.deleteProgram(this.program),this.texture){this.texture.delete();const V=this.textureCache.indexOf(this.texture.texture);V>-1&&this.textureCache.splice(V,1),this.texture=null}if(this.mappedTextures&&this.mappedTextures.length){for(let V=0;V<this.mappedTextures.length;V++){const K=this.mappedTextures[V];K.delete();const fe=this.textureCache.indexOf(K.texture);fe>-1&&this.textureCache.splice(fe,1)}this.mappedTextures=null}if(this.kernelArguments)for(let V=0;V<this.kernelArguments.length;V++)this.kernelArguments[V].destroy();if(this.kernelConstants)for(let V=0;V<this.kernelConstants.length;V++)this.kernelConstants[V].destroy();for(;this.textureCache.length>0;){const V=this.textureCache.pop();this.context.deleteTexture(V)}if($){const V=D.indexOf(this.canvas);V>=0&&(D[V]=null,z[V]=null)}if(this.destroyExtensions(),delete this.context,delete this.canvas,!this.gpu)return;const w=this.gpu.kernels.indexOf(this);w!==-1&&this.gpu.kernels.splice(w,1)}destroyExtensions(){this.extensions.OES_texture_float=null,this.extensions.OES_texture_float_linear=null,this.extensions.OES_element_index_uint=null,this.extensions.WEBGL_draw_buffers=null}static destroyContext($){const w=$.getExtension("WEBGL_lose_context");w&&w.loseContext()}toJSON(){const $=super.toJSON();return $.functionNodes=y.fromKernel(this,v).toJSON(),$.settings.threadDim=this.threadDim,$}}i.exports={WebGLKernel:re}},{"../../plugins/math-random-uniformly-distributed":112,"../../utils":114,"../function-builder":9,"../gl/kernel":13,"../gl/kernel-string":12,"./fragment-shader":37,"./function-node":38,"./kernel-value-maps":39,"./vertex-shader":71}],71:[function(n,i,p){const d=`__FLOAT_TACTIC_DECLARATION__;
__INT_TACTIC_DECLARATION__;
__SAMPLER_2D_TACTIC_DECLARATION__;

attribute vec2 aPos;
attribute vec2 aTexCoord;

varying vec2 vTexCoord;
uniform vec2 ratio;

void main(void) {
  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);
  vTexCoord = aTexCoord;
}`;i.exports={vertexShader:d}},{}],72:[function(n,i,p){const d=`#version 300 es
__HEADER__;
__FLOAT_TACTIC_DECLARATION__;
__INT_TACTIC_DECLARATION__;
__SAMPLER_2D_TACTIC_DECLARATION__;
__SAMPLER_2D_ARRAY_TACTIC_DECLARATION__;

const int LOOP_MAX = __LOOP_MAX__;

__PLUGINS__;
__CONSTANTS__;

in vec2 vTexCoord;

float atan2(float v1, float v2) {
  if (v1 == 0.0 || v2 == 0.0) return 0.0;
  return atan(v1 / v2);
}

float cbrt(float x) {
  if (x >= 0.0) {
    return pow(x, 1.0 / 3.0);
  } else {
    return -pow(x, 1.0 / 3.0);
  }
}

float expm1(float x) {
  return pow(${Math.E}, x) - 1.0; 
}

float fround(highp float x) {
  return x;
}

float imul(float v1, float v2) {
  return float(int(v1) * int(v2));
}

float log10(float x) {
  return log2(x) * (1.0 / log2(10.0));
}

float log1p(float x) {
  return log(1.0 + x);
}

float _pow(float v1, float v2) {
  if (v2 == 0.0) return 1.0;
  return pow(v1, v2);
}

float _round(float x) {
  return floor(x + 0.5);
}


const int BIT_COUNT = 32;
int modi(int x, int y) {
  return x - y * (x / y);
}

int bitwiseOr(int a, int b) {
  int result = 0;
  int n = 1;
  
  for (int i = 0; i < BIT_COUNT; i++) {
    if ((modi(a, 2) == 1) || (modi(b, 2) == 1)) {
      result += n;
    }
    a = a / 2;
    b = b / 2;
    n = n * 2;
    if(!(a > 0 || b > 0)) {
      break;
    }
  }
  return result;
}
int bitwiseXOR(int a, int b) {
  int result = 0;
  int n = 1;
  
  for (int i = 0; i < BIT_COUNT; i++) {
    if ((modi(a, 2) == 1) != (modi(b, 2) == 1)) {
      result += n;
    }
    a = a / 2;
    b = b / 2;
    n = n * 2;
    if(!(a > 0 || b > 0)) {
      break;
    }
  }
  return result;
}
int bitwiseAnd(int a, int b) {
  int result = 0;
  int n = 1;
  for (int i = 0; i < BIT_COUNT; i++) {
    if ((modi(a, 2) == 1) && (modi(b, 2) == 1)) {
      result += n;
    }
    a = a / 2;
    b = b / 2;
    n = n * 2;
    if(!(a > 0 && b > 0)) {
      break;
    }
  }
  return result;
}
int bitwiseNot(int a) {
  int result = 0;
  int n = 1;
  
  for (int i = 0; i < BIT_COUNT; i++) {
    if (modi(a, 2) == 0) {
      result += n;    
    }
    a = a / 2;
    n = n * 2;
  }
  return result;
}
int bitwiseZeroFillLeftShift(int n, int shift) {
  int maxBytes = BIT_COUNT;
  for (int i = 0; i < BIT_COUNT; i++) {
    if (maxBytes >= n) {
      break;
    }
    maxBytes *= 2;
  }
  for (int i = 0; i < BIT_COUNT; i++) {
    if (i >= shift) {
      break;
    }
    n *= 2;
  }

  int result = 0;
  int byteVal = 1;
  for (int i = 0; i < BIT_COUNT; i++) {
    if (i >= maxBytes) break;
    if (modi(n, 2) > 0) { result += byteVal; }
    n = int(n / 2);
    byteVal *= 2;
  }
  return result;
}

int bitwiseSignedRightShift(int num, int shifts) {
  return int(floor(float(num) / pow(2.0, float(shifts))));
}

int bitwiseZeroFillRightShift(int n, int shift) {
  int maxBytes = BIT_COUNT;
  for (int i = 0; i < BIT_COUNT; i++) {
    if (maxBytes >= n) {
      break;
    }
    maxBytes *= 2;
  }
  for (int i = 0; i < BIT_COUNT; i++) {
    if (i >= shift) {
      break;
    }
    n /= 2;
  }
  int result = 0;
  int byteVal = 1;
  for (int i = 0; i < BIT_COUNT; i++) {
    if (i >= maxBytes) break;
    if (modi(n, 2) > 0) { result += byteVal; }
    n = int(n / 2);
    byteVal *= 2;
  }
  return result;
}

vec2 integerMod(vec2 x, float y) {
  vec2 res = floor(mod(x, y));
  return res * step(1.0 - floor(y), -res);
}

vec3 integerMod(vec3 x, float y) {
  vec3 res = floor(mod(x, y));
  return res * step(1.0 - floor(y), -res);
}

vec4 integerMod(vec4 x, vec4 y) {
  vec4 res = floor(mod(x, y));
  return res * step(1.0 - floor(y), -res);
}

float integerMod(float x, float y) {
  float res = floor(mod(x, y));
  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);
}

int integerMod(int x, int y) {
  return x - (y * int(x/y));
}

__DIVIDE_WITH_INTEGER_CHECK__;

// Here be dragons!
// DO NOT OPTIMIZE THIS CODE
// YOU WILL BREAK SOMETHING ON SOMEBODY'S MACHINE
// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME
const vec2 MAGIC_VEC = vec2(1.0, -256.0);
const vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);
const vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536
float decode32(vec4 texel) {
  __DECODE32_ENDIANNESS__;
  texel *= 255.0;
  vec2 gte128;
  gte128.x = texel.b >= 128.0 ? 1.0 : 0.0;
  gte128.y = texel.a >= 128.0 ? 1.0 : 0.0;
  float exponent = 2.0 * texel.a - 127.0 + dot(gte128, MAGIC_VEC);
  float res = exp2(round(exponent));
  texel.b = texel.b - 128.0 * gte128.x;
  res = dot(texel, SCALE_FACTOR) * exp2(round(exponent-23.0)) + res;
  res *= gte128.y * -2.0 + 1.0;
  return res;
}

float decode16(vec4 texel, int index) {
  int channel = integerMod(index, 2);
  return texel[channel*2] * 255.0 + texel[channel*2 + 1] * 65280.0;
}

float decode8(vec4 texel, int index) {
  int channel = integerMod(index, 4);
  return texel[channel] * 255.0;
}

vec4 legacyEncode32(float f) {
  float F = abs(f);
  float sign = f < 0.0 ? 1.0 : 0.0;
  float exponent = floor(log2(F));
  float mantissa = (exp2(-exponent) * F);
  // exponent += floor(log2(mantissa));
  vec4 texel = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;
  texel.rg = integerMod(texel.rg, 256.0);
  texel.b = integerMod(texel.b, 128.0);
  texel.a = exponent*0.5 + 63.5;
  texel.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;
  texel = floor(texel);
  texel *= 0.003921569; // 1/255
  __ENCODE32_ENDIANNESS__;
  return texel;
}

// https://github.com/gpujs/gpu.js/wiki/Encoder-details
vec4 encode32(float value) {
  if (value == 0.0) return vec4(0, 0, 0, 0);

  float exponent;
  float mantissa;
  vec4  result;
  float sgn;

  sgn = step(0.0, -value);
  value = abs(value);

  exponent = floor(log2(value));

  mantissa = value*pow(2.0, -exponent)-1.0;
  exponent = exponent+127.0;
  result   = vec4(0,0,0,0);

  result.a = floor(exponent/2.0);
  exponent = exponent - result.a*2.0;
  result.a = result.a + 128.0*sgn;

  result.b = floor(mantissa * 128.0);
  mantissa = mantissa - result.b / 128.0;
  result.b = result.b + exponent*128.0;

  result.g = floor(mantissa*32768.0);
  mantissa = mantissa - result.g/32768.0;

  result.r = floor(mantissa*8388608.0);
  return result/255.0;
}
// Dragons end here

int index;
ivec3 threadId;

ivec3 indexTo3D(int idx, ivec3 texDim) {
  int z = int(idx / (texDim.x * texDim.y));
  idx -= z * int(texDim.x * texDim.y);
  int y = int(idx / texDim.x);
  int x = int(integerMod(idx, texDim.x));
  return ivec3(x, y, z);
}

float get32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture(tex, st / vec2(texSize));
  return decode32(texel);
}

float get16(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + (texDim.x * (y + (texDim.y * z)));
  int w = texSize.x * 2;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture(tex, st / vec2(texSize.x * 2, texSize.y));
  return decode16(texel, index);
}

float get8(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + (texDim.x * (y + (texDim.y * z)));
  int w = texSize.x * 4;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture(tex, st / vec2(texSize.x * 4, texSize.y));
  return decode8(texel, index);
}

float getMemoryOptimized32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + (texDim.x * (y + (texDim.y * z)));
  int channel = integerMod(index, 4);
  index = index / 4;
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  index = index / 4;
  vec4 texel = texture(tex, st / vec2(texSize));
  return texel[channel];
}

vec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  return texture(tex, st / vec2(texSize));
}

vec4 getImage3D(sampler2DArray tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  return texture(tex, vec3(st / vec2(texSize), z));
}

float getFloatFromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);
  return result[0];
}

vec2 getVec2FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);
  return vec2(result[0], result[1]);
}

vec2 getMemoryOptimizedVec2(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int channel = integerMod(index, 2);
  index = index / 2;
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture(tex, st / vec2(texSize));
  if (channel == 0) return vec2(texel.r, texel.g);
  if (channel == 1) return vec2(texel.b, texel.a);
  return vec2(0.0, 0.0);
}

vec3 getVec3FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);
  return vec3(result[0], result[1], result[2]);
}

vec3 getMemoryOptimizedVec3(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int fieldIndex = 3 * (x + texDim.x * (y + texDim.y * z));
  int vectorIndex = fieldIndex / 4;
  int vectorOffset = fieldIndex - vectorIndex * 4;
  int readY = vectorIndex / texSize.x;
  int readX = vectorIndex - readY * texSize.x;
  vec4 tex1 = texture(tex, (vec2(readX, readY) + 0.5) / vec2(texSize));

  if (vectorOffset == 0) {
    return tex1.xyz;
  } else if (vectorOffset == 1) {
    return tex1.yzw;
  } else {
    readX++;
    if (readX >= texSize.x) {
      readX = 0;
      readY++;
    }
    vec4 tex2 = texture(tex, vec2(readX, readY) / vec2(texSize));
    if (vectorOffset == 2) {
      return vec3(tex1.z, tex1.w, tex2.x);
    } else {
      return vec3(tex1.w, tex2.x, tex2.y);
    }
  }
}

vec4 getVec4FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  return getImage2D(tex, texSize, texDim, z, y, x);
}

vec4 getMemoryOptimizedVec4(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int channel = integerMod(index, 2);
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture(tex, st / vec2(texSize));
  return vec4(texel.r, texel.g, texel.b, texel.a);
}

vec4 actualColor;
void color(float r, float g, float b, float a) {
  actualColor = vec4(r,g,b,a);
}

void color(float r, float g, float b) {
  color(r,g,b,1.0);
}

float modulo(float number, float divisor) {
  if (number < 0.0) {
    number = abs(number);
    if (divisor < 0.0) {
      divisor = abs(divisor);
    }
    return -mod(number, divisor);
  }
  if (divisor < 0.0) {
    divisor = abs(divisor);
  }
  return mod(number, divisor);
}

__INJECTED_NATIVE__;
__MAIN_CONSTANTS__;
__MAIN_ARGUMENTS__;
__KERNEL__;

void main(void) {
  index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;
  __MAIN_RESULT__;
}`;i.exports={fragmentShader:d}},{}],73:[function(n,i,p){const{utils:d}=n("../../utils"),{WebGLFunctionNode:y}=n("../web-gl/function-node");class v extends y{astIdentifierExpression(l,h){if(l.type!=="Identifier")throw this.astErrorOutput("IdentifierExpression - not an Identifier",l);const a=this.getType(l),o=d.sanitizeName(l.name);return l.name==="Infinity"?h.push("intBitsToFloat(2139095039)"):a==="Boolean"?this.argumentNames.indexOf(o)>-1?h.push(`bool(user_${o})`):h.push(`user_${o}`):h.push(`user_${o}`),h}}i.exports={WebGL2FunctionNode:v}},{"../../utils":114,"../web-gl/function-node":38}],74:[function(n,i,p){const{WebGL2KernelValueBoolean:d}=n("./kernel-value/boolean"),{WebGL2KernelValueFloat:y}=n("./kernel-value/float"),{WebGL2KernelValueInteger:v}=n("./kernel-value/integer"),{WebGL2KernelValueHTMLImage:m}=n("./kernel-value/html-image"),{WebGL2KernelValueDynamicHTMLImage:l}=n("./kernel-value/dynamic-html-image"),{WebGL2KernelValueHTMLImageArray:h}=n("./kernel-value/html-image-array"),{WebGL2KernelValueDynamicHTMLImageArray:a}=n("./kernel-value/dynamic-html-image-array"),{WebGL2KernelValueHTMLVideo:o}=n("./kernel-value/html-video"),{WebGL2KernelValueDynamicHTMLVideo:S}=n("./kernel-value/dynamic-html-video"),{WebGL2KernelValueSingleInput:_}=n("./kernel-value/single-input"),{WebGL2KernelValueDynamicSingleInput:P}=n("./kernel-value/dynamic-single-input"),{WebGL2KernelValueUnsignedInput:I}=n("./kernel-value/unsigned-input"),{WebGL2KernelValueDynamicUnsignedInput:k}=n("./kernel-value/dynamic-unsigned-input"),{WebGL2KernelValueMemoryOptimizedNumberTexture:T}=n("./kernel-value/memory-optimized-number-texture"),{WebGL2KernelValueDynamicMemoryOptimizedNumberTexture:L}=n("./kernel-value/dynamic-memory-optimized-number-texture"),{WebGL2KernelValueNumberTexture:D}=n("./kernel-value/number-texture"),{WebGL2KernelValueDynamicNumberTexture:z}=n("./kernel-value/dynamic-number-texture"),{WebGL2KernelValueSingleArray:re}=n("./kernel-value/single-array"),{WebGL2KernelValueDynamicSingleArray:he}=n("./kernel-value/dynamic-single-array"),{WebGL2KernelValueSingleArray1DI:$}=n("./kernel-value/single-array1d-i"),{WebGL2KernelValueDynamicSingleArray1DI:w}=n("./kernel-value/dynamic-single-array1d-i"),{WebGL2KernelValueSingleArray2DI:V}=n("./kernel-value/single-array2d-i"),{WebGL2KernelValueDynamicSingleArray2DI:K}=n("./kernel-value/dynamic-single-array2d-i"),{WebGL2KernelValueSingleArray3DI:fe}=n("./kernel-value/single-array3d-i"),{WebGL2KernelValueDynamicSingleArray3DI:ee}=n("./kernel-value/dynamic-single-array3d-i"),{WebGL2KernelValueArray2:ue}=n("./kernel-value/array2"),{WebGL2KernelValueArray3:_e}=n("./kernel-value/array3"),{WebGL2KernelValueArray4:Re}=n("./kernel-value/array4"),{WebGL2KernelValueUnsignedArray:ft}=n("./kernel-value/unsigned-array"),{WebGL2KernelValueDynamicUnsignedArray:it}=n("./kernel-value/dynamic-unsigned-array"),Pe={unsigned:{dynamic:{Boolean:d,Integer:v,Float:y,Array:it,"Array(2)":ue,"Array(3)":_e,"Array(4)":Re,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:k,NumberTexture:z,"ArrayTexture(1)":z,"ArrayTexture(2)":z,"ArrayTexture(3)":z,"ArrayTexture(4)":z,MemoryOptimizedNumberTexture:L,HTMLCanvas:l,OffscreenCanvas:l,HTMLImage:l,ImageBitmap:l,ImageData:l,HTMLImageArray:a,HTMLVideo:S},static:{Boolean:d,Float:y,Integer:v,Array:ft,"Array(2)":ue,"Array(3)":_e,"Array(4)":Re,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:I,NumberTexture:D,"ArrayTexture(1)":D,"ArrayTexture(2)":D,"ArrayTexture(3)":D,"ArrayTexture(4)":D,MemoryOptimizedNumberTexture:L,HTMLCanvas:m,OffscreenCanvas:m,HTMLImage:m,ImageBitmap:m,ImageData:m,HTMLImageArray:h,HTMLVideo:o}},single:{dynamic:{Boolean:d,Integer:v,Float:y,Array:he,"Array(2)":ue,"Array(3)":_e,"Array(4)":Re,"Array1D(2)":w,"Array1D(3)":w,"Array1D(4)":w,"Array2D(2)":K,"Array2D(3)":K,"Array2D(4)":K,"Array3D(2)":ee,"Array3D(3)":ee,"Array3D(4)":ee,Input:P,NumberTexture:z,"ArrayTexture(1)":z,"ArrayTexture(2)":z,"ArrayTexture(3)":z,"ArrayTexture(4)":z,MemoryOptimizedNumberTexture:L,HTMLCanvas:l,OffscreenCanvas:l,HTMLImage:l,ImageBitmap:l,ImageData:l,HTMLImageArray:a,HTMLVideo:S},static:{Boolean:d,Float:y,Integer:v,Array:re,"Array(2)":ue,"Array(3)":_e,"Array(4)":Re,"Array1D(2)":$,"Array1D(3)":$,"Array1D(4)":$,"Array2D(2)":V,"Array2D(3)":V,"Array2D(4)":V,"Array3D(2)":fe,"Array3D(3)":fe,"Array3D(4)":fe,Input:_,NumberTexture:D,"ArrayTexture(1)":D,"ArrayTexture(2)":D,"ArrayTexture(3)":D,"ArrayTexture(4)":D,MemoryOptimizedNumberTexture:T,HTMLCanvas:m,OffscreenCanvas:m,HTMLImage:m,ImageBitmap:m,ImageData:m,HTMLImageArray:h,HTMLVideo:o}}};function mt(bt,Rt,lt,ct){if(!bt)throw new Error("type missing");if(!Rt)throw new Error("dynamic missing");if(!lt)throw new Error("precision missing");ct.type&&(bt=ct.type);const Ye=Pe[lt][Rt];if(Ye[bt]===!1)return null;if(Ye[bt]===void 0)throw new Error(`Could not find a KernelValue for ${bt}`);return Ye[bt]}i.exports={kernelValueMaps:Pe,lookupKernelValueType:mt}},{"./kernel-value/array2":75,"./kernel-value/array3":76,"./kernel-value/array4":77,"./kernel-value/boolean":78,"./kernel-value/dynamic-html-image":80,"./kernel-value/dynamic-html-image-array":79,"./kernel-value/dynamic-html-video":81,"./kernel-value/dynamic-memory-optimized-number-texture":82,"./kernel-value/dynamic-number-texture":83,"./kernel-value/dynamic-single-array":84,"./kernel-value/dynamic-single-array1d-i":85,"./kernel-value/dynamic-single-array2d-i":86,"./kernel-value/dynamic-single-array3d-i":87,"./kernel-value/dynamic-single-input":88,"./kernel-value/dynamic-unsigned-array":89,"./kernel-value/dynamic-unsigned-input":90,"./kernel-value/float":91,"./kernel-value/html-image":93,"./kernel-value/html-image-array":92,"./kernel-value/html-video":94,"./kernel-value/integer":95,"./kernel-value/memory-optimized-number-texture":96,"./kernel-value/number-texture":97,"./kernel-value/single-array":98,"./kernel-value/single-array1d-i":99,"./kernel-value/single-array2d-i":100,"./kernel-value/single-array3d-i":101,"./kernel-value/single-input":102,"./kernel-value/unsigned-array":103,"./kernel-value/unsigned-input":104}],75:[function(n,i,p){const{WebGLKernelValueArray2:d}=n("../../web-gl/kernel-value/array2");class y extends d{}i.exports={WebGL2KernelValueArray2:y}},{"../../web-gl/kernel-value/array2":41}],76:[function(n,i,p){const{WebGLKernelValueArray3:d}=n("../../web-gl/kernel-value/array3");class y extends d{}i.exports={WebGL2KernelValueArray3:y}},{"../../web-gl/kernel-value/array3":42}],77:[function(n,i,p){const{WebGLKernelValueArray4:d}=n("../../web-gl/kernel-value/array4");class y extends d{}i.exports={WebGL2KernelValueArray4:y}},{"../../web-gl/kernel-value/array4":43}],78:[function(n,i,p){const{WebGLKernelValueBoolean:d}=n("../../web-gl/kernel-value/boolean");class y extends d{}i.exports={WebGL2KernelValueBoolean:y}},{"../../web-gl/kernel-value/boolean":44}],79:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGL2KernelValueHTMLImageArray:y}=n("./html-image-array");class v extends y{getSource(){const l=this.getVariablePrecisionString();return d.linesToString([`uniform ${l} sampler2DArray ${this.id}`,`uniform ${l} ivec2 ${this.sizeId}`,`uniform ${l} ivec3 ${this.dimensionsId}`])}updateValue(l){const{width:h,height:a}=l[0];this.checkSize(h,a),this.dimensions=[h,a,l.length],this.textureSize=[h,a],this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(l)}}i.exports={WebGL2KernelValueDynamicHTMLImageArray:v}},{"../../../utils":114,"./html-image-array":92}],80:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueDynamicHTMLImage:y}=n("../../web-gl/kernel-value/dynamic-html-image");class v extends y{getSource(){const l=this.getVariablePrecisionString();return d.linesToString([`uniform ${l} sampler2D ${this.id}`,`uniform ${l} ivec2 ${this.sizeId}`,`uniform ${l} ivec3 ${this.dimensionsId}`])}}i.exports={WebGL2KernelValueDynamicHTMLImage:v}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-html-image":45}],81:[function(n,i,p){n("../../../utils");const{WebGL2KernelValueDynamicHTMLImage:d}=n("./dynamic-html-image");class y extends d{}i.exports={WebGL2KernelValueDynamicHTMLVideo:y}},{"../../../utils":114,"./dynamic-html-image":80}],82:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueDynamicMemoryOptimizedNumberTexture:y}=n("../../web-gl/kernel-value/dynamic-memory-optimized-number-texture");class v extends y{getSource(){return d.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}}i.exports={WebGL2KernelValueDynamicMemoryOptimizedNumberTexture:v}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-memory-optimized-number-texture":47}],83:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueDynamicNumberTexture:y}=n("../../web-gl/kernel-value/dynamic-number-texture");class v extends y{getSource(){const l=this.getVariablePrecisionString();return d.linesToString([`uniform ${l} sampler2D ${this.id}`,`uniform ${l} ivec2 ${this.sizeId}`,`uniform ${l} ivec3 ${this.dimensionsId}`])}}i.exports={WebGL2KernelValueDynamicNumberTexture:v}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-number-texture":48}],84:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGL2KernelValueSingleArray:y}=n("../../web-gl2/kernel-value/single-array");class v extends y{getSource(){const l=this.getVariablePrecisionString();return d.linesToString([`uniform ${l} sampler2D ${this.id}`,`uniform ${l} ivec2 ${this.sizeId}`,`uniform ${l} ivec3 ${this.dimensionsId}`])}updateValue(l){this.dimensions=d.getDimensions(l,!0),this.textureSize=d.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(l)}}i.exports={WebGL2KernelValueDynamicSingleArray:v}},{"../../../utils":114,"../../web-gl2/kernel-value/single-array":98}],85:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGL2KernelValueSingleArray1DI:y}=n("../../web-gl2/kernel-value/single-array1d-i");class v extends y{getSource(){const l=this.getVariablePrecisionString();return d.linesToString([`uniform ${l} sampler2D ${this.id}`,`uniform ${l} ivec2 ${this.sizeId}`,`uniform ${l} ivec3 ${this.dimensionsId}`])}updateValue(l){this.setShape(l),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(l)}}i.exports={WebGL2KernelValueDynamicSingleArray1DI:v}},{"../../../utils":114,"../../web-gl2/kernel-value/single-array1d-i":99}],86:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGL2KernelValueSingleArray2DI:y}=n("../../web-gl2/kernel-value/single-array2d-i");class v extends y{getSource(){const l=this.getVariablePrecisionString();return d.linesToString([`uniform ${l} sampler2D ${this.id}`,`uniform ${l} ivec2 ${this.sizeId}`,`uniform ${l} ivec3 ${this.dimensionsId}`])}updateValue(l){this.setShape(l),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(l)}}i.exports={WebGL2KernelValueDynamicSingleArray2DI:v}},{"../../../utils":114,"../../web-gl2/kernel-value/single-array2d-i":100}],87:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGL2KernelValueSingleArray3DI:y}=n("../../web-gl2/kernel-value/single-array3d-i");class v extends y{getSource(){const l=this.getVariablePrecisionString();return d.linesToString([`uniform ${l} sampler2D ${this.id}`,`uniform ${l} ivec2 ${this.sizeId}`,`uniform ${l} ivec3 ${this.dimensionsId}`])}updateValue(l){this.setShape(l),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(l)}}i.exports={WebGL2KernelValueDynamicSingleArray3DI:v}},{"../../../utils":114,"../../web-gl2/kernel-value/single-array3d-i":101}],88:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGL2KernelValueSingleInput:y}=n("../../web-gl2/kernel-value/single-input");class v extends y{getSource(){const l=this.getVariablePrecisionString();return d.linesToString([`uniform ${l} sampler2D ${this.id}`,`uniform ${l} ivec2 ${this.sizeId}`,`uniform ${l} ivec3 ${this.dimensionsId}`])}updateValue(l){let[h,a,o]=l.size;this.dimensions=new Int32Array([h||1,a||1,o||1]),this.textureSize=d.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(l)}}i.exports={WebGL2KernelValueDynamicSingleInput:v}},{"../../../utils":114,"../../web-gl2/kernel-value/single-input":102}],89:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueDynamicUnsignedArray:y}=n("../../web-gl/kernel-value/dynamic-unsigned-array");class v extends y{getSource(){const l=this.getVariablePrecisionString();return d.linesToString([`uniform ${l} sampler2D ${this.id}`,`uniform ${l} ivec2 ${this.sizeId}`,`uniform ${l} ivec3 ${this.dimensionsId}`])}}i.exports={WebGL2KernelValueDynamicUnsignedArray:v}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-unsigned-array":54}],90:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueDynamicUnsignedInput:y}=n("../../web-gl/kernel-value/dynamic-unsigned-input");class v extends y{getSource(){const l=this.getVariablePrecisionString();return d.linesToString([`uniform ${l} sampler2D ${this.id}`,`uniform ${l} ivec2 ${this.sizeId}`,`uniform ${l} ivec3 ${this.dimensionsId}`])}}i.exports={WebGL2KernelValueDynamicUnsignedInput:v}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-unsigned-input":55}],91:[function(n,i,p){n("../../../utils");const{WebGLKernelValueFloat:d}=n("../../web-gl/kernel-value/float");class y extends d{}i.exports={WebGL2KernelValueFloat:y}},{"../../../utils":114,"../../web-gl/kernel-value/float":56}],92:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelArray:y}=n("../../web-gl/kernel-value/array");class v extends y{constructor(l,h){super(l,h),this.checkSize(l[0].width,l[0].height),this.dimensions=[l[0].width,l[0].height,l.length],this.textureSize=[l[0].width,l[0].height]}defineTexture(){const{context:l}=this;l.activeTexture(this.contextHandle),l.bindTexture(l.TEXTURE_2D_ARRAY,this.texture),l.texParameteri(l.TEXTURE_2D_ARRAY,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D_ARRAY,l.TEXTURE_MIN_FILTER,l.NEAREST)}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};
`}getSource(){const l=this.getVariablePrecisionString();return d.linesToString([`uniform ${l} sampler2DArray ${this.id}`,`${l} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${l} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(l){const{context:h}=this;h.activeTexture(this.contextHandle),h.bindTexture(h.TEXTURE_2D_ARRAY,this.texture),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!0),h.texImage3D(h.TEXTURE_2D_ARRAY,0,h.RGBA,l[0].width,l[0].height,l.length,0,h.RGBA,h.UNSIGNED_BYTE,null);for(let a=0;a<l.length;a++)h.texSubImage3D(h.TEXTURE_2D_ARRAY,0,0,0,a,l[a].width,l[a].height,1,h.RGBA,h.UNSIGNED_BYTE,this.uploadValue=l[a]);this.kernel.setUniform1i(this.id,this.index)}}i.exports={WebGL2KernelValueHTMLImageArray:v}},{"../../../utils":114,"../../web-gl/kernel-value/array":40}],93:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueHTMLImage:y}=n("../../web-gl/kernel-value/html-image");class v extends y{getSource(){const l=this.getVariablePrecisionString();return d.linesToString([`uniform ${l} sampler2D ${this.id}`,`${l} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${l} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}}i.exports={WebGL2KernelValueHTMLImage:v}},{"../../../utils":114,"../../web-gl/kernel-value/html-image":57}],94:[function(n,i,p){n("../../../utils");const{WebGL2KernelValueHTMLImage:d}=n("./html-image");class y extends d{}i.exports={WebGL2KernelValueHTMLVideo:y}},{"../../../utils":114,"./html-image":93}],95:[function(n,i,p){const{WebGLKernelValueInteger:d}=n("../../web-gl/kernel-value/integer");class y extends d{getSource(m){const l=this.getVariablePrecisionString();return this.origin==="constants"?`const ${l} int ${this.id} = ${parseInt(m)};
`:`uniform ${l} int ${this.id};
`}updateValue(m){this.origin!=="constants"&&this.kernel.setUniform1i(this.id,this.uploadValue=m)}}i.exports={WebGL2KernelValueInteger:y}},{"../../web-gl/kernel-value/integer":60}],96:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueMemoryOptimizedNumberTexture:y}=n("../../web-gl/kernel-value/memory-optimized-number-texture");class v extends y{getSource(){const{id:l,sizeId:h,textureSize:a,dimensionsId:o,dimensions:S}=this,_=this.getVariablePrecisionString();return d.linesToString([`uniform sampler2D ${l}`,`${_} ivec2 ${h} = ivec2(${a[0]}, ${a[1]})`,`${_} ivec3 ${o} = ivec3(${S[0]}, ${S[1]}, ${S[2]})`])}}i.exports={WebGL2KernelValueMemoryOptimizedNumberTexture:v}},{"../../../utils":114,"../../web-gl/kernel-value/memory-optimized-number-texture":61}],97:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueNumberTexture:y}=n("../../web-gl/kernel-value/number-texture");class v extends y{getSource(){const{id:l,sizeId:h,textureSize:a,dimensionsId:o,dimensions:S}=this,_=this.getVariablePrecisionString();return d.linesToString([`uniform ${_} sampler2D ${l}`,`${_} ivec2 ${h} = ivec2(${a[0]}, ${a[1]})`,`${_} ivec3 ${o} = ivec3(${S[0]}, ${S[1]}, ${S[2]})`])}}i.exports={WebGL2KernelValueNumberTexture:v}},{"../../../utils":114,"../../web-gl/kernel-value/number-texture":62}],98:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueSingleArray:y}=n("../../web-gl/kernel-value/single-array");class v extends y{getSource(){const l=this.getVariablePrecisionString();return d.linesToString([`uniform ${l} sampler2D ${this.id}`,`${l} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${l} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(l){if(l.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(l.constructor);return}const{context:h}=this;d.flattenTo(l,this.uploadValue),h.activeTexture(this.contextHandle),h.bindTexture(h.TEXTURE_2D,this.texture),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!1),h.texImage2D(h.TEXTURE_2D,0,h.RGBA32F,this.textureSize[0],this.textureSize[1],0,h.RGBA,h.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}i.exports={WebGL2KernelValueSingleArray:v}},{"../../../utils":114,"../../web-gl/kernel-value/single-array":63}],99:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueSingleArray1DI:y}=n("../../web-gl/kernel-value/single-array1d-i");class v extends y{updateValue(l){if(l.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(l.constructor);return}const{context:h}=this;d.flattenTo(l,this.uploadValue),h.activeTexture(this.contextHandle),h.bindTexture(h.TEXTURE_2D,this.texture),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!1),h.texImage2D(h.TEXTURE_2D,0,h.RGBA32F,this.textureSize[0],this.textureSize[1],0,h.RGBA,h.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}i.exports={WebGL2KernelValueSingleArray1DI:v}},{"../../../utils":114,"../../web-gl/kernel-value/single-array1d-i":64}],100:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueSingleArray2DI:y}=n("../../web-gl/kernel-value/single-array2d-i");class v extends y{updateValue(l){if(l.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(l.constructor);return}const{context:h}=this;d.flattenTo(l,this.uploadValue),h.activeTexture(this.contextHandle),h.bindTexture(h.TEXTURE_2D,this.texture),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!1),h.texImage2D(h.TEXTURE_2D,0,h.RGBA32F,this.textureSize[0],this.textureSize[1],0,h.RGBA,h.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}i.exports={WebGL2KernelValueSingleArray2DI:v}},{"../../../utils":114,"../../web-gl/kernel-value/single-array2d-i":65}],101:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueSingleArray3DI:y}=n("../../web-gl/kernel-value/single-array3d-i");class v extends y{updateValue(l){if(l.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(l.constructor);return}const{context:h}=this;d.flattenTo(l,this.uploadValue),h.activeTexture(this.contextHandle),h.bindTexture(h.TEXTURE_2D,this.texture),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!1),h.texImage2D(h.TEXTURE_2D,0,h.RGBA32F,this.textureSize[0],this.textureSize[1],0,h.RGBA,h.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}i.exports={WebGL2KernelValueSingleArray3DI:v}},{"../../../utils":114,"../../web-gl/kernel-value/single-array3d-i":66}],102:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueSingleInput:y}=n("../../web-gl/kernel-value/single-input");class v extends y{getSource(){const l=this.getVariablePrecisionString();return d.linesToString([`uniform ${l} sampler2D ${this.id}`,`${l} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${l} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(l){const{context:h}=this;d.flattenTo(l.value,this.uploadValue),h.activeTexture(this.contextHandle),h.bindTexture(h.TEXTURE_2D,this.texture),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!1),h.texImage2D(h.TEXTURE_2D,0,h.RGBA32F,this.textureSize[0],this.textureSize[1],0,h.RGBA,h.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}i.exports={WebGL2KernelValueSingleInput:v}},{"../../../utils":114,"../../web-gl/kernel-value/single-input":67}],103:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueUnsignedArray:y}=n("../../web-gl/kernel-value/unsigned-array");class v extends y{getSource(){const l=this.getVariablePrecisionString();return d.linesToString([`uniform ${l} sampler2D ${this.id}`,`${l} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${l} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}}i.exports={WebGL2KernelValueUnsignedArray:v}},{"../../../utils":114,"../../web-gl/kernel-value/unsigned-array":68}],104:[function(n,i,p){const{utils:d}=n("../../../utils"),{WebGLKernelValueUnsignedInput:y}=n("../../web-gl/kernel-value/unsigned-input");class v extends y{getSource(){const l=this.getVariablePrecisionString();return d.linesToString([`uniform ${l} sampler2D ${this.id}`,`${l} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${l} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}}i.exports={WebGL2KernelValueUnsignedInput:v}},{"../../../utils":114,"../../web-gl/kernel-value/unsigned-input":69}],105:[function(n,i,p){const{WebGLKernel:d}=n("../web-gl/kernel"),{WebGL2FunctionNode:y}=n("./function-node"),{FunctionBuilder:v}=n("../function-builder"),{utils:m}=n("../../utils"),{fragmentShader:l}=n("./fragment-shader"),{vertexShader:h}=n("./vertex-shader"),{lookupKernelValueType:a}=n("./kernel-value-maps");let o=null,S=null,_=null,P=null;class I extends d{static get isSupported(){return o!==null||(this.setupFeatureChecks(),o=this.isContextMatch(_)),o}static setupFeatureChecks(){typeof document<"u"?S=document.createElement("canvas"):typeof OffscreenCanvas<"u"&&(S=new OffscreenCanvas(0,0)),S&&(_=S.getContext("webgl2"),!(!_||!_.getExtension)&&(_.getExtension("EXT_color_buffer_float"),_.getExtension("OES_texture_float_linear"),P=this.getFeatures()))}static isContextMatch(T){return typeof WebGL2RenderingContext<"u"?T instanceof WebGL2RenderingContext:!1}static getFeatures(){const T=this.testContext;return Object.freeze({isFloatRead:this.getIsFloatRead(),isIntegerDivisionAccurate:this.getIsIntegerDivisionAccurate(),isSpeedTacticSupported:this.getIsSpeedTacticSupported(),kernelMap:!0,isTextureFloat:!0,isDrawBuffers:!0,channelCount:this.getChannelCount(),maxTextureSize:this.getMaxTextureSize(),lowIntPrecision:T.getShaderPrecisionFormat(T.FRAGMENT_SHADER,T.LOW_INT),lowFloatPrecision:T.getShaderPrecisionFormat(T.FRAGMENT_SHADER,T.LOW_FLOAT),mediumIntPrecision:T.getShaderPrecisionFormat(T.FRAGMENT_SHADER,T.MEDIUM_INT),mediumFloatPrecision:T.getShaderPrecisionFormat(T.FRAGMENT_SHADER,T.MEDIUM_FLOAT),highIntPrecision:T.getShaderPrecisionFormat(T.FRAGMENT_SHADER,T.HIGH_INT),highFloatPrecision:T.getShaderPrecisionFormat(T.FRAGMENT_SHADER,T.HIGH_FLOAT)})}static getIsTextureFloat(){return!0}static getChannelCount(){return _.getParameter(_.MAX_DRAW_BUFFERS)}static getMaxTextureSize(){return _.getParameter(_.MAX_TEXTURE_SIZE)}static lookupKernelValueType(T,L,D,z){return a(T,L,D,z)}static get testCanvas(){return S}static get testContext(){return _}static get features(){return P}static get fragmentShader(){return l}static get vertexShader(){return h}initContext(){const T={alpha:!1,depth:!1,antialias:!1};return this.canvas.getContext("webgl2",T)}initExtensions(){this.extensions={EXT_color_buffer_float:this.context.getExtension("EXT_color_buffer_float"),OES_texture_float_linear:this.context.getExtension("OES_texture_float_linear")}}validateSettings(T){if(!this.validate){this.texSize=m.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output);return}const{features:L}=this.constructor;if(this.precision==="single"&&!L.isFloatRead)throw new Error("Float texture outputs are not supported");if(!this.graphical&&this.precision===null&&(this.precision=L.isFloatRead?"single":"unsigned"),this.fixIntegerDivisionAccuracy===null?this.fixIntegerDivisionAccuracy=!L.isIntegerDivisionAccurate:this.fixIntegerDivisionAccuracy&&L.isIntegerDivisionAccurate&&(this.fixIntegerDivisionAccuracy=!1),this.checkOutput(),!this.output||this.output.length===0){if(T.length!==1)throw new Error("Auto output only supported for kernels with only one input");const D=m.getVariableType(T[0],this.strictIntegers);switch(D){case"Array":this.output=m.getDimensions(D);break;case"NumberTexture":case"MemoryOptimizedNumberTexture":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":this.output=T[0].output;break;default:throw new Error("Auto output not supported for input type: "+D)}}if(this.graphical){if(this.output.length!==2)throw new Error("Output must have 2 dimensions on graphical mode");this.precision==="single"&&(console.warn("Cannot use graphical mode and single precision at the same time"),this.precision="unsigned"),this.texSize=m.clone(this.output);return}else!this.graphical&&this.precision===null&&L.isTextureFloat&&(this.precision="single");this.texSize=m.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output),this.checkTextureSize()}translateSource(){const T=v.fromKernel(this,y,{fixIntegerDivisionAccuracy:this.fixIntegerDivisionAccuracy});this.translatedSource=T.getPrototypeString("kernel"),this.setupReturnTypes(T)}drawBuffers(){this.context.drawBuffers(this.drawBuffersMap)}getTextureFormat(){const{context:T}=this;switch(this.getInternalFormat()){case T.R32F:return T.RED;case T.RG32F:return T.RG;case T.RGBA32F:return T.RGBA;case T.RGBA:return T.RGBA;default:throw new Error("Unknown internal format")}}getInternalFormat(){const{context:T}=this;if(this.precision==="single"){if(this.pipeline)switch(this.returnType){case"Number":case"Float":case"Integer":return this.optimizeFloatMemory?T.RGBA32F:T.R32F;case"Array(2)":return T.RG32F;case"Array(3)":case"Array(4)":return T.RGBA32F;default:throw new Error("Unhandled return type")}return T.RGBA32F}return T.RGBA}_setupOutputTexture(){const T=this.context;if(this.texture){T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_2D,this.texture.texture,0);return}T.bindFramebuffer(T.FRAMEBUFFER,this.framebuffer);const L=T.createTexture(),D=this.texSize;T.activeTexture(T.TEXTURE0+this.constantTextureCount+this.argumentTextureCount),T.bindTexture(T.TEXTURE_2D,L),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,T.REPEAT),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,T.REPEAT),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.NEAREST),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.NEAREST);const z=this.getInternalFormat();this.precision==="single"?T.texStorage2D(T.TEXTURE_2D,1,z,D[0],D[1]):T.texImage2D(T.TEXTURE_2D,0,z,D[0],D[1],0,z,T.UNSIGNED_BYTE,null),T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_2D,L,0),this.texture=new this.TextureConstructor({texture:L,size:D,dimensions:this.threadDim,output:this.output,context:this.context,internalFormat:this.getInternalFormat(),textureFormat:this.getTextureFormat(),kernel:this})}_setupSubOutputTextures(){const T=this.context;if(this.mappedTextures){for(let D=0;D<this.subKernels.length;D++)T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0+D+1,T.TEXTURE_2D,this.mappedTextures[D].texture,0);return}const L=this.texSize;this.drawBuffersMap=[T.COLOR_ATTACHMENT0],this.mappedTextures=[];for(let D=0;D<this.subKernels.length;D++){const z=this.createTexture();this.drawBuffersMap.push(T.COLOR_ATTACHMENT0+D+1),T.activeTexture(T.TEXTURE0+this.constantTextureCount+this.argumentTextureCount+D),T.bindTexture(T.TEXTURE_2D,z),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.NEAREST),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.NEAREST);const re=this.getInternalFormat();this.precision==="single"?T.texStorage2D(T.TEXTURE_2D,1,re,L[0],L[1]):T.texImage2D(T.TEXTURE_2D,0,T.RGBA,L[0],L[1],0,T.RGBA,T.UNSIGNED_BYTE,null),T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0+D+1,T.TEXTURE_2D,z,0),this.mappedTextures.push(new this.TextureConstructor({texture:z,size:L,dimensions:this.threadDim,output:this.output,context:this.context,internalFormat:this.getInternalFormat(),textureFormat:this.getTextureFormat(),kernel:this}))}}_getHeaderString(){return""}_getTextureCoordinate(){const T=this.subKernels,L=this.getVariablePrecisionString(this.texSize,this.tactic);return T===null||T.length<1?`in ${L} vec2 vTexCoord;
`:`out ${L} vec2 vTexCoord;
`}_getMainArgumentsString(T){const L=[],D=this.argumentNames;for(let z=0;z<D.length;z++)L.push(this.kernelArguments[z].getSource(T[z]));return L.join("")}getKernelString(){const T=[this.getKernelResultDeclaration()],L=this.subKernels;if(L!==null)switch(T.push("layout(location = 0) out vec4 data0"),this.returnType){case"Number":case"Float":case"Integer":for(let D=0;D<L.length;D++){const z=L[D];T.push(z.returnType==="Integer"?`int subKernelResult_${z.name} = 0`:`float subKernelResult_${z.name} = 0.0`,`layout(location = ${D+1}) out vec4 data${D+1}`)}break;case"Array(2)":for(let D=0;D<L.length;D++)T.push(`vec2 subKernelResult_${L[D].name}`,`layout(location = ${D+1}) out vec4 data${D+1}`);break;case"Array(3)":for(let D=0;D<L.length;D++)T.push(`vec3 subKernelResult_${L[D].name}`,`layout(location = ${D+1}) out vec4 data${D+1}`);break;case"Array(4)":for(let D=0;D<L.length;D++)T.push(`vec4 subKernelResult_${L[D].name}`,`layout(location = ${D+1}) out vec4 data${D+1}`);break}else T.push("out vec4 data0");return m.linesToString(T)+this.translatedSource}getMainResultGraphical(){return m.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0 = actualColor"])}getMainResultPackedPixels(){switch(this.returnType){case"LiteralInteger":case"Number":case"Integer":case"Float":return this.getMainResultKernelPackedPixels()+this.getMainResultSubKernelPackedPixels();default:throw new Error(`packed output only usable with Numbers, "${this.returnType}" specified`)}}getMainResultKernelPackedPixels(){return m.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()",`  data0 = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(kernelResult)`])}getMainResultSubKernelPackedPixels(){const T=[];if(!this.subKernels)return"";for(let L=0;L<this.subKernels.length;L++)this.subKernels[L].returnType==="Integer"?T.push(`  data${L+1} = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(float(subKernelResult_${this.subKernels[L].name}))`):T.push(`  data${L+1} = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(subKernelResult_${this.subKernels[L].name})`);return m.linesToString(T)}getMainResultKernelMemoryOptimizedFloats(T,L){T.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()",`  data0.${L} = kernelResult`)}getMainResultSubKernelMemoryOptimizedFloats(T,L){if(!this.subKernels)return T;for(let D=0;D<this.subKernels.length;D++){const z=this.subKernels[D];z.returnType==="Integer"?T.push(`  data${D+1}.${L} = float(subKernelResult_${z.name})`):T.push(`  data${D+1}.${L} = subKernelResult_${z.name}`)}}getMainResultKernelNumberTexture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0[0] = kernelResult"]}getMainResultSubKernelNumberTexture(){const T=[];if(!this.subKernels)return T;for(let L=0;L<this.subKernels.length;++L){const D=this.subKernels[L];D.returnType==="Integer"?T.push(`  data${L+1}[0] = float(subKernelResult_${D.name})`):T.push(`  data${L+1}[0] = subKernelResult_${D.name}`)}return T}getMainResultKernelArray2Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0[0] = kernelResult[0]","  data0[1] = kernelResult[1]"]}getMainResultSubKernelArray2Texture(){const T=[];if(!this.subKernels)return T;for(let L=0;L<this.subKernels.length;++L){const D=this.subKernels[L];T.push(`  data${L+1}[0] = subKernelResult_${D.name}[0]`,`  data${L+1}[1] = subKernelResult_${D.name}[1]`)}return T}getMainResultKernelArray3Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0[0] = kernelResult[0]","  data0[1] = kernelResult[1]","  data0[2] = kernelResult[2]"]}getMainResultSubKernelArray3Texture(){const T=[];if(!this.subKernels)return T;for(let L=0;L<this.subKernels.length;++L){const D=this.subKernels[L];T.push(`  data${L+1}[0] = subKernelResult_${D.name}[0]`,`  data${L+1}[1] = subKernelResult_${D.name}[1]`,`  data${L+1}[2] = subKernelResult_${D.name}[2]`)}return T}getMainResultKernelArray4Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0 = kernelResult"]}getMainResultSubKernelArray4Texture(){const T=[];if(!this.subKernels)return T;for(let L=0;L<this.subKernels.length;++L)T.push(`  data${L+1} = subKernelResult_${this.subKernels[L].name}`);return T}destroyExtensions(){this.extensions.EXT_color_buffer_float=null,this.extensions.OES_texture_float_linear=null}toJSON(){const T=super.toJSON();return T.functionNodes=v.fromKernel(this,y).toJSON(),T.settings.threadDim=this.threadDim,T}}i.exports={WebGL2Kernel:I}},{"../../utils":114,"../function-builder":9,"../web-gl/kernel":70,"./fragment-shader":72,"./function-node":73,"./kernel-value-maps":74,"./vertex-shader":106}],106:[function(n,i,p){const d=`#version 300 es
__FLOAT_TACTIC_DECLARATION__;
__INT_TACTIC_DECLARATION__;
__SAMPLER_2D_TACTIC_DECLARATION__;

in vec2 aPos;
in vec2 aTexCoord;

out vec2 vTexCoord;
uniform vec2 ratio;

void main(void) {
  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);
  vTexCoord = aTexCoord;
}`;i.exports={vertexShader:d}},{}],107:[function(n,i,p){const d=n("./index"),y=d.GPU;for(const m in d)d.hasOwnProperty(m)&&m!=="GPU"&&(y[m]=d[m]);typeof window<"u"&&v(window),typeof self<"u"&&v(self);function v(m){m.GPU||Object.defineProperty(m,"GPU",{get(){return y}})}i.exports=d},{"./index":109}],108:[function(n,i,p){const{gpuMock:d}=n("gpu-mock.js"),{utils:y}=n("./utils");n("./backend/kernel");const{CPUKernel:v}=n("./backend/cpu/kernel"),{HeadlessGLKernel:m}=n("./backend/headless-gl/kernel"),{WebGL2Kernel:l}=n("./backend/web-gl2/kernel"),{WebGLKernel:h}=n("./backend/web-gl/kernel"),{kernelRunShortcut:a}=n("./kernel-run-shortcut"),o=[m,l,h],S=["gpu","cpu"],_={headlessgl:m,webgl2:l,webgl:h};let P=!0;class I{static disableValidation(){P=!1}static enableValidation(){P=!0}static get isGPUSupported(){return o.some(L=>L.isSupported)}static get isKernelMapSupported(){return o.some(L=>L.isSupported&&L.features.kernelMap)}static get isOffscreenCanvasSupported(){return typeof Worker<"u"&&typeof OffscreenCanvas<"u"||typeof importScripts<"u"}static get isWebGLSupported(){return h.isSupported}static get isWebGL2Supported(){return l.isSupported}static get isHeadlessGLSupported(){return m.isSupported}static get isCanvasSupported(){return typeof HTMLCanvasElement<"u"}static get isGPUHTMLImageArraySupported(){return l.isSupported}static get isSinglePrecisionSupported(){return o.some(L=>L.isSupported&&L.features.isFloatRead&&L.features.isTextureFloat)}constructor(L){if(L=L||{},this.canvas=L.canvas||null,this.context=L.context||null,this.mode=L.mode,this.Kernel=null,this.kernels=[],this.functions=[],this.nativeFunctions=[],this.injectedNative=null,this.mode!=="dev"){if(this.chooseKernel(),L.functions)for(let D=0;D<L.functions.length;D++)this.addFunction(L.functions[D]);if(L.nativeFunctions)for(const D in L.nativeFunctions){if(!L.nativeFunctions.hasOwnProperty(D))continue;const z=L.nativeFunctions[D],{name:re,source:he}=z;this.addNativeFunction(re,he,z)}}}chooseKernel(){if(this.Kernel)return;let L=null;if(this.context){for(let D=0;D<o.length;D++){const z=o[D];if(z.isContextMatch(this.context)){if(!z.isSupported)throw new Error(`Kernel type ${z.name} not supported`);L=z;break}}if(L===null)throw new Error("unknown Context")}else if(this.mode){if(this.mode in _)(!P||_[this.mode].isSupported)&&(L=_[this.mode]);else if(this.mode==="gpu"){for(let D=0;D<o.length;D++)if(o[D].isSupported){L=o[D];break}}else this.mode==="cpu"&&(L=v);if(!L)throw new Error(`A requested mode of "${this.mode}" and is not supported`)}else{for(let D=0;D<o.length;D++)if(o[D].isSupported){L=o[D];break}L||(L=v)}this.mode||(this.mode=L.mode),this.Kernel=L}createKernel(L,D){if(typeof L>"u")throw new Error("Missing source parameter");if(typeof L!="object"&&!y.isFunction(L)&&typeof L!="string")throw new Error("source parameter not a function");const z=this.kernels;if(this.mode==="dev"){const ee=d(L,k(D));return z.push(ee),ee}L=typeof L=="function"?L.toString():L;const re={},he=k(D)||{};D&&typeof D.argumentTypes=="object"&&(he.argumentTypes=Object.keys(D.argumentTypes).map(ee=>D.argumentTypes[ee]));function $(ee){console.warn("Falling back to CPU");const ue=new v(L,{argumentTypes:fe.argumentTypes,constantTypes:fe.constantTypes,graphical:fe.graphical,loopMaxIterations:fe.loopMaxIterations,constants:fe.constants,dynamicOutput:fe.dynamicOutput,dynamicArgument:fe.dynamicArguments,output:fe.output,precision:fe.precision,pipeline:fe.pipeline,immutable:fe.immutable,optimizeFloatMemory:fe.optimizeFloatMemory,fixIntegerDivisionAccuracy:fe.fixIntegerDivisionAccuracy,functions:fe.functions,nativeFunctions:fe.nativeFunctions,injectedNative:fe.injectedNative,subKernels:fe.subKernels,strictIntegers:fe.strictIntegers,debug:fe.debug});ue.build.apply(ue,ee);const _e=ue.run.apply(ue,ee);return fe.replaceKernel(ue),_e}function w(ee,ue,_e){_e.debug&&console.warn("Switching kernels");let Re=null;if(_e.signature&&!re[_e.signature]&&(re[_e.signature]=_e),_e.dynamicOutput)for(let Rt=ee.length-1;Rt>=0;Rt--){const lt=ee[Rt];lt.type==="outputPrecisionMismatch"&&(Re=lt.needed)}const ft=_e.constructor,it=ft.getArgumentTypes(_e,ue),Pe=ft.getSignature(_e,it),mt=re[Pe];if(mt)return mt.onActivate(_e),mt;const bt=re[Pe]=new ft(L,{argumentTypes:it,constantTypes:_e.constantTypes,graphical:_e.graphical,loopMaxIterations:_e.loopMaxIterations,constants:_e.constants,dynamicOutput:_e.dynamicOutput,dynamicArgument:_e.dynamicArguments,context:_e.context,canvas:_e.canvas,output:Re||_e.output,precision:_e.precision,pipeline:_e.pipeline,immutable:_e.immutable,optimizeFloatMemory:_e.optimizeFloatMemory,fixIntegerDivisionAccuracy:_e.fixIntegerDivisionAccuracy,functions:_e.functions,nativeFunctions:_e.nativeFunctions,injectedNative:_e.injectedNative,subKernels:_e.subKernels,strictIntegers:_e.strictIntegers,debug:_e.debug,gpu:_e.gpu,validate:P,returnType:_e.returnType,tactic:_e.tactic,onRequestFallback:$,onRequestSwitchKernel:w,texture:_e.texture,mappedTextures:_e.mappedTextures,drawBuffersMap:_e.drawBuffersMap});return bt.build.apply(bt,ue),fe.replaceKernel(bt),z.push(bt),bt}const V=Object.assign({context:this.context,canvas:this.canvas,functions:this.functions,nativeFunctions:this.nativeFunctions,injectedNative:this.injectedNative,gpu:this,validate:P,onRequestFallback:$,onRequestSwitchKernel:w},he),K=new this.Kernel(L,V),fe=a(K);return this.canvas||(this.canvas=K.canvas),this.context||(this.context=K.context),z.push(K),fe}createKernelMap(){let L,D;const z=typeof arguments[arguments.length-2];if(z==="function"||z==="string"?(L=arguments[arguments.length-2],D=arguments[arguments.length-1]):L=arguments[arguments.length-1],this.mode!=="dev"&&(!this.Kernel.isSupported||!this.Kernel.features.kernelMap)&&this.mode&&S.indexOf(this.mode)<0)throw new Error(`kernelMap not supported on ${this.Kernel.name}`);const re=k(D);if(D&&typeof D.argumentTypes=="object"&&(re.argumentTypes=Object.keys(D.argumentTypes).map(he=>D.argumentTypes[he])),Array.isArray(arguments[0])){re.subKernels=[];const he=arguments[0];for(let $=0;$<he.length;$++){const w=he[$].toString(),V=y.getFunctionNameFromString(w);re.subKernels.push({name:V,source:w,property:$})}}else{re.subKernels=[];const he=arguments[0];for(let $ in he){if(!he.hasOwnProperty($))continue;const w=he[$].toString(),V=y.getFunctionNameFromString(w);re.subKernels.push({name:V||$,source:w,property:$})}}return this.createKernel(L,re)}combineKernels(){const L=arguments[0],D=arguments[arguments.length-1];if(L.kernel.constructor.mode==="cpu")return D;const z=arguments[0].canvas,re=arguments[0].context,he=arguments.length-1;for(let $=0;$<he;$++)arguments[$].setCanvas(z).setContext(re).setPipeline(!0);return function(){const $=D.apply(this,arguments);return $.toArray?$.toArray():$}}setFunctions(L){return this.functions=L,this}setNativeFunctions(L){return this.nativeFunctions=L,this}addFunction(L,D){return this.functions.push({source:L,settings:D}),this}addNativeFunction(L,D,z){if(this.kernels.length>0)throw new Error('Cannot call "addNativeFunction" after "createKernels" has been called.');return this.nativeFunctions.push(Object.assign({name:L,source:D},z)),this}injectNative(L){return this.injectedNative=L,this}destroy(){return new Promise((L,D)=>{this.kernels||L(),setTimeout(()=>{try{for(let re=0;re<this.kernels.length;re++)this.kernels[re].destroy(!0);let z=this.kernels[0];z&&(z.kernel&&(z=z.kernel),z.constructor.destroyContext&&z.constructor.destroyContext(this.context))}catch(z){D(z)}L()},0)})}}function k(T){if(!T)return{};const L=Object.assign({},T);return T.hasOwnProperty("floatOutput")&&(y.warnDeprecated("setting","floatOutput","precision"),L.precision=T.floatOutput?"single":"unsigned"),T.hasOwnProperty("outputToTexture")&&(y.warnDeprecated("setting","outputToTexture","pipeline"),L.pipeline=!!T.outputToTexture),T.hasOwnProperty("outputImmutable")&&(y.warnDeprecated("setting","outputImmutable","immutable"),L.immutable=!!T.outputImmutable),T.hasOwnProperty("floatTextures")&&(y.warnDeprecated("setting","floatTextures","optimizeFloatMemory"),L.optimizeFloatMemory=!!T.floatTextures),L}i.exports={GPU:I,kernelOrder:o,kernelTypes:S}},{"./backend/cpu/kernel":8,"./backend/headless-gl/kernel":34,"./backend/kernel":36,"./backend/web-gl/kernel":70,"./backend/web-gl2/kernel":105,"./kernel-run-shortcut":111,"./utils":114,"gpu-mock.js":4}],109:[function(n,i,p){const{GPU:d}=n("./gpu"),{alias:y}=n("./alias"),{utils:v}=n("./utils"),{Input:m,input:l}=n("./input"),{Texture:h}=n("./texture"),{FunctionBuilder:a}=n("./backend/function-builder"),{FunctionNode:o}=n("./backend/function-node"),{CPUFunctionNode:S}=n("./backend/cpu/function-node"),{CPUKernel:_}=n("./backend/cpu/kernel"),{HeadlessGLKernel:P}=n("./backend/headless-gl/kernel"),{WebGLFunctionNode:I}=n("./backend/web-gl/function-node"),{WebGLKernel:k}=n("./backend/web-gl/kernel"),{kernelValueMaps:T}=n("./backend/web-gl/kernel-value-maps"),{WebGL2FunctionNode:L}=n("./backend/web-gl2/function-node"),{WebGL2Kernel:D}=n("./backend/web-gl2/kernel"),{kernelValueMaps:z}=n("./backend/web-gl2/kernel-value-maps"),{GLKernel:re}=n("./backend/gl/kernel"),{Kernel:he}=n("./backend/kernel"),{FunctionTracer:$}=n("./backend/function-tracer"),w=n("./plugins/math-random-uniformly-distributed");i.exports={alias:y,CPUFunctionNode:S,CPUKernel:_,GPU:d,FunctionBuilder:a,FunctionNode:o,HeadlessGLKernel:P,Input:m,input:l,Texture:h,utils:v,WebGL2FunctionNode:L,WebGL2Kernel:D,webGL2KernelValueMaps:z,WebGLFunctionNode:I,WebGLKernel:k,webGLKernelValueMaps:T,GLKernel:re,Kernel:he,FunctionTracer:$,plugins:{mathRandom:w}}},{"./alias":5,"./backend/cpu/function-node":6,"./backend/cpu/kernel":8,"./backend/function-builder":9,"./backend/function-node":10,"./backend/function-tracer":11,"./backend/gl/kernel":13,"./backend/headless-gl/kernel":34,"./backend/kernel":36,"./backend/web-gl/function-node":38,"./backend/web-gl/kernel":70,"./backend/web-gl/kernel-value-maps":39,"./backend/web-gl2/function-node":73,"./backend/web-gl2/kernel":105,"./backend/web-gl2/kernel-value-maps":74,"./gpu":108,"./input":110,"./plugins/math-random-uniformly-distributed":112,"./texture":113,"./utils":114}],110:[function(n,i,p){class d{constructor(m,l){this.value=m,Array.isArray(l)?this.size=l:(this.size=new Int32Array(3),l.z?this.size=new Int32Array([l.x,l.y,l.z]):l.y?this.size=new Int32Array([l.x,l.y]):this.size=new Int32Array([l.x]));const[h,a,o]=this.size;if(o){if(this.value.length!==h*a*o)throw new Error(`Input size ${this.value.length} does not match ${h} * ${a} * ${o} = ${a*h*o}`)}else if(a){if(this.value.length!==h*a)throw new Error(`Input size ${this.value.length} does not match ${h} * ${a} = ${a*h}`)}else if(this.value.length!==h)throw new Error(`Input size ${this.value.length} does not match ${h}`)}toArray(){const{utils:m}=n("./utils"),[l,h,a]=this.size;return a?m.erectMemoryOptimized3DFloat(this.value.subarray?this.value:new Float32Array(this.value),l,h,a):h?m.erectMemoryOptimized2DFloat(this.value.subarray?this.value:new Float32Array(this.value),l,h):this.value}}function y(v,m){return new d(v,m)}i.exports={Input:d,input:y}},{"./utils":114}],111:[function(n,i,p){const{utils:d}=n("./utils");function y(m){let l=function(){return m.build.apply(m,arguments),l=function(){let a=m.run.apply(m,arguments);if(m.switchingKernels){const o=m.resetSwitchingKernels(),S=m.onRequestSwitchKernel(o,arguments,m);h.kernel=m=S,a=S.run.apply(S,arguments)}return m.renderKernels?m.renderKernels():m.renderOutput?m.renderOutput():a},l.apply(m,arguments)};const h=function(){return l.apply(m,arguments)};return h.exec=function(){return new Promise((a,o)=>{try{a(l.apply(this,arguments))}catch(S){o(S)}})},h.replaceKernel=function(a){m=a,v(m,h)},v(m,h),h}function v(m,l){if(l.kernel){l.kernel=m;return}const h=d.allPropertiesOf(m);for(let a=0;a<h.length;a++){const o=h[a];o[0]==="_"&&o[1]==="_"||(typeof m[o]=="function"?o.substring(0,3)==="add"||o.substring(0,3)==="set"?l[o]=function(){return l.kernel[o].apply(l.kernel,arguments),l}:l[o]=function(){return l.kernel[o].apply(l.kernel,arguments)}:(l.__defineGetter__(o,()=>l.kernel[o]),l.__defineSetter__(o,S=>{l.kernel[o]=S})))}l.kernel=m}i.exports={kernelRunShortcut:y}},{"./utils":114}],112:[function(n,i,p){const a={name:"math-random-uniformly-distributed",onBeforeRun:o=>{o.setUniform1f("randomSeed1",Math.random()),o.setUniform1f("randomSeed2",Math.random())},functionMatch:"Math.random()",functionReplace:"nrand(vTexCoord)",functionReturnType:"Number",source:`// https://www.shadertoy.com/view/4t2SDh
//note: uniformly distributed, normalized rand, [0,1]
highp float randomSeedShift = 1.0;
highp float slide = 1.0;
uniform highp float randomSeed1;
uniform highp float randomSeed2;

highp float nrand(highp vec2 n) {
  highp float result = fract(sin(dot((n.xy + 1.0) * vec2(randomSeed1 * slide, randomSeed2 * randomSeedShift), vec2(12.9898, 78.233))) * 43758.5453);
  randomSeedShift = result;
  if (randomSeedShift > 0.5) {
    slide += 0.00009; 
  } else {
    slide += 0.0009;
  }
  return result;
}`};i.exports=a},{}],113:[function(n,i,p){class d{constructor(v){const{texture:m,size:l,dimensions:h,output:a,context:o,type:S="NumberTexture",kernel:_,internalFormat:P,textureFormat:I}=v;if(!a)throw new Error('settings property "output" required.');if(!o)throw new Error('settings property "context" required.');if(!m)throw new Error('settings property "texture" required.');if(!_)throw new Error('settings property "kernel" required.');this.texture=m,m._refs?m._refs++:m._refs=1,this.size=l,this.dimensions=h,this.output=a,this.context=o,this.kernel=_,this.type=S,this._deleted=!1,this.internalFormat=P,this.textureFormat=I}toArray(){throw new Error(`Not implemented on ${this.constructor.name}`)}clone(){throw new Error(`Not implemented on ${this.constructor.name}`)}delete(){throw new Error(`Not implemented on ${this.constructor.name}`)}clear(){throw new Error(`Not implemented on ${this.constructor.name}`)}}i.exports={Texture:d}},{}],114:[function(n,i,p){const d=n("acorn"),{Input:y}=n("./input"),{Texture:v}=n("./texture"),m=/function ([^(]*)/,l=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg,h=/([^\s,]+)/g,a={systemEndianness(){return P},getSystemEndianness(){const I=new ArrayBuffer(4),k=new Uint32Array(I),T=new Uint8Array(I);if(k[0]=3735928559,T[0]===239)return"LE";if(T[0]===222)return"BE";throw new Error("unknown endianness")},isFunction(I){return typeof I=="function"},isFunctionString(I){return typeof I=="string"?I.slice(0,8).toLowerCase()==="function":!1},getFunctionNameFromString(I){const k=m.exec(I);return!k||k.length===0?null:k[1].trim()},getFunctionBodyFromString(I){return I.substring(I.indexOf("{")+1,I.lastIndexOf("}"))},getArgumentNamesFromString(I){const k=I.replace(l,"");let T=k.slice(k.indexOf("(")+1,k.indexOf(")")).match(h);return T===null&&(T=[]),T},clone(I){if(I===null||typeof I!="object"||I.hasOwnProperty("isActiveClone"))return I;const k=I.constructor();for(let T in I)Object.prototype.hasOwnProperty.call(I,T)&&(I.isActiveClone=null,k[T]=a.clone(I[T]),delete I.isActiveClone);return k},isArray(I){return!isNaN(I.length)},getVariableType(I,k){if(a.isArray(I))return I.length>0&&I[0].nodeName==="IMG"?"HTMLImageArray":"Array";switch(I.constructor){case Boolean:return"Boolean";case Number:return k&&Number.isInteger(I)?"Integer":"Float";case v:return I.type;case y:return"Input"}if("nodeName"in I)switch(I.nodeName){case"IMG":return"HTMLImage";case"CANVAS":return"HTMLImage";case"VIDEO":return"HTMLVideo"}else{if(I.hasOwnProperty("type"))return I.type;if(typeof OffscreenCanvas<"u"&&I instanceof OffscreenCanvas)return"OffscreenCanvas";if(typeof ImageBitmap<"u"&&I instanceof ImageBitmap)return"ImageBitmap";if(typeof ImageData<"u"&&I instanceof ImageData)return"ImageData"}return"Unknown"},getKernelTextureSize(I,k){let[T,L,D]=k,z=(T||1)*(L||1)*(D||1);return I.optimizeFloatMemory&&I.precision==="single"&&(T=z=Math.ceil(z/4)),L>1&&T*L===z?new Int32Array([T,L]):a.closestSquareDimensions(z)},closestSquareDimensions(I){const k=Math.sqrt(I);let T=Math.ceil(k),L=Math.floor(k);for(;T*L<I;)T--,L=Math.ceil(I/T);return new Int32Array([L,Math.ceil(I/L)])},getMemoryOptimizedFloatTextureSize(I,k){const L=a.roundTo((I[0]||1)*(I[1]||1)*(I[2]||1)*(I[3]||1),4)/k;return a.closestSquareDimensions(L)},getMemoryOptimizedPackedTextureSize(I,k){const[T,L,D]=I,re=a.roundTo((T||1)*(L||1)*(D||1),4)/(4/k);return a.closestSquareDimensions(re)},roundTo(I,k){return Math.floor((I+k-1)/k)*k},getDimensions(I,k){let T;if(a.isArray(I)){const L=[];let D=I;for(;a.isArray(D);)L.push(D.length),D=D[0];T=L.reverse()}else if(I instanceof v)T=I.output;else if(I instanceof y)T=I.size;else throw new Error(`Unknown dimensions of ${I}`);if(k)for(T=Array.from(T);T.length<3;)T.push(1);return new Int32Array(T)},flatten2dArrayTo(I,k){let T=0;for(let L=0;L<I.length;L++)k.set(I[L],T),T+=I[L].length},flatten3dArrayTo(I,k){let T=0;for(let L=0;L<I.length;L++)for(let D=0;D<I[L].length;D++)k.set(I[L][D],T),T+=I[L][D].length},flatten4dArrayTo(I,k){let T=0;for(let L=0;L<I.length;L++)for(let D=0;D<I[L].length;D++)for(let z=0;z<I[L][D].length;z++)k.set(I[L][D][z],T),T+=I[L][D][z].length},flattenTo(I,k){a.isArray(I[0])?a.isArray(I[0][0])?a.isArray(I[0][0][0])?a.flatten4dArrayTo(I,k):a.flatten3dArrayTo(I,k):a.flatten2dArrayTo(I,k):k.set(I)},splitArray(I,k){const T=[];for(let L=0;L<I.length;L+=k)T.push(new I.constructor(I.buffer,L*4+I.byteOffset,k));return T},getAstString(I,k){const T=Array.isArray(I)?I:I.split(/\r?\n/g),L=k.loc.start,D=k.loc.end,z=[];if(L.line===D.line)z.push(T[L.line-1].substring(L.column,D.column));else{z.push(T[L.line-1].slice(L.column));for(let re=L.line;re<D.line;re++)z.push(T[re]);z.push(T[D.line-1].slice(0,D.column))}return z.join(`
`)},allPropertiesOf(I){const k=[];do k.push.apply(k,Object.getOwnPropertyNames(I));while(I=Object.getPrototypeOf(I));return k},linesToString(I){return I.length>0?I.join(`;
`)+`;
`:`
`},warnDeprecated(I,k,T){console.warn(T?`You are using a deprecated ${I} "${k}". It has been replaced with "${T}". Fixing, but please upgrade as it will soon be removed.`:`You are using a deprecated ${I} "${k}". It has been removed. Fixing, but please upgrade as it will soon be removed.`)},flipPixels:(I,k,T)=>{const L=T/2|0,D=k*4,z=new Uint8ClampedArray(k*4),re=I.slice(0);for(let he=0;he<L;++he){const $=he*D,w=(T-he-1)*D;z.set(re.subarray($,$+D)),re.copyWithin($,w,w+D),re.set(z,w)}return re},erectPackedFloat:(I,k)=>I.subarray(0,k),erect2DPackedFloat:(I,k,T)=>{const L=new Array(T);for(let D=0;D<T;D++){const z=D*k,re=z+k;L[D]=I.subarray(z,re)}return L},erect3DPackedFloat:(I,k,T,L)=>{const D=new Array(L);for(let z=0;z<L;z++){const re=new Array(T);for(let he=0;he<T;he++){const $=z*T*k+he*k,w=$+k;re[he]=I.subarray($,w)}D[z]=re}return D},erectMemoryOptimizedFloat:(I,k)=>I.subarray(0,k),erectMemoryOptimized2DFloat:(I,k,T)=>{const L=new Array(T);for(let D=0;D<T;D++){const z=D*k;L[D]=I.subarray(z,z+k)}return L},erectMemoryOptimized3DFloat:(I,k,T,L)=>{const D=new Array(L);for(let z=0;z<L;z++){const re=new Array(T);for(let he=0;he<T;he++){const $=z*T*k+he*k;re[he]=I.subarray($,$+k)}D[z]=re}return D},erectFloat:(I,k)=>{const T=new Float32Array(k);let L=0;for(let D=0;D<k;D++)T[D]=I[L],L+=4;return T},erect2DFloat:(I,k,T)=>{const L=new Array(T);let D=0;for(let z=0;z<T;z++){const re=new Float32Array(k);for(let he=0;he<k;he++)re[he]=I[D],D+=4;L[z]=re}return L},erect3DFloat:(I,k,T,L)=>{const D=new Array(L);let z=0;for(let re=0;re<L;re++){const he=new Array(T);for(let $=0;$<T;$++){const w=new Float32Array(k);for(let V=0;V<k;V++)w[V]=I[z],z+=4;he[$]=w}D[re]=he}return D},erectArray2:(I,k)=>{const T=new Array(k),L=k*4;let D=0;for(let z=0;z<L;z+=4)T[D++]=I.subarray(z,z+2);return T},erect2DArray2:(I,k,T)=>{const L=new Array(T),D=k*4;for(let z=0;z<T;z++){const re=new Array(k),he=z*D;let $=0;for(let w=0;w<D;w+=4)re[$++]=I.subarray(w+he,w+he+2);L[z]=re}return L},erect3DArray2:(I,k,T,L)=>{const D=k*4,z=new Array(L);for(let re=0;re<L;re++){const he=new Array(T);for(let $=0;$<T;$++){const w=new Array(k),V=re*D*T+$*D;let K=0;for(let fe=0;fe<D;fe+=4)w[K++]=I.subarray(fe+V,fe+V+2);he[$]=w}z[re]=he}return z},erectArray3:(I,k)=>{const T=new Array(k),L=k*4;let D=0;for(let z=0;z<L;z+=4)T[D++]=I.subarray(z,z+3);return T},erect2DArray3:(I,k,T)=>{const L=k*4,D=new Array(T);for(let z=0;z<T;z++){const re=new Array(k),he=z*L;let $=0;for(let w=0;w<L;w+=4)re[$++]=I.subarray(w+he,w+he+3);D[z]=re}return D},erect3DArray3:(I,k,T,L)=>{const D=k*4,z=new Array(L);for(let re=0;re<L;re++){const he=new Array(T);for(let $=0;$<T;$++){const w=new Array(k),V=re*D*T+$*D;let K=0;for(let fe=0;fe<D;fe+=4)w[K++]=I.subarray(fe+V,fe+V+3);he[$]=w}z[re]=he}return z},erectArray4:(I,k)=>{const T=new Array(I),L=k*4;let D=0;for(let z=0;z<L;z+=4)T[D++]=I.subarray(z,z+4);return T},erect2DArray4:(I,k,T)=>{const L=k*4,D=new Array(T);for(let z=0;z<T;z++){const re=new Array(k),he=z*L;let $=0;for(let w=0;w<L;w+=4)re[$++]=I.subarray(w+he,w+he+4);D[z]=re}return D},erect3DArray4:(I,k,T,L)=>{const D=k*4,z=new Array(L);for(let re=0;re<L;re++){const he=new Array(T);for(let $=0;$<T;$++){const w=new Array(k),V=re*D*T+$*D;let K=0;for(let fe=0;fe<D;fe+=4)w[K++]=I.subarray(fe+V,fe+V+4);he[$]=w}z[re]=he}return z},flattenFunctionToString:(I,k)=>{const{findDependency:T,thisLookup:L,doNotDefine:D}=k;let z=k.flattened;z||(z=k.flattened={});const re=d.parse(I),he=[];let $=0;function w(K){if(Array.isArray(K)){const fe=[];for(let ee=0;ee<K.length;ee++)fe.push(w(K[ee]));return fe.join("")}switch(K.type){case"Program":return w(K.body)+(K.body[0].type==="VariableDeclaration"?";":"");case"FunctionDeclaration":return`function ${K.id.name}(${K.params.map(w).join(", ")}) ${w(K.body)}`;case"BlockStatement":{const ee=[];$+=2;for(let ue=0;ue<K.body.length;ue++){const _e=w(K.body[ue]);_e&&ee.push(" ".repeat($)+_e,`;
`)}return $-=2,`{
${ee.join("")}}`}case"VariableDeclaration":const fe=a.normalizeDeclarations(K).map(w).filter(ee=>ee!==null);return fe.length<1?"":`${K.kind} ${fe.join(",")}`;case"VariableDeclarator":return K.init.object&&K.init.object.type==="ThisExpression"?L(K.init.property.name,!0)?`${K.id.name} = ${w(K.init)}`:null:`${K.id.name} = ${w(K.init)}`;case"CallExpression":{if(K.callee.property.name==="subarray")return`${w(K.callee.object)}.${w(K.callee.property)}(${K.arguments.map(ee=>w(ee)).join(", ")})`;if(K.callee.object.name==="gl"||K.callee.object.name==="context")return`${w(K.callee.object)}.${w(K.callee.property)}(${K.arguments.map(ee=>w(ee)).join(", ")})`;if(K.callee.object.type==="ThisExpression")return he.push(T("this",K.callee.property.name)),`${K.callee.property.name}(${K.arguments.map(ee=>w(ee)).join(", ")})`;if(K.callee.object.name){const ee=T(K.callee.object.name,K.callee.property.name);return ee===null?`${K.callee.object.name}.${K.callee.property.name}(${K.arguments.map(ue=>w(ue)).join(", ")})`:(he.push(ee),`${K.callee.property.name}(${K.arguments.map(ue=>w(ue)).join(", ")})`)}else{if(K.callee.object.type==="MemberExpression")return`${w(K.callee.object)}.${K.callee.property.name}(${K.arguments.map(ee=>w(ee)).join(", ")})`;throw new Error("unknown ast.callee")}}case"ReturnStatement":return`return ${w(K.argument)}`;case"BinaryExpression":return`(${w(K.left)}${K.operator}${w(K.right)})`;case"UnaryExpression":return K.prefix?`${K.operator} ${w(K.argument)}`:`${w(K.argument)} ${K.operator}`;case"ExpressionStatement":return`${w(K.expression)}`;case"SequenceExpression":return`(${w(K.expressions)})`;case"ArrowFunctionExpression":return`(${K.params.map(w).join(", ")}) => ${w(K.body)}`;case"Literal":return K.raw;case"Identifier":return K.name;case"MemberExpression":return K.object.type==="ThisExpression"?L(K.property.name):K.computed?`${w(K.object)}[${w(K.property)}]`:w(K.object)+"."+w(K.property);case"ThisExpression":return"this";case"NewExpression":return`new ${w(K.callee)}(${K.arguments.map(ee=>w(ee)).join(", ")})`;case"ForStatement":return`for (${w(K.init)};${w(K.test)};${w(K.update)}) ${w(K.body)}`;case"AssignmentExpression":return`${w(K.left)}${K.operator}${w(K.right)}`;case"UpdateExpression":return`${w(K.argument)}${K.operator}`;case"IfStatement":return`if (${w(K.test)}) ${w(K.consequent)}`;case"ThrowStatement":return`throw ${w(K.argument)}`;case"ObjectPattern":return K.properties.map(w).join(", ");case"ArrayPattern":return K.elements.map(w).join(", ");case"DebuggerStatement":return"debugger;";case"ConditionalExpression":return`${w(K.test)}?${w(K.consequent)}:${w(K.alternate)}`;case"Property":if(K.kind==="init")return w(K.key)}throw new Error(`unhandled ast.type of ${K.type}`)}const V=w(re);if(he.length>0){const K=[];for(let fe=0;fe<he.length;fe++){const ee=he[fe];z[ee]||(z[ee]=!0),ee&&K.push(a.flattenFunctionToString(ee,k)+`
`)}return K.join("")+V}return V},normalizeDeclarations:I=>{if(I.type!=="VariableDeclaration")throw new Error('Ast is not of type "VariableDeclaration"');const k=[];for(let T=0;T<I.declarations.length;T++){const L=I.declarations[T];if(L.id&&L.id.type==="ObjectPattern"&&L.id.properties){const{properties:D}=L.id;for(let z=0;z<D.length;z++){const re=D[z];if(re.value.type==="ObjectPattern"&&re.value.properties)for(let he=0;he<re.value.properties.length;he++){const $=re.value.properties[he];if($.type==="Property")k.push({type:"VariableDeclarator",id:{type:"Identifier",name:$.key.name},init:{type:"MemberExpression",object:{type:"MemberExpression",object:L.init,property:{type:"Identifier",name:re.key.name},computed:!1},property:{type:"Identifier",name:$.key.name},computed:!1}});else throw new Error("unexpected state")}else if(re.value.type==="Identifier")k.push({type:"VariableDeclarator",id:{type:"Identifier",name:re.value&&re.value.name?re.value.name:re.key.name},init:{type:"MemberExpression",object:L.init,property:{type:"Identifier",name:re.key.name},computed:!1}});else throw new Error("unexpected state")}}else if(L.id&&L.id.type==="ArrayPattern"&&L.id.elements){const{elements:D}=L.id;for(let z=0;z<D.length;z++){const re=D[z];if(re.type==="Identifier")k.push({type:"VariableDeclarator",id:{type:"Identifier",name:re.name},init:{type:"MemberExpression",object:L.init,property:{type:"Literal",value:z,raw:z.toString(),start:re.start,end:re.end},computed:!0}});else throw new Error("unexpected state")}}else k.push(L)}return k},splitHTMLImageToRGB:(I,k)=>{const T=I.createKernel(function(he){return he[this.thread.y][this.thread.x].r*255},{output:[k.width,k.height],precision:"unsigned",argumentTypes:{a:"HTMLImage"}}),L=I.createKernel(function(he){return he[this.thread.y][this.thread.x].g*255},{output:[k.width,k.height],precision:"unsigned",argumentTypes:{a:"HTMLImage"}}),D=I.createKernel(function(he){return he[this.thread.y][this.thread.x].b*255},{output:[k.width,k.height],precision:"unsigned",argumentTypes:{a:"HTMLImage"}}),z=I.createKernel(function(he){return he[this.thread.y][this.thread.x].a*255},{output:[k.width,k.height],precision:"unsigned",argumentTypes:{a:"HTMLImage"}}),re=[T(k),L(k),D(k),z(k)];return re.rKernel=T,re.gKernel=L,re.bKernel=D,re.aKernel=z,re.gpu=I,re},splitRGBAToCanvases:(I,k,T,L)=>{const D=I.createKernel(function($){const w=$[this.thread.y][this.thread.x];this.color(w.r/255,0,0,255)},{output:[T,L],graphical:!0,argumentTypes:{v:"Array2D(4)"}});D(k);const z=I.createKernel(function($){const w=$[this.thread.y][this.thread.x];this.color(0,w.g/255,0,255)},{output:[T,L],graphical:!0,argumentTypes:{v:"Array2D(4)"}});z(k);const re=I.createKernel(function($){const w=$[this.thread.y][this.thread.x];this.color(0,0,w.b/255,255)},{output:[T,L],graphical:!0,argumentTypes:{v:"Array2D(4)"}});re(k);const he=I.createKernel(function($){const w=$[this.thread.y][this.thread.x];this.color(255,255,255,w.a/255)},{output:[T,L],graphical:!0,argumentTypes:{v:"Array2D(4)"}});return he(k),[D.canvas,z.canvas,re.canvas,he.canvas]},getMinifySafeName:I=>{try{const k=d.parse(`const value = ${I.toString()}`),{init:T}=k.body[0].declarations[0];return T.body.name||T.body.body[0].argument.name}catch{throw new Error("Unrecognized function type.  Please use `() => yourFunctionVariableHere` or function() { return yourFunctionVariableHere; }")}},sanitizeName:function(I){return o.test(I)&&(I=I.replace(o,"S_S")),S.test(I)?I=I.replace(S,"U_U"):_.test(I)&&(I=I.replace(_,"u_u")),I}},o=/\$/,S=/__/,_=/_/,P=a.getSystemEndianness();i.exports={utils:a}},{"./input":110,"./texture":113,acorn:1}]},{},[107])(107)})});const X={toTable(g){const t=g.reduce((n,i)=>Object.assign(n,i),{});return X.toHash(t)},toTable2D(g){const t={};let n=0;for(let i=0;i<g.length;i++){const p=g[i];for(let d=0;d<p.length;d++){const y=p[d];for(const v in y)y.hasOwnProperty(v)&&!t.hasOwnProperty(v)&&(t[v]=n++)}}return t},toInputTable2D(g){const t={};let n=0;for(let i=0;i<g.length;i++){const p=g[i].input;for(let d=0;d<p.length;d++){const y=p[d];for(const v in y)y.hasOwnProperty(v)&&(t.hasOwnProperty(v)||(t[v]=n++))}}return t},toOutputTable2D(g){const t={};let n=0;for(let i=0;i<g.length;i++){const p=g[i].output;for(let d=0;d<p.length;d++){const y=p[d];for(const v in y)y.hasOwnProperty(v)&&(t.hasOwnProperty(v)||(t[v]=n++))}}return t},toHash(g){const t={};let n=0;const i=Object.keys(g);for(let p=0;p<i.length;p++)t[i[p]]=n++;return t},toArray(g,t,n){const i=new Float32Array(n);for(const p in g)g.hasOwnProperty(p)&&(i[g[p]]=t.hasOwnProperty(p)?t[p]:0);return i},toArrayShort(g,t){const n=[];for(const i in g)if(g.hasOwnProperty(i)){if(!t.hasOwnProperty(i))break;n[g[i]]=t[i]}return Float32Array.from(n)},toArrays(g,t,n){const i=[];for(let p=0;p<t.length;p++)i.push(this.toArray(g,t[p],n));return i},toObject(g,t){const n={};for(const i in g)g.hasOwnProperty(i)&&(n[i]=t[g[i]]);return n},toObjectPartial(g,t,n=0,i=0){const p={};let d=0;for(const y in g)g.hasOwnProperty(y)&&(n>0&&d++<n||i>0&&d++>=i||(p[y]=t[g[y]-n]));return p},dataShape(g){const t=[];let n;g.hasOwnProperty("input")?(t.push("datum"),n=g.input):Array.isArray(g)?g[0]&&g[0].input?(t.push("array","datum"),n=g[0].input):Array.isArray(g[0])?(t.push("array"),n=g[0]):n=g:n=g;let i;for(;n;)if(i=Object.keys(n)[0],Array.isArray(n)||typeof n.buffer=="object"){t.push("array");const p=n[parseInt(i)];if(typeof p=="number"){t.push("number");break}else n=p}else if(typeof n=="object"&&typeof n.buffer!="object"){t.push("object");const p=n[i];if(typeof p=="number"){t.push("number");break}else n=p}else throw new Error("unhandled signature");return t},addKeys(g,t){if(Array.isArray(g))return t;let n=Object.keys(t).length;for(const i in g)g.hasOwnProperty(i)&&(t.hasOwnProperty(i)||(t[i]=n++));return t}};var ne=G(function(g,t){var n=J&&J.__assign||function(){return n=Object.assign||function(y){for(var v,m=1,l=arguments.length;m<l;m++){v=arguments[m];for(var h in v)Object.prototype.hasOwnProperty.call(v,h)&&(y[h]=v[h])}return y},n.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.thaw=t.Block=t.Thaw=void 0;var i=function(){function y(v,m){var l=this;m===void 0&&(m={});var h=n(n({},y.defaultSettings),m),a=h.each,o=h.done;this.i=0,this.isStopped=!1,this.items=v,this.options=m,this.tick=function(){if(!l.isStopped&&(l.timeout=setTimeout(l.tick,0),!y.thawing)){var S=l.items[l.i];if(l.i>=l.items.length){o!==null&&(y.thawing=!0,o(),y.thawing=!1),l.isStopped=!0,clearTimeout(l.timeout);return}a!==null?(y.thawing=!0,a(S,l.i),y.thawing=!1):S!==void 0&&S(),l.i++}},y.thaws.push(this),m.delay||this.tick()}return Object.defineProperty(y,"isThawing",{get:function(){return y.thawing},enumerable:!1,configurable:!0}),y.stopAll=function(){for(var v=0;v<y.thaws.length;v++)y.thaws[v].stop()},y.prototype.makeReady=function(){return this.isStopped?(this.isStopped=!1,!0):!1},y.prototype.add=function(v){return this.items.push(v),this.makeReady()&&this.tick(),this},y.prototype.insert=function(v){return this.items.splice(this.i,0,v),this.makeReady()&&this.tick(),this},y.prototype.addArray=function(v){return this.items=this.items.concat(v),this.makeReady()&&this.tick(),this},y.prototype.insertArray=function(v){var m=this.items.splice(0,this.i),l=this.items;return this.items=m.concat(v,l),this.makeReady()&&this.tick(),this},y.prototype.stop=function(){return this.isStopped=!0,clearTimeout(this.timeout),this.options.done&&this.options.done(),this},y.thawing=!1,y.thaws=[],y.defaultSettings={each:null,done:null},y}();t.Thaw=i;function p(y,v){return new i(y,v)}t.thaw=p;var d=function(){function y(v,m){m===void 0&&(m=200),this.index=0,this.thaws=[],this.count=m,this.options=v}return y.prototype.add=function(v){var m=this.next();return m.add(v),this},y.prototype.addArray=function(v){var m=this.next();return m.addArray(v),this},y.prototype.insert=function(v){var m=this.next();return m.insert(v),this},y.prototype.insertArray=function(v){var m=this.next();return m.insertArray(v),this},y.prototype.stop=function(){for(var v=0;v<this.thaws.length;v++)this.thaws[v].stop();return this},y.prototype.next=function(){var v,m=this.thaws;return m.length<this.count?(v=new i([],this.options),m.push(v)):v=m[this.index]||null,this.index++,this.index>=this.count&&(this.index=0),v},y}();t.Block=d,typeof window<"u"&&(window.Thaw=i,window.thaw=p,window.Thaw.Block=d)});function Q(g){const t=[];for(let n=0;n<g.length;n++)t.push(Float32Array.from(g[n]));return t}function te(g,t){const n=[];for(let i=0;i<g.length;i++)n.push(Float32Array.from(g[i]));for(let i=0;i<t.length;i++)n.push(Float32Array.from(t[i]));return n}function se(g){const t=[];for(let n=0;n<g.length;n++)t.push(Float32Array.from([g[n]]));return t}function le(g,t){const n=[];for(let i=0;i<g.length;i++)n.push(Float32Array.from([g[i]]));for(let i=0;i<t.length;i++)n.push(Float32Array.from([t[i]]));return n}function ie(g){return Float32Array.from(g)}function pe(g,t,n,i,p,d){const y=[];for(let v=0;v<g.length;v++){const m=g[v],l=new Float32Array(p);for(const h in m)m.hasOwnProperty(h)&&(l[n[h]]=m[h]);y.push(l)}for(let v=0;v<t.length;v++){const m=t[v],l=new Float32Array(d);for(const h in m)m.hasOwnProperty(h)&&(l[i[h]]=m[h]);y.push(l)}return y}function ve(g){const t=[];for(const n in g)g.hasOwnProperty(n)&&t.push(Float32Array.from([g[n]]));return t}function de(g,t){const n=[];for(const i in g)g.hasOwnProperty(i)&&n.push(Float32Array.from([g[i]]));for(const i in t)t.hasOwnProperty(i)&&n.push(Float32Array.from([t[i]]));return n}function me(g,t,n){const i=new Float32Array(n);for(const p in g)g.hasOwnProperty(p)&&(i[t[p]]=g[p]);return i}class Ee{constructor(t,n){this.prop=null,this.table={},this.length=0;const i=this.table;if(n){this.prop=n;for(let p=0;p<t.length;p++){const y=t[p][n];for(const v in y)y.hasOwnProperty(v)&&(i.hasOwnProperty(v)||(i[v]=this.length++))}}else if(Array.isArray(t)&&Array.isArray(t[0]))for(let p=0;p<t.length;p++){const d=t[p];for(let y=0;y<d.length;y++){const v=d[y];for(const m in v)v.hasOwnProperty(m)&&(i.hasOwnProperty(m)||(i[m]=this.length++))}}else for(let p=0;p<t.length;p++){const d=t[p];for(const y in d)d.hasOwnProperty(y)&&(i.hasOwnProperty(y)||(i[y]=this.length++))}}}function ye(g){return Array.isArray(g)||g instanceof Float32Array?Math.max(...g):Math.max(...Object.values(g))}function Ce(g){let t=0;for(let n=0;n<g.length;n++)t+=g[n]**2;return t/g.length}function oe(){return Math.random()*.4-.2}function ae(g,t){return Math.random()*(t-g)+g}function be(){if(be.returnV)return be.returnV=!1,be.vVal;const g=2*Math.random()-1,t=2*Math.random()-1,n=g*g+t*t;if(n===0||n>1)return be();const i=Math.sqrt(-2*Math.log(n)/n);return be.vVal=t*i,be.returnV=!0,g*i}function Le(g,t){return Math.floor(Math.random()*(t-g)+g)}function Ie(g,t){return g+be()*t}be.returnV=!1,be.vVal=0;var Ae=Object.freeze({__proto__:null,randomFloat:ae,gaussRandom:be,randomInteger:Le,randomN:Ie});function Se(g,t=null){const n=new Float32Array(g);if(t===null)for(let i=0;i<g;i++)n[i]=oe();else for(let i=0;i<g;i++)n[i]=ae(-t,t);return n}function ke(g,t,n){const i=new Array(t);for(let p=0;p<t;p++)i[p]=Se(g,n);return i}function Me(g,t,n,i){const p=new Array(n);for(let d=0;d<n;d++)p[d]=ke(g,t,i);return p}function De(g){return new Float32Array(g)}function Ke(g,t){if(g.buffer instanceof ArrayBuffer)return null;if(Array.isArray(g))return ie;if(!t)throw new Error("table is not Object");const{length:n}=Object.keys(t);return i=>{const p=new Float32Array(n);for(const d in t)t.hasOwnProperty(d)&&typeof i[d]=="number"&&(p[t[d]]=i[d]||0);return p}}function Ve(){return{inputSize:0,outputSize:0,binaryThresh:.5}}function at(){return{activation:"sigmoid",iterations:2e4,errorThresh:.005,log:!1,logPeriod:10,leakyReluAlpha:.01,learningRate:.3,momentum:.1,callbackPeriod:10,timeout:1/0,beta1:.9,beta2:.999,epsilon:1e-8}}class Ze{constructor(t={}){this.options=Ve(),this.trainOpts=at(),this.sizes=[],this.outputLayer=-1,this.biases=[],this.weights=[],this.outputs=[],this.deltas=[],this.changes=[],this.errors=[],this.errorCheckInterval=1,this.inputLookup=null,this.inputLookupLength=0,this.outputLookup=null,this.outputLookupLength=0,this._formatInput=null,this._formatOutput=null,this.runInput=d=>(this.setActivation(),this.runInput(d)),this.calculateDeltas=d=>(this.setActivation(),this.calculateDeltas(d)),this.biasChangesLow=[],this.biasChangesHigh=[],this.changesLow=[],this.changesHigh=[],this.iterations=0,this.options={...this.options,...t},this.updateTrainingOptions(t);const{inputSize:n,hiddenLayers:i,outputSize:p}=this.options;n&&p&&(this.sizes=[n].concat(i??[]).concat([p]))}initialize(){if(!this.sizes.length)throw new Error("Sizes must be set before initializing");this.outputLayer=this.sizes.length-1,this.biases=new Array(this.outputLayer),this.weights=new Array(this.outputLayer),this.outputs=new Array(this.outputLayer),this.deltas=new Array(this.outputLayer),this.changes=new Array(this.outputLayer),this.errors=new Array(this.outputLayer);for(let t=0;t<=this.outputLayer;t++){const n=this.sizes[t];if(this.deltas[t]=De(n),this.errors[t]=De(n),this.outputs[t]=De(n),t>0){this.biases[t]=Se(n),this.weights[t]=new Array(n),this.changes[t]=new Array(n);for(let i=0;i<n;i++){const p=this.sizes[t-1];this.weights[t][i]=Se(p),this.changes[t][i]=De(p)}}}this.setActivation(),this.trainOpts.praxis==="adam"&&this._setupAdam()}setActivation(t){const n=t??this.trainOpts.activation;switch(n){case"sigmoid":this.runInput=this._runInputSigmoid,this.calculateDeltas=this._calculateDeltasSigmoid;break;case"relu":this.runInput=this._runInputRelu,this.calculateDeltas=this._calculateDeltasRelu;break;case"leaky-relu":this.runInput=this._runInputLeakyRelu,this.calculateDeltas=this._calculateDeltasLeakyRelu;break;case"tanh":this.runInput=this._runInputTanh,this.calculateDeltas=this._calculateDeltasTanh;break;default:throw new Error(`Unknown activation ${n}. Available activations are: 'sigmoid', 'relu', 'leaky-relu', 'tanh'`)}}get isRunnable(){return this.sizes.length>0}run(t){if(!this.isRunnable)throw new Error("network not runnable");let n;this.inputLookup?n=X.toArray(this.inputLookup,t,this.inputLookupLength):n=t,this.validateInput(n);const i=this.runInput(n).slice(0);return this.outputLookup?X.toObject(this.outputLookup,i):i}_runInputSigmoid(t){this.outputs[0]=t;let n=null;for(let i=1;i<=this.outputLayer;i++){const p=this.sizes[i],d=this.weights[i],y=this.biases[i],v=this.outputs[i];for(let m=0;m<p;m++){const l=d[m];let h=y[m];for(let a=0;a<l.length;a++)h+=l[a]*t[a];v[m]=1/(1+Math.exp(-h))}n=t=v}if(!n)throw new Error("output was empty");return n}_runInputRelu(t){this.outputs[0]=t;let n=null;for(let i=1;i<=this.outputLayer;i++){const p=this.sizes[i],d=this.weights[i],y=this.biases[i],v=this.outputs[i];for(let m=0;m<p;m++){const l=d[m];let h=y[m];for(let a=0;a<l.length;a++)h+=l[a]*t[a];v[m]=h<0?0:h}n=t=v}if(!n)throw new Error("output was empty");return n}_runInputLeakyRelu(t){this.outputs[0]=t;const{leakyReluAlpha:n}=this.trainOpts;let i=null;for(let p=1;p<=this.outputLayer;p++){const d=this.sizes[p],y=this.weights[p],v=this.biases[p],m=this.outputs[p];for(let l=0;l<d;l++){const h=y[l];let a=v[l];for(let o=0;o<h.length;o++)a+=h[o]*t[o];m[l]=Math.max(a,n*a)}i=t=m}if(!i)throw new Error("output was empty");return i}_runInputTanh(t){this.outputs[0]=t;let n=null;for(let i=1;i<=this.outputLayer;i++){const p=this.sizes[i],d=this.weights[i],y=this.biases[i],v=this.outputs[i];for(let m=0;m<p;m++){const l=d[m];let h=y[m];for(let a=0;a<l.length;a++)h+=l[a]*t[a];v[m]=Math.tanh(h)}n=t=v}if(!n)throw new Error("output was empty");return n}verifyIsInitialized(t){this.sizes.length&&this.outputLayer>0||(this.sizes=[],this.sizes.push(t[0].input.length),this.options.hiddenLayers?this.options.hiddenLayers.forEach(n=>{this.sizes.push(n)}):this.sizes.push(Math.max(3,Math.floor(t[0].input.length/2))),this.sizes.push(t[0].output.length),this.initialize())}updateTrainingOptions(t){const n={...this.trainOpts,...t};this.validateTrainingOptions(n),this.trainOpts=n,this.setLogMethod(this.trainOpts.log)}validateTrainingOptions(t){const n={activation:()=>["sigmoid","relu","leaky-relu","tanh"].includes(t.activation),iterations:()=>{const i=t.iterations;return typeof i=="number"&&i>0},errorThresh:()=>{const i=t.errorThresh;return typeof i=="number"&&i>0&&i<1},log:()=>{const i=t.log;return typeof i=="function"||typeof i=="boolean"},logPeriod:()=>{const i=t.logPeriod;return typeof i=="number"&&i>0},leakyReluAlpha:()=>{const i=t.leakyReluAlpha;return typeof i=="number"&&i>0&&i<1},learningRate:()=>{const i=t.learningRate;return typeof i=="number"&&i>0&&i<1},momentum:()=>{const i=t.momentum;return typeof i=="number"&&i>0&&i<1},callback:()=>{const i=t.callback;return typeof i=="function"||i===void 0},callbackPeriod:()=>{const i=t.callbackPeriod;return typeof i=="number"&&i>0},timeout:()=>{const i=t.timeout;return typeof i=="number"&&i>0},praxis:()=>{const i=t.praxis;return!i||i==="adam"},beta1:()=>{const i=t.beta1;return i>0&&i<1},beta2:()=>{const i=t.beta2;return i>0&&i<1},epsilon:()=>{const i=t.epsilon;return i>0&&i<1}};for(const i in n){const p=t;if(!n[i]())throw new Error(`[${i}, ${p[i]}] is out of normal training range, your network will probably not train.`)}}getTrainOptsJSON(){const{activation:t,iterations:n,errorThresh:i,log:p,logPeriod:d,leakyReluAlpha:y,learningRate:v,momentum:m,callbackPeriod:l,timeout:h,praxis:a,beta1:o,beta2:S,epsilon:_}=this.trainOpts;return{activation:t,iterations:n,errorThresh:i,log:typeof p=="function"?!0:typeof p=="boolean"?p:!1,logPeriod:d,leakyReluAlpha:y,learningRate:v,momentum:m,callbackPeriod:l,timeout:h===1/0?"Infinity":h,praxis:a,beta1:o,beta2:S,epsilon:_}}setLogMethod(t){typeof t=="function"?this.trainOpts.log=t:t?this.trainOpts.log=this.logTrainingStatus:this.trainOpts.log=!1}logTrainingStatus(t){console.log(`iterations: ${t.iterations}, training error: ${t.error}`)}calculateTrainingError(t){let n=0;for(let i=0;i<t.length;++i)n+=this.trainPattern(t[i],!0);return n/t.length}trainPatterns(t){for(let n=0;n<t.length;++n)this.trainPattern(t[n])}trainingTick(t,n,i){const{callback:p,callbackPeriod:d,errorThresh:y,iterations:v,log:m,logPeriod:l}=this.trainOpts;return n.iterations>=v||n.error<=y||Date.now()>=i?!1:(n.iterations++,m&&n.iterations%l===0?(n.error=this.calculateTrainingError(t),m(n)):n.iterations%this.errorCheckInterval===0?n.error=this.calculateTrainingError(t):this.trainPatterns(t),p&&n.iterations%d===0&&p({iterations:n.iterations,error:n.error}),!0)}prepTraining(t,n={}){this.updateTrainingOptions(n);const i=this.formatData(t),p=Date.now()+this.trainOpts.timeout,d={error:1,iterations:0};return this.verifyIsInitialized(i),this.validateData(i),{preparedData:i,status:d,endTime:p}}train(t,n={}){const{preparedData:i,status:p,endTime:d}=this.prepTraining(t,n);for(;this.trainingTick(i,p,d););return p}async trainAsync(t,n={}){const{preparedData:i,status:p,endTime:d}=this.prepTraining(t,n);return await new Promise((y,v)=>{try{const m=new ne.Thaw(new Array(this.trainOpts.iterations),{delay:!0,each:()=>this.trainingTick(i,p,d)||m.stop(),done:()=>y(p)});m.tick()}catch(m){v(m)}})}trainPattern(t,n){return this.runInput(t.input),this.calculateDeltas(t.output),this.adjustWeights(),n?Ce(this.errors[this.outputLayer]):null}_calculateDeltasSigmoid(t){for(let n=this.outputLayer;n>=0;n--){const i=this.sizes[n],p=this.outputs[n],d=this.errors[n],y=this.deltas[n],v=this.weights[n+1];for(let m=0;m<i;m++){const l=p[m];let h=0;if(n===this.outputLayer)h=t[m]-l;else{const a=this.deltas[n+1];for(let o=0;o<a.length;o++)h+=a[o]*v[o][m]}d[m]=h,y[m]=h*l*(1-l)}}}_calculateDeltasRelu(t){for(let n=this.outputLayer;n>=0;n--){const i=this.sizes[n],p=this.outputs[n],d=this.weights[n+1],y=this.deltas[n+1],v=this.errors[n],m=this.deltas[n];for(let l=0;l<i;l++){const h=p[l];let a=0;if(n===this.outputLayer)a=t[l]-h;else for(let o=0;o<y.length;o++)a+=y[o]*d[o][l];v[l]=a,m[l]=h>0?a:0}}}_calculateDeltasLeakyRelu(t){const n=this.trainOpts.leakyReluAlpha;for(let i=this.outputLayer;i>=0;i--){const p=this.sizes[i],d=this.outputs[i],y=this.deltas[i+1],v=this.weights[i+1],m=this.errors[i],l=this.deltas[i];for(let h=0;h<p;h++){const a=d[h];let o=0;if(i===this.outputLayer)o=t[h]-a;else for(let S=0;S<y.length;S++)o+=y[S]*v[S][h];m[h]=o,l[h]=a>0?o:n*o}}}_calculateDeltasTanh(t){for(let n=this.outputLayer;n>=0;n--){const i=this.sizes[n],p=this.outputs[n],d=this.deltas[n+1],y=this.weights[n+1],v=this.errors[n],m=this.deltas[n];for(let l=0;l<i;l++){const h=p[l];let a=0;if(n===this.outputLayer)a=t[l]-h;else for(let o=0;o<d.length;o++)a+=d[o]*y[o][l];v[l]=a,m[l]=(1-h*h)*a}}}adjustWeights(){const{learningRate:t,momentum:n}=this.trainOpts;for(let i=1;i<=this.outputLayer;i++){const p=this.outputs[i-1],d=this.sizes[i],y=this.deltas[i],v=this.changes[i],m=this.weights[i],l=this.biases[i];for(let h=0;h<d;h++){const a=y[h];for(let o=0;o<p.length;o++){let S=v[h][o];S=t*a*p[o]+n*S,v[h][o]=S,m[h][o]+=S}l[h]+=t*a}}}_setupAdam(){this.biasChangesLow=[],this.biasChangesHigh=[],this.changesLow=[],this.changesHigh=[],this.iterations=0;for(let t=0;t<=this.outputLayer;t++){const n=this.sizes[t];if(t>0){this.biasChangesLow[t]=De(n),this.biasChangesHigh[t]=De(n),this.changesLow[t]=new Array(n),this.changesHigh[t]=new Array(n);for(let i=0;i<n;i++){const p=this.sizes[t-1];this.changesLow[t][i]=De(p),this.changesHigh[t][i]=De(p)}}}this.adjustWeights=this._adjustWeightsAdam}_adjustWeightsAdam(){this.iterations++;const{iterations:t}=this,{beta1:n,beta2:i,epsilon:p,learningRate:d}=this.trainOpts;for(let y=1;y<=this.outputLayer;y++){const v=this.outputs[y-1],m=this.sizes[y],l=this.deltas[y],h=this.changesLow[y],a=this.changesHigh[y],o=this.weights[y],S=this.biases[y],_=this.biasChangesLow[y],P=this.biasChangesHigh[y];for(let I=0;I<m;I++){const k=l[I];for(let he=0;he<v.length;he++){const $=k*v[he],w=h[I][he]*n+(1-n)*$,V=a[I][he]*i+(1-i)*$*$,K=w/(1-Math.pow(n,t)),fe=V/(1-Math.pow(i,t));h[I][he]=w,a[I][he]=V,o[I][he]+=d*K/(Math.sqrt(fe)+p)}const T=l[I],L=_[I]*n+(1-n)*T,D=P[I]*i+(1-i)*T*T,z=_[I]/(1-Math.pow(n,t)),re=P[I]/(1-Math.pow(i,t));_[I]=L,P[I]=D,S[I]+=d*z/(Math.sqrt(re)+p)}}}validateData(t){const n=this.sizes[0],i=this.sizes[this.sizes.length-1],{length:p}=t;for(let d=0;d<p;d++){const{input:y,output:v}=t[d];if(y.length!==n)throw new Error(`input at index ${d} length ${y.length} must be ${n}`);if(t[d].output.length!==i)throw new Error(`output at index ${d} length ${v.length} must be ${i}`)}}validateInput(t){const n=this.sizes[0];if(t.length!==n)throw new Error(`input length ${t.length} must match options.inputSize of ${n}`)}formatData(t){if(!Array.isArray(t[0].input))if(this.inputLookup)this.inputLookupLength=Object.keys(this.inputLookup).length;else{const n=new Ee(t,"input");this.inputLookup=n.table,this.inputLookupLength=n.length}if(!Array.isArray(t[0].output))if(this.outputLookup)this.outputLookupLength=Object.keys(this.outputLookup).length;else{const n=new Ee(t,"output");this.outputLookup=n.table,this.outputLookupLength=n.length}if(this._formatInput||(this._formatInput=Ke(t[0].input,this.inputLookup)),this._formatOutput||(this._formatOutput=Ke(t[0].output,this.outputLookup)),this._formatInput&&this._formatOutput){const n=[];for(let i=0;i<t.length;i++)n.push({input:this._formatInput(t[i].input),output:this._formatOutput(t[i].output)});return n}if(this._formatInput){const n=[];for(let i=0;i<t.length;i++)n.push({input:this._formatInput(t[i].input),output:t[i].output});return n}if(this._formatOutput){const n=[];for(let i=0;i<t.length;i++)n.push({input:t[i].input,output:this._formatOutput(t[i].output)});return n}return t}addFormat(t){var n,i;(!Array.isArray(t.input)||typeof t.input[0]!="number")&&(this.inputLookup=X.addKeys(t.input,(n=this.inputLookup)!==null&&n!==void 0?n:{}),this.inputLookup&&(this.inputLookupLength=Object.keys(this.inputLookup).length)),(!Array.isArray(t.output)||typeof t.output[0]!="number")&&(this.outputLookup=X.addKeys(t.output,(i=this.outputLookup)!==null&&i!==void 0?i:{}),this.outputLookup&&(this.outputLookupLength=Object.keys(this.outputLookup).length))}test(t){const{preparedData:n}=this.prepTraining(t),i=n[0].output.length===1,p=[];let d=0;if(i){let y=0,v=0,m=0,l=0;for(let h=0;h<n.length;h++){const a=this.runInput(n[h].input),o=n[h].output,S=a[0]>this.options.binaryThresh?1:0,_=o[0];if(S!==_){const P=n[h];p.push({input:P.input,output:P.output,actual:S,expected:_})}S===0&&_===0?l++:S===1&&_===1?m++:S===0&&_===1?v++:S===1&&_===0&&y++,d+=Ce(a.map((P,I)=>o[I]-P))}return{error:d/n.length,misclasses:p,total:n.length,trueNeg:l,truePos:m,falseNeg:v,falsePos:y,precision:m>0?m/(m+y):0,recall:m>0?m/(m+v):0,accuracy:(l+m)/n.length}}for(let y=0;y<n.length;y++){const v=this.runInput(n[y].input),m=n[y].output,l=v.indexOf(ye(v)),h=m.indexOf(ye(m));if(l!==h){const a=n[y];p.push({input:a.input,output:a.output,actual:l,expected:h})}d+=Ce(v.map((a,o)=>m[o]-a))}return{error:d/n.length,misclasses:p,total:n.length}}toJSON(){var t,n;this.isRunnable||this.initialize();const i=this.weights.map(v=>v.map(m=>Array.from(m))),p=this.biases.map(v=>Array.from(v)),d=[],y=this.sizes.length-1;for(let v=0;v<=y;v++)d.push({weights:(t=i[v])!==null&&t!==void 0?t:[],biases:(n=p[v])!==null&&n!==void 0?n:[]});return{type:"NeuralNetwork",sizes:[...this.sizes],layers:d,inputLookup:this.inputLookup?{...this.inputLookup}:null,inputLookupLength:this.inputLookupLength,outputLookup:this.outputLookup?{...this.outputLookup}:null,outputLookupLength:this.outputLookupLength,options:{...this.options},trainOpts:this.getTrainOptsJSON()}}fromJSON(t){if(this.options={...Ve(),...t.options},t.hasOwnProperty("trainOpts")){const d={...t.trainOpts,timeout:t.trainOpts.timeout==="Infinity"?1/0:t.trainOpts.timeout};this.updateTrainingOptions(d)}this.sizes=t.sizes,this.initialize(),this.inputLookup=t.inputLookup?{...t.inputLookup}:null,this.inputLookupLength=t.inputLookupLength,this.outputLookup=t.outputLookup?{...t.outputLookup}:null,this.outputLookupLength=t.outputLookupLength;const n=t.layers,i=this.weights.map((d,y)=>n[y].weights.map(v=>Float32Array.from(v))),p=this.biases.map((d,y)=>Float32Array.from(n[y].biases));for(let d=0;d<=this.outputLayer;d++)this.weights[d]=i[d]||[],this.biases[d]=p[d]||[];return this}toFunction(t){const{activation:n,leakyReluAlpha:i}=this.trainOpts;let p=!1;const d=(a,o)=>{if(a===0)return`(input[${o}]||0)`;const S=this.weights[a][o],_=this.biases[a][o];if(!S)throw new Error(`weights at layerIndex ${a} & nodeIndex ${o} not found`);if(!_)throw new Error(`bias as layerIndex ${a} & nodeIndex ${o} not found`);const P=[];S.forEach((k,T)=>{k<0?P.push(`${k}*${d(a-1,T)}`):P.push(`+${k}*${d(a-1,T)}`)});const I=`(${_.toString()}${P.join("")})`;switch(n){case"sigmoid":return`1/(1+1/Math.exp(${I}))`;case"relu":return p=!0,`((v=${I})<0?0:v)`;case"leaky-relu":return p=!0,`Math.max((v=${I}),${i}*v)`;case"tanh":return`Math.tanh(${I})`;default:throw new Error(`Unknown activation ${n}. Available activations are: 'sigmoid', 'relu', 'leaky-relu', 'tanh'`)}};function y(a){if(a.find(o=>o.includes('"')))throw new Error(`key contains '"', which is not compatible`)}const v=[];let m,l="";if(this.inputLookup){const a=Object.keys(this.inputLookup);y(a),l=`input = new Float32Array([${Object.keys(this.inputLookup).map(o=>`input["${o}"]`).join(",")}]);`}if(this.sizes.length<1)throw new Error("No layers");for(let a=0;a<this.sizes[this.outputLayer];a++)v.push(d(this.outputLayer,a));if(this.outputLookup){const a=Object.keys(this.outputLookup);y(a),m=`{${a.map((S,_)=>`"${S}":${v[_]}`).join(",")}}`}else m=`[${v.join(",")}]`;const h=`${l}${p?"var v;":""}return ${m};`;return new Function("input",t?t(h):h)}}let Qe=null;function yt(g){Qe=g}function ge(g,t){let n=Qe;return n===null&&(n=new Z.GPU({mode:"gpu"}),yt(n)),n.createKernel(g,t).setPipeline(!0)}function Ge(g,t,n){let i=Qe;return i===null&&(i=new Z.GPU({mode:"gpu"}),yt(i)),i.createKernelMap(g,t,n).setPipeline(!0)}function We(g,t){return new Z.Input(g,t)}function we(g){g instanceof Z.Texture&&g.delete()}function ot(g){if(g instanceof Z.Texture){g.clear();return}if(Array.isArray(g)){if(typeof g[0]=="number")g.fill(0);else if(typeof g[0][0]=="number"){for(let t=0;t<g.length;t++)g[t].fill(0);return}else if(typeof g[0][0][0]=="number"){for(let t=0;t<g.length;t++){const n=g[t];for(let i=0;i<n.length;i++)n[i].fill(0)}return}}if(g instanceof Float32Array){g.fill(0);return}throw new Error("unhandled value")}function et(g){if(g instanceof Z.Texture)return g.clone();if(g instanceof Float32Array)return g.slice(0);if(Array.isArray(g)){if(typeof g[0]=="number")return g.slice(0);if(typeof g[0][0]=="number"){const t=new Array(g.length);for(let n=0;n<g.length;n++)t[n]=g[n].slice(0);return t}else if(typeof g[0][0][0]=="number"){const t=new Array(g.length);for(let n=0;n<g.length;n++){const i=g[n],p=new Array(i.length);for(let d=0;d<i.length;d++)p[d]=i[d].slice(0)}return t}}throw new Error("unhandled value")}function Tt(g,t,n){let i=t[this.thread.x];for(let p=0;p<this.constants.size;p++)i+=g[this.thread.x][p]*n[p];return 1/(1+Math.exp(-i))}function ut(g,t,n){let i=t[this.thread.x];for(let p=0;p<this.constants.size;p++)i+=g[this.thread.x][p]*n[p];return i<0?0:i}function Ut(g,t,n){let i=t[this.thread.x];for(let p=0;p<this.constants.size;p++)i+=g[this.thread.x][p]*n[p];return i<0?0:.01*i}function Ft(g,t,n){let i=t[this.thread.x];for(let p=0;p<this.constants.size;p++)i+=g[this.thread.x][p]*n[p];return Math.tanh(i)}function vt(g,t){return t-g}function on(g,t){return g*t*(1-t)}function ht(g,t){return t>0?g:0}function pn(g,t){return t>0?g:.01*g}function Wt(g,t){return(1-t*t)*g}function wt(g,t,n,i){let p=0;for(let d=0;d<t;d++)p+=i[d]*n[d][g];return p}function Kt(g,t,n,i,p){return g*i*p+t*n}function Et(g,t){return g+t}function kt(g,t){return g[this.thread.x]+t[this.thread.x]*this.constants.learningRate}function dt(g){let t=0;for(let n=0;n<this.constants.size;n++)t+=g[n]**2;return t/this.constants.size}class Be extends Ze{constructor(t={}){super(t),this.texturizeInputData=()=>{throw new Error("not yet setup")},this.forwardPropagate=[],this.backwardPropagate=[],this.changesPropagate=[],this.biasesPropagate=[],this.getMSE=()=>{throw new Error("not yet setup")},this._addMSE=()=>{throw new Error("not yet setup")},this._divideMSESum=()=>{throw new Error("not yet setup")},this.outputs=[],this.deltas=[],this.errors=[],this.weights=[],this.changes=[],this.biases=[],this.runInput=n=>{let i;this.outputs[0]=n;for(let p=1;p<=this.outputLayer;p++)we(this.outputs[p]),this.outputs[p]=this.forwardPropagate[p](this.weights[p],this.biases[p],n),i=n=this.outputs[p];return i},this.calculateDeltas=n=>{for(let i=this.outputLayer;i>0;i--){we(this.deltas[i]),we(this.errors[i]);let p;i===this.outputLayer?p=this.backwardPropagate[i](this.outputs[i],n):p=this.backwardPropagate[i](this.weights[i+1],this.outputs[i],this.deltas[i+1]),this.deltas[i]=p.result,this.errors[i]=p.error}},this.errorCheckInterval=100,this.gpu=new Z.GPU({mode:t.mode})}initialize(){super.initialize(),this.buildRunInput(),this.buildCalculateDeltas(),this.buildGetChanges(),this.buildChangeBiases(),this.buildGetMSE()}setActivation(){}trainPattern(t,n){return this.runInput(t.input),this.calculateDeltas(t.output),this.adjustWeights(),n?this.getMSE(this.errors[this.outputLayer]):null}calculateTrainingError(t){let n=new Float32Array([0]);for(let p=0;p<t.length;++p){const d=n,y=this.trainPattern(t[p],!0);n=this._addMSE(n,y),we(y),we(d)}const i=this._divideMSESum(t.length,n);return we(n),(i instanceof Z.Texture?i.toArray():i)[0]}adjustWeights(){this.getChanges(),this.changeBiases()}buildRunInput(){let t=null;switch(this.trainOpts.activation){case"sigmoid":t=Tt;break;case"relu":t=ut;break;case"leaky-relu":t=Ut;break;case"tanh":t=Ft;break;default:throw new Error(`Unknown activation ${this.trainOpts.activation}. Available activations are: 'sigmoid', 'relu', 'leaky-relu', 'tanh'`)}for(let n=1;n<=this.outputLayer;n++)this.forwardPropagate[n]=this.gpu.createKernel(t,{output:[this.sizes[n]],pipeline:!0,constants:{size:this.sizes[n-1]},immutable:!0});this.texturizeInputData=this.gpu.createKernel(function(n){return n[this.thread.x]},{output:[this.sizes[1]],pipeline:!0,immutable:!0})}buildCalculateDeltas(){let t;switch(this.trainOpts.activation){case"sigmoid":t=on;break;case"relu":t=ht;break;case"leaky-relu":t=pn;break;case"tanh":t=Wt;break;default:throw new Error(`Unknown activation ${this.trainOpts.activation}. Available activations are: 'sigmoid', 'relu', 'leaky-relu', 'tanh'`)}t=Z.alias(Z.utils.getMinifySafeName(()=>t),t),this.gpu.addFunction(t);for(let n=this.outputLayer;n>0;n--)n===this.outputLayer?this.backwardPropagate[this.outputLayer]=this.gpu.createKernelMap({error:vt},function(i,p){const d=i[this.thread.x],y=p[this.thread.x];return t(vt(d,y),d)},{output:[this.sizes[this.outputLayer]],pipeline:!0,immutable:!0}):this.backwardPropagate[n]=this.gpu.createKernelMap({error:wt},function(i,p,d){const y=p[this.thread.x];return t(wt(this.thread.x,this.constants.size,i,d),y)},{output:[this.sizes[n]],pipeline:!0,constants:{size:this.sizes[n+1]},immutable:!0})}buildGetChanges(){for(let t=1;t<=this.outputLayer;t++)this.changesPropagate[t]=this.gpu.createKernelMap({weights:Et,changes:Kt},function(n,i,p,d){const y=Kt(this.constants.learningRate,this.constants.momentum,d[this.thread.y][this.thread.x],i[this.thread.y],n[this.thread.x]);return Et(y,p[this.thread.y][this.thread.x])},{output:[this.sizes[t-1],this.sizes[t]],pipeline:!0,constants:{size:this.sizes[t-1],learningRate:this.trainOpts.learningRate,momentum:this.trainOpts.momentum},immutable:!0})}getChanges(){for(let t=1;t<=this.outputLayer;t++){const n=this.weights[t],i=this.changes[t],p=this.changesPropagate[t](this.outputs[t-1],this.deltas[t],n,i);we(n),we(i),this.weights[t]=p.weights,this.changes[t]=p.changes,we(p.result)}}buildChangeBiases(){for(let t=1;t<=this.outputLayer;t++)this.biasesPropagate[t]=this.gpu.createKernel(kt,{output:[this.sizes[t]],pipeline:!0,constants:{learningRate:this.trainOpts.learningRate},immutable:!0})}changeBiases(){for(let t=1;t<=this.outputLayer;t++){const n=this.biases[t];this.biases[t]=this.biasesPropagate[t](n,this.deltas[t]),we(n)}}buildGetMSE(){this.getMSE=this.gpu.createKernel(dt,{output:[1],constants:{size:this.sizes[this.outputLayer]},pipeline:!0,immutable:!0}),this._addMSE=this.gpu.createKernel(function(t,n){return t[0]+n[0]},{output:[1],pipeline:!0,immutable:!0}),this._divideMSESum=this.gpu.createKernel(function(t,n){const i=n[0];return i>0?i/t:0},{output:[1]})}run(t){if(!this.isRunnable)throw new Error("network not runnable");let n;this.inputLookup?n=X.toArray(this.inputLookup,t,this.inputLookupLength):n=t,this.validateInput(n);const i=this.runInput(n),p=i instanceof Z.Texture?i.toArray():i;return this.outputLookup?X.toObject(this.outputLookup,p):p}prepTraining(t,n={}){this.updateTrainingOptions(n);const i=this.formatData(t),p=Date.now()+this.trainOpts.timeout,d={error:1,iterations:0};this.verifyIsInitialized(i);const y=this.gpu.createKernel(function(v){return v[this.thread.x]},{output:[i[0].output.length],pipeline:!0,immutable:!0});return{preparedData:i.map(v=>({input:this.texturizeInputData(v.input),output:y(v.output)})),status:d,endTime:p}}toFunction(){throw new Error(`${this.constructor.name}-toFunction is not yet implemented`)}toJSON(){var t,n;this.sizes===null&&this.initialize();const i=this.weights.map(y=>(y instanceof Z.Texture?y.toArray():y).map(v=>Array.from(v))),p=this.biases.map(y=>Array.from(y instanceof Z.Texture?y.toArray():y)),d=[];for(let y=0;y<=this.outputLayer;y++)d.push({weights:(t=i[y])!==null&&t!==void 0?t:[],biases:(n=p[y])!==null&&n!==void 0?n:[]});return{type:"NeuralNetworkGPU",sizes:[...this.sizes],layers:d,inputLookup:this.inputLookup?{...this.inputLookup}:null,inputLookupLength:this.inputLookupLength,outputLookup:this.outputLookup?{...this.outputLookup}:null,outputLookupLength:this.outputLookupLength,options:{...this.options},trainOpts:this.getTrainOptsJSON()}}}class Ct extends Error{constructor(t){super(`Cannot run a ${t.constructor.name} before it is trained.`)}}class Ne{constructor(t){t??(t={}),t.binaryThresh,t.hiddenLayers,t.decodedSize&&t.decodedSize,this.denoiser=new Be(t)}denoise(t){return this.denoiser.run(t)}decode(t){if(!this.decoder)throw new Ct(this);return this.decoder.run(t)}encode(t){if(!this.denoiser)throw new Ct(this);this.denoiser.run(t);let n=this.encodedLayer;return n instanceof Z.Texture?n=n.toArray():n=n.slice(0),n}likelyIncludesAnomalies(t,n=.2){var i;const p=[],d=this.denoise(t);for(let m=0;m<((i=t.length)!==null&&i!==void 0?i:0);m++)p[m]=Math.abs(t[m]-d[m]);return p.reduce((m,l)=>m+l)/t.length>n}train(t,n){const i=[];for(const d of t)i.push({input:d,output:d});const p=this.denoiser.train(i,n);return this.decoder=this.createDecoder(),p}createDecoder(){const t=this.denoiser.toJSON(),n=[],i=[];for(let d=this.encodedLayerIndex;d<this.denoiser.sizes.length;d++)n.push(t.layers[d]),i.push(t.sizes[d]);return t.layers=n,t.sizes=i,t.options.inputSize=t.sizes[0],new Be().fromJSON(t)}get encodedLayer(){return this.denoiser.outputs[this.encodedLayerIndex]}get encodedLayerIndex(){return Math.round(this.denoiser.outputs.length*.5)-1}}class He{constructor(t){this.json={avgs:{error:0,iterations:0,testTime:0,trainTime:0},stats:{total:0,testSize:0,trainSize:0},sets:[]},this.initClassifier=t}testPartition(t,n,i){const p=this.initClassifier(),d=Date.now(),y=p.train(n,t),v=Date.now(),m=p.test(i),l=Date.now();return{...m,trainTime:v-d,testTime:l-v,iterations:y.iterations,error:y.error,total:m.total,network:p.toJSON()}}shuffleArray(t){for(let n=t.length-1;n>0;n--){const i=Math.floor(Math.random()*(n+1)),p=t[n];t[n]=t[i],t[i]=p}return t}train(t,n={},i=4){if(t.length<i)throw new Error(`Training set size is too small for ${t.length} k folds of ${i}`);this.shuffleArray(t);const p=t.length/i,d={trainTime:0,testTime:0,iterations:0,error:0},y={total:0,testSize:0,trainSize:0},v={total:0,testSize:0,trainSize:0,truePos:0,trueNeg:0,falsePos:0,falseNeg:0,precision:0,recall:0,accuracy:0},m=[];let l=null;for(let h=0;h<i;h++){const a=t.slice(0),o=a.splice(h*p,p),S=a,_=this.testPartition(n,S,o);l===null&&(l=_.hasOwnProperty("falseNeg")&&_.hasOwnProperty("falsePos")&&_.hasOwnProperty("trueNeg")&&_.hasOwnProperty("truePos"),l&&Object.assign(y,v)),d.iterations+=_.iterations,d.testTime+=_.testTime,d.trainTime+=_.trainTime,d.error+=_.error,y.total+=_.total,He.isBinaryStats(y)&&He.isBinaryPartitionResults(_)&&(y.accuracy+=_.accuracy,y.falseNeg+=_.falseNeg,y.falsePos+=_.falsePos,y.precision+=_.precision,y.recall+=_.recall,y.trueNeg+=_.trueNeg,y.truePos+=_.truePos),m.push(_)}return d.error/=i,d.iterations/=i,d.testTime/=i,d.trainTime/=i,He.isBinaryStats(y)&&(y.precision=y.truePos/(y.truePos+y.falsePos),y.recall=y.truePos/(y.truePos+y.falseNeg),y.accuracy=(y.trueNeg+y.truePos)/y.total),y.testSize=p,y.trainSize=t.length-p,this.json={avgs:d,stats:y,sets:m},this.json}toNeuralNetwork(){return this.fromJSON(this.json)}toJSON(){return this.json}fromJSON(t){const n=t.sets.reduce((i,p)=>i.error<p.error?i:p);return this.initClassifier().fromJSON(n.network)}}He.isBinaryStats=g=>g.accuracy!==void 0,He.isBinaryResults=g=>g.stats.accuracy!==void 0,He.isBinaryPartitionResults=g=>g.accuracy!==void 0;function qt(g){let t=0;for(let n=0;n<this.constants.height;n++)for(let i=0;i<this.constants.width;i++)t+=g[n][i]**2;return t/this.constants.length}class Pn{constructor({width:t,height:n}){this.calculate=ge(qt,{output:[1],constants:{width:t,height:n,length:t*n},immutable:!0}),this.addAbsolute=ge(function(i,p){return i[0]+Math.abs(p[0][0])},{output:[1],immutable:!0}),this.add=ge(function(i,p){return i[0]+p[0]},{output:[1],immutable:!0}),this.divide=ge(function(i,p){const d=p[0];return d>0?d/i:0},{output:[1],immutable:!0})}}const An={width:1,height:1,depth:null,weights:null,deltas:null,praxis:null,praxisOpts:null,cleanupDeltas:!0};class Xt{constructor(t){this.praxis=null,this.predictKernel=null,this.compareKernel=null,t?this.settings={...An,...t}:this.settings={...An},this.setupPraxis()}get width(){var t;return(t=this.settings.width)!==null&&t!==void 0?t:0}get height(){var t;return(t=this.settings.height)!==null&&t!==void 0?t:0}get depth(){var t;return(t=this.settings.depth)!==null&&t!==void 0?t:0}get weights(){return this.settings.weights}set weights(t){this.settings.weights=t,this.settings.cleanupDeltas&&this.deltas&&ot(this.deltas)}get deltas(){return this.settings.deltas}set deltas(t){this.settings.deltas=t}get id(){var t;return(t=this.settings.id)!==null&&t!==void 0?t:""}set id(t){this.settings.id=t}setupPraxis(){const{initPraxis:t,praxis:n,praxisOpts:i}=this.settings;this.praxis||(t?i?this.praxis=t(this,i):this.praxis=t(this):n&&(this.praxis=n))}validate(){if(Number.isNaN(this.height))throw new Error(`${this.constructor.name} layer height is not a number`);if(Number.isNaN(this.width))throw new Error(`${this.constructor.name} layer width is not a number`);if(this.height<1)throw new Error(`${this.constructor.name} layer height is less than 1`);if(this.width<1)throw new Error(`${this.constructor.name} layer width is less than 1`)}setupKernels(t){}reuseKernels(t){if(t.width!==this.width)throw new Error(`${this.constructor.name} kernel width mismatch ${t.width} is not ${this.width}`);if(t.height!==this.height)throw new Error(`${this.constructor.name} kernel width mismatch ${t.height} is not ${this.height}`);if(t.hasOwnProperty("predictKernel")&&t.predictKernel!==null){if(!t.predictKernel.immutable)throw new Error(`${t.constructor.name}.predictKernel is not reusable, set kernel.immutable = true`);this.predictKernel=t.predictKernel}if(t.hasOwnProperty("compareKernel")&&t.compareKernel!==null){if(!t.compareKernel.immutable)throw new Error(`${t.constructor.name}.compareKernel is not reusable, set kernel.immutable = true`);this.compareKernel=t.compareKernel}this.praxis=t.praxis}predict(t){}compare(t){}learn(t){}toArray(){return Array.isArray(this.weights)?this.weights:this.weights.toArray()}toJSON(){return Xt.toJSON(this)}static toJSON(t){const{weights:n}=t;return{width:t.width,height:t.height,depth:t.depth,weights:sr(n&&n instanceof Z.Texture?n.toArray():n),type:t.constructor.name,praxisOpts:t.praxis?t.praxis.toJSON():null}}}function sr(g){if(g===null)return null;if(Array.isArray(g)){if(typeof g[0]=="number")return g;if(Array.isArray(g[0])&&typeof g[0][0]=="number")return g;if(Array.isArray(g[0][0])&&typeof g[0][0][0]=="number")return g;if(g[0]instanceof Float32Array)return g.map(n=>Array.from(n));if(g[0][0]instanceof Float32Array)return g.map(n=>n.map(i=>Array.from(i)))}else if(g)return Array.from(g);throw new Error("unexpected value")}function Bt(g,t){const n=new Array(t);for(let i=0;i<t;i++)n[i]=De(g);return n}function en(g,t,n){const i=new Array(n);for(let p=0;p<n;p++)i[p]=Bt(g,t);return i}class zt extends Xt{constructor(t,n){super(n),this.inputLayer=t;const{width:i,height:p,depth:d}=this;this.predictKernel=null,this.compareKernel=null,this.validate(),d>0?(this.weights=en(i,p,d),this.deltas=en(i,p,d)):p>0&&(this.weights=Bt(i,p),this.deltas=Bt(i,p)),this.setupPraxis()}get width(){return this.inputLayer.width}get height(){return this.inputLayer.height}get depth(){return this.inputLayer.depth}}class Vt extends Xt{constructor(t,n){super(),this.settings=t,this.inputLayer=n}get width(){return this.inputLayer.width}get height(){return this.inputLayer.height}get depth(){return this.inputLayer.depth}get filterCount(){return this.settings.filterCount}get filterWidth(){return this.settings.filterWidth}get filterHeight(){return this.settings.filterHeight}get filters(){return this.settings.filters}set filters(t){this.settings.filters=t}get filterDeltas(){return this.settings.filterDeltas}set filterDeltas(t){this.settings.filterDeltas=t}}class nt{constructor(){this.predictKernel=null,this.compareKernel=null,this.praxis=null}get width(){return this.settings.width}get height(){return this.settings.height}get depth(){return this.settings.depth}get weights(){return this.settings.weights}set weights(t){this.settings.weights=t}get deltas(){return this.settings.deltas}set deltas(t){this.settings.deltas=t}toJSON(){return Xt.toJSON(this)}}class rt extends Xt{constructor(t,n){super({...n,width:t.width,height:t.height,depth:t.depth}),this.inputLayer=t}validate(){var t;if(super.validate(),this.width!==this.inputLayer.width)throw new Error(`width of ${this.width} does not match inputLayer.width of ${this.inputLayer.width}`);if(this.height!==this.inputLayer.height)throw new Error(`height of ${this.height} does not match inputLayer.height of ${this.inputLayer.height}`);if(this.depth!==((t=this.inputLayer.depth)!==null&&t!==void 0?t:0))throw new Error(`depth of ${this.depth} does not match inputLayer.depth of ${this.inputLayer.depth}`)}}class Xe extends Xt{constructor(t,n,i){super(i),this.inputLayer1=t,this.inputLayer2=n,this.validate(),this.weights=Bt(this.width,this.height),this.deltas=Bt(this.width,this.height),this.setupPraxis()}}function Lt(g,t){return g[this.thread.y][this.thread.x]-t[this.thread.x]}function Yt(g,t){return g[this.thread.y][this.thread.x]-t[this.thread.y][this.thread.x]}class cn extends Xt{constructor(t,n){if(super(t),this.inputLayer=n,this.validate(),this.depth)throw new Error("Target layer not implemented for depth");this.height?(this.weights=Bt(this.width,this.height),this.deltas=Bt(this.width,this.height),this.errors=Bt(this.width,this.height)):(this.weights=De(this.width),this.deltas=De(this.width),this.errors=De(this.width))}setupKernels(){this.width===1?this.compareKernel=ge(Lt,{output:[this.width,this.height],immutable:!0}):this.compareKernel=ge(Yt,{output:[this.width,this.height],immutable:!0})}predict(){we(this.weights),this.weights=et(this.inputLayer.weights)}compare(t){we(this.deltas),we(this.errors),we(this.inputLayer.deltas),this.deltas=this.compareKernel(this.weights,t),this.inputLayer.deltas=et(this.deltas),this.errors=et(this.deltas)}setupPraxis(){}}function $n(g,t){return new cn(g,t)}class Bn{}class Wn extends Xt{}class yn extends Xt{learn(t){const{weights:n}=this;if(!this.praxis)throw new Error("this.praxis not defined");this.weights=this.praxis.run(this,t),we(n)}}class xn{constructor(t,n={}){this.layerTemplate=t,this.settings={...n},this.kernel=null}get width(){return this.layerTemplate.width}get height(){return this.layerTemplate.height}get depth(){return this.layerTemplate.depth}setupKernels(){}reuseKernels(t){if(t.width!==this.width)throw new Error(`${this.constructor.name} kernel width mismatch ${t.width} is not ${this.width}`);if(t.height!==this.height)throw new Error(`${this.constructor.name} kernel width mismatch ${t.height} is not ${this.height}`);t.hasOwnProperty("kernel")&&(this.kernel=t.kernel)}toJSON(){return{...this.settings}}}function Lr(g,t){return g[this.thread.y][this.thread.x]+this.constants.learningRate*t[this.thread.y][this.thread.x]}const ar={learningRate:.3};class wn extends xn{constructor(t,n){super(t),this.settings={...ar,...n},this.kernel=null}run(t){return this.kernel(t.weights,t.deltas)}setupKernels(){var t;this.kernel=ge(Lr,{output:[this.width,this.height],constants:{learningRate:(t=this.settings.learningRate)!==null&&t!==void 0?t:.01}})}}function Hn(g,t){return new wn(g,t)}function mr(g){return g}function Xn(g,t,n,i){const p=g[this.thread.y][this.thread.x],d=i[this.thread.y][0],y=t[this.thread.y][this.thread.x],v=n[this.thread.x][0],m=this.constants.learningRate*d*v+this.constants.momentum*p;return y+m}const zn={learningRate:.3,momentum:.1,weightsLayer:null,incomingLayer:null,deltaLayer:null};class Rn extends xn{constructor(t,n){super(t),this.kernelMap=null,this.settings={...zn,...n},this.changes=Bt(t.width,t.height)}get learningRate(){return this.settings.learningRate}get momentum(){return this.settings.momentum}get weightsLayer(){return this.settings.weightsLayer}set weightsLayer(t){this.settings.weightsLayer=t}get deltaLayer(){return this.settings.deltaLayer}set deltaLayer(t){this.settings.deltaLayer=t}get incomingLayer(){return this.settings.incomingLayer}set incomingLayer(t){this.settings.incomingLayer=t}run(){const t=this.kernelMap(this.changes,this.weightsLayer.weights,this.incomingLayer.weights,this.deltaLayer.deltas);return this.changes=t.changes,t.result}setupKernels(){this.kernelMap=Ge({changes:mr},Xn,{output:[this.width,this.height],constants:{learningRate:this.learningRate,momentum:this.momentum}})}}function _n(g,t){return new Rn(g,t)}function Qn(g,t,n){return n*t+(1-t)*g*g}function fn(g,t,n){return g>t?t:g<n?n:g}function Yn(g,t,n){const i=t[this.thread.y][this.thread.x],p=fn(i,this.constants.clipValue,-this.constants.clipValue),d=g[this.thread.y][this.thread.x],y=n[this.thread.y][this.thread.x],v=Qn(i,this.constants.decayRate,y);return d+-this.constants.learningRate*p/Math.sqrt(v+this.constants.smoothEps)-this.constants.regularizationStrength*d}const Pt={decayRate:.999,regularizationStrength:1e-6,learningRate:.01,smoothEps:1e-8,clipValue:5};class Je extends xn{constructor(t,n={}){super(t),this.kernelMap=null,this.settings={...Pt,...n},this.momenta=Bt(t.width,t.height)}get clipValue(){return this.settings.clipValue}get decayRate(){return this.settings.decayRate}get learningRate(){return this.settings.learningRate}get regularizationStrength(){return this.settings.regularizationStrength}get smoothEps(){return this.settings.smoothEps}run(t){const{momenta:n,result:i}=this.kernelMap(t.weights,t.deltas,this.momenta);return we(this.momenta),this.momenta=n,i}setupKernels(){this.kernelMap=Ge({momenta:Qn},Yn,{output:[this.width,this.height],constants:{clipValue:this.clipValue,decayRate:this.decayRate,learningRate:this.learningRate,regularizationStrength:this.regularizationStrength,smoothEps:this.smoothEps},functions:[fn],immutable:!0})}}function $t(g,t){return new Je(g,t)}var bn=Object.freeze({__proto__:null,ArthurDeviationBiases:wn,arthurDeviationBiases:Hn,ArthurDeviationWeights:Rn,arthurDeviationWeights:_n,MomentumRootMeanSquaredPropagation:Je,momentumRootMeanSquaredPropagation:$t,MRmsProp:Je,mRmsProp:$t});function Dn(g,t){g.hasOwnProperty("inputLayer")?Dn(g.inputLayer,t):(g.hasOwnProperty("inputLayer1")&&Dn(g.inputLayer1,t),g.hasOwnProperty("inputLayer2")&&Dn(g.inputLayer2,t)),t(g)}function sn(g){const t=g.slice(0);for(let n=0;n<t.length;n++){let i=0;Dn(t[n],p=>{t.includes(p)||(t.splice(n+i,0,p),i++)})}return t}function In(g,t){if(g.width!==t.width)throw new Error(`Layer width mismatch of ${g.width} and ${t.width}`);if(g.height!==t.height)throw new Error(`Layer height mismatch of ${g.height} and ${t.height}`)}function Nn(g,t){return g[this.thread.y][this.thread.x]+t[this.thread.y][this.thread.x]}class Jn extends Xe{get width(){return this.inputLayer1.width}get height(){return this.inputLayer1.height}get depth(){return this.inputLayer1.depth}validate(){super.validate(),In(this.inputLayer1,this.inputLayer2)}setupKernels(){this.predictKernel=ge(Nn,{output:[this.width,this.height],immutable:!0})}predict(){we(this.weights),this.weights=this.predictKernel(this.inputLayer1.weights,this.inputLayer2.weights)}compare(){we(this.inputLayer1.deltas),we(this.inputLayer2.deltas),this.inputLayer1.deltas=et(this.deltas),this.inputLayer2.deltas=et(this.deltas)}}function Gt(g,t,n){return new Jn(g,t,n)}const er={...An,std:null};class Mn extends yn{constructor(t){super(),this.settings={...er,...t},this.setupPraxis(),this.validate(),this.weights||(this.weights=ke(this.width,this.height,t.std)),this.deltas||(this.deltas=Bt(this.width,this.height))}predict(){}compare(){}}function jt(g){return new Mn(g)}function or(g,t){let n=0;for(let i=0;i<this.constants.size;i++)n+=g[this.thread.y][i]*t[i][this.thread.x];return n}function ur(g,t,n){let i=t[this.thread.y][this.thread.x];for(let p=0;p<this.constants.size;p++)i+=g[this.thread.y][p]*n[this.thread.x][p];return i}function Or(g,t,n){let i=t[this.thread.y][this.thread.x];for(let p=0;p<this.constants.size;p++)i+=g[p][this.thread.x]*n[p][this.thread.y];return i}class tn extends Xe{constructor(){super(...arguments),this.compareKernel1=null,this.compareKernel2=null}get width(){return this.inputLayer2.width}set width(t){throw new Error("Cannot set width on Multiply")}get height(){return this.inputLayer1.height}set height(t){throw new Error("Cannot set height on Multiply")}get depth(){return this.inputLayer1.depth}set depth(t){throw new Error("Cannot set depth on Multiply")}validate(){if(super.validate(),this.inputLayer1.width!==this.inputLayer2.height)throw new Error(`Layer width mismatch of ${this.inputLayer1.width} and ${this.inputLayer2.height}`)}setupKernels(){this.predictKernel=ge(or,{output:[this.width,this.height],constants:{size:this.inputLayer2.height},immutable:!0}),this.compareKernel1=ge(ur,{output:[this.inputLayer1.width,this.inputLayer1.height],constants:{size:this.inputLayer2.width},immutable:!0}),this.compareKernel2=ge(Or,{output:[this.inputLayer2.width,this.inputLayer2.height],constants:{size:this.inputLayer1.height},immutable:!0})}reuseKernels(t){super.reuseKernels(t),this.compareKernel1=t.compareKernel1,this.compareKernel2=t.compareKernel2}predict(){if(we(this.weights),!this.predictKernel)throw new Error("this.predictKernel is not set");this.weights=this.predictKernel(this.inputLayer1.weights,this.inputLayer2.weights)}compare(){if(!this.compareKernel1)throw new Error("this.compareKernel1 not set");if(!this.compareKernel2)throw new Error("this.compareKernel2 not set");const t=this.inputLayer1.deltas,n=this.inputLayer2.deltas,i=this.compareKernel1(this.deltas,this.inputLayer1.deltas,this.inputLayer2.weights),p=this.compareKernel2(this.deltas,this.inputLayer2.deltas,this.inputLayer1.weights);this.inputLayer2.deltas=p,this.inputLayer1.deltas=i,we(t),we(n)}setupPraxis(){}toJSON(){return{...super.toJSON(),width:this.width,height:this.height}}}function tt(g,t,n){return new tn(g,t,n)}function Jt(g){return 1/(1+Math.exp(-g[this.thread.y][this.thread.x]))}function Sn(g){return 1/(1+Math.exp(-g[this.thread.z][this.thread.y][this.thread.x]))}function Ln(g,t){const n=g[this.thread.y][this.thread.x],i=t[this.thread.y][this.thread.x];return n*(1-n)*i}function Tr(g,t){const n=g[this.thread.z][this.thread.y][this.thread.x],i=t[this.thread.z][this.thread.y][this.thread.x];return n*(1-n)*i}class gr extends zt{setupKernels(){this.depth>0?(this.predictKernel=ge(Sn,{output:[this.width,this.height,this.depth],functions:[C],immutable:!0}),this.compareKernel=ge(Tr,{output:[this.width,this.height,this.depth],functions:[A],immutable:!0})):(this.predictKernel=ge(Jt,{output:[this.width,this.height],functions:[C],immutable:!0}),this.compareKernel=ge(Ln,{output:[this.width,this.height],functions:[A],immutable:!0}))}predict(){we(this.weights),this.weights=this.predictKernel(this.inputLayer.weights)}compare(){we(this.inputLayer.deltas),this.inputLayer.deltas=this.compareKernel(this.weights,this.deltas)}learn(t){}}function qn(g,t){return new gr(g,t)}function jr(g,t){const{height:n}=g;function i(a,o){const S=_n(a,o);return S.setupKernels(),S}function p(a,o){const S=Hn(a,o);return S.setupKernels(),S}const d=jt({id:"weights",height:n,width:t.height,initPraxis:i}),y=jt({id:"biases",height:n,initPraxis:p}),v=tt(d,t),m=Gt(v,y),l=qn(m),h=d.praxis;return h.weightsLayer=d,h.incomingLayer=t,h.deltaLayer=l,l}function Er(g,t){if(typeof g.stride=="number")return{strideX:g.stride,strideY:g.stride};{let n=t.stride,i=t.stride;return typeof g.strideX=="number"&&(n=g.strideX),typeof g.strideY=="number"&&(i=g.strideY),{strideX:n,strideY:i}}}function lr(g,t){if(typeof g.padding=="number")return{paddingX:g.padding,paddingY:g.padding};{let n=t.padding,i=t.padding;return typeof g.paddingX=="number"&&(n=g.paddingX),typeof g.paddingY=="number"&&(i=g.paddingY),{paddingX:n,paddingY:i}}}function Cr(g,t){return new Float32Array(g).fill(t)}function Jr(g,t,n){const i=this.constants.paddingX-this.thread.x*this.constants.strideX,p=this.thread.x*this.constants.strideX-this.constants.paddingX,d=Math.min(this.constants.filterWidth,i+this.constants.inputWidth),y=this.constants.paddingY-this.thread.y*this.constants.strideY,v=this.thread.y*this.constants.strideY-this.constants.paddingY,m=Math.min(this.constants.filterHeight,y+this.constants.inputHeight);let l=0;for(let h=0;h<this.constants.inputDepth;h++)for(let a=Math.max(0,y),o=Math.max(0,v);a<m;a++,o++)for(let S=Math.max(0,i),_=Math.max(0,p);S<d;S++,_++)l+=t[h][a][S]*g[h][o][_];return l+n[this.thread.z]}function cr(g,t,n){const i=Math.max(0,Math.ceil((this.constants.paddingX-this.thread.x)/this.constants.strideX)),p=i*this.constants.strideX+this.thread.x-this.constants.paddingX,d=Math.min(this.constants.deltaWidth,Math.floor((this.constants.inputWidth-1-this.thread.x+this.constants.paddingX)/this.constants.strideX)+1),y=Math.max(0,Math.ceil((this.constants.paddingY-this.thread.y)/this.constants.strideY)),v=y*this.constants.strideY+this.thread.y-this.constants.paddingY,m=Math.min(this.constants.deltaHeight,Math.floor((this.constants.inputHeight-1-this.thread.y+this.constants.paddingY)/this.constants.strideY)+1);let l=g[this.thread.z][this.thread.y][this.thread.x];for(let h=y,a=v;h<m;h++,a+=this.constants.strideY)for(let o=i,S=p;o<d;o++,S+=this.constants.strideX)l+=t[this.thread.z][a][S]*n[this.constants.deltaZ][h][o];return l}function qr(g,t,n){const i=this.thread.x+this.constants.paddingX,p=i<this.constants.filterWidth?0:Math.floor((i-this.constants.filterWidth+this.constants.strideX)/this.constants.strideX),d=i-p*this.constants.strideX,y=Math.min(p+Math.floor(d/this.constants.strideX)+1,this.constants.deltaWidth),v=this.thread.y+this.constants.paddingY,m=v<this.constants.filterHeight?0:Math.floor((v-this.constants.filterHeight+this.constants.strideY)/this.constants.strideY),l=v-m*this.constants.strideY,h=Math.min(m+Math.floor(l/this.constants.strideY)+1,this.constants.deltaHeight);let a=g[this.thread.z][this.thread.y][this.thread.x],o=m;for(let S=l;o<h;S-=this.constants.strideY,o++){let _=p;for(let P=d;_<y;P-=this.constants.strideX,_++)a+=t[this.thread.z][S][P]*n[this.constants.deltaZ][o][_]}return a}function Si(g,t){let n=0;for(let i=0;i<this.constants.deltaHeight;i++)for(let p=0;p<this.constants.deltaWidth;p++)n+=t[this.thread.z][i][p];return g[this.thread.z][this.thread.y][this.thread.x]+n}const Fn={stride:0,padding:0,bias:.1,filterCount:1,filterWidth:0,filterHeight:0};class Ar extends Vt{constructor(t,n){var i,p,d;super(t,n),this.compareFilterDeltasKernel=null,this.compareInputDeltasKernel=null,this.compareBiasesKernel=null,this.settings={...Fn,...t,...lr(t,Fn),...Er(t,Fn)},this.weights=(i=t.weights)!==null&&i!==void 0?i:Me(this.width,this.height,this.depth),this.deltas=en(this.width,this.height,this.depth),this.biases=Cr(this.depth,this.bias),this.biasDeltas=(p=t.biasDeltas)!==null&&p!==void 0?p:Se(this.depth),this.filters=(d=t.filters)!==null&&d!==void 0?d:Me(this.filterWidth,this.filterHeight,this.filterCount),this.filterDeltas=en(this.filterWidth,this.filterHeight,this.filterCount),this.validate()}get strideX(){return this.settings.strideX}get strideY(){return this.settings.strideY}get paddingX(){return this.settings.paddingX}get paddingY(){return this.settings.paddingX}get width(){return Math.floor((this.inputLayer.width+this.paddingX*2-this.filterWidth)/this.strideX+1)}get height(){return Math.floor((this.inputLayer.height+this.paddingY*2-this.filterHeight)/this.strideY+1)}get bias(){return this.settings.bias}get depth(){return this.filterCount}get biases(){return this.settings.biases}set biases(t){this.settings.biases=t}get biasDeltas(){return this.settings.biasDeltas}set biasDeltas(t){this.settings.biasDeltas=t}get filters(){return this.settings.filters}set filters(t){this.settings.filters=t}get filterDeltas(){return this.settings.filterDeltas}set filterDeltas(t){this.settings.filterDeltas=t}setupKernels(){this.predictKernel=ge(Jr,{constants:{inputWidth:this.inputLayer.width,inputHeight:this.inputLayer.height,inputDepth:this.inputLayer.depth,strideX:this.strideX,strideY:this.strideY,paddingX:this.paddingX,paddingY:this.paddingY,filterWidth:this.filterWidth,filterHeight:this.filterHeight},output:[this.width,this.height,this.depth],immutable:!0}),this.compareFilterDeltasKernel=ge(cr,{constants:{deltaWidth:this.width,deltaHeight:this.height,deltaZ:this.depth,inputWidth:this.inputLayer.width,inputHeight:this.inputLayer.height,inputDepth:this.inputLayer.depth,strideX:this.strideX,strideY:this.strideY,paddingX:this.paddingX,paddingY:this.paddingY,filterWidth:this.filterWidth,filterHeight:this.filterHeight},output:[this.width,this.height,this.depth],immutable:!0}),this.compareInputDeltasKernel=ge(qr,{constants:{deltaWidth:this.width,deltaHeight:this.height,deltaZ:this.depth,strideX:this.strideX,strideY:this.strideY,paddingX:this.paddingX,paddingY:this.paddingY,filterWidth:this.filterWidth,filterHeight:this.filterHeight,filterCount:this.filterCount},output:[this.inputLayer.width,this.inputLayer.height,this.inputLayer.depth],immutable:!0}),this.compareBiasesKernel=ge(Si,{output:[1,1,this.depth],constants:{deltaWidth:this.width,deltaHeight:this.height},immutable:!0})}predict(){this.weights=this.predictKernel(this.inputLayer.weights,this.filters,this.biases)}compare(){const{filterDeltas:t,biasDeltas:n}=this;this.filterDeltas=this.compareFilterDeltasKernel(t,this.inputLayer.weights,this.deltas),we(t),this.biasDeltas=this.compareBiasesKernel(n,this.deltas),we(n),we(this.deltas),this.deltas=this.compareInputDeltasKernel(this.filters,this.inputLayer.deltas),we(this.inputLayer.deltas),this.inputLayer.deltas=et(this.deltas)}learn(t){const{weights:n}=this;this.weights=this.praxis.run(this,t),we(n)}}function Zr(g,t){return new Ar(g,t)}function yr(g){return g}function Rr(g){return Math.random()<this.constants.probability?0:g[this.thread.y][this.thread.x]}function ii(g){return g[this.thread.y][this.thread.x]*this.constants.probability}function si(g,t){return g[this.thread.y][this.thread.x]===0?0:t[this.thread.y][this.thread.x]}const Ti={...An,probability:.5};class ai extends Vt{constructor(t,n){super(n,t),this.predictKernelMap=null,this.settings={...Ti,...n},this.dropouts=null,this.validate()}setupKernels(t){const n=[this.width,this.height];t?(this.predictKernelMap=Ge({dropouts:yr},Rr,{output:n,immutable:!0}),this.compareKernel=ge(si,{output:n,immutable:!0})):this.predictKernelMap=Ge({},ii,{output:n,immutable:!0})}predict(){we(this.weights),this.dropouts&&we(this.dropouts);const{result:t,dropouts:n}=this.predictKernelMap(this.inputLayer.weights);this.weights=t,this.dropouts=n}compare(){we(this.deltas),this.deltas=this.compareKernel(this.dropouts,this.inputLayer.deltas)}}function Ue(g,t){return new ai(g,t)}function pt(g,t){const{height:n,praxisOpts:i=null}=g,p=jt({id:"weights",height:n,width:t.height,praxisOpts:i}),d=jt({id:"biases",height:n,praxisOpts:i});return qn(Gt(tt(p,t,{praxisOpts:i}),d,{praxisOpts:i}),{praxisOpts:i})}function an(g,t,n){let i=0,p=0;for(let d=0;d<this.constants.inputHeight;d++)for(let y=0;y<this.constants.inputWidth;y++)i+=g[d][y]*t[this.thread.x][p],p++;return i+n[this.thread.x]}function hn(g,t,n){let i=0,p=0;for(let d=0;d<this.constants.inputDepth;d++)for(let y=0;y<this.constants.inputHeight;y++)for(let v=0;v<this.constants.inputWidth;v++)i+=g[d][y][v]*t[this.thread.x][p],p++;return i+n[this.thread.x]}function un(g,t,n){let i=0;const p=this.thread.x+this.thread.y*this.output.x;for(let d=0;d<this.constants.filterCount;d++)i+=n[d][p]*t[0][d];return i+g[this.thread.y][this.thread.x]}function oi(g,t,n){let i=0;const p=this.thread.x+this.thread.y*this.output.x;for(let d=0;d<this.constants.filterCount;d++)i+=n[d][p]*t[0][d];return i+g[this.thread.z][this.thread.y][this.thread.x]}function Ei(g,t){return g[this.thread.x]+t[this.thread.y][this.thread.x]}function Ji(g,t,n){return g[this.thread.y][this.thread.x]+t[this.thread.y][this.thread.x]*n[this.constants.deltaY][this.constants.deltaX]}function ui(g,t,n){const i=Math.floor(this.thread.x/(this.constants.inputWidth*this.constants.inputHeight)),p=Math.floor((this.thread.x-i*this.constants.inputWidth*this.constants.inputHeight)/this.constants.inputWidth),d=this.thread.x-this.constants.inputWidth*(p+this.constants.inputHeight*i);return g[this.thread.y][this.thread.x]+t[i][p][d]*n[0][this.thread.y]}class Ba extends Vt{constructor(t,n){super(t,n),this.compareFilterDeltasKernel=null,this.compareInputDeltasKernel=null,this.compareBiasesKernel=null,this.settings={...t},this.validate();const i=n.width*n.height*n.depth;this.biases=Cr(this.height,this.bias),this.biasDeltas=De(this.height),this.filters=ke(i,this.height),this.filterDeltas=Bt(i,this.height),this.depth>0?(this.weights=Me(this.width,this.height,this.depth),this.deltas=en(this.width,this.height,this.depth)):this.height>0&&(this.weights=ke(this.width,this.height),this.deltas=Bt(this.width,this.height))}get bias(){return this.settings.bias}get biases(){return this.settings.biases}set biases(t){this.settings.biases=t}get biasDeltas(){return this.settings.biases}set biasDeltas(t){this.settings.biasDeltas=t}validate(){if(super.validate(),this.depth>0)throw new Error("depth not supported")}setupKernels(){const{inputLayer:t}=this,n=t.width*t.height*t.depth;t.depth>0?(this.predictKernel=ge(hn,{output:[this.width,this.height],constants:{inputHeight:t.height,inputWidth:t.width,inputDepth:t.depth}}),this.compareFilterDeltasKernel=ge(ui,{output:[n,this.height],constants:{deltaX:0,deltaY:0,inputWidth:t.width,inputHeight:t.height},immutable:!0}),this.compareInputDeltasKernel=ge(oi,{output:[t.width,t.height,t.depth],constants:{filterCount:this.height},immutable:!0})):(this.predictKernel=ge(an,{output:[this.width,this.height],constants:{inputHeight:t.height,inputWidth:t.width}}),this.compareFilterDeltasKernel=ge(Ji,{output:[n,this.height],constants:{deltaX:0,deltaY:0,inputWidth:t.width,inputHeight:t.height}}),this.compareInputDeltasKernel=ge(un,{output:[t.width,t.height],constants:{filterCount:this.height}})),this.compareBiasesKernel=ge(Ei,{output:[this.width,this.height]})}predict(){this.weights=this.predictKernel(this.inputLayer.weights,this.filters,this.biases)}compare(){const t=this.inputLayer.deltas;this.inputLayer.deltas=this.compareInputDeltasKernel(t,this.deltas,this.filters),we(t);const{biasDeltas:n,filterDeltas:i}=this;this.biasDeltas=this.compareBiasesKernel(this.biases,this.deltas),this.filterDeltas=this.compareFilterDeltasKernel(i,this.inputLayer.weights,this.deltas),we(n),we(i)}}function xc(g,t){return new Ba(g,t)}function bc(g){return-g[this.thread.y][this.thread.x]}class Ga extends rt{constructor(t,n){super(t,n),this.validate()}setupKernels(){this.predictKernel=ge(bc,{output:[this.width,this.height]})}predict(){this.weights=this.predictKernel(this.inputLayer.weights)}}function Ua(g,t){return new Ga(g,t)}function vc(g,t){return g[this.thread.y][this.thread.x]*t[this.thread.y][this.thread.x]}function wc(g,t){return g[this.thread.y][this.thread.x]*t[this.thread.y][this.thread.x]}class Wa extends Xe{get width(){return this.inputLayer1.width}get height(){return this.inputLayer1.height}get depth(){return this.inputLayer1.depth}validate(){super.validate(),In(this.inputLayer1,this.inputLayer2)}setupKernels(){this.predictKernel=ge(vc,{output:[this.width,this.height],immutable:!0}),this.compareKernel=ge(wc,{output:[this.width,this.height],immutable:!0})}predict(){we(this.weights),this.weights=this.predictKernel(this.inputLayer1.weights,this.inputLayer2.weights)}compare(){we(this.inputLayer1.deltas),we(this.inputLayer2.deltas),this.inputLayer1.deltas=this.compareKernel(this.inputLayer2.weights,this.deltas),this.inputLayer2.deltas=this.compareKernel(this.inputLayer1.weights,this.deltas)}}function Qr(g,t,n){return new Wa(g,t,n)}function Ha(g){return new Float32Array(g).fill(1)}function Xa(g,t){const n=new Array(t);for(let i=0;i<t;i++)n[i]=Ha(g);return n}class Ya extends yn{constructor(t){super(t),this.validate(),this.weights=Xa(this.width,this.height),this.deltas=Bt(this.width,this.height)}}function Ja(g){return new Ya(g)}function Sc(g){return M(g[this.thread.y][this.thread.x])}function Tc(g){return M(g[this.thread.z][this.thread.y][this.thread.x])}function Ec(g,t){return F(g[this.thread.y][this.thread.x],t[this.thread.y][this.thread.x])}function Cc(g,t){return F(g[this.thread.z][this.thread.y][this.thread.x],t[this.thread.z][this.thread.y][this.thread.x])}class qa extends zt{setupKernels(){this.depth>0?(this.predictKernel=ge(Tc,{output:[this.width,this.height,this.depth],functions:[M],immutable:!0}),this.compareKernel=ge(Cc,{output:[this.width,this.height,this.depth],functions:[F],immutable:!0})):(this.predictKernel=ge(Sc,{output:[this.width,this.height],functions:[M],immutable:!0}),this.compareKernel=ge(Ec,{output:[this.width,this.height],functions:[F],immutable:!0}))}predict(){we(this.weights),this.weights=this.predictKernel(this.inputLayer.weights)}compare(){we(this.inputLayer.deltas),this.inputLayer.deltas=this.compareKernel(this.weights,this.deltas)}}function qi(g,t){return new qa(g,t)}class Za extends yn{constructor(t){super(t),this.validate(),this.weights=Bt(this.width,this.height),this.deltas=Bt(this.width,this.height)}predict(){}compare(){}}function kr(g){return new Za(g)}function $c(g,t,n){const{height:i}=g,p=jt({height:i,width:n.height}),d=jt({width:i,height:i}),y=kr({height:i}),v=qn(Gt(Gt(tt(p,n),tt(d,t)),y)),m=jt({height:i,width:n.height}),l=jt({width:i,height:i}),h=kr({height:i}),a=qn(Gt(Gt(tt(m,n),tt(l,t)),h)),o=jt({height:i,width:n.height}),S=jt({width:i,height:i}),_=kr({height:i}),P=qi(Gt(Gt(tt(o,n),tt(S,Qr(a,t))),_));return Gt(Qr(Gt(Ja({width:v.width,height:v.height}),Ua(v)),P),Qr(t,v))}const _c={weights:null};class Qa extends Wn{constructor(t){super({..._c,...t}),this.reshapeInput=null,this.validate(),this.reshapeInput=null,this.deltas=Bt(this.width,this.height)}setupKernels(){this.width===1&&(this.predict=this.predict1D,this.reshapeInput=ge(function(t){return t[this.thread.y]},{output:[1,this.height],immutable:!0}))}reuseKernels(t){this.reshapeInput=t.reshapeInput}predict(t){if((Array.isArray(t)||t instanceof Float32Array)&&typeof t[0]=="number"&&t.length===this.height*this.width)we(this.weights),this.weights=We(t,[this.width,this.height]);else if(Array.isArray(t)&&t.length===this.height&&(Array.isArray(t[0])||t[0]instanceof Float32Array)&&t[0].length===this.width)this.weights=et(t);else throw new Error("Inputs are not of sized correctly")}predict1D(t){this.weights&&we(this.weights),this.reshapeInput?this.weights=this.reshapeInput(t):this.weights=t}compare(){}learn(){}}function Ic(g){return new Qa(g)}function Lc(g){return B(g[this.thread.y][this.thread.x])}function Oc(g){return B(g[this.thread.z][this.thread.y][this.thread.x])}function Ac(g,t){return H(g[this.thread.y][this.thread.x],t[this.thread.y][this.thread.x])}function Rc(g,t){return H(g[this.thread.z][this.thread.y][this.thread.x],t[this.thread.z][this.thread.y][this.thread.x])}class eo extends zt{setupKernels(){const{width:t,height:n,depth:i}=this.inputLayer;this.depth>0?(this.predictKernel=ge(Oc,{output:[t,n,i],functions:[B],immutable:!0}),this.compareKernel=ge(Rc,{output:[t,n,i],functions:[H],immutable:!0})):(this.predictKernel=ge(Lc,{output:[t,n],functions:[B],immutable:!0}),this.compareKernel=ge(Ac,{output:[t,n],functions:[H],immutable:!0}))}predict(){we(this.weights),this.weights=this.predictKernel(this.inputLayer.weights)}compare(){const{deltas:t}=this;this.deltas=this.compareKernel(this.weights,t),we(t)}}function kc(g,t){return new eo(g,t)}function Dc(g,t,n){const{height:i}=g;if(typeof i!="number")throw new Error("no settings.height given");n.setDimensions&&n.setDimensions(1,i);const p=jt({width:t.height,height:i,std:.08,id:"inputGateWeights"}),d=jt({width:i,height:i,std:.08,id:"inputGatePeepholes"}),y=kr({width:1,height:i,id:"inputGateBias"}),v=qn(Gt(Gt(tt(p,t),tt(d,n)),y),{id:"inputGate"}),m=jt({width:t.height,height:i,std:.08,id:"forgetGateWeights"}),l=jt({width:i,height:i,std:.08,id:"forgetGatePeepholes"}),h=kr({width:1,height:i,id:"forgetGateBias"}),a=qn(Gt(Gt(tt(m,t),tt(l,n)),h),{id:"forgetGate"}),o=jt({width:t.height,height:i,std:.08,id:"outputGateWeights"}),S=jt({width:i,height:i,std:.08,id:"outputGatePeepholes"}),_=kr({width:1,height:i,id:"outputGateBias"}),P=qn(Gt(Gt(tt(o,t),tt(S,n)),_),{id:"outputGate"}),I=jt({width:t.height,height:i,std:.08,id:"memoryWeights"}),k=jt({width:i,height:i,std:.08,id:"memoryPeepholes"}),T=kr({width:1,height:i,id:"memoryBias"}),L=qi(Gt(Gt(tt(I,t),tt(k,n)),T),{id:"memory"}),D=Qr(a,n,{id:"retainCell"}),z=Qr(v,L,{id:"writeCell"}),re=Gt(D,z,{id:"cell"});return Qr(P,qi(re),{id:"activations"})}function Mc(g,t){const{height:n}=g,i=jt({height:n,width:t.height,id:"outputGate",std:.08}),p=jt({height:n,id:"output",std:.08}),d=tt(i,t,{id:"outputGateConnected"});return $n({id:"target",...g},Gt(d,p))}function Pc(g){return g}function zc(g){return g}function Nc(g){const t=this.thread.x*this.constants.strideX-this.constants.paddingX,n=this.thread.y*this.constants.strideY-this.constants.paddingY,i=t+this.constants.filterWidth,p=n+this.constants.filterHeight,d=Math.max(t,0),y=Math.max(n,0),v=Math.min(i,this.constants.inputWidth),m=Math.min(p,this.constants.inputHeight);let l=g[this.thread.z][y][d];for(let h=y;h<m;h++)for(let a=d;a<v;a++){const o=g[this.thread.z][h][a];o>l&&(l=o)}return l}function Fc(g,t,n){const i=this.thread.x+.5,p=this.thread.y+.5,d=1/this.constants.strideX,y=1/this.constants.strideY,v=Math.max(0,Math.ceil((i-this.constants.filterWidth+this.constants.paddingX)*d)),m=Math.max(0,Math.ceil((p-this.constants.filterHeight+this.constants.paddingY)*y)),l=Math.min(Math.ceil((i+this.constants.paddingX)*d),this.constants.outputWidth),h=Math.min(Math.ceil((p+this.constants.paddingY)*y),this.constants.outputHeight);let a=0;for(let o=m;o<h;o++)for(let S=v;S<l;S++){const _=t[o][S],P=n[o][S];Math.abs(_-this.thread.x)<.1&&Math.abs(P-this.thread.y)<.1&&(a+=g[o][S])}return a}const to={padding:0,stride:0};class no extends Vt{constructor(t,n){super(t,n),this.predictKernelMap=null,this.settings={...t,...Er(t,to),...lr(t,to)},this.weights=Me(this.width,this.height,this.depth),this.deltas=en(this.width,this.height,this.depth),this.validate()}get strideX(){return this.settings.strideX}get strideY(){return this.settings.strideY}get paddingX(){return this.settings.paddingX}get paddingY(){return this.settings.paddingY}get width(){return Math.ceil((this.inputLayer.width+this.paddingX*2-this.filterWidth)/this.strideX+1)}get height(){return Math.floor((this.inputLayer.height+this.paddingY*2-this.filterHeight)/this.strideY+1)}get depth(){return this.settings.filterCount}get filterCount(){return this.settings.filterCount}get switchX(){return this.settings.switchX}set switchX(t){this.settings.switchX=t}get switchY(){return this.settings.switchY}set switchY(t){this.settings.switchY=t}setupKernels(){this.predictKernelMap=Ge({switchX:zc,switchY:Pc},Nc,{output:[this.width,this.height,this.depth],constants:{inputWidth:this.inputLayer.width,inputHeight:this.inputLayer.height,paddingX:this.paddingX,paddingY:this.paddingY,filterHeight:this.filterHeight,filterWidth:this.filterWidth,strideX:this.strideX,strideY:this.strideY}}),this.compareKernel=ge(Fc,{output:[this.inputLayer.width,this.inputLayer.height,this.inputLayer.depth],constants:{inputWidth:this.inputLayer.width,inputHeight:this.inputLayer.height,outputWidth:this.width,outputHeight:this.height,filterWidth:this.filterWidth,filterHeight:this.filterHeight,paddingX:this.paddingX,paddingY:this.paddingY,strideX:this.strideX,strideY:this.strideY}})}predict(){const{result:t,switchX:n,switchY:i}=this.predictKernelMap(this.inputLayer.weights);this.switchX=n,this.switchY=i,this.weights=t}compare(){const t=this.inputLayer.deltas;this.inputLayer.deltas=this.compareKernel(this.deltas,this.switchX,this.switchY),we(t)}}function Vc(g,t){return new no(g,t)}class Zi extends nt{constructor(t){super(),this.praxis=null,this.predictKernel=null,this.compareKernel=null,this.settings={},this.recurrentInput=t,this.validate()}get width(){return this.recurrentInput.width}get height(){return this.recurrentInput.height}get depth(){return this.recurrentInput.depth}get deltas(){return this.recurrentInput.deltas}set deltas(t){const n=this.recurrentInput.deltas;this.recurrentInput.deltas=t,we(n)}get weights(){return this.recurrentInput.weights}set weights(t){const n=this.recurrentInput.weights;this.recurrentInput.weights=t,we(n)}validate(){if(Xt.prototype.validate.call(this),this.width!==this.recurrentInput.width)throw new Error(`${this.constructor.name} layer width ${this.width} and ${this.recurrentInput.constructor.name} width (${this.recurrentInput.width}) are not same`);if(this.height!==this.recurrentInput.height)throw new Error(`${this.constructor.name} layer height ${this.height} and ${this.recurrentInput.constructor.name} width (${this.recurrentInput.height}) are not same`)}setDimensions(t,n){this.recurrentInput.width=t,this.recurrentInput.height=n}predict(){}compare(){}learn(){}setupKernels(){}reuseKernels(){}}class Qi extends nt{constructor(t){super(),this.praxis=null,this.settings={},this.predictKernel=null,this.compareKernel=null,t&&(this.settings={...t})}setDimensions(t,n){this.praxis=null,this.settings={...this.settings,width:t,height:n,weights:Bt(t,n),deltas:Bt(t,n)}}setupKernels(){}reuseKernels(){}predict(){}compare(){}learn(t){const{weights:n}=this;this.weights=this.praxis.run(this,t),we(n)}}function ro(){return new Qi}function jc(g){return c(g[this.thread.y][this.thread.x])}function Kc(g,t){return f(g[this.thread.y][this.thread.x],t[this.thread.y][this.thread.x])}function Bc(g){return c(g[this.thread.z][this.thread.y][this.thread.x])}function Gc(g,t){return f(g[this.thread.z][this.thread.y][this.thread.x],t[this.thread.z][this.thread.y][this.thread.x])}class io extends zt{setupKernels(){const{width:t,height:n,depth:i}=this.inputLayer;i>0?(this.predictKernel=ge(Bc,{output:[t,n,i],functions:[c],immutable:!0}),this.compareKernel=ge(Gc,{output:[t,n,i],functions:[f],immutable:!0})):(this.predictKernel=ge(jc,{output:[t,n],functions:[c],immutable:!0}),this.compareKernel=ge(Kc,{output:[t,n],functions:[f],immutable:!0}))}predict(){we(this.weights),this.weights=this.predictKernel(this.inputLayer.weights)}compare(){we(this.inputLayer.deltas),this.inputLayer.deltas=this.compareKernel(this.weights,this.deltas)}}function so(g,t){return new io(g,t)}function Uc(g,t,n){const{height:i}=g;if(typeof i!="number")throw new Error("height not set");n.setDimensions&&n.setDimensions(1,i);const p=jt({id:"weight",height:i,width:t.height,std:.08}),d=jt({id:"transition",height:i,width:i,std:.08}),y=kr({id:"bias",height:i});return so(Gt(Gt(tt(p,t),tt(d,n)),y))}class ao extends Xt{constructor(t,n){super(t),this.inputLayer=n,this.validate()}predict(){we(this.weights),this.weights=et(this.inputLayer.weights)}learn(){}}function Wc(g,t){return new ao(g,t)}function Hc(g){let t=-1/0;for(let n=0;n<this.constants.inputHeight;n++)for(let i=0;i<this.constants.inputWidth;i++){const p=g[n][i];p>t&&(t=p)}return t}function Xc(g){let t=-1/0;for(let n=0;n<this.constants.inputDepth;n++)for(let i=0;i<this.constants.inputHeight;i++)for(let p=0;p<this.constants.inputWidth;p++){const d=g[n][i][p];d>t&&(t=d)}return t}function Yc(g){let t=0;for(let n=0;n<this.constants.inputHeight;n++)for(let i=0;i<this.constants.inputWidth;i++)t+=g[n][i];return t}function Jc(g){let t=0;for(let n=0;n<this.constants.inputDepth;n++)for(let i=0;i<this.constants.inputHeight;i++)for(let p=0;p<this.constants.inputWidth;p++)t+=g[n][i][p];return t}function qc(g,t){return Math.exp(g[this.thread.x]-t[0])}function Zc(g,t){return Math.exp(g[this.thread.z][this.thread.y][this.thread.x]-t[0])}function Qc(g,t){return g[this.thread.y][this.thread.x]/t[0]}function eh(g,t){return g[this.thread.z][this.thread.y][this.thread.x]/t[0]}function th(g,t){let n=0;return this.thread.x+this.thread.y*this.output.x===g&&(n=1),-(n-t[this.thread.y][this.thread.x])}function nh(g,t){let n=0;return this.thread.x+this.thread.y*this.output.x+this.thread.z*this.output.x*this.output.y===g&&(n=1),-(n-t[this.thread.z][this.thread.y][this.thread.x])}class oo extends rt{constructor(t,n){super(t,n),this.errors=null,this.getExponentialsKernel=null,this.getMaxValueKernel=null,this.getSumKernel=null,this.validate(),this.depth>0?(this.weights=Me(this.width,this.height,this.depth),this.deltas=en(this.width,this.height,this.depth)):this.height>0?(this.weights=ke(this.width,this.height),this.deltas=Bt(this.width,this.height)):(this.weights=Se(this.width),this.deltas=De(this.width))}setupKernels(){const{width:t,height:n,depth:i}=this;i>0?(this.getExponentialsKernel=ge(Zc,{output:[t,n,i]}),this.getMaxValueKernel=ge(Xc,{output:[1,1,1],constants:{inputWidth:t,inputHeight:n,inputDepth:i}}),this.getSumKernel=ge(Jc,{output:[1,1,1],constants:{inputWidth:t,inputHeight:n,inputDepth:i}}),this.predictKernel=ge(eh,{output:[t,n,i]}),this.compareKernel=ge(nh,{output:[t,n,i],immutable:!0})):(this.getExponentialsKernel=ge(qc,{output:[t,n]}),this.getMaxValueKernel=ge(Hc,{output:[1,1],constants:{inputWidth:t,inputHeight:n}}),this.getSumKernel=ge(Yc,{output:[1,1],constants:{inputWidth:t,inputHeight:n}}),this.predictKernel=ge(Qc,{output:[t,n]}),this.compareKernel=ge(th,{output:[t,n],immutable:!0}))}predict(){const t=this.getMaxValueKernel(this.inputLayer.weights),n=this.getExponentialsKernel(this.inputLayer.weights,t),i=this.getSumKernel(n);this.weights=this.predictKernel(n,i)}compare(t){const{deltas:n,errors:i}=this;this.errors=this.compareKernel(t[0],n),this.deltas=et(this.errors),we(n),we(i);const p=this.inputLayer.deltas;this.inputLayer.deltas=et(this.deltas),we(p)}}function rh(g,t){return new oo(g,t)}class uo extends Xt{constructor(t,n){super(n),this.inputLayer=t}predict(){we(this.weights),this.weights=et(this.inputLayer.weights),this.validate()}learn(){}}function ih(g,t){return new uo(g,t)}function lo(g){return g[this.thread.x][this.thread.y]}const sh=lo;class co extends rt{get width(){return this.inputLayer.height}get height(){return this.inputLayer.width}constructor(t){super(t),this.validate()}setupKernels(){this.predictKernel=ge(lo,{output:[this.height,this.width]}),this.compareKernel=ge(sh,{output:[this.width,this.height]})}predict(){this.weights=this.predictKernel(this.inputLayer.weights)}compare(){this.inputLayer.deltas=this.compareKernel(this.deltas)}}function ah(g){return new co(g)}const $r={Activation:zt,Internal:nt,InternalModel:Bn,EntryPoint:Wn,Filter:Vt,Model:yn,Modifier:rt,Operator:Xe,Target:cn};var Fs=Object.freeze({__proto__:null,layerTypes:$r,Add:Jn,add:Gt,arthurFeedForward:jr,BaseLayer:Xt,baseLayerDefaultSettings:An,Convolution:Ar,convolution:Zr,Dropout:ai,dropout:Ue,feedForward:pt,FullyConnected:Ba,fullyConnected:xc,gru:$c,Input:Qa,input:Ic,LeakyRelu:eo,leakyRelu:kc,lstmCell:Dc,Multiply:tn,multiply:tt,MultiplyElement:Wa,multiplyElement:Qr,Negative:Ga,negative:Ua,Ones:Ya,ones:Ja,output:Mc,Pool:no,pool:Vc,Random:Mn,random:jt,RecurrentInput:Zi,RecurrentZeros:Qi,rnnCell:Uc,Regression:ao,regression:Wc,Relu:io,relu:so,Sigmoid:gr,sigmoid:qn,SoftMax:oo,softMax:rh,SVM:uo,svm:ih,Tanh:qa,tanh:qi,Target:cn,target:$n,Transpose:co,transpose:ah,Zeros:Za,zeros:kr});const oh=Object.keys(Fs);function Kr(g,t,n){if(!oh.find(p=>p===g.type))return null;const i=Fs[g.type];if(i.prototype instanceof $r.Filter){if(!t)throw new Error("inputLayer missing");return new i(g,t)}else if(i.prototype instanceof $r.Activation||i.prototype instanceof $r.Modifier){if(!t)throw new Error("inputLayer missing");return new i(t,g)}else{if(i.prototype instanceof $r.Internal)return new i(g);if(i.prototype instanceof $r.Operator){if(!t)throw new Error("inputLayer1 missing");if(!n)throw new Error("inputLayer2 missing");return new i(t,n,g)}else{if(i.prototype instanceof $r.InternalModel||i.prototype instanceof $r.EntryPoint||i.prototype instanceof $r.Model)return new i(g);if(i===cn){if(!t)throw new Error("inputLayer missing");return new i(g,t)}}}return null}const uh={learningRate:.3,binaryThresh:.5,initPraxis:(g,t)=>{var n;return $t(g,(n=g.settings.praxisOpts)!==null&&n!==void 0?n:t)}},Vs={iterations:2e4,errorThresh:.005,log:!1,logPeriod:10,learningRate:.3,callbackPeriod:10,errorCheckInterval:100,timeout:1/0};class Ci{constructor(t={}){this.trainOpts={},this.layers=null,this._inputLayer=null,this._hiddenLayers=null,this._outputLayer=null,this._model=null,this.meanSquaredError=null,this.inputLookup=null,this.inputLookupLength=null,this.outputLookup=null,this.outputLookupLength=null,this.options={...uh,...t},this._updateTrainingOptions({...Vs,...t})}static _validateTrainingOptions(t){const{iterations:n,errorThresh:i,log:p,logPeriod:d,learningRate:y,callback:v,callbackPeriod:m,timeout:l}=t,h={iterations:()=>typeof n=="number"&&n>0,errorThresh:()=>typeof i=="number"&&i>0&&i<1,log:()=>typeof p=="function"||typeof p=="boolean",logPeriod:()=>typeof d=="number"&&d>0,learningRate:()=>typeof y=="number"&&y>0&&y<1,callback:()=>typeof v=="function"||v===null,callbackPeriod:()=>typeof m=="number"&&m>0,timeout:()=>typeof l=="number"&&l>0};Object.keys(Vs).forEach(a=>{if(h.hasOwnProperty(a)&&!h[a]()){const o=t[a];throw new Error(`[${a}, ${(o??"undefined").toString()}] is out of normal training range, your network will probably not train.`)}})}_setLogMethod(t){typeof t=="function"?this.trainOpts.log=t:t?this.trainOpts.log=console.log:this.trainOpts.log=!1}_updateTrainingOptions(t){var n;this.trainOpts={...Vs,...this.trainOpts,...t},Ci._validateTrainingOptions(this.trainOpts),this._setLogMethod((n=t.log)!==null&&n!==void 0?n:this.trainOpts.log);const{callback:i,callbackPeriod:p,errorCheckInterval:d}=this.trainOpts;i&&p!==d&&console.warn(`options.callbackPeriod with value of ${(p??"undefined").toString()} does not match options.errorCheckInterval with value of ${(d??"undefined").toString()}, if logging error, it will repeat.  These values may need to match`)}_connectOptionsLayers(){const{inputLayerIndex:t,outputLayerIndex:n,layers:i}=this.options;if(!i)throw new Error("this.options.layers in unexpected state");if(typeof t!="number")throw new Error("inputLayerIndex not a number");if(typeof n!="number")throw new Error("inputLayerIndex not a number");const p=i[t];if(!p)throw new Error("inputLayer not found in this.options.layers");const d=i[n];if(!d)throw new Error("outputLayer not found in this.options.layers");return this._inputLayer=p,this._hiddenLayers=i.slice(t,n-t),this._outputLayer=d,i}_connectNewLayers(){const{inputLayer:t,outputLayer:n}=this.options;if(!t)throw new Error("inputLayer not defined");const i=[];this._inputLayer=t();const p=this._connectHiddenLayers(this._inputLayer);if(!n)throw new Error("outputLayer not defined");return this._outputLayer=n(p[p.length-1],p.length),i.push(this._inputLayer),i.push(...p),i.push(this._outputLayer),sn(i)}_connectHiddenLayers(t){this._hiddenLayers=[];const n=[],{hiddenLayers:i}=this.options;if(!i)throw new Error("hiddenLayers not defined");for(let p=0;p<i.length;p++){const d=i[p](t,p);n.push(d),this._hiddenLayers.push(d),t=d}return n}initialize(){this.layers=this.options.layers?this._connectOptionsLayers():this._connectNewLayers(),this.initializeLayers(this.layers),this._model=this.layers.filter(t=>t instanceof yn)}initializeLayers(t){var n,i;for(let d=0;d<t.length;d++){const y=t[d];y.setupKernels(!0),y instanceof yn&&y.praxis===null&&typeof this.options.initPraxis=="function"&&(y.praxis=this.options.initPraxis(y,(i=(n=y.settings.praxisOpts)!==null&&n!==void 0?n:this.options.praxisOpts)!==null&&i!==void 0?i:{}),y.praxis.setupKernels())}const p=t[t.length-1];this.meanSquaredError=new Pn({width:p.width,height:p.height})}run(t){let n;if(Array.isArray(t)||t.buffer)n=t;else if(this.inputLookup)n=X.toArray(this.inputLookup,t,this.inputLookupLength);else throw new Error("input is incompatible with net");let i=this.runInput(n);return i instanceof Z.Texture&&(i=i.toArray()),this.outputLookup?X.toObject(this.outputLookup,i):i}runInput(t){if(!this.layers)throw new Error("not initialized");this.layers[0].predict(t);for(let n=1;n<this.layers.length;n++)this.layers[n].predict();return this.layers[this.layers.length-1].weights}train(t,n={}){const{preparedData:i,status:p,endTime:d}=this._prepTraining(t,n);let y=!0;const v=()=>this._calculateTrainingError(i),m=()=>this._trainPatterns(i);for(;y;)y=this._trainingTick(p,d,v,m);return p}async trainAsync(t,n={}){const{preparedData:i,status:p,endTime:d}=this._prepTraining(t,n);return await new Promise((y,v)=>{try{const m=()=>this._calculateTrainingError(i),l=()=>this._trainPatterns(i),h=new ne.Thaw(new Array(this.trainOpts.iterations),{delay:!0,each:()=>this._trainingTick(p,d,m,l)||h.stop(),done:()=>y(p)});h.tick()}catch(m){v(m)}})}_trainingTick(t,n,i,p){const{trainOpts:d}=this;return t.iterations>=d.iterations||t.error<=d.errorThresh||Date.now()>=n?!1:(typeof d.log=="function"&&t.iterations%d.logPeriod===0?(t.error=i(),d.log(`iterations: ${t.iterations}, training error: ${t.error}`)):t.iterations%d.errorCheckInterval===0?t.error=i():p(),d.callback&&t.iterations%d.callbackPeriod===0&&d.callback(Object.assign(t)),t.iterations++,!0)}_prepTraining(t,n){this._updateTrainingOptions(n);const i=this.formatData(t),p=this.trainOpts.timeout?Date.now()+this.trainOpts.timeout:0,d={error:1,iterations:0};return this.verifyIsInitialized(),{preparedData:this.transferData(i),status:d,endTime:p}}verifyIsInitialized(){this._model||this.initialize()}_calculateTrainingError(t){let n=new Float32Array([0]);const i=this.meanSquaredError;for(let d=0;d<t.length;++d){const y=n,v=this._trainPattern(t[d].input,t[d].output,!0);n=i.add(n,v),we(v),we(y)}const p=i.divide(t.length,n);if(we(n),p instanceof Z.Texture){const d=p.toArray();return we(p),d[0]}return p[0]}_trainPatterns(t){for(let n=0;n<t.length;++n)this._trainPattern(t[n].input,t[n].output,!1)}_trainPattern(t,n,i){var p;if(this.runInput(t),this._calculateDeltas(n),this.adjustWeights(),i){if(!(!((p=this._outputLayer)===null||p===void 0)&&p.errors))throw new Error("outputLayer.errors not defined");return this.meanSquaredError.calculate(this._outputLayer.errors)}return null}_calculateDeltas(t){const n=this.layers;for(let i=n.length-1;i>-1;i--)n[i].compare(t)}adjustWeights(){const t=this._model;for(let n=0;n<t.length;n++)t[n].learn(this.trainOpts.learningRate)}formatData(t){if(!Array.isArray(t)){const d=[];d.push(t),t=d}const n=t[0].input;let i;if(Array.isArray(t)&&!Array.isArray(n)&&!(n instanceof Float32Array)){if(!this.inputLookup){const d=new Ee(t,"input");this.inputLookup=d.table,this.inputLookupLength=d.length}i=t.map(d=>({input:X.toArray(this.inputLookup,d.input,this.inputLookupLength)}),this)}else i=t;const p=t[0].output;if(!Array.isArray(p)&&!(p instanceof Float32Array)){if(!this.outputLookup){const d=new Ee(t,"output");this.outputLookup=d.table,this.outputLookupLength=d.length}i=t.map((d,y)=>{const v=X.toArray(this.outputLookup,d.output,this.inputLookupLength);return{input:i[y].input,output:v}},this)}return i}transferData(t){const n=new Array(t.length),i=ge(function(d){return d[this.thread.x]},{output:[t[0].input.length],immutable:!0}),p=ge(function(d){return d[this.thread.x]},{output:[t[0].output.length],immutable:!0});for(let d=0;d<t.length;d++){const y=t[d];n[d]={input:i(y.input),output:p(y.output)}}return n}test(){throw new Error(`${this.constructor.name}-test is not yet implemented`)}toJSON(){var t;if(this.layers||this.initialize(),!this._model||!this.layers||!this._inputLayer||!this._hiddenLayers||!this._outputLayer)throw new Error("network is not initialized");const n=[];for(let i=0;i<this.layers.length;i++){const p=this.layers[i],d=p.toJSON();p.hasOwnProperty("inputLayer")?d.inputLayerIndex=this.layers.indexOf(p.inputLayer):p.hasOwnProperty("inputLayer1")&&p.hasOwnProperty("inputLayer2")&&(d.inputLayer1Index=this.layers.indexOf(p.inputLayer1),d.inputLayer2Index=this.layers.indexOf(p.inputLayer2)),n.push(d)}return{type:this.constructor.name,sizes:(t=this.options.sizes)!==null&&t!==void 0?t:[this._inputLayer.height].concat(this._hiddenLayers.map(i=>i.height)).concat([this._outputLayer.height]),outputLayerIndex:this.layers.indexOf(this._outputLayer),layers:n,inputLayerIndex:this.layers.indexOf(this._inputLayer)}}static fromJSON(t,n){var i,p,d,y;const v=t.layers,m=[],l=n?(i=Kr(v[0]))!==null&&i!==void 0?i:n(v[0]):Kr(v[0]);if(!l)throw new Error("unable to find layer");m.push(l);for(let h=1;h<v.length;h++){const a=v[h];if(typeof a.inputLayerIndex>"u"&&typeof a.inputLayer1Index>"u"&&typeof a.inputLayer2Index>"u"){const o=n?(p=Kr(a))!==null&&p!==void 0?p:n(a):Kr(a);if(!o)throw new Error("unable to find layer");m.push(o)}else if(typeof a.inputLayerIndex=="number"){const o=m[a.inputLayerIndex];if(!o)throw new Error("inputLayer1 not found");const S=n?(d=Kr(a,o))!==null&&d!==void 0?d:n(a,o):Kr(a,o);if(!S)throw new Error("unable to find layer");m.push(S)}else{if(typeof a.inputLayer1Index!="number")throw new Error("Cannot create network from provided JSON. inputLayer1Index not defined.");if(typeof a.inputLayer2Index!="number")throw new Error("Cannot create network from provided JSON. inputLayer2Index not defined.");const o=m[a.inputLayer1Index],S=m[a.inputLayer2Index];if(o===void 0)throw new Error(`Cannot create network from provided JSON. layer of index ${a.inputLayer1Index} not found.`);if(S===void 0)throw new Error(`Cannot create network from provided JSON. layer of index ${a.inputLayer2Index} not found.`);const _=n?(y=Kr(a,o,S))!==null&&y!==void 0?y:n(a,o,S):Kr(a,o,S);if(!_)throw new Error("unable to find layer");m.push(_)}}return new this({...t,layers:m})}toFunction(){throw new Error(`${this.constructor.name}-toFunction is not yet implemented`)}}function lh(g,t){if(!t)throw new TypeError(`Required parameter 'net' is of type ${typeof t}. Must be of type 'brain.NeuralNetwork'`);const n=t.run(g);let i=null,p=-1;return Object.entries(n).forEach(([d,y])=>{typeof y<"u"&&typeof y=="number"&&y>p&&(i=d,p=y)}),i}class ho extends nt{constructor(){super(...arguments),this.settings={},this.layer=null}setLayer(t){this.layer=t}get width(){if(!this.layer)throw new Error("layer not set");return this.layer.width}set width(t){throw new Error(`${this.constructor.name}-width is not yet implemented`)}get height(){if(!this.layer)throw new Error("layer not set");return this.layer.height}set height(t){throw new Error(`${this.constructor.name}-height is not yet implemented`)}get deltas(){if(!this.layer)throw new Error("layer not set");return this.layer.deltas}set deltas(t){if(!this.layer)throw new Error("layer not set");we(this.layer.deltas),this.layer.deltas=t}get weights(){if(!this.layer)throw new Error("layer not set");return this.layer.weights}set weights(t){if(!this.layer)throw new Error("layer not set");we(this.layer.weights),this.layer.weights=t}predict(){}compare(){}learn(){throw new Error("no longer using")}setupKernels(){}reuseKernels(){}}class po extends Ci{constructor(t={}){super(t),this.trainOpts={},this._outputConnection=null,this._layerSets=[],this._hiddenLayerOutputIndices=[],this._model=null}_connectLayers(){if(!this.options.inputLayer)throw new Error("inputLayer not found");if(!this.options.outputLayer)throw new Error("outputLayer not found");const t=this.options.inputLayer(),n=this._connectHiddenLayers(t),i=this.options.outputLayer(n[n.length-1],-1);return{inputLayer:t,hiddenLayers:n,outputLayer:i}}_connectLayersDeep(){const t=[],n=this._layerSets[this._layerSets.length-1];let i=0;function p(y){const v=n.indexOf(y);if(v<0)throw new Error("unable to find layer");return t[v]}function d(y){return{...y.settings,weights:null,deltas:null,praxis:null}}for(let y=0;y<n.length;y++){const v=n[y];let m;if(v instanceof zt)m=new v.constructor(p(v.inputLayer),d(v));else if(v instanceof Wn)m=new v.constructor(d(v));else if(v instanceof Vt)m=new v.constructor(d(v.inputLayer),p(v.inputLayer));else if(v instanceof nt){const l=n[this._hiddenLayerOutputIndices[i++]];if(v instanceof ho)throw new Error("unfinished");if(v instanceof Zi)m=new Zi(l);else if(v instanceof Qi)m=new Zi(l);else throw new Error(`hidden layer ${v.constructor.name} extends unknown hidden layer`)}else if(v instanceof Bn||v instanceof yn)m=v;else if(v instanceof rt)m=new v.constructor(p(v.inputLayer),d(v.inputLayer));else if(v instanceof Xe)m=new v.constructor(p(v.inputLayer1),p(v.inputLayer2),d(v));else if(v instanceof cn)m=new v.constructor(d(v),p(v.inputLayer));else throw new Error(`hidden layer ${v.constructor.name} extends unknown hidden layer`);t.push(m)}return t}_connectHiddenLayers(t){const n=[];if(!this.options.hiddenLayers)throw new Error("hiddenLayers not defined");for(let i=0;i<this.options.hiddenLayers.length;i++){const p=new Qi,d=this.options.hiddenLayers[i](t,p,i);t=d,n.push(d)}return n}initialize(){this._outputConnection=new ho;let t;if(this.options.layers)t=this._connectOptionsLayers();else{const{inputLayer:n,hiddenLayers:i,outputLayer:p}=this._connectLayers();t=sn([n,...i,p]),this._hiddenLayerOutputIndices=i.map(d=>t.indexOf(d)),this._inputLayer=n,this._hiddenLayers=i,this._outputLayer=p}this.layers=t,this._layerSets=[t],this._model=t.filter(n=>n instanceof yn||n instanceof Bn),this.initializeLayers(t)}initializeDeep(){const t=this._connectLayersDeep();for(let n=0;n<t.length;n++){const i=t[n];i.setupKernels(!0),i.reuseKernels(this._layerSets[0][n])}this._layerSets.push(t)}run(t){for(;this._layerSets.length<=t.length;)this.initializeDeep();const n=this.runInputs(t);return n instanceof Z.Texture?n.toArray():n}runInput(t){throw new Error("use .runInputs()")}runInputs(t){for(;this._layerSets.length<t.length;)this.initializeDeep();const n=t.length-1;for(let d=0;d<=n;d++){const y=this._layerSets[d];y[0].predict(t[d]);for(let v=1;v<y.length;v++)y[v].predict()}const i=this._layerSets[n],p=i[i.length-1].weights;return this.end(),p}train(t,n={}){const{preparedData:i,status:p,endTime:d}=this._prepTraining(t,n);let y=!0;const v=()=>this._calculateTrainingError(i),m=()=>this._trainPatterns(i);for(;y;)y=this._trainingTick(p,d,v,m);return p}end(){const t=this._layerSets.length-1,n=this._layerSets[t];n[0].predict([new Float32Array([0])]);for(let i=1;i<n.length;i++)n[i].predict()}transferData(t){return t}_prepTraining(t,n){this._updateTrainingOptions(n);const i=this.trainOpts.timeout?Date.now()+this.trainOpts.timeout:0,p={error:1,iterations:0};return this.verifyIsInitialized(),{preparedData:this.transferData(t),status:p,endTime:i}}_calculateTrainingError(t){if(!this.meanSquaredError)throw new Error("this.meanSquaredError not setup");let n=new Float32Array(1);for(let p=0;p<t.length;++p){const d=n,y=this._trainPattern(t[p],!0);n=this.meanSquaredError.add(n,y),we(y),we(d)}const i=this.meanSquaredError.divide(t.length,n);return we(n),i instanceof Z.Texture?i.toArray()[0]:i[0]}formatData(t){return t}_calculateDeltas(t){const n=this._layerSets[this._layerSets.length-1];for(let i=n.length-2;i>=0;i--)n[i].compare();for(let i=t.length-2;i>=0;i--){const p=this._layerSets[i];p[p.length-1].compare(t[i+1]);for(let d=p.length-2;d>=0;d--)p[d].compare()}}adjustWeights(){var t;const n=this._model;for(let i=0;i<n.length;i++)n[i].learn((t=this.options.learningRate)!==null&&t!==void 0?t:0)}_trainPatterns(t){for(let n=0;n<t.length;++n)this._trainPattern(t[n],!1)}_trainPattern(t,n){if(this.runInputs(t),this._calculateDeltas(t),this.adjustWeights(),n){if(!this.meanSquaredError)throw new Error("this.meanSquaredError not setup");let i=new Float32Array(1);for(let p=0,d=t.length-2;p<=d;p++){const y=this._layerSets[p],v=y[y.length-1],m=i;i=this.meanSquaredError.addAbsolute(m,v.errors),we(m)}return et(this.meanSquaredError.divide(t.length,i))}return null}}class At{constructor(t,n){this.rows=0,this.columns=0,t&&(this.rows=t),n&&(this.columns=n),this.weights=De(this.rows*this.columns),this.deltas=De(this.rows*this.columns)}getWeight(t,n){const i=this.columns*t+n;if(i<0||i>=this.weights.length)throw new Error("get accessor is skewed");return this.weights[i]}setWeight(t,n,i){const p=this.columns*t+n;if(p<0||p>=this.weights.length)throw new Error("set accessor is skewed");return this.weights[p]=i,this}getDelta(t,n){const i=this.columns*t+n;if(i<0||i>=this.deltas.length)throw new Error("get accessor is skewed");return this.deltas[i]}setDelta(t,n,i){const p=this.columns*t+n;if(p<0||p>=this.weights.length)throw new Error("set accessor is skewed");return this.deltas[p]=i,this}toJSON(){return{rows:this.rows,columns:this.columns,weights:Array.from(this.weights.slice(0))}}static fromJSON(t){const n=new At(t.rows,t.columns);for(let i=0,p=t.rows*t.columns;i<p;i++)n.weights[i]=t.weights[i];return n}static fromArray(t){const n=new At(t.length,t[0].length);return n.fromArray(t),n}deltasToArray(){return this.toArray("deltas")}weightsToArray(){return this.toArray("weights")}toArray(t="weights"){const n=new Array(this.rows);return this.iterate({row:i=>{n[i]=new Array(this.columns)},column:(i,p)=>{t==="weights"?n[i][p]=this.getWeight(i,p):t==="deltas"&&(n[i][p]=this.getDelta(i,p))}}),n}fromArray(t,n="weights"){if(t.length!==this.rows)throw new Error("rows do not match");if(t[0].length!==this.columns)throw new Error("columns do not match");return this.iterate({column:(i,p)=>{const d=t[i][p];if(typeof d!="number")throw new Error("value not number");n==="weights"?this.setWeight(i,p,d):n==="deltas"&&this.setDelta(i,p,d)}}),this}iterate(t){const n=this.rows,i=this.columns;for(let p=0;p<n;p++){t.row&&t.row(p);for(let d=0;d<i;d++)t.column&&t.column(p,d)}return this}}class mn extends At{constructor(t,n,i){super(t,n),this.std=i;for(let p=0,d=this.weights.length;p<d;p++)this.weights[p]=ae(-i,i)}}class xr{constructor(t,n=0){this.values=t,this.indexTable={},this.characterTable={},this.characters=[],this.specialIndexes=[],this.isSetup=!1,t!==void 0&&this.setup(t,n)}setup(t,n=0){if(this.isSetup)throw new Error("DataFormatter is already setup");this.values=t,this.buildCharactersFromIterable(t),this.buildTables(n),t[0].input&&this.addInputOutput(),this.addUnrecognized(),this.isSetup=!0}buildCharactersFromIterable(t){const n={};for(let i=0,p=t.length;i<p;i++){const d=t[i];if(d.hasOwnProperty("length")){const y=d;for(let v=0,m=y.length;v<m;v++){const l=y[v];n.hasOwnProperty(l)||(n[l]=!0,this.characters.push(l))}}else if(typeof d=="number"){if(n.hasOwnProperty(d))continue;n[d]=!0,this.characters.push(d)}else if(typeof d=="boolean"){const y=d.toString();if(n.hasOwnProperty(y))continue;n[y]=!0,this.characters.push(y)}else if(Array.isArray(d)&&typeof d[0]=="string")for(let y=0;y<d.length;y++){const v=d[y];n.hasOwnProperty(v)||(n[v]=!0,this.characters.push(v))}else if(Array.isArray(d)&&(typeof d[0]=="number"||typeof d[0]=="boolean"))for(let y=0;y<d.length;y++){const v=d[y].toString();n.hasOwnProperty(i)||(n[v]=!0,this.characters.push(v))}else if(d.hasOwnProperty("input")&&d.hasOwnProperty("output")){const{input:y,output:v}=d;Array.isArray(y)?this.addCharacters(y,n):this.addCharacters(y.toString(),n),Array.isArray(v)?this.addCharacters(v,n):this.addCharacters(v.toString(),n)}else throw new Error("Unhandled value")}}addCharacters(t,n){for(let i=0;i<t.length;i++){const p=t[i].toString();n.hasOwnProperty(p)||(n[p]=!0,this.characters.push(p))}}buildTables(t){const n=this.characters.length;for(let i=0;i<n;i++){const p=this.characters[i];i>=t&&(this.indexTable[p]=i,this.characterTable[i]=p)}}toIndexes(t,n=0){const i=[],{indexTable:p}=this;switch(typeof t){case"number":case"boolean":t=t.toString()}for(let d=0,y=t.length;d<y;d++){const v=t[d].toString();let m=p[v];if(m===void 0)if(p.unrecognized)m=p.unrecognized;else throw new Error(`unrecognized character "${v}"`);m<n||i.push(m)}return i}toIndexesInputOutput(t,n,i=0){const p=this.toIndexesValue(t,i,!0);return typeof n>"u"?p:p.concat(this.toIndexesValue(n,i,!1))}toIndexesValue(t,n,i){if(typeof t=="string")t=t.split("");else if(typeof t=="number"||typeof t=="boolean")t=t.toString().split("");else if(Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="boolean"||typeof t[0]=="string"))t=t.map(p=>p.toString());else throw new Error("unrecognized value");return i&&(t=t.concat(["stop-input","start-output"])),this.toIndexes(t,n)}toCharacters(t,n=0){const i=[],{indexTable:p,characterTable:d}=this;for(let y=0,v=t.length;y<v;y++){const m=t[y];if(m<n)continue;let l=d[m];if(l===void 0)if(p.unrecognized)l=d[p.unrecognized];else throw new Error(`unrecognized index "${m}"`);else l!==null&&i.push(l.toString())}return i}toString(t,n){return this.toCharacters(t,n).join("")}addInputOutput(){this.addSpecial("stop-input"),this.addSpecial("start-output")}addUnrecognized(){this.addSpecial("unrecognized")}static fromAllPrintable(t,n=[`
`]){for(let i=32;i<=126;i++)n.push(String.fromCharCode(i));return new xr(n,t)}static fromAllPrintableInputOutput(t,n=[`
`]){const i=xr.fromAllPrintable(t,n);return i.addInputOutput(),i.addUnrecognized(),i}static fromStringInputOutput(t,n){const i=Array.from(new Set(t)).join(""),p=new xr(i.split(""),n);return p.addInputOutput(),p.addUnrecognized(),p.isSetup=!0,p}static fromArrayInputOutput(t,n){const i=[];for(let y=0;y<t.length;y++){const v=t[y];i.push($i(v.input),$i(v.output))}const p=Array.isArray(i)?i.flat():i,d=new xr(Array.from(new Set(p)),n);return d.addInputOutput(),d.addUnrecognized(),d.isSetup=!0,d}static fromString(t,n=0){const i=Array.from(new Set(t)).join("");return new xr(i.split(""),n)}toJSON(){return{indexTable:this.indexTable,characterTable:this.characterTable,values:this.values,characters:this.characters,specialIndexes:this.specialIndexes}}static fromJSON(t){const n=new xr;return n.indexTable=t.indexTable,n.characterTable=t.characterTable,n.values=t.values,n.characters=t.characters,n.specialIndexes=t.specialIndexes,n.isSetup=!0,n}addSpecial(t,n=null){const i=this.indexTable[t]=this.characters.length;this.characterTable[i]=n,this.specialIndexes.push(this.characters.length),this.characters.push(t)}toFunctionString(){return`
var characterTable = ${JSON.stringify(this.characterTable)};
var indexTable = ${JSON.stringify(this.indexTable)};
var characters = ${JSON.stringify(this.characters)};
var dataFormatter = {
  toIndexes: function ${this.toIndexes.toString()},
  toIndexesInputOutput: function ${this.toIndexesInputOutput.toString()},
  toCharacters: function ${this.toCharacters.toString()},
  toIndexesValue: function ${this.toIndexesValue.toString()},
};`}formatDataIn(t,n){var i;return t===void 0?[]:Array.isArray(t)&&typeof t[0]=="number"?t:!((i=this.indexTable)===null||i===void 0)&&i.hasOwnProperty("stop-input")?this.toIndexesInputOutput(t,n):this.toIndexes(t)}formatDataOut(t,n){return this.toCharacters(n).join("")}format(t){if(typeof t[0]=="number"&&!Array.isArray(t[0])&&(!t[0].hasOwnProperty("input")||!t[0].hasOwnProperty("output")))return t;const n=[];if(typeof t[0]=="string"||typeof t[0]=="number"||Array.isArray(t[0]))if(this.isSetup)for(let i=0,p=t.length;i<p;i++)n.push(this.formatDataIn(t[i]));else{this.setup(t);for(let i=0;i<t.length;i++)n.push(this.formatDataIn($i(t[i])))}else if(t[0].input&&t[0].output){this.isSetup||this.setup(t);for(let i=0,p=t.length;i<p;i++)n.push(this.formatDataIn($i(t[i].input),$i(t[i].output)))}else throw new Error("unrecognized data");return n}}function $i(g){if(typeof g=="string")return g;if(typeof g=="number"||typeof g=="boolean")return g.toString();if(Array.isArray(g)&&typeof g[0]=="string")return g;if(typeof g[0]=="boolean")return g.map(t=>t.toString());if(typeof g[0]=="number")return g.map(t=>t.toString());throw new Error("unrecognized value, expected string[], string, number[], number, boolean[], or boolean")}function ch(g,t){g.rows=t.rows,g.columns=t.columns,g.weights=t.weights.slice(0),g.deltas=t.deltas.slice(0)}function hh(g,t,n){for(let i=0;i<t.weights.length;i++)g.weights[i]=t.weights[i]+n.weights[i],g.deltas[i]=0}function dh(g,t,n){for(let i=0;i<g.deltas.length;i++)t.deltas[i]=g.deltas[i],n.deltas[i]=g.deltas[i]}function ph(g){for(let t=0;t<g.weights.length;t++)g.weights[t]=1,g.deltas[t]=0}function fh(g,t){g.rows=t.rows,g.columns=t.columns,g.weights=t.weights.slice(0),g.deltas=t.deltas.slice(0);for(let n=0;n<t.weights.length;n++)g.weights[n]=-t.weights[n],g.deltas[n]=0}function mh(g,t,n){const i=t.rows,p=t.columns,d=n.columns;for(let y=0;y<i;y++){const v=p*y,m=d*y;for(let l=0;l<d;l++){let h=0;for(let a=0;a<p;a++){const o=d*a,S=v+a,_=o+l;h+=t.weights[S]*n.weights[_],t.deltas[S]=0,n.deltas[_]=0}g.weights[m+l]=h}}}function gh(g,t,n){const i=t.rows,p=t.columns,d=n.columns;for(let y=0;y<i;y++){const v=p*y,m=d*y;for(let l=0;l<d;l++)for(let h=0;h<p;h++){const a=d*h,o=v+h,S=a+l,_=g.deltas[m+l];t.deltas[o]+=n.weights[S]*_,n.deltas[S]+=t.weights[o]*_}}}function yh(g,t,n){const{weights:i}=t;for(let p=0;p<i.length;p++)g.weights[p]=t.weights[p]*n.weights[p],g.deltas[p]=0}function xh(g,t,n){for(let i=0;i<t.weights.length;i++)t.deltas[i]=n.weights[i]*g.deltas[i],n.deltas[i]=t.weights[i]*g.deltas[i]}function bh(g,t){for(let n=0;n<t.weights.length;n++)g.weights[n]=Math.max(0,t.weights[n]),g.deltas[n]=0}function vh(g,t){for(let n=0;n<g.deltas.length;n++)t.deltas[n]=t.weights[n]>0?g.deltas[n]:0}function wh(g,t,n){const{columns:i}=t,p=i*n;for(let d=0;d<i;d++)g.weights[d]=t.weights[p+d],g.deltas[d]=0}function Sh(g,t,n){const{columns:i}=t,p=i*n;for(let d=0;d<i;d++)t.deltas[p+d]=g.deltas[d]}function Th(g,t){for(let n=0;n<t.weights.length;n++)g.weights[n]=1/(1+Math.exp(-t.weights[n])),g.deltas[n]=0}function Eh(g,t){for(let n=0;n<g.deltas.length;n++){const i=g.weights[n];t.deltas[n]=i*(1-i)*g.deltas[n]}}function es(g){const t=new At(g.rows,g.columns);let n=-999999;for(let p=0;p<g.weights.length;p++)g.weights[p]>n&&(n=g.weights[p]);let i=0;for(let p=0;p<g.weights.length;p++)t.weights[p]=Math.exp(g.weights[p]-n),i+=t.weights[p];for(let p=0;p<g.weights.length;p++)t.weights[p]/=i;return t}function Ch(g,t){for(let n=0;n<t.weights.length;n++)g.weights[n]=Math.tanh(t.weights[n]),g.deltas[n]=0}function $h(g,t){for(let n=0;n<g.deltas.length;n++){const i=g.weights[n];t.deltas[n]=(1-i*i)*g.deltas[n]}}class fo{constructor(){this.states=[],this.inputRow=0}add(t,n){if(t.weights.length!==n.weights.length)throw new Error("misaligned matrices");const i=new At(t.rows,t.columns);return this.states.push({name:"add",product:i,left:t,right:n,forwardFn:hh,backpropagationFn:dh}),i}allOnes(t,n){const i=new At(t,n);return this.states.push({name:"allOnes",product:i,left:i,forwardFn:ph,backpropagationFn:()=>{}}),i}cloneNegative(t){const n=new At(t.rows,t.columns);return this.states.push({name:"cloneNegative",product:n,left:t,forwardFn:fh,backpropagationFn:()=>{}}),n}subtract(t,n){if(t.weights.length!==n.weights.length)throw new Error("misaligned matrices");return this.add(this.add(this.allOnes(t.rows,t.columns),this.cloneNegative(t)),n)}multiply(t,n){if(t.columns!==n.rows)throw new Error("misaligned matrices");const i=new At(t.rows,n.columns);return this.states.push({name:"multiply",product:i,left:t,right:n,forwardFn:mh,backpropagationFn:gh}),i}multiplyElement(t,n){if(t.weights.length!==n.weights.length)throw new Error("misaligned matrices");const i=new At(t.rows,t.columns);return this.states.push({name:"multiplyElement",product:i,left:t,right:n,forwardFn:yh,backpropagationFn:xh}),i}relu(t){const n=new At(t.rows,t.columns);return this.states.push({name:"relu",product:n,left:t,forwardFn:bh,backpropagationFn:vh}),n}input(t){return this.states.push({name:"input",product:t,forwardFn:n=>{if(this.inputValue){if(this.inputValue.length!==n.weights.length)throw new Error("this.inputValue is of wrong dimensions");n.weights=t.weights=this.inputValue}},backpropagationFn:()=>{}}),t}inputMatrixToRow(t){const n=this,i=new At(t.columns,1);return this.states.push({name:"inputMatrixToRow",product:i,left:t,get right(){return n.inputRow},forwardFn:wh,backpropagationFn:Sh}),i}sigmoid(t){const n=new At(t.rows,t.columns);return this.states.push({name:"sigmoid",product:n,left:t,forwardFn:Th,backpropagationFn:Eh}),n}tanh(t){const n=new At(t.rows,t.columns);return this.states.push({name:"tanh",product:n,left:t,forwardFn:Ch,backpropagationFn:$h}),n}observe(t){return this.states.push({name:"observe",product:new At,forwardFn:()=>{},backpropagationFn:()=>{}}),t}runIndex(t=0){this.inputRow=t;let n=this.states[0];for(let i=0,p=this.states.length;i<p;i++)n=this.states[i],n.hasOwnProperty("forwardFn")&&n.forwardFn(n.product,n.left,n.right);return n.product}runInput(t){this.inputValue=t;let n=this.states[0];for(let i=0,p=this.states.length;i<p;i++)n=this.states[i],n.hasOwnProperty("forwardFn")&&n.forwardFn(n.product,n.left,n.right);return n.product}backpropagate(){let t=this.states.length,n=this.states[0];for(;t-- >0;)n=this.states[t],n.hasOwnProperty("backpropagationFn")&&n.backpropagationFn(n.product,n.left,n.right);return n.product}backpropagateIndex(t=0){this.inputRow=t;let n=this.states.length,i=this.states[0];for(;n-- >0;)i=this.states[n],i.hasOwnProperty("backpropagationFn")&&i.backpropagationFn(i.product,i.left,i.right);return i.product}predictTarget(t,n){let i=0;const p=this.runInput(t);for(let d=0;d<p.weights.length;d++){const y=p.weights[d]-n[d];i+=Math.abs(y),p.deltas[d]=y}return i}predictTargetIndex(t,n){const i=this.runIndex(t),p=i,d=es(i);return p.deltas=d.weights.slice(0),p.deltas[n]-=1,-Math.log2(d.weights[n])}}function js(g){const{weights:t}=g;let n=t[0],i=0;for(let p=1;p<t.length;p++){const d=t[p];d<n||(i=p,n=d)}return i}function Ks(g){const t=ae(0,1),n=g.weights;let i=0,p=0;for(;;){if(i+=n[p],i>t)return p;p++}}const li={iterations:2e4,errorThresh:.005,log:!1,logPeriod:10,learningRate:.01,callbackPeriod:10,timeout:1/0},_i=()=>({inputSize:20,inputRange:20,hiddenLayers:[20,20],outputSize:20,decayRate:.999,smoothEps:1e-8,regc:1e-6,clipval:5,maxPredictionLength:100,dataFormatter:new xr});class Ii{constructor(t={}){this.options={..._i()},this.trainOpts={...li},this.stepCache={},this.runs=0,this.ratioClipped=0,this.model=Object.seal({isInitialized:!1,input:new At(0,0),hiddenLayers:[],output:new At(0,0),equations:[],allMatrices:[],equationConnections:[],outputConnector:new mn(0,0,.08)}),this.initialLayerInputs=[],this.options={...this.options,...t},this.updateTrainingOptions({...li}),t.json&&this.fromJSON(t.json)}initialize(){const{dataFormatter:t}=this.options;t!=null&&t.characters.length&&(this.options.inputSize=this.options.inputRange=this.options.outputSize=t.characters.length),this.model=this.mapModel()}createHiddenLayers(){const{hiddenLayers:t,inputSize:n}=this.options,i=[];i.push(this.getHiddenLayer(t[0],n));let p=t[0];for(let d=1;d<t.length;d++){const y=t[d];i.push(this.getHiddenLayer(y,p)),p=y}return i}getHiddenLayer(t,n){return{weight:new mn(t,n,.08),transition:new mn(t,t,.08),bias:new At(t,1)}}getEquation(t,n,i,p){if(!p.weight||!p.transition||!p.bias)throw new Error("hiddenLayer does not have expected properties");const d=t.relu.bind(t),y=t.add.bind(t),v=t.multiply.bind(t);return d(y(y(v(p.weight,n),v(p.transition,i)),p.bias))}createInputMatrix(){const{inputRange:t,inputSize:n}=this.options;if(t<1)throw new Error("this.options.inputRange not an expected number");if(n<1)throw new Error("this.options.inputSize not an expected number");return new mn(t+1,n,.08)}createOutputMatrices(){const{outputSize:t,hiddenLayers:n}=this.options,i=Bs(n);return{outputConnector:new mn(t+1,i,.08),output:new At(t+1,1)}}bindEquation(){const{model:t}=this,{hiddenLayers:n}=this.options,i=new fo,p=[],d=t.equationConnections.length>0?Bs(t.equationConnections):this.initialLayerInputs;let y=this.getEquation(i,i.inputMatrixToRow(t.input),d[0],t.hiddenLayers[0]);p.push(y);for(let v=1,m=n.length;v<m;v++){if(!d[v])throw new Error(`Cannot find equation at index ${v}`);y=this.getEquation(i,y,d[v],t.hiddenLayers[v]),p.push(y)}t.equationConnections.push(p),i.add(i.multiply(t.outputConnector,y),t.output),t.equations.push(i)}mapModel(){const t=[];this.initialLayerInputs=this.options.hiddenLayers.map(y=>new At(y,1));const n=this.createInputMatrix();t.push(n);const i=this.createHiddenLayers();if(!i.length)throw new Error("net.hiddenLayers not set");for(let y=0,v=i.length;y<v;y++){const m=i[y];for(const l in m)m.hasOwnProperty(l)&&t.push(m[l])}const{output:p,outputConnector:d}=this.createOutputMatrices();return t.push(d),t.push(p),Object.seal({isInitialized:!0,input:n,hiddenLayers:i,output:p,equations:[],allMatrices:t,equationConnections:[],outputConnector:d})}trainInput(t){this.runs++;const{model:n}=this,i=t.length;let p=0,d;for(;n.equations.length<=t.length+1;)this.bindEquation();for(let y=-1,v=t.length;y<v;y++){const m=y+1;d=n.equations[m];const l=y===-1?0:t[y]+1,h=y===i-1?0:t[y+1]+1;p+=d.predictTargetIndex(l,h)}return Math.pow(2,p/(i-1))/100}backpropagate(t){let n=t.length;const{model:i}=this,{equations:p}=i;for(;n>0;)p[n].backpropagateIndex(t[n-1]+1),n--;p[0].backpropagateIndex(0)}adjustWeights(){const{regc:t,clipval:n,decayRate:i,smoothEps:p}=this.options,{trainOpts:d,model:y,stepCache:v}=this,{learningRate:m}=d,{allMatrices:l}=y;let h=0,a=0;for(let o=0;o<l.length;o++){const S=l[o],{weights:_,deltas:P}=S;o in v||(v[o]=De(S.rows*S.columns));const I=v[o];for(let k=0;k<_.length;k++){let T=P[k];const L=_[k];I[k]=I[k]*i+(1-i)*T*T,T>n?(T=n,h++):T<-n&&(T=-n,h++),a++,_[k]=L+-m*T/Math.sqrt(I[k]+p)-t*L}}this.ratioClipped=h/a}get isRunnable(){return this.model&&this.model.equations.length===0?(console.error("No equations bound, did you run train()?"),!1):!0}checkRunnable(){if(!this.isRunnable)throw new Error("Network not runnable")}run(t=[],n=!1,i=1){const p=this.options.maxPredictionLength+(t!==null?t.length:0)+(this.options.dataFormatter?this.options.dataFormatter.specialIndexes.length:0);this.checkRunnable();const d=this.options.dataFormatter&&t.length>0?this.options.dataFormatter.formatDataIn(t):t,{model:y}=this,v=[];let m=0;for(;;){const l=m===0?0:m<d.length?d[m-1]+1:v[m-1];for(;y.equations.length<=m;)this.bindEquation();const a=y.equations[m].runIndex(l),o=new At(y.output.rows,y.output.columns);if(ch(o,a),i!==1&&n)for(let P=0,I=o.weights.length;P<I;P++)o.weights[P]/=i;const S=es(o),_=n?Ks(S):js(S);if(m++,_===0||m>=p)break;v.push(_)}return this.options.dataFormatter.formatDataOut(d,v.slice(d.length).map(l=>l-1))}verifyIsInitialized(){this.model.isInitialized||this.initialize()}updateTrainingOptions(t){var n;this.trainOpts={...li,...t},this.validateTrainingOptions(this.trainOpts),this.setLogMethod((n=t.log)!==null&&n!==void 0?n:this.trainOpts.log)}validateTrainingOptions(t){const n={iterations:()=>{const i=t.iterations;return typeof i=="number"&&i>0},errorThresh:()=>{const i=t.errorThresh;return typeof i=="number"&&i>0&&i<1},log:()=>{const i=t.log;return typeof i=="function"||typeof i=="boolean"},logPeriod:()=>{const i=t.logPeriod;return typeof i=="number"&&i>0},learningRate:()=>{const i=t.learningRate;return typeof i=="number"&&i>0&&i<1},callback:()=>{const i=t.callback;return typeof i=="function"||i===void 0},callbackPeriod:()=>{const i=t.callbackPeriod;return typeof i=="number"&&i>0},timeout:()=>{const i=t.timeout;return typeof i=="number"&&i>0}};for(const i in n){const p=t;if(!n[i]())throw new Error(`[${i}, ${p[i]}] is out of normal training range, your network will probably not train.`)}}setLogMethod(t){typeof t=="function"?this.trainOpts.log=t:t?this.trainOpts.log=console.log:this.trainOpts.log=!1}prepTraining(t,n){var i;this.updateTrainingOptions(n);const p=this.options.dataFormatter.format(t),d=Date.now()+((i=this.trainOpts.timeout)!==null&&i!==void 0?i:0),y={error:1,iterations:0};return this.verifyIsInitialized(),{preparedData:p,status:y,endTime:d}}train(t,n={}){var i;this.trainOpts=n={...li,...n};const{iterations:p,errorThresh:d,logPeriod:y,callback:v,callbackPeriod:m}=this.trainOpts,l=n.log===!0?console.log:n.log;let h=1/0,a,o;if(!((i=this.options)===null||i===void 0)&&i.dataFormatter)o=this.options.dataFormatter.format(t);else if(Array.isArray(t)&&Array.isArray(t[0])&&typeof t[0][0]=="number")o=t;else throw new Error("training not in expected format of number[][]");for(this.verifyIsInitialized(),a=0;a<p&&h>d;a++){let S=0;for(let _=0;_<o.length;_++){const P=this.trainPattern(o[_],!0);S+=P}if(h=S/t.length,isNaN(h))throw new Error("Network error rate is unexpected NaN, check network configurations and try again. Most probably input format is not correct or training data is not enough. ");l&&a%y===0&&l(`iterations: ${a}, training error: ${h}`),v&&a%m===0&&v({error:h,iterations:a})}return{error:h,iterations:a}}addFormat(t){}formatData(t){const n=[];for(let i=0;i<t.length;i++)n.push(this.options.dataFormatter.formatDataIn(t[i]));return n}toJSON(){this.model.isInitialized||this.initialize();const{model:t,options:n}=this;return{type:this.constructor.name,options:{...n,dataFormatter:n.dataFormatter.toJSON()},trainOpts:{...this.trainOpts,timeout:this.trainOpts.timeout===1/0?"Infinity":this.trainOpts.timeout},input:t.input.toJSON(),hiddenLayers:t.hiddenLayers.map(i=>{const p={};for(const d in i)i.hasOwnProperty(d)&&(p[d]=i[d].toJSON());return p}),outputConnector:this.model.outputConnector.toJSON(),output:this.model.output.toJSON()}}fromJSON(t){const{options:n}=t,i=[],p=At.fromJSON(t.input);i.push(p);const d=[];t.hiddenLayers.forEach(m=>{const l={};for(const h in m)l[h]=At.fromJSON(m[h]),i.push(l[h]);d.push(l)});const y=At.fromJSON(t.outputConnector);i.push(y);const v=At.fromJSON(t.output);return i.push(v),n.dataFormatter?this.options={..._i(),...n,dataFormatter:xr.fromJSON(n.dataFormatter)}:this.options={..._i(),...n,dataFormatter:new xr},this.model=Object.seal({isInitialized:!0,input:p,hiddenLayers:d,output:v,allMatrices:i,outputConnector:y,equations:[],equationConnections:[]}),this.initialLayerInputs=this.options.hiddenLayers.map(m=>new At(m,1)),this.bindEquation(),this}toFunction(t){const{model:n}=this,{equations:i}=this.model,p=i[1],{states:d}=p,y=JSON.stringify(this.toJSON());function v(I){const k=n.equationConnections[0],{states:T}=i[0];for(let L=0,D=T.length;L<D;L++)if(T[L].product===I)return L;return k.indexOf(I)}function m(I,k){for(let T=0,L=d.length;T<L;T++){const D=d[T];if(T===k){const z=v(I);return z>-1&&(I===D.left||I===D.right)?`typeof prevStates[${z}] === 'object' ? prevStates[${z}].product : new Matrix(${I.rows}, ${I.columns})`:`new Matrix(${I.rows}, ${I.columns})`}if(I===D.product)return`states[${T}].product`;if(I===D.right)return`states[${T}].right`;if(I===D.left)return`states[${T}].left`}return""}function l(I,k){if(!I||!I.rows||!I.columns)return"null";if(I===n.input)return"json.input";if(I===n.outputConnector)return"json.outputConnector";if(I===n.output)return"json.output";for(let T=0,L=n.hiddenLayers.length;T<L;T++){const D=n.hiddenLayers[T];for(const z in D)if(D.hasOwnProperty(z)&&D[z]===I)return`json.hiddenLayers[${T}].${z}`}return m(I,k)}function h(I){const k=I.toString().split("{");k.shift();const L=k.join("{").split("}");return L.pop(),L.join("}").split(`
`).join(`
        `).replace("product.deltas[i] = 0;","").replace("product.deltas[column] = 0;","").replace("left.deltas[leftIndex] = 0;","").replace("right.deltas[rightIndex] = 0;","").replace("product.deltas = left.deltas.slice(0);","")}function a(I){return`src/recurrent/matrix/${I.replace(/[A-Z]/g,function(k){return`-${k.toLowerCase()}`})}.js`}const o=[],S={},_=[];for(let I=0,k=d.length;I<k;I++){const T=d[I];o.push(`states[${I}] = {
      name: '${T.forwardFn.name}',
      left: ${T.left?l(T.left,I):"undefined"},
      right: ${T.right?l(T.right,I):"undefined"},
      product: ${l(T.product,I)}
    }`);const L=T.forwardFn.name;S[L]||(S[L]=!0,_.push(`        case '${L}': //compiled from ${a(L)}
          ${h(T.forwardFn.toString())}
          break;`))}const P=`
  if (typeof rawInput === 'undefined') rawInput = [];
  if (typeof isSampleI === 'undefined') isSampleI = false;
  if (typeof temperature === 'undefined') temperature = 1;
  var json = ${y};
  ${this.options.dataFormatter?`${this.options.dataFormatter.toFunctionString()};
  Object.assign(dataFormatter, json.options.dataFormatter);`:""}
  ${this.options.dataFormatter&&typeof this.options.dataFormatter.formatDataIn=="function"?`const formatDataIn = function (input, output) { ${h(this.options.dataFormatter.formatDataIn.toString())} }.bind(dataFormatter);`:""}
  ${this.options.dataFormatter!==null&&typeof this.options.dataFormatter.formatDataOut=="function"?`const formatDataOut = function formatDataOut(input, output) { ${h(this.options.dataFormatter.formatDataOut.toString())} }.bind(dataFormatter);`:""}
  var maxPredictionLength =
    ${this.options.maxPredictionLength} +
    rawInput.length +
    ${this.options.dataFormatter?this.options.dataFormatter.specialIndexes.length:0};
  var input = ${this.options.dataFormatter&&typeof this.options.dataFormatter.formatDataIn=="function"?"formatDataIn(rawInput)":"rawInput"};
  var _i = 0;
  var output = [];
  var states = [];
  var prevStates;
  while (true) {
    var previousIndex = (_i === 0
        ? 0
        : _i < input.length
          ? input[_i - 1] + 1
          : output[_i - 1])
          ;
    var rowPluckIndex = previousIndex;
    prevStates = states;
    states = [];
    ${o.join(`;
    `)};
    for (var stateIndex = 0, stateMax = ${o.length}; stateIndex < stateMax; stateIndex++) {
      var state = states[stateIndex];
      var product = state.product;
      var left = state.left;
      var right = state.right;
      switch (state.name) {
${_.join(`
`)}
      }
    }

    var logProbabilities = state.product;
    if (temperature !== 1 && isSampleI) {
      for (var q = 0, nq = logProbabilities.weights.length; q < nq; q++) {
        logProbabilities.weights[q] /= temperature;
      }
    }

    var probs = softmax(logProbabilities);
    var nextIndex = isSampleI ? sampleI(probs) : maxI(probs);

    _i++;
    if (nextIndex === 0) {
      break;
    }
    if (_i >= maxPredictionLength) {
      break;
    }

    output.push(nextIndex);
  }
  ${this.options.dataFormatter&&typeof this.options.dataFormatter.formatDataOut=="function"?"return formatDataOut(input, output.slice(input.length).map(function(value) { return value - 1; }))":"return output.slice(input.length).map(function(value) { return value - 1; })"};
  function Matrix(rows, columns) {
    this.rows = rows;
    this.columns = columns;
    this.weights = zeros(rows * columns);
  }
  ${De.toString()}
  ${es.toString().replace("_1.Matrix","Matrix")}
  ${ae.toString()}
  ${Ks.toString()}
  ${js.toString()}`;return new Function("rawInput","isSampleI","temperature",t?t(P):P)}trainPattern(t,n){const i=this.trainInput(t);return this.backpropagate(t),this.adjustWeights(),n?i:0}}function Bs(g){return g[g.length-1]}class mo extends Ii{getHiddenLayer(t,n){return go(t,n)}getEquation(t,n,i,p){return yo(t,n,i,p)}}function go(g,t){return{updateGateInputMatrix:new mn(g,t,.08),updateGateHiddenMatrix:new mn(g,g,.08),updateGateBias:new At(g,1),resetGateInputMatrix:new mn(g,t,.08),resetGateHiddenMatrix:new mn(g,g,.08),resetGateBias:new At(g,1),cellWriteInputMatrix:new mn(g,t,.08),cellWriteHiddenMatrix:new mn(g,g,.08),cellWriteBias:new At(g,1)}}function yo(g,t,n,i){if(!i.updateGateInputMatrix||!i.updateGateHiddenMatrix||!i.updateGateBias||!i.resetGateInputMatrix||!i.resetGateHiddenMatrix||!i.resetGateBias||!i.cellWriteInputMatrix||!i.cellWriteHiddenMatrix||!i.cellWriteBias)throw new Error("hiddenLayer does not have expected properties");const p=g.sigmoid.bind(g),d=g.add.bind(g),y=g.multiply.bind(g),v=g.multiplyElement.bind(g),m=g.tanh.bind(g),l=g.allOnes.bind(g),h=g.cloneNegative.bind(g),a=p(d(d(y(i.updateGateInputMatrix,t),y(i.updateGateHiddenMatrix,n)),i.updateGateBias)),o=p(d(d(y(i.resetGateInputMatrix,t),y(i.resetGateHiddenMatrix,n)),i.resetGateBias)),S=m(d(d(y(i.cellWriteInputMatrix,t),y(i.cellWriteHiddenMatrix,v(o,n))),i.cellWriteBias));return d(v(d(l(a.rows,a.columns),h(a)),S),v(n,a))}class xo{constructor(t,n){this.prop=n,this.length=0,this.table={};for(let i=0;i<t.length;i++){const d=t[i][n];for(let y=0;y<d.length;y++){const v=d[y];for(const m in v)v.hasOwnProperty(m)&&(this.table.hasOwnProperty(m)||(this.table[m]=this.length++))}}}}const bo=()=>({..._i(),inputSize:1,hiddenLayers:[20],outputSize:1,inputRange:0});class ts extends Ii{constructor(t={}){super(),this.inputLookupLength=0,this.inputLookup=null,this.outputLookup=null,this.outputLookupLength=0,this.model=Object.seal({isInitialized:!1,hiddenLayers:[],output:new At(0,0),equations:[],allMatrices:[],equationConnections:[],outputConnector:new mn(0,0,.08)}),this.options=bo(),this.options={...this.options,...t},this.updateTrainingOptions({..._h,...t}),t.json&&this.fromJSON(t.json)}createInputMatrix(){throw new Error("Input Matrices do not exist on RNNTimeStep")}createOutputMatrices(){const{outputSize:t}=this.options,n=Bs(this.options.hiddenLayers),i=new mn(t,n,.08);return{output:new mn(t,1,.08),outputConnector:i}}bindEquation(){const{model:t,options:n}=this,{hiddenLayers:i,inputSize:p}=n,d=t.hiddenLayers,y=new fo,v=[],m=t.equationConnections.length>0?t.equationConnections[t.equationConnections.length-1]:this.initialLayerInputs;let l=this.getEquation(y,y.input(new At(p,1)),m[0],d[0]);v.push(l);for(let h=1,a=i.length;h<a;h++)l=this.getEquation(y,l,m[h],d[h]),v.push(l);t.equationConnections.push(v),y.add(y.multiply(t.outputConnector,l),t.output),t.equations.push(y)}initialize(){this.model=this.mapModel()}mapModel(){const t=[];this.initialLayerInputs=this.options.hiddenLayers.map(d=>new At(d,1));const n=this.createHiddenLayers();for(let d=0,y=n.length;d<y;d++){const v=n[d];for(const m in v)v.hasOwnProperty(m)&&t.push(v[m])}const{outputConnector:i,output:p}=this.createOutputMatrices();return t.push(i),t.push(p),Object.seal({isInitialized:!0,hiddenLayers:n,output:p,equations:[],allMatrices:t,equationConnections:[],outputConnector:i})}backpropagate(){for(let t=this.model.equations.length-1;t>-1;t--)this.model.equations[t].backpropagate()}run(t){const n=X.dataShape(t).join(",");switch(n){case"array,number":return this.runArray(t);case"array,array,number":return this.runArrayOfArray(t);case"object,number":return this.runObject(t);case"array,object,number":return this.runArrayOfObject(t);default:throw new Error(`Unrecognized data shape ${n}`)}}forecast(t,n=1){const i=X.dataShape(t).join(",");switch(i){case"array,number":return this.forecastArray(t,n);case"array,array,number":return this.forecastArrayOfArray(t,n);case"object,number":return this.runObject(t);case"array,object,number":return this.forecastArrayOfObject(t,n);default:throw new Error(`Unrecognized data shape ${i}`)}}forecastArray(t,n=1){this.checkRunnable();const{model:i}=this,{equations:p}=i,d=t.length+n;for(;p.length<=d;)this.bindEquation();let y,v=0;if(this.options.inputSize===1)for(let l=0;l<t.length;l++)y=p[v++].runInput(Float32Array.from([t[l]]));else for(let l=0;l<t.length;l++)y=p[v++].runInput(Float32Array.from([]));if(!y)throw new Error("lastOutput not set");const m=[y.weights[0]];for(let l=0,h=n-1;l<h;l++)y=p[v++].runInput(y.weights),m.push(y.weights[0]);return this.end(),Float32Array.from(m)}forecastArrayOfArray(t,n=1){this.checkRunnable();const{model:i}=this,{equations:p}=i,d=t.length+n;for(;p.length<=d;)this.bindEquation();let y,v=0;for(let l=0;l<t.length;l++)y=p[v++].runInput(t[l]);if(!y)throw new Error("lastOutput not set");const m=[Float32Array.from(y.weights)];for(let l=0,h=n-1;l<h;l++)y=p[v++].runInput(y.weights),m.push(Float32Array.from(y.weights.slice(0)));return this.end(),m}forecastArrayOfObject(t,n=1){if(!this.inputLookup)throw new Error("this.inputLookup not set");if(!this.outputLookup)throw new Error("this.outputLookup not set");const i=t.map(p=>X.toArray(this.inputLookup,p,this.inputLookupLength));return this.forecastArrayOfArray(i,n).map(p=>X.toObject(this.outputLookup,p))}train(t,n={}){this.trainOpts=n={...li,...n},this.options.inputSize===1&&this.options.outputSize===1&&this.setSize(t),this.verifySize();const i=this.formatData(t);let p=1/0,d;this.verifyIsInitialized();const{iterations:y,errorThresh:v,logPeriod:m,callback:l,callbackPeriod:h}=this.trainOpts,a=n.log===!0?console.log:n.log;for(d=0;d<y&&p>v;d++){let o=0;for(let S=0;S<i.length;S++){const _=this.trainPattern(i[S],!0);o+=_}if(p=o/i.length,isNaN(p))throw new Error("Network error rate is unexpected NaN, check network configurations and try again. Most probably input format is not correct or training data is not enough. ");a&&d%m===0&&a(`iterations: ${d}, training error: ${p}`),l&&d%h===0&&l({error:p,iterations:d})}return{error:p,iterations:d}}trainArrayOfArray(t){if(t.length<2)throw new Error("input must be an array of 2 or more");const{equations:n}=this.model;for(;n.length<t.length;)this.bindEquation();let i=0;for(let p=0,d=t.length-1;p<d;p++)i+=n[p].predictTarget(t[p],t[p+1]);return this.end(),i/t.length}trainPattern(t,n){const i=this.trainArrayOfArray(t);return this.backpropagate(),this.adjustWeights(),n?i:0}setSize(t){let n=0;switch(X.dataShape(t).join(",")){case"array,array,number":case"array,object,number":case"array,datum,array,number":case"array,datum,object,number":n=1;break;case"array,array,array,number":n=t[0][0].length;break;case"array,array,object,number":n=Object.keys(X.toTable2D(t)).length;break;case"array,datum,array,array,number":n=t[0].input[0].length;break;case"array,datum,array,object,number":n=Object.keys(X.toInputTable2D(t)).length;break;default:throw new Error("unknown data shape or configuration")}this.options=Object.seal({...this.options,inputSize:n,outputSize:n})}verifySize(){if((this.options.inputSize||this.options.outputSize)&&this.options.inputSize!==this.options.outputSize)throw new Error("manually set inputSize and outputSize mismatch")}runArray(t){this.checkRunnable();const{equations:n}=this.model;for(;n.length<=t.length;)this.bindEquation();let i;for(let p=0;p<t.length;p++)i=n[p].runInput(new Float32Array([t[p]]));return this.end(),i.weights[0]}runArrayOfArray(t){this.checkRunnable();const{model:n}=this,{equations:i}=n;for(;i.length<=t.length;)this.bindEquation();let p;for(let d=0;d<t.length;d++)p=i[d].runInput(t[d]).weights;return this.end(),p??Float32Array.from([])}runObject(t){if(!this.inputLookup)throw new Error("this.inputLookup not set");if(!this.outputLookup)throw new Error("this.outputLookup not set");if(!this.outputLookupLength)throw new Error("this.outputLookupLength not set");if(this.inputLookup===this.outputLookup){const n=X.toArrayShort(this.inputLookup,t);return X.toObjectPartial(this.outputLookup,this.forecastArray(n,this.outputLookupLength-n.length),n.length)}return X.toObject(this.outputLookup,this.forecastArray(X.toArray(this.inputLookup,t,this.inputLookupLength),this.outputLookupLength))}runArrayOfObject(t){if(this.inputLookup===null)throw new Error("this.inputLookup not set");if(this.outputLookup===null)throw new Error("this.outputLookup not set");const n=t.map(i=>X.toArray(this.inputLookup,i,this.inputLookupLength));return this.forecastArrayOfArray(n,1).map(i=>X.toObject(this.outputLookup,i))[0]}runArrayOfObjectOfArray(t){if(!this.inputLookup)throw new Error("this.inputLookup not set");if(!this.outputLookup)throw new Error("this.outputLookup not set");return X.toObject(this.outputLookup,this.runArrayOfArray(X.toArrays(this.inputLookup,t,this.inputLookupLength)))}end(){this.model.equations[this.model.equations.length-1].runInput(new Float32Array(this.options.outputSize))}requireInputOutputOfOne(){if(this.options.inputSize!==1)throw new Error("inputSize must be 1 for this data size");if(this.options.outputSize!==1)throw new Error("outputSize must be 1 for this data size")}formatArray(t){const n=[];this.requireInputOutputOfOne();for(let i=0;i<t.length;i++)n.push(Float32Array.from([t[i]]));return[n]}formatArrayOfArray(t){const n=[],{inputSize:i,outputSize:p}=this.options;if(i===1&&p===1){for(let d=0;d<t.length;d++)n.push(se(t[d]));return n}if(i!==t[0].length)throw new Error("inputSize must match data input size");if(p!==t[0].length)throw new Error("outputSize must match data output size");for(let d=0;d<t.length;d++)n.push(Float32Array.from(t[d]));return[n]}formatArrayOfObject(t){if(this.requireInputOutputOfOne(),!this.inputLookup){const i=new Ee(t);this.inputLookup=this.outputLookup=i.table,this.inputLookupLength=this.outputLookupLength=i.length}const n=[];for(let i=0;i<t.length;i++)n.push(ve(t[i]));return n}formatArrayOfObjectMulti(t){if(!this.inputLookup){const i=new Ee(t);this.inputLookup=this.outputLookup=i.table,this.inputLookupLength=this.outputLookupLength=i.length}const n=[];for(let i=0;i<t.length;i++)n.push([me(t[i],this.inputLookup,this.inputLookupLength)]);return n}formatArrayOfDatumOfArray(t){const n=[];this.requireInputOutputOfOne();for(let i=0;i<t.length;i++){const p=t[i];n.push(le(p.input,p.output))}return n}formatArrayOfDatumOfObject(t){if(this.requireInputOutputOfOne(),!this.inputLookup){const i=new Ee(t,"input");this.inputLookup=i.table,this.inputLookupLength=i.length}if(!this.outputLookup){const i=new Ee(t,"output");this.outputLookup=i.table,this.outputLookupLength=i.length}const n=[];for(let i=0;i<t.length;i++){const p=t[i];n.push(de(p.input,p.output))}return n}formatArrayOfArrayOfArray(t){const n=[];for(let i=0;i<t.length;i++)n.push(Q(t[i]));return n}formatArrayOfArrayOfObject(t){if(!this.inputLookup){const i=new Ee(t);this.inputLookup=this.outputLookup=i.table,this.inputLookupLength=this.outputLookupLength=i.length}const n=[];for(let i=0;i<t.length;i++){const p=[];for(let d=0;d<t[i].length;d++)p.push(me(t[i][d],this.inputLookup,this.inputLookupLength));n.push(p)}return n}formatArrayOfDatumOfArrayOfArray(t){const n=[],{inputSize:i,outputSize:p}=this.options;if(i!==t[0].input[0].length)throw new Error("inputSize must match data input size");if(p!==t[0].output[0].length)throw new Error("outputSize must match data output size");for(let d=0;d<t.length;d++){const y=t[d];n.push(te(y.input,y.output))}return n}formatArrayOfDatumOfArrayOfObject(t){if(!this.inputLookup){const i=new xo(t,"input");this.inputLookup=i.table,this.inputLookupLength=i.length}if(!this.outputLookup){const i=new xo(t,"output");this.outputLookup=i.table,this.outputLookupLength=i.length}if(!this.outputLookupLength)throw new Error("this.outputLookupLength not set to usable number");const n=[];for(let i=0;i<t.length;i++){const p=t[i];n.push(pe(p.input,p.output,this.inputLookup,this.outputLookup,this.inputLookupLength,this.outputLookupLength))}return n}formatData(t){switch(X.dataShape(t).join(",")){case"array,number":return this.formatArray(t);case"array,array,number":return this.formatArrayOfArray(t);case"array,object,number":return this.options.inputSize===1?this.formatArrayOfObject(t):this.formatArrayOfObjectMulti(t);case"array,datum,array,number":return this.formatArrayOfDatumOfArray(t);case"array,datum,object,number":return this.formatArrayOfDatumOfObject(t);case"array,array,array,number":return this.formatArrayOfArrayOfArray(t);case"array,array,object,number":return this.formatArrayOfArrayOfObject(t);case"array,datum,array,array,number":return this.formatArrayOfDatumOfArrayOfArray(t);case"array,datum,array,object,number":return this.formatArrayOfDatumOfArrayOfObject(t);default:throw new Error("unknown data shape or configuration")}}test(t){const n=[];let i=0;const p=this.formatData(t);for(let d=0;d<p.length;d++){const y=p[d],v=this.run(y.splice(0,y.length-1)),m=y[y.length-1];let l=0,h=0;for(let o=0;o<v.length;o++){h++;const S=m[o]-v[o];l+=S*S}if(i+=l/h,Math.abs(l)>this.trainOpts.errorThresh){const o=t[d];n.push({value:o,actual:v})}}return{error:i/p.length,misclasses:n,total:p.length}}addFormat(t){var n,i,p,d,y,v;switch(X.dataShape(t).join(",")){case"array,array,number":case"datum,array,array,number":case"array,number":case"datum,array,number":return;case"datum,object,number":{this.inputLookup=X.addKeys(t.input,(n=this.inputLookup)!==null&&n!==void 0?n:{}),this.inputLookup&&(this.inputLookupLength=Object.keys(this.inputLookup).length),this.outputLookup=X.addKeys(t.output,(i=this.outputLookup)!==null&&i!==void 0?i:{}),this.outputLookup&&(this.outputLookupLength=Object.keys(this.outputLookup).length);break}case"object,number":{this.inputLookup=this.outputLookup=X.addKeys(t,(p=this.inputLookup)!==null&&p!==void 0?p:{}),this.inputLookup&&(this.inputLookupLength=this.outputLookupLength=Object.keys(this.inputLookup).length);break}case"array,object,number":{const l=t;for(let h=0;h<l.length;h++)this.inputLookup=this.outputLookup=X.addKeys(l[h],(d=this.inputLookup)!==null&&d!==void 0?d:{}),this.inputLookup&&(this.inputLookupLength=this.outputLookupLength=Object.keys(this.inputLookup).length);break}case"datum,array,object,number":{const l=t,h=l.input;for(let o=0;o<h.length;o++)this.inputLookup=X.addKeys(h[o],(y=this.inputLookup)!==null&&y!==void 0?y:{}),this.inputLookup&&(this.inputLookupLength=Object.keys(this.inputLookup).length);const a=l.output;for(let o=0;o<a.length;o++)this.outputLookup=X.addKeys(a[o],(v=this.outputLookup)!==null&&v!==void 0?v:{}),this.outputLookup&&(this.outputLookupLength=Object.keys(this.outputLookup).length);break}default:throw new Error("unknown data shape or configuration")}}toJSON(){this.model||this.initialize();const{model:t}=this,n={...this.options,..._i};return{type:this.constructor.name,options:n,hiddenLayers:t.hiddenLayers.map(i=>{const p={};for(const d in i)i.hasOwnProperty(d)&&(p[d]=i[d].toJSON());return p}),outputConnector:t.outputConnector.toJSON(),output:t.output.toJSON(),inputLookup:this.inputLookup,inputLookupLength:this.inputLookupLength,outputLookup:this.outputLookup,outputLookupLength:this.outputLookupLength}}fromJSON(t){const{options:n}=t,i=[],p=[];t.hiddenLayers.forEach(v=>{const m={};for(const l in v)m[l]=At.fromJSON(v[l]),i.push(m[l]);p.push(m)});const d=At.fromJSON(t.outputConnector);i.push(d);const y=At.fromJSON(t.output);return i.push(y),this.options={...bo(),...n},this.inputLookup=t.inputLookup,this.inputLookupLength=t.inputLookupLength,this.outputLookup=t.outputLookup,this.outputLookupLength=t.outputLookupLength,this.model=Object.seal({isInitialized:!0,hiddenLayers:p,output:y,allMatrices:i,outputConnector:d,equations:[],equationConnections:[]}),this.initialLayerInputs=n.hiddenLayers.map(v=>new At(v,1)),this.bindEquation(),this}toFunction(t){const{model:n,inputLookup:i,inputLookupLength:p,outputLookup:d,outputLookupLength:y}=this,{inputSize:v}=this.options,{equations:m}=n,l=m[1],{states:h}=l,a=JSON.stringify(this.toJSON());function o($){const w=n.equationConnections[0],{states:V}=m[0];for(let K=0,fe=V.length;K<fe;K++)if(V[K].product===$)return K;return w.indexOf($)}function S($,w){for(let V=0,K=h.length;V<K;V++){const fe=h[V];if(V===w){const ee=o($);switch($){case fe.left:if(ee>-1)return`typeof prevStates[${ee}] === 'object' ? prevStates[${ee}].product : new Matrix(${$.rows}, ${$.columns})`;case fe.right:if(ee>-1)return`typeof prevStates[${ee}] === 'object' ? prevStates[${ee}].product : new Matrix(${$.rows}, ${$.columns})`;case fe.product:return`new Matrix(${$.rows}, ${$.columns})`;default:throw Error("unknown state")}}if($===fe.product)return`states[${V}].product`;if($===fe.right)return`states[${V}].right`;if($===fe.left)return`states[${V}].left`}return""}function _($,w){if(!$||!$.rows||!$.columns)return"null";if($===n.outputConnector)return"json.outputConnector";if($===n.output)return"json.output";for(let V=0,K=n.hiddenLayers.length;V<K;V++){const fe=n.hiddenLayers[V];for(const ee in fe)if(fe.hasOwnProperty(ee)&&fe[ee]===$)return`json.hiddenLayers[${V}].${ee}`}return S($,w)}function P(){return i?v===1?i===d?`function lookupInput(input) {
            var table = ${JSON.stringify(i)};
            var result = [];
            for (var p in table) {
              if (!input.hasOwnProperty(p)) break;
              result.push(Float32Array.from([input[p]]));
            }
            return result;
          }`:`function lookupInput(input) {
          var table = ${JSON.stringify(i)};
          var result = [];
          for (var p in table) {
            result.push(Float32Array.from([input[p]]));
          }
          return result;
        }`:`function lookupInput(rawInputs) {
        var table = ${JSON.stringify(i)};
        var result = [];
        for (var i = 0; i < rawInputs.length; i++) {
          var rawInput = rawInputs[i];
          var input = new Float32Array(${p});
          for (var p in table) {
            input[table[p]] = rawInput.hasOwnProperty(p) ? rawInput[p] : 0;
          }
          result.push(input);
        }
        return result;
      }`:""}function I(){return d?v===1?i===d?`function lookupOutputPartial(output, input) {
            var table = ${JSON.stringify(d)};
            var offset = input.length;
            var result = {};
            var i = 0;
            for (var p in table) {
              if (i++ < offset) continue;
              result[p] = output[table[p] - offset][0];
            }
            return result;
          }`:`function lookupOutput(output) {
          var table = ${JSON.stringify(d)};
          var result = {};
          for (var p in table) {
            result[p] = output[table[p]][0];
          }
          return result;
        }`:`function lookupOutput(output) {
        var table = ${JSON.stringify(d)};
        var result = {};
        for (var p in table) {
          result[p] = output[table[p]];
        }
        return result;
      }`:""}function k($){const w=$.toString().split("{");w.shift();const K=w.join("{").split("}");return K.pop(),K.join("}").split(`
`).join(`
        `).replace("product.deltas[i] = 0;","").replace("product.deltas[column] = 0;","").replace("left.deltas[leftIndex] = 0;","").replace("right.deltas[rightIndex] = 0;","").replace("product.deltas = left.deltas.slice(0);","")}function T($){return`src/recurrent/matrix/${$.replace(/[A-Z]/g,function(w){return`-${w.toLowerCase()}`})}.js`}const L=[],D={},z=[];for(let $=0,w=h.length;$<w;$++){const V=h[$];L.push(`states[${$}] = {
      name: '${V.forwardFn.name}',
      left: ${V.left?_(V.left,$):"undefined"},
      right: ${V.right?_(V.right,$):"undefined"},
      product: ${_(V.product,$)}
    }`);const K=V.forwardFn.name;D[K]||(D[K]=!0,V.name==="input"?(z.push(`case '${K}':`),z.push(i&&v===1?"product.weights = _i < input.length ? input[_i]: prevStates[prevStates.length - 1].product.weights;":v===1?"product.weights = [input[_i]];":"product.weights = input[_i];"),z.push("break;")):z.push(`        case '${K}':${K!=="forwardFn"?` //compiled from ${T(K)}`:""}
          ${k(V.forwardFn.toString())}
          break;`))}const re=v===1&&this.outputLookup,he=`
  var input = ${this.inputLookup?"lookupInput(rawInput)":"rawInput"};
  var json = ${a};
  var output = [];
  var states = [];
  var prevStates;
  var state;
  var max = ${re?i===d?p:`input.length + ${y-1}`:"input.length"};
  for (var _i = 0; _i < max; _i++) {
    prevStates = states;
    states = [];
    ${L.join(`;
    `)};
    for (var stateIndex = 0, stateMax = ${L.length}; stateIndex < stateMax; stateIndex++) {
      state = states[stateIndex];
      var product = state.product;
      var left = state.left;
      var right = state.right;

      switch (state.name) {
${z.join(`
`)}
      }
    }
    ${v===1&&i?"if (_i >= input.length - 1) { output.push(state.product.weights); }":"output = state.product.weights;"}
  }
  ${d?d===i?"return lookupOutputPartial(output, input)":"return lookupOutput(output)":v===1?"return output[0]":"return output"};
  ${P()}
  ${I()}

  function Matrix(rows, columns) {
    this.rows = rows;
    this.columns = columns;
    this.weights = new Float32Array(rows * columns);
  }
  ${es.toString().replace("_2.default","Matrix")}
  ${ae.toString()}
  ${Ks.toString()}
  ${js.toString()}`;return new Function("rawInput",t?t(he):he)}}const _h={...li};class vo extends ts{getHiddenLayer(t,n){return go(t,n)}getEquation(t,n,i,p){return yo(t,n,i,p)}}class wo extends Ii{getHiddenLayer(t,n){return So(t,n)}getEquation(t,n,i,p){return To(t,n,i,p)}}function So(g,t){return{inputMatrix:new mn(g,t,.08),inputHidden:new mn(g,g,.08),inputBias:new At(g,1),forgetMatrix:new mn(g,t,.08),forgetHidden:new mn(g,g,.08),forgetBias:new At(g,1),outputMatrix:new mn(g,t,.08),outputHidden:new mn(g,g,.08),outputBias:new At(g,1),cellActivationMatrix:new mn(g,t,.08),cellActivationHidden:new mn(g,g,.08),cellActivationBias:new At(g,1)}}function To(g,t,n,i){if(!i.inputMatrix||!i.inputHidden||!i.inputBias||!i.forgetMatrix||!i.forgetHidden||!i.forgetBias||!i.outputMatrix||!i.outputHidden||!i.outputBias||!i.cellActivationMatrix||!i.cellActivationHidden||!i.cellActivationBias)throw new Error("hiddenLayer does not have expected properties");const p=g.sigmoid.bind(g),d=g.add.bind(g),y=g.multiply.bind(g),v=g.multiplyElement.bind(g),m=g.tanh.bind(g),l=p(d(d(y(i.inputMatrix,t),y(i.inputHidden,n)),i.inputBias)),h=p(d(d(y(i.forgetMatrix,t),y(i.forgetHidden,n)),i.forgetBias)),a=p(d(d(y(i.outputMatrix,t),y(i.outputHidden,n)),i.outputBias)),o=m(d(d(y(i.cellActivationMatrix,t),y(i.cellActivationHidden,n)),i.cellActivationBias)),S=v(h,n),_=v(l,o),P=d(S,_);return v(a,m(P))}class Eo extends ts{getHiddenLayer(t,n){return So(t,n)}getEquation(t,n,i,p){return To(t,n,i,p)}}function Ih(g,t){const n=[];for(;g<t;g++)n.push(g);return n}function Lh(g){return Array.isArray(g)?Float32Array.from(g):Float32Array.from(Object.values(g))}function Oh({pixelX:g,pixelY:t,radius:n,inputs:i,row:p,line:d,fontSize:y,fontClassName:v}){let m=`<rect
              x="${g/2-n}"
              y="${t/2+p*t-n}"
              width="${2*n}"
              height="${2*n}"
              stroke="black"
              stroke-width="1"
              fill="${i.color}"
              class="${i.className}" />
            <line
              x1="${g/4}"
              y1="${t/2+p*t}"
              x2="${g/2-n}"
              y2="${t/2+p*t}"
              style="stroke:${d.color};stroke-width:${d.width}"
              class="${d.className}" />`;return i.labels&&(m+=`<text
              x="${g/8}"
              y="${t/2+p*t-5}"
              fill="black"
              font-size="${y}"
              class="${v}">${i.labels[p]}</text>`),m}function Ah({pixelX:g,pixelY:t,row:n,column:i,radius:p,hidden:d}){return`<circle
            cx="${g/2+i*g}"
            cy="${t/2+n*t}"
            r="${p}"
            stroke="black"
            stroke-width="1"
            fill="${d.color}"
            class="${d.className}" />`}function Rh({pixelX:g,pixelY:t,row:n,column:i,line:p,outputs:d,radius:y}){return`<circle
            cx="${g/2+i*g}"
            cy="${t/2+n*t}"
            r="${y}"
            stroke="black"
            stroke-width="1"
            fill="${d.color}"
            class="${d.className}" />
          <line
            x1="${g/2+i*g+y}"
            y1="${t/2+n*t}"
            x2="${g/2+i*g+g/4}"
            y2="${t/2+n*t}"
            style="stroke:${p.color};stroke-width:${p.width}"
            class="${p.className}" />`}function kh({pixelX:g,pixelY:t,row:n,column:i,radius:p,lineY:d,line:y,previousConnectionIndex:v}){return`<line
            x1="${g/2+(i-1)*g+p}"
            y1="${d/2+v*d}"
            x2="${g/2+i*g-p}"
            y2="${t/2+n*t}"
            style="stroke:${y.color};stroke-width:${y.width}"
            class="${y.className}" />`}function Gs(g){const{sizes:t,height:n,width:i}=g;let p="";const d=i/t.length;for(let y=0;y<t.length;y++){const v=t[y],m=n/v;for(let l=0;l<v;l++)if(y===0)p+=Oh({pixelX:d,pixelY:m,row:l,...g});else{y===t.length-1?p+=Rh({pixelX:d,pixelY:m,row:l,column:y,...g}):p+=Ah({pixelX:d,pixelY:m,row:l,column:y,...g});const h=t[y-1],a=n/h;for(let o=0;o<h;o++)p+=kh({pixelX:d,pixelY:m,row:l,column:y,lineY:a,previousConnectionIndex:o,...g})}}return p}function Dh({pixelX:g,pixelY:t,row:n,column:i,radius:p,recurrentLine:d}){const y=g/2+i*g+p+1,v=t/2+n*t,m=y-p*2-2,l=v,h=m+100,a=l+50,o=y-100,S=v+50;return`<path
              d="M ${y} ${v} C ${h} ${a}, ${o} ${S}, ${m} ${l}"
              stroke="${d.color}"
              stroke-width="${d.width}"
              fill="transparent"
              stroke-linecap="round"
              marker-end="url(#arrow)"
              class="${d.className}" />`}function Co(g){const{width:t,height:n,recurrentLine:i,sizes:p,radius:d}=g,y=t/p.length;let v=`<defs>
              <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">
                <path d="M0,0 L0,6 L9,3 z" fill="${i.color}" />
              </marker>
            </defs>`;v+=Gs(g);for(let m=1;m<p.length;m++){const l=p[m],h=n/l;for(let a=0;a<l;a++)v+=Dh({pixelX:y,pixelY:h,row:a,column:m,radius:d,recurrentLine:i})}return v}function Mh(g){const{options:t}=g;if(!t)throw new Error("options not defined");if(!t.inputLayer)throw new Error("options.inputLater not defined");if(!t.hiddenLayers)throw new Error("options.hiddenLayers not defined");if(t.hiddenLayers.length<1)throw new Error("options.hiddenLayers is empty");if(!t.outputLayer)throw new Error("options.outputLayer not defined");const n=t.inputLayer(),i=[];i.push(t.hiddenLayers[0](n,0));for(let d=1;d<t.hiddenLayers.length;d++)i.push(t.hiddenLayers[d](i[d-1],d));const p=t.outputLayer(i[i.length-1],i.length);return{inputSize:n.height,hiddenLayers:i.map(d=>d.height),outputSize:p.height}}function Ph(g){const t=[],{options:n}=g;if(!n.inputLayer)throw new Error("inputLayer not defined");if(!n.outputLayer)throw new Error("outputLayer not defined");const i=n.inputLayer();t.push(n.hiddenLayers[0](i,ro(),0));for(let d=1;d<n.hiddenLayers.length;d++)t.push(n.hiddenLayers[d](t[d-1],ro(),d));const p=n.outputLayer(t[t.length-1],-1);return{inputSize:i.height,hiddenLayers:t.map(d=>d.height),outputSize:p.height}}function ns(g,t,n){return`<svg
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            version="1.1"
            width="${t}"
            height="${n}">${g}</svg>`}function zh(g){return g.sizes}function Nh(g){const{options:t,sizes:n}=g,{inputSize:i,outputSize:p,hiddenLayers:d}=t;if(!n){if(typeof i=="number"&&i<1)throw new Error("inputSize not set");if(typeof p=="number"&&p<1)throw new Error("outputSize not set");if(d!=null&&d.some(y=>y<1))throw new Error("hiddenLayers not set")}return typeof i=="number"&&Array.isArray(d)&&typeof p=="number"?[i].concat(d).concat([p]):n}function $o(g){const{options:t}=g,{inputSize:n,outputSize:i,hiddenLayers:p}=t;return[n].concat(p).concat([i])}function Fh(){return{line:{width:.5,color:"black",className:"connection"},recurrentLine:{width:1,color:"red",className:"recurrence"},inputs:{color:"rgba(0, 128, 0, 0.5)",labels:null,className:"input"},outputs:{color:"rgba(100, 149, 237, 0.5)",className:"output"},hidden:{color:"rgba(255, 127, 80, 0.5)",className:"hidden-neuron"},fontSize:"14px",fontClassName:"label",radius:8,width:400,height:250,sizes:[]}}function Vh(g,t){const n={...Fh(),...t},{width:i,height:p,inputs:d}=n;let y=[];if(g instanceof Ze||g instanceof Be)y=Nh(g);else if(g instanceof po){const{inputSize:v,hiddenLayers:m,outputSize:l}=Ph(g);y=[v].concat(m).concat([l])}else if(g instanceof Ci){const{inputSize:v,hiddenLayers:m,outputSize:l}=Mh(g);y=[v].concat(m).concat([l])}else{if(g instanceof Ii||g instanceof wo||g instanceof mo||g instanceof ts||g instanceof Eo||g instanceof vo)return ns(Co({...n,sizes:rs($o(g),d.labels)}),i,p);if(g.hasOwnProperty("type"))switch(g.type){case"NeuralNetwork":case"NeuralNetworkGPU":return ns(Gs({...n,sizes:rs(zh(g),d.labels)}),i,p);case"RNN":case"GRU":case"LSTM":case"RNNTimeStep":case"GRUTimeStep":case"LSTMTimeStep":return ns(Co({...n,sizes:rs($o(g),d.labels)}),i,p);default:throw new Error("unrecognized network")}else if(g.hasOwnProperty("inputSize")&&g.hasOwnProperty("hiddenLayers")&&g.hasOwnProperty("outputSize")){const{inputSize:v,hiddenLayers:m,outputSize:l}=g;y=[v,...m,l]}else if(g.hasOwnProperty("sizes"))y=g.sizes;else throw new Error("unrecognized network")}return ns(Gs({...n,sizes:rs(y,d.labels)}),i,p)}function rs(g,t){if(!g)throw new Error("sizes not set");if(g.some(n=>n<1))throw new Error("sizes not set correctly");if(t&&t.length!==g[0])throw new Error("not enough labels for inputs");return g}const jh={RNNTimeStep:ts,LSTMTimeStep:Eo,GRUTimeStep:vo,RNN:Ii,LSTM:wo,GRU:mo},Kh={max:ye,mse:Ce,ones:Ha,ones2D:Xa,random:Ae,randomWeight:oe,randos:Se,range:Ih,toArray:Lh,DataFormatter:xr,zeros:De,toSVG:Vh};u.AE=Ne,u.CrossValidate=He,u.FeedForward=Ci,u.NeuralNetwork=Ze,u.NeuralNetworkGPU=Be,u.Recurrent=po,u.activation=W,u.layer=Fs,u.layerTypes=$r,u.likely=lh,u.lookup=X,u.praxis=bn,u.recurrent=jh,u.utilities=Kh,Object.defineProperty(u,"__esModule",{value:!0})})}(Ni,Ni.exports)),Ni.exports}var Wx=Ux();const _a=()=>new Wx.NeuralNetwork({activation:"leaky-relu",hiddenLayers:[128,64],learningRate:.01}),Hx=(e,r="tic-tac-toe-ai-model")=>{const u=e.toJSON();localStorage.setItem(r,JSON.stringify(u))},Xx=(e="tic-tac-toe-ai-model")=>{const r=localStorage.getItem(e);if(!r)return null;const u=_a();return u.fromJSON(JSON.parse(r)),u},Yu=e=>e.map(r=>r==="X"?1:r==="O"?-1:0),Yx=e=>{const r=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const[u,c,f]of r)if(e[u]&&e[u]===e[c]&&e[u]===e[f])return e[u];return null},Jx=e=>new Promise(r=>setTimeout(r,e)),qx=async(e,r=2e3,u=()=>{})=>{const A=Array(9).fill(0),R=Array(9).fill(0);e.train([{input:A,output:R}],{iterations:1,log:!1});const M=()=>{let j=Array(9).fill(null),B="X",H=[];for(;;){if(B==="X"){const W=j.map((Y,Z)=>Y===null?Z:null).filter(Y=>Y!==null);if(W.length===0)break;const J=Math.floor(Math.random()*W.length),G=W[J];j[G]="X",H.push({board:[...j],move:G,player:"X"}),B="O"}else{const W=Yu(j);let J;try{J=e.run(W)}catch{J=Array(9).fill(Math.random())}let G=-1,Y=-1/0;for(let Z=0;Z<9;Z++)j[Z]===null&&J[Z]>Y&&(Y=J[Z],G=Z);if(G===-1||j[G]!==null){const Z=j.map((X,ne)=>X===null?ne:null).filter(X=>X!==null);if(Z.length>0)G=Z[Math.floor(Math.random()*Z.length)];else break}j[G]="O",H.push({board:[...j],move:G,player:"O"}),B="X"}const q=Yx(j);if(q)return{winner:q,history:H};if(!j.includes(null))return{winner:null,history:H}}return{winner:null,history:[]}},F=50;for(let j=0;j<r;j+=F){const B=Math.min(j+F,r);for(let q=j;q<B;q++){const{winner:W,history:J}=M();for(let G=0;G<J.length;G++){const{board:Y,move:Z,player:X}=J[G],ne=Yu(Y);try{const te=[...e.run(ne)];let se=0;G===J.length-1?X==="O"&&(se=W==="O"?1:W==="X"?-1:.5):se=.01,te[Z]=se,e.train([{input:ne,output:te}],{iterations:1,errorThresh:.001,log:!1})}catch(Q){console.error("Training error at episode",q,"step",G,Q)}}}const H=Math.round(Math.min(j+F,r)/r*100);u(H),await Jx(0)}return u(100),e},Qx=()=>{const[e,r]=b.useState(Array(9).fill(null)),[u,c]=b.useState(!0),[f,E]=b.useState(null),[C,A]=b.useState(!1),[R,M]=b.useState(!1),[F,j]=b.useState(0),[B,H]=b.useState(0),[q,W]=b.useState(0),[J,G]=b.useState(!1),[Y,Z]=b.useState(null),[X,ne]=b.useState("idle"),[Q,te]=b.useState(0),[se,le]=b.useState("medium");b.useEffect(()=>{const oe=Xx();if(oe)Z(oe),ne("completed"),te(100);else{const ae=_a();Z(ae),ie(ae)}},[]),b.useEffect(()=>{console.log("Current state:",{isPlayerTurn:u,winner:f,isDraw:C,aiThinking:R,trainingStatus:X})},[u,f,C,R,X]);const ie=b.useCallback(async oe=>{ne("training"),te(0);try{const ae=await qx(oe,2e3,be=>te(be));Z(ae),Hx(ae),ne("completed")}catch(ae){console.error("Training failed:",ae),ne("idle")}},[]),pe=b.useCallback(()=>{const oe=_a();Z(oe),ie(oe)},[ie]),ve=b.useCallback(oe=>{const ae=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(let be=0;be<ae.length;be++){const[Le,Ie,Ae]=ae[be];if(oe[Le]&&oe[Le]===oe[Ie]&&oe[Le]===oe[Ae])return oe[Le]}return null},[]),de=b.useCallback(oe=>{if(e[oe]||f||C||!u||R||X==="training")return;const ae=[...e];ae[oe]="X",r(ae);const be=ve(ae);if(be){E(be),H(Le=>Le+1);return}if(!ae.includes(null)){A(!0),W(Le=>Le+1);return}c(!1),X==="completed"&&M(!0)},[e,f,C,u,R,X,ve]),me=b.useCallback((oe,ae)=>{const be=[];for(let Le=0;Le<9;Le++)if(oe[Le]===null){const Ie=[...oe];Ie[Le]=ae,ve(Ie)===ae&&be.push(Le)}return be},[ve]),Ee=b.useCallback(()=>{!Y||u||f||C||X!=="completed"||(M(!0),setTimeout(()=>{const oe=e.map(Se=>Se==="X"?1:Se==="O"?-1:0);let ae;try{ae=Y.run(oe)}catch(Se){console.error("AI prediction error:",Se),ae=Array(9).fill(0)}let be=-1,Le=e.map((Se,ke)=>ke).filter(Se=>e[Se]===null);if(Le.length===0){A(!0),W(Se=>Se+1),M(!1);return}if(se==="medium"){const Se=me(e,"O");if(Se.length>0)be=Se[0];else{const ke=me(e,"X");if(ke.length>0)be=ke[0];else{const Me=Le.map(De=>({idx:De,value:ae[De]})).sort((De,Ke)=>Ke.value-De.value);be=Math.random()<.7?Me[0].idx:Me[Math.floor(Math.random()*Me.length)].idx}}}else be=Le.reduce((Se,ke)=>ae[ke]>ae[Se]?ke:Se,Le[0]);const Ie=[...e];Ie[be]="O",r(Ie);const Ae=ve(Ie);Ae?(E(Ae),j(Se=>Se+1)):Ie.includes(null)?c(!0):(A(!0),W(Se=>Se+1)),M(!1)},500))},[Y,e,u,f,C,X,se,ve,me]);b.useEffect(()=>{!u&&!f&&!C&&X==="completed"&&Ee()},[u,f,C,R,X,Ee]);const ye=b.useCallback(()=>{r(Array(9).fill(null)),c(!0),E(null),A(!1),M(!1)},[]),Ce=b.useCallback(oe=>{le(oe),ye()},[ye]);return b.useEffect(()=>{X==="completed"&&ye()},[X,ye]),xe.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 to-purple-100 py-8 px-4 sm:px-6",children:xe.jsxs("div",{className:"max-w-4xl mx-auto",children:[xe.jsx(Mx,{}),xe.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[xe.jsx("div",{className:"lg:col-span-2 bg-white rounded-2xl shadow-xl p-4 sm:p-6",children:X==="training"?xe.jsx(Bx,{trainingProgress:Q}):xe.jsxs(xe.Fragment,{children:[xe.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 sm:mb-6 gap-3",children:[xe.jsx("div",{className:"text-lg sm:text-xl font-semibold text-gray-800 min-h-[28px] sm:min-h-[32px]",children:R?xe.jsxs("span",{className:"flex items-center text-purple-600",children:[xe.jsx("span",{className:"animate-pulse mr-2 text-lg",children:"⏳"})," ","هوش مصنوعی در حال فکر کردن..."]}):X==="training"?xe.jsxs("span",{className:"flex items-center text-indigo-600",children:[xe.jsx("span",{className:"animate-spin mr-2",children:"🌀"})," در حال آموزش هوش مصنوعی..."]}):f?xe.jsx("span",{className:f==="X"?"text-green-600":"text-red-600",children:f==="X"?"🎉 شما برنده شدید!":"🤖 هوش مصنوعی برنده شد!"}):C?xe.jsx("span",{className:"text-yellow-600",children:"😐 بازی مساوی شد!"}):xe.jsx("span",{className:u?"text-green-600":"text-gray-500",children:u?"نوبت شما (X)":"نوبت هوش مصنوعی (O)"})}),xe.jsx(Ur,{type:"primary",icon:xe.jsx(D0,{}),onClick:ye,disabled:X==="training",className:"w-full sm:w-auto",children:"بازی جدید"})]}),xe.jsx(Px,{board:e,handlePlayerMove:de,isPlayerTurn:u,winner:f,isDraw:C,aiThinking:R,playerWins:B,aiWins:F,draws:q})]})}),xe.jsx(jx,{aiLevel:se,changeAiLevel:Ce,trainingProgress:Q,trainingStatus:X,retrainAI:pe,showStats:J,setShowStats:G})]}),J&&xe.jsx(Kx,{})]})})};export{Qx as default};
